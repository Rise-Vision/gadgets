var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{};RiseVision.Common.Settings={};RiseVision.Common.Picker={};RiseVision.Common.Visualization={};RiseVision.Common.Financial={};RiseVision.Common.Financial.Helper={};RiseVision.Common.Financial.RealTime={};RiseVision.Common.Financial.Historical={};RiseVision.Common.Financial.Historical.CollectionTimes={};RiseVision.Common.HorizontalScroll={};RiseVision.Common.Item={};RiseVision.Common.Scroller={};RiseVision.Common.Authorization={};
RiseVision.Common.Font={};RiseVision.Common.Utility={};RiseVision.Common.Settings=function(){};RiseVision.Common.Settings.prototype.validateRequired=function(a,c,b){if(a.is(":visible")){if($.trim(a.val()))return!1;c.innerHTML+=b+" is a required field.<br />";return!0}return!1};RiseVision.Common.Settings.prototype.validateNumeric=function(a,c,b){return a.is(":visible")&&isNaN(a.val())?(c.innerHTML+="The "+b+" field must contain only numbers.<br />",!0):!1};RiseVision.Common.Picker=function(){};
RiseVision.Common.Picker.prototype.showPicker=function(a,c){gadgets.rpc.call("","rscmd_openGooglePicker",null,a,c)};
RiseVision.Common.Picker.prototype.getSheets=function(a){var c,b,d=[];$.getJSON(encodeURI("https://spreadsheets.google.com/feeds/worksheets/"+a.docID+"/public/basic?alt=json&dummy="+Math.ceil(100*Math.random()))).done(function(e){for(var f=0;f<e.feed.entry.length;f++)c=document.createElement("option"),c.text=e.feed.entry[f].title.$t,b=e.feed.entry[f].link[2].href,b=b.replace("&pub=1",""),-1==b.indexOf("/gviz/")?c.value=b:c.value=b.replace("spreadsheets.google.com","docs.google.com"),d.push(c);a.callback(d)}).fail(function(b,
c,d){$(".errors").empty();$(".errors").append("To use this spreadsheet, it first needs to be published to the web. From the Google Spreadsheet menu, select <em>File > Publish to the web</em>, and then click the <em>Start Publishing</em> button. Once done, select your file from the Google Drive link again.");$(".errors").css("display","inline-block");$("li.more").hide();console.log(b.status+" - "+b.statusText);console.log(b.responseText);a.callback(null)})};
RiseVision.Common.Picker.prototype.getURL=function(a){var c="",c=a.baseURL;""!=a.headerRows&&(c+="&headers="+a.headerRows);""!=a.range&&(c+="&range="+a.range);return c};RiseVision.Common.Visualization=function(){this.query=null;this.isVisualizationLoaded=!1};
RiseVision.Common.Visualization.prototype.getData=function(a){this.url=a.url;this.refreshInterval=a.refreshInterval;this.timeout=a.timeout||30;this.callback=a.callback;this.params=a.params;a.queryString&&(this.queryString=a.queryString);this.isVisualizationLoaded?this.sendQuery():this.loadVisualizationAPI()};RiseVision.Common.Visualization.prototype.loadVisualizationAPI=function(){var a=this;google.load("visualization","1",{callback:function(){a.isVisualizationLoaded=!0;a.sendQuery()}})};
RiseVision.Common.Visualization.prototype.sendQuery=function(){var a=this;null!=this.query&&this.query.abort();this.query=new google.visualization.Query(this.url);this.query.setRefreshInterval(this.refreshInterval);this.query.setTimeout(this.timeout);this.queryString&&this.query.setQuery(this.queryString);this.query.send(function(c){a.onQueryExecuted(c)})};
RiseVision.Common.Visualization.prototype.onQueryExecuted=function(a){null==a?this.callback(a,this.params):a.isError()?(console.log("Message: "+a.getMessage()),console.log("Detailed message: "+a.getDetailedMessage()),console.log("Reasons: "+a.getReasons()),this.callback(null,this.params)):this.callback(a.getDataTable(),this.params)};RiseVision.Common.Financial.Helper=function(a){this.instruments=a};RiseVision.Common.Financial.Helper.prototype.setInstruments=function(a){this.instruments=a};
RiseVision.Common.Financial.Helper.prototype.getInstruments=function(a,c){var b=this;if(a)return this.instruments.join("|");var d=(new Date).getDay(),e=c.length,f=[];$.each(this.instruments,function(a,g){for(var k=0;k<e;k++)if(g==c[k].instrument){var l=c[k].startTime,m=c[k].endTime;$.each(c[k].daysOfWeek,function(c,e){if(e==d)return(new Date).between(l,m)&&f.push(b.instruments[a]),!1})}});return f.join("|")};
RiseVision.Common.Financial.RealTime=function(a,c){this.displayID=a?a:"preview";c=c.split(",");$.each(c,function(a,d){c[a]=$.trim(c[a])});this.instruments=c;this.isLoading=!0;this.conditions={};this.collectionTimes=[];this.updateInterval=6E4;this.now=Date.today();this.url="http://contentfinancial2.appspot.com/data?";this.logosURL="https://s3.amazonaws.com/risecontentlogos/financial/";this.viz=new RiseVision.Common.Visualization;this.helper=new RiseVision.Common.Financial.Helper(this.instruments)};
RiseVision.Common.Financial.RealTime.prototype.setInstruments=function(a){a=a.split(",");$.each(a,function(c,b){a[c]=$.trim(a[c])});this.isLoading=!0;this.collectionTimes=[];this.instruments=a;this.helper.setInstruments(this.instruments)};
RiseVision.Common.Financial.RealTime.prototype.getData=function(a,c,b,d){var e=this,f=!1,h=0,g="select instrument",k="";this.dataFields={};this.dataFields.instrument=0;this.startTimeIndex=1;this.isLoading&&(this.callback=d);$.each(a,function(a,b){f=!1;"instrument"!=b&&($.each(e.dataFields,function(a,c){if(a==b)return f=!0,!1}),f||(g+=", "+b,e.dataFields[b]=h+1,h++,e.startTimeIndex++))});this.logoCount=0;g+=", startTime, endTime, daysOfWeek, timeZoneOffset";if(!Date.equals(Date.today(),this.now))for(this.now=
Date.today(),k=0;k<this.collectionTimes.length;k++)this.collectionTimes[k].startTime.addDays(1),this.collectionTimes[k].endTime.addDays(1);(k=this.helper.getInstruments(this.isLoading,this.collectionTimes))?(e=this,k={url:this.url+"id="+this.displayID+"&codes="+k,refreshInterval:0,queryString:g,callback:function(a){e.onRealTimeDataLoaded(a,c,b)}},this.getDataTimer=setTimeout(function(){e.getData(a,c,b,d)},this.updateInterval),this.viz.getData(k)):d(null)};
RiseVision.Common.Financial.RealTime.prototype.onRealTimeDataLoaded=function(a,c,b){null!=a?(clearTimeout(this.getDataTimer),this.data=a,this.isLoading?(this.isLoading=!1,0==this.collectionTimes.length&&this.saveCollectionTimes(),c?this.loadLogos():this.callback&&this.callback(this.data,this.logoURLs)):c&&b?this.loadLogos():this.callback&&this.callback(this.data,this.logoURLs)):(console.log("Error encountered loading real-time data for: "),console.log(this.instruments[0]))};
RiseVision.Common.Financial.RealTime.prototype.saveCollectionTimes=function(){var a,c,b,d;a=this.data.getNumberOfRows();if(1==this.instruments.length&&1<this.data.getNumberOfRows())"INVALID_SYMBOL"!=this.data.getValue(0,0)&&("..."==this.data.getValue(0,0)?this.isLoading=!0:(c=this.data.getValue(0,this.startTimeIndex+3),b=this.data.getValue(0,this.startTimeIndex),d=this.data.getValue(0,this.startTimeIndex+1),b&&d&&"N/P"!=c&&this.collectionTimes.push({instrument:this.instruments[0],startTime:b.setTimezoneOffset(c),
endTime:d.setTimezoneOffset(c),daysOfWeek:this.data.getFormattedValue(0,this.startTimeIndex+2).split(",")})));else{for(var e=0;e<a;e++)"INVALID_SYMBOL"!=this.data.getValue(e,0)&&("..."==this.data.getValue(e,0)?this.isLoading=!0:(c=this.data.getValue(e,this.startTimeIndex+3),b=this.data.getValue(e,this.startTimeIndex),d=this.data.getValue(e,this.startTimeIndex+1),b&&d&&"N/P"!=c&&this.collectionTimes.push({instrument:this.instruments[e],startTime:b.setTimezoneOffset(c),endTime:d.setTimezoneOffset(c),
daysOfWeek:this.data.getFormattedValue(e,this.startTimeIndex+2).split(",")})));0==this.collectionTimes.length&&console.log(this.collectionTimes)}};RiseVision.Common.Financial.RealTime.prototype.loadLogos=function(){var a=this.data.getNumberOfRows();this.logoCount=0;this.urls=[];this.logoURLs=[];for(var c=0;c<a;c++)this.urls.push(this.logosURL+this.data.getFormattedValue(c,0)+".svg");this.loadLogo(this.urls.length)};
RiseVision.Common.Financial.RealTime.prototype.loadLogo=function(a){var c,b=this;c=new Image;c.onload=function(){b.logoURLs.push(c.src);b.onLogoLoaded(a)};c.onerror=function(){b.logoURLs.push(null);b.onLogoLoaded(a)};c.src=this.urls[this.logoCount]};RiseVision.Common.Financial.RealTime.prototype.onLogoLoaded=function(a){this.logoCount++;a--;0==a?this.callback&&this.callback(this.data,this.logoURLs):this.loadLogo(a)};
RiseVision.Common.Financial.RealTime.prototype.checkSigns=function(a){var c=0,b=[],d,c=0;for(numRows=this.data.getNumberOfRows();c<numRows;c++)d=this.data.getValue(c,this.dataFields[a]),isNaN(d)&&(d=d.replace(/[^0-9\.-]+/g,""),d=parseFloat(d)),isNaN(d)||(d=0<=d?1:-1,b.push(d));return b};
RiseVision.Common.Financial.RealTime.prototype.compare=function(a){var c=this,b=0,d=0,e=[],f=!1;if(this.conditions[a])for(row=0,numRows=this.data.getNumberOfRows();row<numRows;row++)b=this.data.getValue(row,this.dataFields[a]),f=!1,$.each(this.conditions[a],function(a,g){if(g.instrument==c.data.getValue(row,0))return d=g.value,isNaN(b)&&(b=b.replace(/[^0-9\.-]+/g,""),b=parseFloat(b)),isNaN(d)&&(d=d.replace(/[^0-9\.-]+/g,""),d=parseFloat(d)),isNaN(b)||isNaN(d)||(b!=d?b>d?e.push(1):e.push(-1):e.push(0)),
f=!0,!1}),f||e.push(0);this.saveBeforeValues([a]);return e};RiseVision.Common.Financial.RealTime.prototype.saveBeforeValues=function(a){var c=this;$.each(a,function(a,d){c.conditions[d]=[];c.saveBeforeValue(d,c.dataFields[d])})};RiseVision.Common.Financial.RealTime.prototype.saveBeforeValue=function(a,c){for(var b=0,d=this.data.getNumberOfRows();b<d;b++)this.conditions[a].push({instrument:this.data.getValue(b,0),value:this.data.getValue(b,c)})};
RiseVision.Common.Financial.Historical=function(a,c,b){this.displayID=a?a:"preview";this.instrument=c;this.duration=b;this.isLoading=!0;this.updateInterval=6E4;this.now=Date.today();this.url="http://contentfinancial2.appspot.com/data/historical?";this.historicalViz=new RiseVision.Common.Visualization;this.helper=new RiseVision.Common.Financial.Helper([this.instrument])};RiseVision.Common.Financial.Historical.prototype.setInstrument=function(a){this.isLoading=!0;this.instrument=a;this.helper.setInstruments([this.instrument])};
RiseVision.Common.Financial.Historical.prototype.setDuration=function(a){this.duration=a};RiseVision.Common.Financial.Historical.prototype.setIsUpdated=function(a){CollectionTimes.getInstance().setIsUpdated(this.instrument,a)};
RiseVision.Common.Financial.Historical.prototype.getHistoricalData=function(a,c,b){var d=this,e="select "+a.join()+" ORDER BY tradeTime",f="";b&&(b.sortOrder&&"desc"==b.sortOrder&&(e+=" desc"),b.limit&&(e+=" LIMIT "+b.limit));CollectionTimes.getInstance().addInstrument(this.instrument,this.now,function(h,g){d.now=g;(f=d.helper.getInstruments(d.isLoading,[h]))?(b={url:d.url+"id="+d.displayID+"&code="+d.instrument+"&kind="+d.duration,refreshInterval:0,queryString:e,callback:function(a){d.onHistoricalDataLoaded(a,
h,c)}},d.getHistoricalDataTimer=setTimeout(function(){d.getHistoricalData(a,c,b)},d.updateInterval),d.historicalViz.getData(b)):c(null)})};
RiseVision.Common.Financial.Historical.prototype.onHistoricalDataLoaded=function(a,c,b){var d=0;null!=a?(clearTimeout(this.getHistoricalDataTimer),this.historicalData=a,d=a.getNumberOfRows(),0==d||1==d&&"0"==a.getFormattedValue(0,0)?this.isLoading=!0:this.isLoading=!1,null!=this.historicalData?b({data:this.historicalData,collectionData:c}):b({collectionData:c})):(console.log("Error encountered loading historical data for: "),console.log(this))};
var CollectionTimes=function(){function a(){function a(c,f){var h=new RiseVision.Common.Visualization;collectionTimesTimer=setTimeout(function(){a(c,f)},6E4);h.getData({url:"http://contentfinancial2.appspot.com/info?codes="+c,refreshInterval:0,queryString:"select startTime, endTime, daysOfWeek, timeZoneOffset, updateInterval",callback:function(a,d){h=null;if(null!=a){clearTimeout(d);var l,m,n;if(null!=a){a.getNumberOfRows();for(var p=0;p<b.length;p++)if(b[p].instrument==c){n=a.getValue(0,3);l=a.getValue(0,
0);m=a.getValue(0,1);b[p].collectionTimes={instrument:c,startTime:l.setTimezoneOffset(n),endTime:m.setTimezoneOffset(n),daysOfWeek:a.getFormattedValue(0,2).split(","),timeZoneOffset:n,isUpdated:!0};break}}f()}else console.log("Error encountered loading collection times for: "+c)},params:collectionTimesTimer})}return{setIsUpdated:function(a,c){for(var d=0;d<b.length;d++)b[d].instrument==a&&null!=b[d].collectionTimes&&(b[d].collectionTimes.isUpdated=c)},addInstrument:function(c,f,h){for(var g=0,k=!1,
l=!1;g<b.length;g++)if(b[g].instrument==c){null!=b[g].collectionTimes&&(Date.equals(Date.today(),f)||b[g].collectionTimes.isUpdated||(f=Date.today(),b[g].collectionTimes.startTime.addDays(1),b[g].collectionTimes.endTime.addDays(1),b[g].collectionTimes.isUpdated=!0),l=!0);k=!0;break}l?h(b[g].collectionTimes,f):(k||b.push({instrument:c,collectionTimes:null}),a(c,function(){h(b[g].collectionTimes,f)}))}}}var c=!1,b=[];return{getInstance:function(){c||(c=a());return c}}}();
RiseVision.Common.HorizontalScroll=function(a,c){var b=[],d=0,e=!1,f={width:800,height:75,scrollBy:"item",scrollDirection:"rtl",speed:"medium",spacing:20,duration:1E4,interactivityTimeout:5E3};a&&$.extend(f,a);this.scroller=document.createElement("canvas");this.scroller.id="scroller";this.scroller.width=f.width;this.scroller.height=f.height;this.interactivityTimeout=f.interactivityTimeout;this.context=this.scroller.getContext("2d");this.data=c;this.isHolding=!1;this.isLoading=!0;this.items=[];this.previousItemIndex=
-1;this.currentItemIndex=this.itemCount=0;this.mouseMove=this.mouseDown=!1;this.lastMouseX=0;f.speed?"fastest"==f.speed?this.speed=5:"fast"==f.speed?this.speed=4:"medium"==f.speed?this.speed=3:"slow"==f.speed?this.speed=2:"slowest"==f.speed&&(this.speed=1):this.speed=3;"ltr"==f.scrollDirection&&(this.speed=-this.speed);this.getScrollBy=function(){return f.scrollBy};this.getScrollDirection=function(){return f.scrollDirection};this.getDuration=function(){return f.duration};this.getScroller=function(a){return b[a]};
this.getScrollers=function(){return b};this.getTotalPixels=function(){return d};this.getIsStopped=function(){return e};this.getInteractivityTimerID=function(){return null};this.getSpacing=function(){return f.spacing};this.setScroller=function(a,c){b[a]=c};this.setTotalPixels=function(a){d=a};this.setIsStopped=function(a){e=a};document.body.appendChild(this.scroller);window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){return window.setTimeout(a,1E3/60)}}();window.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout};
RiseVision.Common.HorizontalScroll.prototype.initialize=function(){var a=this;this.scroller.onmousemove=function(b){a.handleMouseMove(b)};this.scroller.onmousedown=function(b){a.handleMouseDown(b)};this.scroller.onmouseup=function(b){a.handleMouseUp(b)};this.scroller.onmouseout=function(b){a.handleMouseOut(b)};for(var c=0;2>c;c++)"rtl"==this.getScrollDirection()?this.setScroller(c,new RiseVision.Common.Scroller(c*this.scroller.width,this.scroller.width,this.scroller.height)):this.setScroller(c,new RiseVision.Common.Scroller(-c*
this.scroller.width,this.scroller.width,this.scroller.height));this.totalWidth=0;this.itemsCount=1;0<this.data.length&&this.loadItem()};RiseVision.Common.HorizontalScroll.prototype.loadItem=function(){var a=this;(new RiseVision.Common.Item(this.data[this.currentItemIndex],this.scroller,this.getSpacing(),this.getScrollDirection())).initialize(function(){a.items[a.currentItemIndex]=this;a.totalWidth+=this.getWidth();a.onItemInitialized()})};
RiseVision.Common.HorizontalScroll.prototype.onItemInitialized=function(){this.itemCount++;if(this.itemCount==this.data.length){for(var a=0;a<this.getScrollers().length;a++)this.adjustCanvas(a);this.currentItemIndex=0;readyEvent()}else this.currentItemIndex++,this.loadItem()};
RiseVision.Common.HorizontalScroll.prototype.adjustCanvas=function(a,c){var b=0,b=!1;c||(c=this.getScrollDirection());"rtl"==this.getScrollDirection()?"rtl"==c?this.getScroller(a).writeDirection="forward":this.getScroller(a).writeDirection="backward":"rtl"==c?this.getScroller(a).writeDirection="backward":this.getScroller(a).writeDirection="forward";if("item"==this.getScrollBy())for(this.getScroller(a).holdPositions=[],b=this.getItemPosition(this.getNextScrollerIndex(a),c);this.getScroller(a).totalPixelsCopied<
this.getScroller(a).canvas.width;)0==this.getScroller(a).totalPixelsCopied&&("rtl"==this.getScrollDirection()&&"rtl"==c||"ltr"==this.getScrollDirection()&&"rtl"==c?(this.getScroller(a).startCanvasIndex=this.currentItemIndex,this.getScroller(a).startCanvasItem=this.items[this.currentItemIndex]):(this.getScroller(a).endCanvasIndex=this.currentItemIndex,this.getScroller(a).endCanvasItem=this.items[this.currentItemIndex])),this.currentItemIndex!=this.previousItemIndex&&("rtl"==this.getScrollDirection()?
"rtl"==c?"forward"==this.getScroller(a).writeDirection&&this.getScroller(a).holdPositions.push({position:this.getScroller(a).writePosition,wasHeld:!1}):0!=b&&this.getScroller(a).holdPositions.push({position:this.getScroller(a).writePosition,wasHeld:!1}):this.getScroller(a).holdPositions.push({position:this.getScroller(a).writePosition,wasHeld:!1})),"rtl"==this.getScrollDirection()?"rtl"==c?(b=this.getScroller(a).drawCanvasFromStart(this.items[this.currentItemIndex].canvas,b,this.getScrollDirection()),
0==this.getScroller(a).endCanvasPosition&&0==this.getScroller(a).writePosition&&this.setNextItem(this.currentItemIndex),this.getScroller(a).endCanvasIndex=this.currentItemIndex,this.getScroller(a).endCanvasItem=this.items[this.currentItemIndex]):(b=this.getScroller(a).drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,b),this.getScroller(a).startCanvasIndex=this.currentItemIndex,this.getScroller(a).startCanvasItem=this.items[this.currentItemIndex]):"ltr"==c?(b=this.getScroller(a).drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,
b,this.getScrollDirection()),this.getScroller(a).startCanvasIndex=this.currentItemIndex,this.getScroller(a).startCanvasItem=this.items[this.currentItemIndex]):(b=this.getScroller(a).drawCanvasFromStart(this.items[this.currentItemIndex].canvas,b,this.getScrollDirection()),this.getScroller(a).endCanvasIndex=this.currentItemIndex,this.getScroller(a).endCanvasItem=this.items[this.currentItemIndex]),b&&("forward"==this.getScroller(a).writeDirection?this.setNextItem(this.currentItemIndex):this.setPreviousItem(this.currentItemIndex)),
b=0;else{for(b=this.getItemPosition(this.getNextScrollerIndex(a),c);this.getScroller(a).totalPixelsCopied<this.getScroller(a).canvas.width;)0==this.getScroller(a).totalPixelsCopied&&("rtl"==this.getScrollDirection()&&"rtl"==c||"ltr"==this.getScrollDirection()&&"rtl"==c?this.getScroller(a).startCanvasIndex=this.currentItemIndex:this.getScroller(a).endCanvasIndex=this.currentItemIndex),this.getScrollDirection(),(b="rtl"==c?this.getScroller(a).drawCanvasFromStart(this.items[this.currentItemIndex].canvas,
b,this.getScrollDirection()):this.getScroller(a).drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,b,this.getScrollDirection(),this.getScroller(this.getNextScrollerIndex(a)).writeDirection))&&("forward"==this.getScroller(a).writeDirection?this.setNextItem(this.currentItemIndex):this.setPreviousItem(this.currentItemIndex)),b=0;"rtl"==this.getScrollDirection()&&"rtl"==c||"ltr"==this.getScrollDirection()&&"rtl"==c?this.getScroller(a).endCanvasIndex=this.currentItemIndex:this.getScroller(a).startCanvasIndex=
this.currentItemIndex}this.isLoading=!1;this.getScroller(a).totalPixelsCopied=0};RiseVision.Common.HorizontalScroll.prototype.getItemPosition=function(a,c){this.getScrollDirection();return"rtl"==c?this.getPositionFromEnd(a,c):this.getPositionFromStart(a,c)};
RiseVision.Common.HorizontalScroll.prototype.getPositionFromStart=function(a,c){var b;b=this.getScroller(a).startCanvasPosition;this.currentItemIndex=this.getScroller(a).startCanvasIndex;"rtl"==this.getScrollDirection()&&"ltr"==c?0==b&&this.setPreviousItem(this.getScroller(a).startCanvasIndex):"ltr"==this.getScrollDirection()&&"ltr"==c&&(this.isLoading||0==b&&this.setNextItem(this.getScroller(a).startCanvasIndex));this.isLoading||(this.previousItemIndex=this.currentItemIndex);return b};
RiseVision.Common.HorizontalScroll.prototype.getPositionFromEnd=function(a,c){var b;this.currentItemIndex=this.getScroller(a).endCanvasIndex;b=this.getScroller(a).endCanvasPosition;"ltr"==this.getScrollDirection()&&"rtl"==c?b==this.items[this.currentItemIndex].canvas.width&&(this.setPreviousItem(this.getScroller(a).endCanvasIndex),b=0):"rtl"==this.getScrollDirection()&&"rtl"==c&&b==this.items[this.currentItemIndex].canvas.width&&(this.setNextItem(this.getScroller(a).endCanvasIndex),b=0);this.isLoading||
(this.previousItemIndex=this.currentItemIndex);return b};RiseVision.Common.HorizontalScroll.prototype.getNextScrollerIndex=function(a){a=++a;a>=this.getScrollers().length&&(a=0);return a};RiseVision.Common.HorizontalScroll.prototype.setNextItem=function(a){a=++a;a>=this.items.length&&(a=0);return this.currentItemIndex=a};RiseVision.Common.HorizontalScroll.prototype.setPreviousItem=function(a){a=--a;0>a&&(a=this.items.length-1);return this.currentItemIndex=a};
RiseVision.Common.HorizontalScroll.prototype.drawScene=function(){var a=this,c;if(!this.mouseDown&&!this.isStopped){this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var b=0;b<this.getScrollers().length;b++){var d=this.getScroller(b);d.x-=this.speed;c="rtl"==this.getScrollDirection()?d.x+this.scroller.width:d.x-this.scroller.width;0>c&&"rtl"==this.getScrollDirection()?(d.x=this.scroller.width,d.x-=-c,this.adjustCanvas(b)):0<c&&"ltr"==this.getScrollDirection()&&(d.x=-this.scroller.width,
d.x-=-c,this.adjustCanvas(b));this.drawCanvas(d.x,b)}this.setTotalPixels(this.getTotalPixels()+Math.abs(this.speed));0==this.totalWidth?(this.pause(),setTimeout(function(){0==a.totalWidth?$(a).trigger("done"):a.tick()},5E3)):this.getTotalPixels()>this.totalWidth&&(this.setTotalPixels(this.getTotalPixels()-this.totalWidth),$(this).trigger("done"))}};
RiseVision.Common.HorizontalScroll.prototype.drawSceneByItem=function(){if(!this.mouseDown&&!this.isStopped){for(var a=0,c=0;c<this.getScrollers().length;c++){var b=this.getScroller(c);if(0<b.holdPositions.length){for(var d=0;d<b.holdPositions.length;d++)if(b.x<=-b.holdPositions[d].position&&!b.holdPositions[d].wasHeld&&"rtl"==this.getScrollDirection()){a=b.x+b.holdPositions[d].position;b.x=-b.holdPositions[d].position;this.holdScroller(b,c,d);break}else if(b.x>=b.holdPositions[d].position&&!b.holdPositions[d].wasHeld&&
"ltr"==this.getScrollDirection()){a=b.x-b.holdPositions[d].position;b.x=b.holdPositions[d].position;this.holdScroller(b,c,d);break}else this.isHolding=!1;if(this.isHolding){b=this.getNextScrollerIndex(c);this.getScroller(b).x=this.getScroller(b).x-a;this.moveCanvas(c);this.drawCanvas(this.getScroller(b).x,b);break}}else this.isHolding=!1}if(!this.isHolding)for(this.context.clearRect(0,0,this.scroller.width,this.scroller.height),c=0;c<this.getScrollers().length;c++)b=this.getScroller(c),b.x-=this.speed,
this.moveCanvas(c),this.drawCanvas(b.x,c)}};RiseVision.Common.HorizontalScroll.prototype.holdScroller=function(a,c,b){a.holdPositions[b].wasHeld=!0;this.context.clearRect(0,0,this.scroller.width,this.scroller.height);this.moveCanvas(c);this.drawCanvas(a.x,c);this.setHoldTimer();this.isHolding=!0};
RiseVision.Common.HorizontalScroll.prototype.moveCanvas=function(a){var c=this.getScroller(a),b;b="rtl"==this.getScrollDirection()?c.x+this.scroller.width:c.x-this.scroller.width;0>b&&"rtl"==this.getScrollDirection()?(c.x=this.scroller.width,c.x-=-b,this.adjustCanvas(a)):0<b&&"ltr"==this.getScrollDirection()&&(c.x=-this.scroller.width,c.x-=-b,this.adjustCanvas(a))};
RiseVision.Common.HorizontalScroll.prototype.drawCanvas=function(a,c){var b=this.getScroller(c).canvas;this.context.save();this.context.translate(a,0);this.context.drawImage(b,0,0,b.width,b.height);this.context.restore()};
RiseVision.Common.HorizontalScroll.prototype.setHoldTimer=function(){var a=this;clearTimeout(this.holdTimerID);this.itemsCount>this.items.length-1?(this.itemsCount=0,$(this).trigger("done")):(this.isStopped=this.isHolding=!0,this.holdTimerID=setTimeout(function(){a.isHolding=!1;a.isStopped=!1;a.itemsCount++},this.getDuration()))};RiseVision.Common.HorizontalScroll.prototype.handleMouseDown=function(a){this.mouseDown=!0;this.lastMouseX=a.clientX};
RiseVision.Common.HorizontalScroll.prototype.handleMouseUp=function(a){var c=this;this.mouseDown=!1;this.mouseMove?this.mouseMove=!1:(clearTimeout(this.interactivityTimerID),this.isStopped=!0,this.interactivityTimerID=setTimeout(function(){c.isStopped=!1},this.interactivityTimeout))};RiseVision.Common.HorizontalScroll.prototype.handleMouseOut=function(a){this.mouseDown=!1};
RiseVision.Common.HorizontalScroll.prototype.handleMouseMove=function(a){if(this.mouseDown){clearTimeout(this.holdTimerID);this.isHolding=!1;a=a.clientX;var c=this.lastMouseX-a,b;this.mouseMove=!0;this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var d=0;d<this.getScrollers().length;d++){var e=this.getScroller(d);e.x-=c;if("rtl"==this.getScrollDirection())for(0<c?(b=e.x+this.scroller.width,0>b&&(e.x=this.scroller.width,e.x-=-b,this.adjustCanvas(d,"rtl"))):0>c&&(b=e.x-this.scroller.width,
0<b&&(e.x=-this.scroller.width,e.x-=-b,this.adjustCanvas(d,"ltr"))),b=0;b<e.holdPositions.length;b++)e.x<=-e.holdPositions[b].position&&!e.holdPositions[b].wasHeld&&(e.holdPositions[b].wasHeld=!0);else for(0<c?(b=e.x+this.scroller.width,0>b&&(e.x=this.scroller.width,e.x-=-b,this.adjustCanvas(d,"rtl"))):0>c&&(b=e.x-this.scroller.width,0<b&&(e.x=-this.scroller.width,e.x-=-b,this.adjustCanvas(d,"ltr"))),b=0;b<e.holdPositions.length;b++)e.x<=-e.holdPositions[b].position&&!e.holdPositions[b].wasHeld&&
"forward"==e.writeDirection?e.holdPositions[b].wasHeld=!0:e.x>=e.holdPositions[b].position&&!e.holdPositions[b].wasHeld&&"backward"==e.writeDirection&&(e.holdPositions[b].wasHeld=!0);this.drawCanvas(e.x,d)}this.isStopped=!1;this.lastMouseX=a}};RiseVision.Common.HorizontalScroll.prototype.tick=function(){var a=this;this.request=requestAnimFrame(function(){a.tick()});"item"==this.getScrollBy()?this.drawSceneByItem():this.drawScene()};RiseVision.Common.HorizontalScroll.prototype.pause=function(){cancelRequestAnimFrame(this.request)};
RiseVision.Common.HorizontalScroll.prototype.updateItem=function(a,c,b){var d=this,e=this.items[a],f=null;null!=e&&(this.totalWidth-=e.getWidth(),this.items[a]=null,e.destroy());f=new RiseVision.Common.Item(c,this.scroller,this.getSpacing(),this.getScrollDirection(),a);f.initialize(function(){d.items[a]=this;d.totalWidth+=this.getWidth();f=null;b&&b()})};
RiseVision.Common.HorizontalScroll.prototype.clear=function(){for(var a=0;a<this.getScrollers().length;a++)this.getScroller(a).clear();for(a=0;a<this.items.length;a++)this.items[a].destroy();this.totalWidth=0;this.items=[]};
RiseVision.Common.Item=function(a,c,b,d,e,f){this.svgCanvases=[];this.canvas=document.createElement("canvas");this.canvas.className="item";this.context=this.canvas.getContext("2d");this.context.canvas.height=c.height;this.data=a;this.writePosition=this.width=this.index=0;this.scroller=c;this.padding=b;this.scrollDirection=d;this.isRefreshing=f;this.dataIndex=0;this.position="undefined"===typeof e?-1:e};RiseVision.Common.Item.prototype.getWidth=function(){return this.context.canvas.width};
RiseVision.Common.Item.prototype.initialize=function(a){this.callback=a;this.getImage()};
RiseVision.Common.Item.prototype.getImage=function(){var a=this,c=this.data[this.dataIndex],b;c?(b=null==c.padding?this.padding:c.padding,"image"==c.type?(this.index=this.dataIndex,0<this.svgCanvases.length?($.each(this.svgCanvases,function(b,e){if(e.url==c.value)return c.svg=a.svgCanvases[b].canvas,!1}),c.svg?(this.width+=c.svg.width+b,this.dataIndex++,this.getImage()):this.loadImage(c.value)):this.loadImage(c.value)):(this.createTempText(c.value,c.fontRule,b),this.dataIndex++,this.getImage())):
this.drawCanvas()};RiseVision.Common.Item.prototype.loadImage=function(a){var c={},b=this;c[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.TEXT;gadgets.io.makeRequest(a,function(a){if(a.data){var c=b.data[b.dataIndex];c.svg=a.data;b.createTempImage(b.dataIndex,c.svg,c.value)}b.dataIndex++;b.getImage()},c)};
RiseVision.Common.Item.prototype.createTempImage=function(a,c,b){var d=document.createElement("canvas");d.getContext("2d");var e=null==this.data[a].padding?this.padding:this.data[a].padding;d.id="svg";d.height=this.scroller.height-10;d.width=this.scroller.height-10;document.body.appendChild(d);canvg("svg",c,{scaleHeight:!0,ignoreDimensions:!0});this.width+=d.width+e;this.data[a].svg=d;this.svgCanvases.push({url:b,canvas:d});document.body.removeChild(d)};
RiseVision.Common.Item.prototype.createImage=function(a,c){var b=null==this.data[a].padding?this.padding:this.data[a].padding;"rtl"==this.scrollDirection?this.context.drawImage(this.data[a].svg,0,0,this.data[a].svg.width,this.data[a].svg.height,this.writePosition,5,this.data[a].svg.width,this.data[a].svg.height):this.context.drawImage(this.data[a].svg,0,0,this.data[a].svg.width,this.data[a].svg.height,this.writePosition+b,5,this.data[a].svg.width,this.data[a].svg.height);this.writePosition+=this.data[a].svg.width+
b};RiseVision.Common.Item.prototype.createTempText=function(a,c,b){var d=document.createElement("canvas").getContext("2d");this.writeText(a,c,b,d);this.width+=d.measureText(a).width+b};RiseVision.Common.Item.prototype.createText=function(a,c,b){this.writeText(a,c,b,this.context);this.writePosition+=this.context.measureText(a).width+b};
RiseVision.Common.Item.prototype.writeText=function(a,c,b,d){var e=d.canvas.height/2,f="",h="",f=RiseVision.Common.Utility.parseCSSRule(c);null!=f[3]&&"normal"!=f[3]&&(h+=f[3]+" ");null!=f[4]&&"normal"!=f[4]&&(h+=f[4]+" ");h+=f[2]+" "+f[0];d.font=h;d.strokeStyle=f[1];d.textAlign="left";d.textBaseline="middle";d.save();d.translate(0,e);d.fillStyle=f[1];d.fillText(a,this.writePosition+b,0);d.restore()};
RiseVision.Common.Item.prototype.drawCanvas=function(){var a=this.data.length,c;this.context.canvas.width=this.width;this.context.canvas.style.display="none";for(var b=0;b<a;b++)c=null==this.data[b].padding?this.padding:this.data[b].padding,"text"==this.data[b].type?this.createText(this.data[b].value,this.data[b].fontRule,c):"image"==this.data[b].type&&this.data[b].svg&&this.createImage(b,this.data[b].svg);this.addCanvas();this.callback()};
RiseVision.Common.Item.prototype.addCanvas=function(){if(-1!=this.position){var a=$(".item").eq(this.position);0<a.length?$(this.canvas).insertBefore(a):document.body.appendChild(this.canvas)}else document.body.appendChild(this.canvas)};RiseVision.Common.Item.prototype.destroy=function(){document.body.removeChild(this.canvas);this.callback=this.scroller=this.data=this.canvas=this.context=null};
RiseVision.Common.Item.prototype.getFontHeight=function(a){var c=document.getElementsByTagName("body")[0],b=document.createElement("div"),d=document.createTextNode("M");b.setAttribute("style",a);c.appendChild(b);b.appendChild(d);a=b.offsetHeight;b.removeChild(d);c.removeChild(b);return a};
RiseVision.Common.Scroller=function(a,c,b){this.canvas=document.createElement("canvas");this.canvas.width=c;this.canvas.height=b;this.context=this.canvas.getContext("2d");this.x=a;this.endCanvasItem=this.startCanvasItem=null;this.endCanvasPosition=this.startCanvasPosition=this.endCanvasIndex=this.startCanvasIndex=0;this.writeDirection="forward";this.writePosition=this.totalPixelsCopied=0;this.holdPositions=[]};
RiseVision.Common.Scroller.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};
RiseVision.Common.Scroller.prototype.drawCanvasFromStart=function(a,c,b){var d=a.getContext("2d"),e=this.canvas.width-this.totalPixelsCopied,f=!1,h=0,g=null;0==this.totalPixelsCopied&&(this.startCanvasPosition=c,this.context.clearRect(0,0,this.canvas.width,this.canvas.height));b="rtl"==b?0==c?a.width:a.width-c:a.width-c;b<=e?(0<b&&(g=d.getImageData(c,0,b,a.height)),h=b,this.totalPixelsCopied+=h,c=0,f=!0):(g=d.getImageData(c,0,e,a.height),h=e,this.totalPixelsCopied+=e,c+=e);g&&this.context.putImageData(g,
this.writePosition,0);this.writePosition+=h;this.endCanvasPosition=c;this.totalPixelsCopied>=this.canvas.width&&(this.writePosition=0);return f};
RiseVision.Common.Scroller.prototype.drawCanvasFromEnd=function(a,c){var b=a.getContext("2d"),d=this.canvas.width-this.totalPixelsCopied,e=!1,f=0;0==c?c=f=a.width:f=c;0==this.totalPixelsCopied&&(this.endCanvasPosition=f,this.context.clearRect(0,0,this.canvas.width,this.canvas.height));f<=d?(b=b.getImageData(0,0,f,a.height),this.totalPixelsCopied+=f,c=0,e=!0):(b=b.getImageData(f-d,0,d,a.height),f=d,this.totalPixelsCopied+=d,c-=d);this.context.putImageData(b,this.canvas.width-this.totalPixelsCopied,
0);this.startCanvasPosition=c;this.writePosition+=f;this.totalPixelsCopied>=this.canvas.width&&(this.writePosition=0);return e};RiseVision.Common.Authorization=function(){this.clientID="726689182011.apps.googleusercontent.com";this.scope="https://www.googleapis.com/auth/drive"};RiseVision.Common.Authorization.prototype.checkAuth=function(){var a=this;gapi.auth.authorize({client_id:this.clientID,scope:this.scope,immediate:!0},function(c){a.handleAuthResult(c)})};
RiseVision.Common.Authorization.prototype.handleAuthResult=function(a){a&&!a.error?(this.oauthToken=a.access_token,$(window).trigger("authorized")):$(window).trigger("notAuthorized")};RiseVision.Common.Authorization.prototype.handleLogin=function(){var a=this;gapi.auth.authorize({client_id:this.clientID,scope:this.scope,immediate:!1},function(c){a.handleAuthResult(c)});return!1};
RiseVision.Common.Font=function(a,c,b,d){this.font=a;this.fontStyle=c;this.customFont=d;"Use Custom Font"==a?""!=b&&RiseVision.Common.Utility.loadCustomFont(d,b):"Google"==c&&RiseVision.Common.Utility.loadGoogleFont(this.font)};RiseVision.Common.Font.prototype.getFontFamily=function(){return"Use Custom Font"==this.font?this.customFont:"Google"==this.fontStyle?this.font:this.fontStyle};RiseVision.Common.CKEditorFonts=function(){this.reset()};
RiseVision.Common.CKEditorFonts.prototype.reset=function(){this.customFonts=[];this.googleFonts=[]};
RiseVision.Common.CKEditorFonts.prototype.getFonts=function(a){a=$.parseHTML(a);var c=this;null!=a&&$.each(a,function(a,d){var e=$(d).find("[data-custom-font-url]").andSelf().filter("[data-custom-font-url]"),f=$(d).find("[data-google-font-url]").andSelf().filter("[data-google-font-url]");$.each(e,function(){var a=$(this).attr("data-custom-font"),b=$(this).attr("data-custom-font-url"),d=!1;$.each(c.customFonts,function(b,c){if(c.font==a)return d=!0,!1});d||c.customFonts.push({font:a,url:b})});$.each(f,
function(){var a=$(this).attr("data-google-font"),b=$(this).attr("data-google-font-url"),d=!1;$.each(c.googleFonts,function(a,c){if(c==b)return d=!0,!1});d||c.googleFonts.push({font:a,url:b})})})};
RiseVision.Common.CKEditorFonts.prototype.loadFonts=function(a){null!=this.customFonts&&0<this.customFonts.length&&$.each(this.customFonts,function(c,b){RiseVision.Common.Utility.loadCustomFont(b.font,b.url,a)});null!=this.googleFonts&&0<this.googleFonts.length&&$.each(this.googleFonts,function(c,b){RiseVision.Common.Utility.loadGoogleFont(b.font,a)})};
RiseVision.Common.Utility.loadCustomFont=function(a,c,b){null==b&&(b=document);b=b.styleSheets[0];null!=b&&b.addRule("@font-face","font-family: "+a+"; src: url('"+c+"');")};RiseVision.Common.Utility.loadGoogleFont=function(a,c){null==c&&(c=document);var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href","https://fonts.googleapis.com/css?family="+a);null!=b&&c.getElementsByTagName("head")[0].appendChild(b)};
RiseVision.Common.Utility.loadCSS=function(a){var c=$("<link>");c.attr({type:"text/css",rel:"stylesheet",href:a});$("head").append(c)};RiseVision.Common.Utility.loadJS=function(a,c){var b=document.createElement("script");b.type="text/javascript";b.onload=function(){c&&c()};b.src=a;"undefined"!=typeof b&&document.getElementsByTagName("head")[0].appendChild(b)};
RiseVision.Common.Utility.addCommas=function(a){var c,b;c=(a+"").split(".");a=c[0];c=1<c.length?"."+c[1]:"";for(b=/(\d+)(\d{3})/;b.test(a);)a=a.replace(b,"$1,$2");return a+c};RiseVision.Common.Utility.unescapeHTML=function(a){var c=document.createElement("div");c.innerHTML=a;return void 0!==c.innerText?c.innerText:c.textContent};
RiseVision.Common.Utility.stripScripts=function(a){var c=document.createElement("div"),b;c.innerHTML=a;a=c.getElementsByTagName("script");for(b=a.length;b--;)a[b].parentNode.removeChild(a[b]);return c.innerHTML};RiseVision.Common.Utility.truncate=function(a,c){a.length>c&&(a=a.substring(0,c),a=a.replace(/\w+$/,""),a+=" ...");return a};
RiseVision.Common.Utility.scaleToFit=function(a){var c=new Image;c.onload=function(){var b,d,e,f;b=c.width;d=c.height;0<b&&0<d&&(b>a.rsW||d>a.rsH)&&(e=a.rsW/b,f=a.rsH/d,e=e<f?e:f,b=parseInt(b*e,10),d=parseInt(d*e,10));a.callback(b,d)};c.onerror=function(){a.onerror(c)};c.setAttribute("src",a.url)};RiseVision.Common.Utility.getNodeValue=function(a){return null!=a&&0<a.length&&0<a[0].childNodes.length?a[0].childNodes[0].nodeValue:""};
RiseVision.Common.Utility.getElementByNodeName=function(a,c){for(var b=c.indexOf(":"),b=c.substr(b+1),b=a.getElementsByTagNameNS("*",b),d=0;d<b.length;d++)if(b[d].nodeName==c)return b;return null};RiseVision.Common.Utility.adjustTime=function(a,c){return a.setTimezoneOffset(c)};
RiseVision.Common.Utility.getStyle=function(a){var c,b,d;for(c=0;c<document.styleSheets.length;c++)for(b=document.styleSheets[c],d=b.rules||b.cssRules,b=0;b<d.length;b++)if(d[b].selectorText==a)return a=d[b].cssText?d[b].cssText:d[b].style.cssText;return""};
RiseVision.Common.Utility.parseCSSRule=function(a){var c=a.indexOf("{"),b=a.indexOf("}");a.substring(0,c);a=a.substring(++c,b).split(";");for(var c=[],d=0;d<a.length;d++)b=-1,-1!=a[d].indexOf("font-family:",0)?b=0:-1!=a[d].indexOf("color:",0)?b=1:-1!=a[d].indexOf("font-size:",0)?b=2:-1!=a[d].indexOf("font-weight:",0)?b=3:-1!=a[d].indexOf("font-style:",0)&&(b=4),-1==b?c.push(a[d].substring(a[d].indexOf(":",0)+1).trim()):c[b]=a[d].substring(a[d].indexOf(":",0)+1).trim();return c};
RiseVision.Common.Utility.isTouchDevice=function(){return"ontouchstart"in window};RiseVision.Common.Utility.getQueryParam=function(a){for(var c=window.location.search.substring(1).split("&"),b,d=0;d<c.length;d++)if(b=c[d].split("="),b[0]==a)return decodeURIComponent(b[1]);return null};