var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Settings={},RiseVision.Common.Picker={},RiseVision.Common.Visualization={},RiseVision.Common.Financial={},RiseVision.Common.Financial.Helper={},RiseVision.Common.Financial.RealTime={},RiseVision.Common.Financial.Historical={},RiseVision.Common.Financial.Historical.CollectionTimes={},RiseVision.Common.HorizontalScroll={},RiseVision.Common.Item={},RiseVision.Common.Scroller={},RiseVision.Common.Authorization={},RiseVision.Common.Font={},RiseVision.Common.Utility={},RiseVision.Common.Settings=function(){},RiseVision.Common.Settings.prototype.validateRequired=function(t,i,e){return!!t.is(":visible")&&(!$.trim(t.val())&&(i.innerHTML+=e+" is a required field.<br />",!0))},RiseVision.Common.Settings.prototype.validateNumeric=function(t,i,e){return!!t.is(":visible")&&(!!isNaN(t.val())&&(i.innerHTML+="The "+e+" field must contain only numbers.<br />",!0))},RiseVision.Common.Picker=function(){},RiseVision.Common.Picker.prototype.showPicker=function(t,i){gadgets.rpc.call("","rscmd_openGooglePicker",null,t,i)},RiseVision.Common.Picker.prototype.getSheets=function(s){var e,o,n=[];$.getJSON(encodeURI("https://spreadsheets.google.com/feeds/worksheets/"+s.docID+"/public/basic?alt=json&dummy="+Math.ceil(100*Math.random()))).done(function(t){for(var i=0;i<t.feed.entry.length;i++)(e=document.createElement("option")).text=t.feed.entry[i].title.$t,-1==(o=(o=t.feed.entry[i].link[2].href).replace("&pub=1","")).indexOf("/gviz/")?e.value=o:e.value=o.replace("spreadsheets.google.com","docs.google.com"),n.push(e);s.callback(n)}).fail(function(t,i,e){$(".errors").empty(),$(".errors").append("To use this spreadsheet, it first needs to be published to the web. From the Google Spreadsheet menu, select <em>File > Publish to the web</em>, and then click the <em>Start Publishing</em> button. Once done, select your file from the Google Drive link again."),$(".errors").css("display","inline-block"),$("li.more").hide(),console.log(t.status+" - "+t.statusText),console.log(t.responseText),s.callback(null)})},RiseVision.Common.Picker.prototype.getURL=function(t){var i="";return i=t.baseURL,""!=t.headerRows&&(i+="&headers="+t.headerRows),""!=t.range&&(i+="&range="+t.range),i},RiseVision.Common.Visualization=function(){this.query=null,this.isVisualizationLoaded=!1},RiseVision.Common.Visualization.prototype.getData=function(t){this.url=t.url,this.refreshInterval=t.refreshInterval,this.timeout=t.timeout||30,this.callback=t.callback,this.params=t.params,t.queryString&&(this.queryString=t.queryString),this.isVisualizationLoaded?this.sendQuery():this.loadVisualizationAPI()},RiseVision.Common.Visualization.prototype.loadVisualizationAPI=function(){var t=this;google.load("visualization","1",{callback:function(){t.isVisualizationLoaded=!0,t.sendQuery()}})},RiseVision.Common.Visualization.prototype.sendQuery=function(){var i=this;null!=this.query&&this.query.abort(),this.query=new google.visualization.Query(this.url),this.query.setRefreshInterval(this.refreshInterval),this.query.setTimeout(this.timeout),this.queryString&&this.query.setQuery(this.queryString),this.query.send(function(t){i.onQueryExecuted(t)})},RiseVision.Common.Visualization.prototype.onQueryExecuted=function(t){null==t?this.callback(t,this.params):t.isError()?(console.log("Message: "+t.getMessage()),console.log("Detailed message: "+t.getDetailedMessage()),console.log("Reasons: "+t.getReasons()),this.callback(null,this.params)):this.callback(t.getDataTable(),this.params)},RiseVision.Common.Financial.Helper=function(t){this.instruments=t},RiseVision.Common.Financial.Helper.prototype.setInstruments=function(t){this.instruments=t},RiseVision.Common.Financial.Helper.prototype.getInstruments=function(t,r){var a=this;if(t)return this.instruments.join("|");var l=(new Date).getDay(),h=r.length,c=[];return $.each(this.instruments,function(e,t){for(var i=0;i<h;i++)if(t==r[i].instrument){var s=r[i].startTime,o=r[i].endTime,n=r[i].daysOfWeek;$.each(n,function(t,i){if(i==l)return(new Date).between(s,o)&&c.push(a.instruments[e]),!1})}}),c.join("|")},RiseVision.Common.Financial.RealTime=function(t,e){this.displayID=t||"preview",e=e.split(","),$.each(e,function(t,i){e[t]=$.trim(e[t])}),this.instruments=e,this.isLoading=!0,this.conditions={},this.collectionTimes=[],this.updateInterval=6e4,this.now=Date.today(),this.url="http://contentfinancial2.appspot.com/data?",this.logosURL="https://s3.amazonaws.com/risecontentlogos/financial/",this.viz=new RiseVision.Common.Visualization,this.helper=new RiseVision.Common.Financial.Helper(this.instruments)},RiseVision.Common.Financial.RealTime.prototype.setInstruments=function(e){e=e.split(","),$.each(e,function(t,i){e[t]=$.trim(e[t])}),this.isLoading=!0,this.collectionTimes=[],this.instruments=e,this.helper.setInstruments(this.instruments)},RiseVision.Common.Financial.RealTime.prototype.getData=function(t,i,e,s){var o,n=this,r=!1,a=0,l="select instrument";if(this.dataFields={},this.dataFields.instrument=0,this.startTimeIndex=1,this.isLoading&&(this.callback=s),$.each(t,function(t,e){r=!1,"instrument"==e||($.each(n.dataFields,function(t,i){if(t==e)return!(r=!0)}),r||(l+=", "+e,n.dataFields[e]=a+1,a++,n.startTimeIndex++))}),this.logoCount=0,l+=", startTime, endTime, daysOfWeek, timeZoneOffset",!Date.equals(Date.today(),this.now)){this.now=Date.today();for(var h=0;h<this.collectionTimes.length;h++)this.collectionTimes[h].startTime.addDays(1),this.collectionTimes[h].endTime.addDays(1)}if(o=this.helper.getInstruments(this.isLoading,this.collectionTimes)){n=this;var c={url:this.url+"id="+this.displayID+"&codes="+encodeURIComponent(o),refreshInterval:0,queryString:l,callback:function(t){n.onRealTimeDataLoaded(t,i,e)}};this.getDataTimer=setTimeout(function(){n.getData(t,i,e,s)},this.updateInterval),this.viz.getData(c)}else s(null)},RiseVision.Common.Financial.RealTime.prototype.onRealTimeDataLoaded=function(t,i,e){null!=t?(clearTimeout(this.getDataTimer),this.data=t,this.isLoading?(this.isLoading=!1,0==this.collectionTimes.length&&this.saveCollectionTimes(),i?this.loadLogos():this.callback&&this.callback(this.data,this.logoURLs)):i&&e?this.loadLogos():this.callback&&this.callback(this.data,this.logoURLs)):(console.log("Error encountered loading real-time data for: "),console.log(this.instruments[0]))},RiseVision.Common.Financial.RealTime.prototype.saveCollectionTimes=function(){var t,i,e,s;if(t=this.data.getNumberOfRows(),1==this.instruments.length&&1<this.data.getNumberOfRows())"INVALID_SYMBOL"!=this.data.getValue(0,0)&&("..."==this.data.getValue(0,0)?this.isLoading=!0:(i=this.data.getValue(0,this.startTimeIndex+3),e=this.data.getValue(0,this.startTimeIndex),s=this.data.getValue(0,this.startTimeIndex+1),e&&s&&"N/P"!=i&&this.collectionTimes.push({instrument:this.instruments[0],startTime:e.setTimezoneOffset(i),endTime:s.setTimezoneOffset(i),daysOfWeek:this.data.getFormattedValue(0,this.startTimeIndex+2).split(",")})));else{for(var o=0;o<t;o++)"INVALID_SYMBOL"!=this.data.getValue(o,0)&&("..."==this.data.getValue(o,0)?this.isLoading=!0:(i=this.data.getValue(o,this.startTimeIndex+3),e=this.data.getValue(o,this.startTimeIndex),s=this.data.getValue(o,this.startTimeIndex+1),e&&s&&"N/P"!=i&&this.collectionTimes.push({instrument:this.instruments[o],startTime:e.setTimezoneOffset(i),endTime:s.setTimezoneOffset(i),daysOfWeek:this.data.getFormattedValue(o,this.startTimeIndex+2).split(",")})));0==this.collectionTimes.length&&console.log(this.collectionTimes)}},RiseVision.Common.Financial.RealTime.prototype.loadLogos=function(){var t=this.data.getNumberOfRows();this.logoCount=0,this.urls=new Array,this.logoURLs=new Array;for(var i=0;i<t;i++)this.urls.push(this.logosURL+this.data.getFormattedValue(i,0)+".svg");this.loadLogo(this.urls.length)},RiseVision.Common.Financial.RealTime.prototype.loadLogo=function(t){var i,e=this;(i=new Image).onload=function(){e.logoURLs.push(i.src),e.onLogoLoaded(t)},i.onerror=function(){e.logoURLs.push(null),e.onLogoLoaded(t)},i.src=this.urls[this.logoCount]},RiseVision.Common.Financial.RealTime.prototype.onLogoLoaded=function(t){this.logoCount++,0==--t?this.callback&&this.callback(this.data,this.logoURLs):this.loadLogo(t)},RiseVision.Common.Financial.RealTime.prototype.checkSigns=function(t){var i,e,s=0,o=[];for(s=0,numRows=this.data.getNumberOfRows();s<numRows;s++)i=this.data.getValue(s,this.dataFields[t]),isNaN(i)&&(i=i.replace(/[^0-9\.-]+/g,""),i=parseFloat(i)),isNaN(i)||(e=0<=i?1:-1,o.push(e));return o},RiseVision.Common.Financial.RealTime.prototype.compare=function(t){var e=this,s=0,o=0,n=[],r=!1;if(this.conditions[t])for(row=0,numRows=this.data.getNumberOfRows();row<numRows;row++)s=this.data.getValue(row,this.dataFields[t]),r=!1,$.each(this.conditions[t],function(t,i){if(i.instrument==e.data.getValue(row,0))return o=i.value,isNaN(s)&&(s=s.replace(/[^0-9\.-]+/g,""),s=parseFloat(s)),isNaN(o)&&(o=o.replace(/[^0-9\.-]+/g,""),o=parseFloat(o)),isNaN(s)||isNaN(o)||(s!=o?o<s?n.push(1):n.push(-1):n.push(0)),!(r=!0)}),r||n.push(0);return this.saveBeforeValues([t]),n},RiseVision.Common.Financial.RealTime.prototype.saveBeforeValues=function(t){var e=this;$.each(t,function(t,i){e.conditions[i]=[],e.saveBeforeValue(i,e.dataFields[i])})},RiseVision.Common.Financial.RealTime.prototype.saveBeforeValue=function(t,i){for(var e=0,s=this.data.getNumberOfRows();e<s;e++)this.conditions[t].push({instrument:this.data.getValue(e,0),value:this.data.getValue(e,i)})},RiseVision.Common.Financial.Historical=function(t,i,e){this.displayID=t||"preview",this.instrument=i,this.duration=e,this.isLoading=!0,this.updateInterval=6e4,this.now=Date.today(),this.url="http://contentfinancial2.appspot.com/data/historical?",this.historicalViz=new RiseVision.Common.Visualization,this.helper=new RiseVision.Common.Financial.Helper([this.instrument])},RiseVision.Common.Financial.Historical.prototype.setInstrument=function(t){this.isLoading=!0,this.instrument=t,this.helper.setInstruments([this.instrument])},RiseVision.Common.Financial.Historical.prototype.setDuration=function(t){this.duration=t},RiseVision.Common.Financial.Historical.prototype.setIsUpdated=function(t){CollectionTimes.getInstance().setIsUpdated(this.instrument,t)},RiseVision.Common.Financial.Historical.prototype.getHistoricalData=function(e,s,o){var n=this,r="select "+e.join()+" ORDER BY tradeTime";o&&(o.sortOrder&&"desc"==o.sortOrder&&(r+=" desc"),o.limit&&(r+=" LIMIT "+o.limit)),CollectionTimes.getInstance().addInstrument(this.instrument,this.now,function(i,t){n.now=t,n.helper.getInstruments(n.isLoading,[i])?(o={url:n.url+"id="+n.displayID+"&code="+n.instrument+"&kind="+n.duration,refreshInterval:0,queryString:r,callback:function(t){n.onHistoricalDataLoaded(t,i,s)}},n.getHistoricalDataTimer=setTimeout(function(){n.getHistoricalData(e,s,o)},n.updateInterval),n.historicalViz.getData(o)):s(null)})},RiseVision.Common.Financial.Historical.prototype.onHistoricalDataLoaded=function(t,i,e){var s=0;null!=t?(clearTimeout(this.getHistoricalDataTimer),0==(s=(this.historicalData=t).getNumberOfRows())||1==s&&"0"==t.getFormattedValue(0,0)?this.isLoading=!0:this.isLoading=!1,null!=this.historicalData?e({data:this.historicalData,collectionData:i}):e({collectionData:i})):(console.log("Error encountered loading historical data for: "),console.log(this))};var CollectionTimes=function(){var t=!1,a=[];function i(){function r(e,s){var t,o=new RiseVision.Common.Visualization;collectionTimesTimer=setTimeout(function(){r(e,s)},6e4),t={url:"http://contentfinancial2.appspot.com/info?codes="+e,refreshInterval:0,queryString:"select startTime, endTime, daysOfWeek, timeZoneOffset, updateInterval",callback:function(t,i){(o=null)!=t?(clearTimeout(i),function(t,i){var e,s,o;if(null!=i){i.getNumberOfRows();for(var n=0;n<a.length;n++)if(a[n].instrument==t){o=i.getValue(0,3),e=i.getValue(0,0),s=i.getValue(0,1),a[n].collectionTimes={instrument:t,startTime:e.setTimezoneOffset(o),endTime:s.setTimezoneOffset(o),daysOfWeek:i.getFormattedValue(0,2).split(","),timeZoneOffset:o,isUpdated:!0};break}}}(e,t),s()):console.log("Error encountered loading collection times for: "+e)},params:collectionTimesTimer},o.getData(t)}return{setIsUpdated:function(t,i){for(var e=0;e<a.length;e++)a[e].instrument==t&&null!=a[e].collectionTimes&&(a[e].collectionTimes.isUpdated=i)},addInstrument:function(t,i,e){for(var s=0,o=!1,n=!1;s<a.length;s++)if(a[s].instrument==t){null!=a[s].collectionTimes&&(Date.equals(Date.today(),i)||a[s].collectionTimes.isUpdated||(i=Date.today(),a[s].collectionTimes.startTime.addDays(1),a[s].collectionTimes.endTime.addDays(1),a[s].collectionTimes.isUpdated=!0),n=!0),o=!0;break}n?e(a[s].collectionTimes,i):(o||a.push({instrument:t,collectionTimes:null}),r(t,function(){e(a[s].collectionTimes,i)}))}}}return{getInstance:function(){return t=t||i()}}}();RiseVision.Common.HorizontalScroll=function(t,i){var e=[],s=0,o=!1,n={width:800,height:75,scrollBy:"item",scrollDirection:"rtl",speed:"medium",spacing:20,duration:1e4,interactivityTimeout:5e3};t&&$.extend(n,t),this.scroller=document.createElement("canvas"),this.scroller.id="scroller",this.scroller.width=n.width,this.scroller.height=n.height,this.interactivityTimeout=n.interactivityTimeout,this.context=this.scroller.getContext("2d"),this.data=i,this.isHolding=!1,this.isLoading=!0,this.items=[],this.previousItemIndex=-1,this.itemCount=0,this.currentItemIndex=0,this.mouseDown=!1,this.mouseMove=!1,this.lastMouseX=0,n.speed?"fastest"==n.speed?this.speed=5:"fast"==n.speed?this.speed=4:"medium"==n.speed?this.speed=3:"slow"==n.speed?this.speed=2:"slowest"==n.speed&&(this.speed=1):this.speed=3,"ltr"==n.scrollDirection&&(this.speed=-this.speed),this.getScrollBy=function(){return n.scrollBy},this.getScrollDirection=function(){return n.scrollDirection},this.getDuration=function(){return n.duration},this.getScroller=function(t){return e[t]},this.getScrollers=function(){return e},this.getTotalPixels=function(){return s},this.getIsStopped=function(){return o},this.getInteractivityTimerID=function(){return null},this.getSpacing=function(){return n.spacing},this.setScroller=function(t,i){e[t]=i},this.setTotalPixels=function(t){s=t},this.setIsStopped=function(t){o=t},document.body.appendChild(this.scroller),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,i){return window.setTimeout(t,1e3/60)},window.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout},RiseVision.Common.HorizontalScroll.prototype.initialize=function(){var i=this;this.scroller.onmousemove=function(t){i.handleMouseMove(t)},this.scroller.onmousedown=function(t){i.handleMouseDown(t)},this.scroller.onmouseup=function(t){i.handleMouseUp(t)},this.scroller.onmouseout=function(t){i.handleMouseOut(t)};for(var t=0;t<2;t++)"rtl"==this.getScrollDirection()?this.setScroller(t,new RiseVision.Common.Scroller(t*this.scroller.width,this.scroller.width,this.scroller.height)):this.setScroller(t,new RiseVision.Common.Scroller(-t*this.scroller.width,this.scroller.width,this.scroller.height));this.totalWidth=0,this.itemsCount=1,0<this.data.length&&this.loadItem()},RiseVision.Common.HorizontalScroll.prototype.loadItem=function(){var t=new RiseVision.Common.Item(this.data[this.currentItemIndex],this.scroller,this.getSpacing(),this.getScrollDirection()),i=this;t.initialize(function(){i.items[i.currentItemIndex]=this,i.totalWidth+=this.getWidth(),i.onItemInitialized()})},RiseVision.Common.HorizontalScroll.prototype.onItemInitialized=function(){if(this.itemCount++,this.itemCount==this.data.length){for(var t=0;t<this.getScrollers().length;t++)this.adjustCanvas(t);this.currentItemIndex=0,readyEvent()}else this.currentItemIndex++,this.loadItem()},RiseVision.Common.HorizontalScroll.prototype.adjustCanvas=function(t,i){var e=0,s=!1;if(i=i||this.getScrollDirection(),"rtl"==this.getScrollDirection()?this.getScroller(t).writeDirection="rtl"==i?"forward":"backward":this.getScroller(t).writeDirection="rtl"==i?"backward":"forward","item"==this.getScrollBy()){for(this.getScroller(t).holdPositions=[],e=this.getItemPosition(this.getNextScrollerIndex(t),i);this.getScroller(t).totalPixelsCopied<this.getScroller(t).canvas.width;)0==this.getScroller(t).totalPixelsCopied&&("rtl"==this.getScrollDirection()&&"rtl"==i||"ltr"==this.getScrollDirection()&&"rtl"==i?(this.getScroller(t).startCanvasIndex=this.currentItemIndex,this.getScroller(t).startCanvasItem=this.items[this.currentItemIndex]):(this.getScroller(t).endCanvasIndex=this.currentItemIndex,this.getScroller(t).endCanvasItem=this.items[this.currentItemIndex])),this.currentItemIndex!=this.previousItemIndex&&("rtl"==this.getScrollDirection()?"rtl"==i?"forward"==this.getScroller(t).writeDirection&&this.getScroller(t).holdPositions.push({position:this.getScroller(t).writePosition,wasHeld:!1}):0!=e&&this.getScroller(t).holdPositions.push({position:this.getScroller(t).writePosition,wasHeld:!1}):this.getScroller(t).holdPositions.push({position:this.getScroller(t).writePosition,wasHeld:!1})),"rtl"==this.getScrollDirection()?"rtl"==i?(s=this.getScroller(t).drawCanvasFromStart(this.items[this.currentItemIndex].canvas,e,this.getScrollDirection()),0==this.getScroller(t).endCanvasPosition&&0==this.getScroller(t).writePosition&&this.setNextItem(this.currentItemIndex),this.getScroller(t).endCanvasIndex=this.currentItemIndex,this.getScroller(t).endCanvasItem=this.items[this.currentItemIndex]):(s=this.getScroller(t).drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,e),this.getScroller(t).startCanvasIndex=this.currentItemIndex,this.getScroller(t).startCanvasItem=this.items[this.currentItemIndex]):"ltr"==i?(s=this.getScroller(t).drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,e,this.getScrollDirection()),this.getScroller(t).startCanvasIndex=this.currentItemIndex,this.getScroller(t).startCanvasItem=this.items[this.currentItemIndex]):(s=this.getScroller(t).drawCanvasFromStart(this.items[this.currentItemIndex].canvas,e,this.getScrollDirection()),this.getScroller(t).endCanvasIndex=this.currentItemIndex,this.getScroller(t).endCanvasItem=this.items[this.currentItemIndex]),s&&("forward"==this.getScroller(t).writeDirection?this.setNextItem(this.currentItemIndex):this.setPreviousItem(this.currentItemIndex)),e=0}else{for(e=this.getItemPosition(this.getNextScrollerIndex(t),i);this.getScroller(t).totalPixelsCopied<this.getScroller(t).canvas.width;)0==this.getScroller(t).totalPixelsCopied&&("rtl"==this.getScrollDirection()&&"rtl"==i||"ltr"==this.getScrollDirection()&&"rtl"==i?this.getScroller(t).startCanvasIndex=this.currentItemIndex:this.getScroller(t).endCanvasIndex=this.currentItemIndex),(s=(this.getScrollDirection(),"rtl"==i?this.getScroller(t).drawCanvasFromStart(this.items[this.currentItemIndex].canvas,e,this.getScrollDirection()):this.getScroller(t).drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,e,this.getScrollDirection(),this.getScroller(this.getNextScrollerIndex(t)).writeDirection)))&&("forward"==this.getScroller(t).writeDirection?this.setNextItem(this.currentItemIndex):this.setPreviousItem(this.currentItemIndex)),e=0;"rtl"==this.getScrollDirection()&&"rtl"==i||"ltr"==this.getScrollDirection()&&"rtl"==i?this.getScroller(t).endCanvasIndex=this.currentItemIndex:this.getScroller(t).startCanvasIndex=this.currentItemIndex}this.isLoading=!1,this.getScroller(t).totalPixelsCopied=0},RiseVision.Common.HorizontalScroll.prototype.getItemPosition=function(t,i){return this.getScrollDirection(),"rtl"==i?this.getPositionFromEnd(t,i):this.getPositionFromStart(t,i)},RiseVision.Common.HorizontalScroll.prototype.getPositionFromStart=function(t,i){var e;return e=this.getScroller(t).startCanvasPosition,this.currentItemIndex=this.getScroller(t).startCanvasIndex,"rtl"==this.getScrollDirection()&&"ltr"==i?0==e&&this.setPreviousItem(this.getScroller(t).startCanvasIndex):"ltr"==this.getScrollDirection()&&"ltr"==i&&(this.isLoading||0==e&&this.setNextItem(this.getScroller(t).startCanvasIndex)),this.isLoading||(this.previousItemIndex=this.currentItemIndex),e},RiseVision.Common.HorizontalScroll.prototype.getPositionFromEnd=function(t,i){var e;return this.currentItemIndex=this.getScroller(t).endCanvasIndex,e=this.getScroller(t).endCanvasPosition,"ltr"==this.getScrollDirection()&&"rtl"==i?e==this.items[this.currentItemIndex].canvas.width&&(this.setPreviousItem(this.getScroller(t).endCanvasIndex),e=0):"rtl"==this.getScrollDirection()&&"rtl"==i&&e==this.items[this.currentItemIndex].canvas.width&&(this.setNextItem(this.getScroller(t).endCanvasIndex),e=0),this.isLoading||(this.previousItemIndex=this.currentItemIndex),e},RiseVision.Common.HorizontalScroll.prototype.getNextScrollerIndex=function(t){var i=++t;return i>=this.getScrollers().length&&(i=0),i},RiseVision.Common.HorizontalScroll.prototype.setNextItem=function(t){var i=++t;return i>=this.items.length&&(i=0),this.currentItemIndex=i},RiseVision.Common.HorizontalScroll.prototype.setPreviousItem=function(t){var i=--t;return i<0&&(i=this.items.length-1),this.currentItemIndex=i},RiseVision.Common.HorizontalScroll.prototype.drawScene=function(){var t,i=this;if(!this.mouseDown&&!this.isStopped){this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var e=0;e<this.getScrollers().length;e++){var s=this.getScroller(e);s.x=s.x-this.speed,(t="rtl"==this.getScrollDirection()?s.x+this.scroller.width:s.x-this.scroller.width)<0&&"rtl"==this.getScrollDirection()?(s.x=this.scroller.width,s.x=s.x- -t,this.adjustCanvas(e)):0<t&&"ltr"==this.getScrollDirection()&&(s.x=-this.scroller.width,s.x=s.x- -t,this.adjustCanvas(e)),this.drawCanvas(s.x,e)}this.setTotalPixels(this.getTotalPixels()+Math.abs(this.speed)),0==this.totalWidth?(this.pause(),setTimeout(function(){0==i.totalWidth?$(i).trigger("done"):i.tick()},5e3)):this.getTotalPixels()>this.totalWidth&&(this.setTotalPixels(this.getTotalPixels()-this.totalWidth),$(this).trigger("done"))}},RiseVision.Common.HorizontalScroll.prototype.drawSceneByItem=function(){if(!this.mouseDown&&!this.isStopped){for(var t=0,i=0;i<this.getScrollers().length;i++){if(0<(o=this.getScroller(i)).holdPositions.length){for(var e=0;e<o.holdPositions.length;e++){if(o.x<=-o.holdPositions[e].position&&!o.holdPositions[e].wasHeld&&"rtl"==this.getScrollDirection()){t=o.x+o.holdPositions[e].position,o.x=-o.holdPositions[e].position,this.holdScroller(o,i,e);break}if(o.x>=o.holdPositions[e].position&&!o.holdPositions[e].wasHeld&&"ltr"==this.getScrollDirection()){t=o.x-o.holdPositions[e].position,o.x=o.holdPositions[e].position,this.holdScroller(o,i,e);break}this.isHolding=!1}if(this.isHolding){var s=this.getNextScrollerIndex(i);this.getScroller(s).x=this.getScroller(s).x-t,this.moveCanvas(i),this.drawCanvas(this.getScroller(s).x,s);break}}else this.isHolding=!1}if(!this.isHolding){this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(i=0;i<this.getScrollers().length;i++){var o,n=(o=this.getScroller(i)).x-this.speed;o.x=n,this.moveCanvas(i),this.drawCanvas(o.x,i)}}}},RiseVision.Common.HorizontalScroll.prototype.holdScroller=function(t,i,e){t.holdPositions[e].wasHeld=!0,this.context.clearRect(0,0,this.scroller.width,this.scroller.height),this.moveCanvas(i),this.drawCanvas(t.x,i),this.setHoldTimer(),this.isHolding=!0},RiseVision.Common.HorizontalScroll.prototype.moveCanvas=function(t){var i,e=this.getScroller(t);(i="rtl"==this.getScrollDirection()?e.x+this.scroller.width:e.x-this.scroller.width)<0&&"rtl"==this.getScrollDirection()?(e.x=this.scroller.width,e.x=e.x- -i,this.adjustCanvas(t)):0<i&&"ltr"==this.getScrollDirection()&&(e.x=-this.scroller.width,e.x=e.x- -i,this.adjustCanvas(t))},RiseVision.Common.HorizontalScroll.prototype.drawCanvas=function(t,i){var e=this.getScroller(i).canvas;this.context.save(),this.context.translate(t,0),this.context.drawImage(e,0,0,e.width,e.height),this.context.restore()},RiseVision.Common.HorizontalScroll.prototype.setHoldTimer=function(){var t=this;clearTimeout(this.holdTimerID),this.itemsCount>this.items.length-1?(this.itemsCount=0,$(this).trigger("done")):(this.isHolding=!0,this.isStopped=!0,this.holdTimerID=setTimeout(function(){t.isHolding=!1,t.isStopped=!1,t.itemsCount++},this.getDuration()))},RiseVision.Common.HorizontalScroll.prototype.handleMouseDown=function(t){this.mouseDown=!0,this.lastMouseX=t.clientX},RiseVision.Common.HorizontalScroll.prototype.handleMouseUp=function(t){var i=this;this.mouseDown=!1,this.mouseMove?this.mouseMove=!1:(clearTimeout(this.interactivityTimerID),this.isStopped=!0,this.interactivityTimerID=setTimeout(function(){i.isStopped=!1},this.interactivityTimeout))},RiseVision.Common.HorizontalScroll.prototype.handleMouseOut=function(t){this.mouseDown=!1},RiseVision.Common.HorizontalScroll.prototype.handleMouseMove=function(t){if(this.mouseDown){clearTimeout(this.holdTimerID),this.isHolding=!1;var i,e=t.clientX,s=this.lastMouseX-e;this.mouseMove=!0,this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var o=0;o<this.getScrollers().length;o++){var n=this.getScroller(o);if(n.x=n.x-s,"rtl"==this.getScrollDirection()){0<s?(i=n.x+this.scroller.width)<0&&(n.x=this.scroller.width,n.x=n.x- -i,this.adjustCanvas(o,"rtl")):s<0&&0<(i=n.x-this.scroller.width)&&(n.x=-this.scroller.width,n.x=n.x- -i,this.adjustCanvas(o,"ltr"));for(var r=0;r<n.holdPositions.length;r++)n.x<=-n.holdPositions[r].position&&!n.holdPositions[r].wasHeld&&(n.holdPositions[r].wasHeld=!0)}else{0<s?(i=n.x+this.scroller.width)<0&&(n.x=this.scroller.width,n.x=n.x- -i,this.adjustCanvas(o,"rtl")):s<0&&0<(i=n.x-this.scroller.width)&&(n.x=-this.scroller.width,n.x=n.x- -i,this.adjustCanvas(o,"ltr"));for(r=0;r<n.holdPositions.length;r++)n.x<=-n.holdPositions[r].position&&!n.holdPositions[r].wasHeld&&"forward"==n.writeDirection?n.holdPositions[r].wasHeld=!0:n.x>=n.holdPositions[r].position&&!n.holdPositions[r].wasHeld&&"backward"==n.writeDirection&&(n.holdPositions[r].wasHeld=!0)}this.drawCanvas(n.x,o)}this.isStopped=!1,this.lastMouseX=e}},RiseVision.Common.HorizontalScroll.prototype.tick=function(){var t=this;this.request=requestAnimFrame(function(){t.tick()}),"item"==this.getScrollBy()?this.drawSceneByItem():this.drawScene()},RiseVision.Common.HorizontalScroll.prototype.pause=function(){cancelRequestAnimFrame(this.request)},RiseVision.Common.HorizontalScroll.prototype.updateItem=function(t,i,e){var s=this,o=this.items[t];null!=o&&(this.totalWidth-=o.getWidth(),this.items[t]=null,o.destroy()),new RiseVision.Common.Item(i,this.scroller,this.getSpacing(),this.getScrollDirection(),t).initialize(function(){s.items[t]=this,s.totalWidth+=this.getWidth(),null,e&&e()})},RiseVision.Common.HorizontalScroll.prototype.clear=function(){for(var t=0;t<this.getScrollers().length;t++)this.getScroller(t).clear();for(t=0;t<this.items.length;t++)this.items[t].destroy();this.totalWidth=0,this.items=[]},RiseVision.Common.Item=function(t,i,e,s,o,n){this.svgCanvases=[],this.canvas=document.createElement("canvas"),this.canvas.className="item",this.context=this.canvas.getContext("2d"),this.context.canvas.height=i.height,this.data=t,this.index=0,this.width=0,this.writePosition=0,this.scroller=i,this.padding=e,this.scrollDirection=s,this.isRefreshing=n,this.dataIndex=0,this.position=void 0===o?-1:o},RiseVision.Common.Item.prototype.getWidth=function(){return this.context.canvas.width},RiseVision.Common.Item.prototype.initialize=function(t){this.callback=t,this.getImage()},RiseVision.Common.Item.prototype.getImage=function(){var t,e=this,s=this.data[this.dataIndex];s?(t=null==s.padding?this.padding:s.padding,"image"==s.type?(this.index=this.dataIndex,0<this.svgCanvases.length?($.each(this.svgCanvases,function(t,i){if(i.url==s.value)return s.svg=e.svgCanvases[t].canvas,!1}),s.svg?(this.width+=s.svg.width+t,this.dataIndex++,this.getImage()):this.loadImage(s.value)):this.loadImage(s.value)):(this.createTempText(s.value,s.fontRule,t),this.dataIndex++,this.getImage())):this.drawCanvas()},RiseVision.Common.Item.prototype.loadImage=function(t){var i={},e=this;i[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.TEXT,gadgets.io.makeRequest(t,function(t){if(t.data){var i=e.data[e.dataIndex];i.svg=t.data,e.createTempImage(e.dataIndex,i.svg,i.value)}e.dataIndex++,e.getImage()},i)},RiseVision.Common.Item.prototype.createTempImage=function(t,i,e){var s=document.createElement("canvas"),o=(s.getContext("2d"),null==this.data[t].padding?this.padding:this.data[t].padding);s.id="svg",s.height=this.scroller.height-10,s.width=this.scroller.height-10,document.body.appendChild(s),canvg("svg",i,{scaleHeight:!0,ignoreDimensions:!0}),this.width+=s.width+o,this.data[t].svg=s,this.svgCanvases.push({url:e,canvas:s}),document.body.removeChild(s)},RiseVision.Common.Item.prototype.createImage=function(t,i){var e=null==this.data[t].padding?this.padding:this.data[t].padding;"rtl"==this.scrollDirection?this.context.drawImage(this.data[t].svg,0,0,this.data[t].svg.width,this.data[t].svg.height,this.writePosition,5,this.data[t].svg.width,this.data[t].svg.height):this.context.drawImage(this.data[t].svg,0,0,this.data[t].svg.width,this.data[t].svg.height,this.writePosition+e,5,this.data[t].svg.width,this.data[t].svg.height),this.writePosition+=this.data[t].svg.width+e},RiseVision.Common.Item.prototype.createTempText=function(t,i,e){var s=document.createElement("canvas").getContext("2d");this.writeText(t,i,e,s),this.width+=s.measureText(t).width+e},RiseVision.Common.Item.prototype.createText=function(t,i,e){this.writeText(t,i,e,this.context),this.writePosition+=this.context.measureText(t).width+e},RiseVision.Common.Item.prototype.writeText=function(t,i,e,s){var o,n=s.canvas.height/2,r="";null!=(o=RiseVision.Common.Utility.parseCSSRule(i))[3]&&"normal"!=o[3]&&(r+=o[3]+" "),null!=o[4]&&"normal"!=o[4]&&(r+=o[4]+" "),r+=o[2]+" "+o[0],s.font=r,s.strokeStyle=o[1],s.textAlign="left",s.textBaseline="middle",s.save(),s.translate(0,n),s.fillStyle=o[1],this.scrollDirection,s.fillText(t,this.writePosition+e,0),s.restore()},RiseVision.Common.Item.prototype.drawCanvas=function(){var t,i=this.data.length;this.context.canvas.width=this.width,this.context.canvas.style.display="none";for(var e=0;e<i;e++)t=null==this.data[e].padding?this.padding:this.data[e].padding,"text"==this.data[e].type?this.createText(this.data[e].value,this.data[e].fontRule,t):"image"==this.data[e].type&&this.data[e].svg&&this.createImage(e,this.data[e].svg);this.addCanvas(),this.callback()},RiseVision.Common.Item.prototype.addCanvas=function(){if(-1!=this.position){var t=$(".item").eq(this.position);0<t.length?$(this.canvas).insertBefore(t):document.body.appendChild(this.canvas)}else document.body.appendChild(this.canvas)},RiseVision.Common.Item.prototype.destroy=function(){document.body.removeChild(this.canvas),this.context=null,this.canvas=null,this.data=null,this.scroller=null,this.callback=null},RiseVision.Common.Item.prototype.getFontHeight=function(t){var i,e=document.getElementsByTagName("body")[0],s=document.createElement("div"),o=document.createTextNode("M");return s.setAttribute("style",t),e.appendChild(s),s.appendChild(o),i=s.offsetHeight,s.removeChild(o),e.removeChild(s),o=s=e=null,i},RiseVision.Common.Scroller=function(t,i,e){this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=e,this.context=this.canvas.getContext("2d"),this.x=t,this.startCanvasItem=null,this.endCanvasItem=null,this.startCanvasIndex=0,this.endCanvasIndex=0,this.startCanvasPosition=0,this.endCanvasPosition=0,this.writeDirection="forward",this.totalPixelsCopied=0,this.writePosition=0,this.holdPositions=[]},RiseVision.Common.Scroller.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},RiseVision.Common.Scroller.prototype.drawCanvasFromStart=function(t,i,e){var s,o=t.getContext("2d"),n=this.canvas.width-this.totalPixelsCopied,r=!1,a=0,l=null;return 0==this.totalPixelsCopied&&(this.startCanvasPosition=i,this.context.clearRect(0,0,this.canvas.width,this.canvas.height)),(s="rtl"==e&&0==i?t.width:t.width-i)<=n?(0<s&&(l=o.getImageData(i,0,s,t.height)),a=s,this.totalPixelsCopied+=a,r=!(i=0)):(l=o.getImageData(i,0,n,t.height),a=n,this.totalPixelsCopied+=n,i+=n),l&&this.context.putImageData(l,this.writePosition,0),this.writePosition+=a,this.endCanvasPosition=i,this.totalPixelsCopied>=this.canvas.width&&(this.writePosition=0),l=null,r},RiseVision.Common.Scroller.prototype.drawCanvasFromEnd=function(t,i){var e,s,o=t.getContext("2d"),n=this.canvas.width-this.totalPixelsCopied,r=!1,a=0;return 0==i?i=s=t.width:s=i,0==this.totalPixelsCopied&&(this.endCanvasPosition=s,this.context.clearRect(0,0,this.canvas.width,this.canvas.height)),s<=n?(e=o.getImageData(0,0,s,t.height),a=s,this.totalPixelsCopied+=a,r=!(i=0)):(e=o.getImageData(s-n,0,n,t.height),a=n,this.totalPixelsCopied+=n,i-=n),this.context.putImageData(e,this.canvas.width-this.totalPixelsCopied,0),this.startCanvasPosition=i,this.writePosition+=a,this.totalPixelsCopied>=this.canvas.width&&(this.writePosition=0),e=null,r},RiseVision.Common.Authorization=function(){this.clientID="726689182011.apps.googleusercontent.com",this.scope="https://www.googleapis.com/auth/drive.file"},RiseVision.Common.Authorization.prototype.checkAuth=function(){var i=this;gapi.auth.authorize({client_id:this.clientID,scope:this.scope,immediate:!0},function(t){i.handleAuthResult(t)})},RiseVision.Common.Authorization.prototype.handleAuthResult=function(t){t&&!t.error?(this.oauthToken=t.access_token,$(window).trigger("authorized")):$(window).trigger("notAuthorized")},RiseVision.Common.Authorization.prototype.handleLogin=function(){var i=this;return gapi.auth.authorize({client_id:this.clientID,scope:this.scope,immediate:!1},function(t){i.handleAuthResult(t)}),!1},RiseVision.Common.Font=function(t,i,e,s){this.font=t,this.fontStyle=i,this.customFont=s,"Use Custom Font"==t?""!=e&&RiseVision.Common.Utility.loadCustomFont(s,e):"Google"==i&&RiseVision.Common.Utility.loadGoogleFont(this.font)},RiseVision.Common.Font.prototype.getFontFamily=function(){return"Use Custom Font"==this.font?this.customFont:"Google"==this.fontStyle?this.font:this.fontStyle},RiseVision.Common.CKEditorFonts=function(){this.reset()},RiseVision.Common.CKEditorFonts.prototype.reset=function(){this.customFonts=[],this.googleFonts=[]},RiseVision.Common.CKEditorFonts.prototype.getFonts=function(t){var i=$.parseHTML(t),o=this;null!=i&&$.each(i,function(t,i){var e=$(i).find("[data-custom-font-url]").andSelf().filter("[data-custom-font-url]"),s=$(i).find("[data-google-font-url]").andSelf().filter("[data-google-font-url]");$.each(e,function(){var e=$(this).attr("data-custom-font"),t=$(this).attr("data-custom-font-url"),s=!1;$.each(o.customFonts,function(t,i){if(i.font==e)return!(s=!0)}),s||o.customFonts.push({font:e,url:t})}),$.each(s,function(){var t=$(this).attr("data-google-font"),e=$(this).attr("data-google-font-url"),s=!1;$.each(o.googleFonts,function(t,i){if(i==e)return!(s=!0)}),s||o.googleFonts.push({font:t,url:e})})})},RiseVision.Common.CKEditorFonts.prototype.loadFonts=function(e){null!=this.customFonts&&0<this.customFonts.length&&$.each(this.customFonts,function(t,i){RiseVision.Common.Utility.loadCustomFont(i.font,i.url,e)}),null!=this.googleFonts&&0<this.googleFonts.length&&$.each(this.googleFonts,function(t,i){RiseVision.Common.Utility.loadGoogleFont(i.font,e)})},RiseVision.Common.Utility.loadCustomFont=function(t,i,e){null==e&&(e=document);var s=e.styleSheets[0],o="font-family: "+t+"; src: url('"+i+"');";null!=s&&s.addRule("@font-face",o)},RiseVision.Common.Utility.loadGoogleFont=function(t,i){null==i&&(i=document);var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","https://fonts.googleapis.com/css?family="+t),null!=e&&i.getElementsByTagName("head")[0].appendChild(e)},RiseVision.Common.Utility.loadCSS=function(t){var i=$("<link>");i.attr({type:"text/css",rel:"stylesheet",href:t}),$("head").append(i)},RiseVision.Common.Utility.loadJS=function(t,i){var e=document.createElement("script");e.type="text/javascript",e.onload=function(){i&&i()},e.src=t,void 0!==e&&document.getElementsByTagName("head")[0].appendChild(e)},RiseVision.Common.Utility.addCommas=function(t){var i,e,s,o;for(e=(i=(t+="").split("."))[0],s=1<i.length?"."+i[1]:"",o=/(\d+)(\d{3})/;o.test(e);)e=e.replace(o,"$1,$2");return e+s},RiseVision.Common.Utility.unescapeHTML=function(t){var i=document.createElement("div");return i.innerHTML=t,void 0!==i.innerText?i.innerText:i.textContent},RiseVision.Common.Utility.stripScripts=function(t){var i,e,s=document.createElement("div");for(s.innerHTML=t,e=(i=s.getElementsByTagName("script")).length;e--;)i[e].parentNode.removeChild(i[e]);return s.innerHTML},RiseVision.Common.Utility.truncate=function(t,i){return t.length>i&&(t=(t=t.substring(0,i)).replace(/\w+$/,""),t+=" ..."),t},RiseVision.Common.Utility.scaleToFit=function(a){var l=new Image;l.onload=function(){var t,i,e,s,o,n,r;t=l.width,i=l.height,0<t&&0<i&&(t>a.rsW||i>a.rsH)?(o=(e=a.rsW/t)<(s=a.rsH/i)?e:s,n=parseInt(t*o,10),r=parseInt(i*o,10),a.callback(n,r)):a.callback(t,i)},l.onerror=function(){a.onerror(l)},l.setAttribute("src",a.url)},RiseVision.Common.Utility.getNodeValue=function(t){return null!=t&&0<t.length?t[0].textContent:""},RiseVision.Common.Utility.getElementByNodeName=function(t,i){for(var e=i.indexOf(":"),s=i.substr(e+1),o=t.getElementsByTagNameNS("*",s),n=0;n<o.length;n++)if(o[n].nodeName==i)return o;return null},RiseVision.Common.Utility.adjustTime=function(t,i){return t.setTimezoneOffset(i)},RiseVision.Common.Utility.getStyle=function(t){var i,e,s,o,n="";for(i=0;i<document.styleSheets.length;i++)for(o=(s=document.styleSheets[i]).rules||s.cssRules,e=0;e<o.length;e++)if(o[e].selectorText==t)return n=o[e].cssText?o[e].cssText:o[e].style.cssText;return n},RiseVision.Common.Utility.parseCSSRule=function(t){for(var i,e=t.indexOf("{"),s=t.indexOf("}"),o=(t.substring(0,e),t.substring(++e,s).split(";")),n=[],r=0;r<o.length;r++)(i=-1)!=o[r].indexOf("font-family:",0)?i=0:-1!=o[r].indexOf("color:",0)?i=1:-1!=o[r].indexOf("font-size:",0)?i=2:-1!=o[r].indexOf("font-weight:",0)?i=3:-1!=o[r].indexOf("font-style:",0)&&(i=4),-1==i?n.push(o[r].substring(o[r].indexOf(":",0)+1).trim()):n[i]=o[r].substring(o[r].indexOf(":",0)+1).trim();return n},RiseVision.Common.Utility.isTouchDevice=function(){return"ontouchstart"in window},RiseVision.Common.Utility.getQueryParam=function(t){for(var i,e=window.location.search.substring(1).split("&"),s=0;s<e.length;s++)if((i=e[s].split("="))[0]==t)return decodeURIComponent(i[1]);return null};
