function HorizontalScroll(a,c){this.scroller=document.createElement("canvas");this.scroller.id="scroller";this.scroller.width=a.width;this.scroller.height=a.height;this.context=this.scroller.getContext("2d");this.data=c;this.totalPixels=0;this.spacing=a.spacing;this.isHolding=!1;this.isLoading=!0;this.isStopped=!1;this.scrollers=[];this.items=[];this.previousItemIndex=-1;this.dataIndex=this.currentItemIndex=this.itemCount=0;this.scrollBy=a.scrollBy;this.scrollDirection=a.scrollDirection;this.duration=
a.duration;this.interactivityTimeout=a.interactivityTimeout;this.interactivityTimerID=null;this.mouseMove=this.mouseDown=!1;this.lastMouseX=0;this.speed="fastest"==a.speed?5:"fast"==a.speed?4:"medium"==a.speed?3:"slow"==a.speed?2:"slowest"==a.speed?1:3;"ltr"==a.scrollDirection&&(this.speed=-this.speed);document.body.appendChild(this.scroller);window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)}}();window.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}
HorizontalScroll.prototype.initialize=function(){var a=this;this.scroller.onmousemove=function(b){a.handleMouseMove(b)};this.scroller.onmousedown=function(b){a.handleMouseDown(b)};this.scroller.onmouseup=function(b){a.handleMouseUp(b)};this.scroller.onmouseout=function(b){a.handleMouseOut(b)};for(var c=0;2>c;c++)this.scrollers[c]="rtl"==this.scrollDirection?new Scroller(c*this.scroller.width,this.scroller.width,this.scroller.height):new Scroller(-c*this.scroller.width,this.scroller.width,this.scroller.height);
this.totalWidth=0;this.itemsCount=1;0<this.data.length&&this.loadItem()};HorizontalScroll.prototype.loadItem=function(){var a=this;(new Item(this.data[this.currentItemIndex],this.scroller,this.spacing,this.scrollDirection)).initialize(function(){a.items[a.currentItemIndex]=this;a.totalWidth+=this.getWidth();a.onItemInitialized()})};
HorizontalScroll.prototype.onItemInitialized=function(){this.itemCount++;if(this.itemCount==this.data.length){for(var a=0;a<this.scrollers.length;a++)this.adjustCanvas(a);this.currentItemIndex=0;readyEvent()}else this.currentItemIndex++,this.loadItem()};
HorizontalScroll.prototype.adjustCanvas=function(a,c){var b=0,b=!1;c||(c=this.scrollDirection);this.scrollers[a].writeDirection="rtl"==this.scrollDirection?"rtl"==c?"forward":"backward":"rtl"==c?"backward":"forward";if("item"==this.scrollBy){this.scrollers[a].holdPositions=[];for(b=this.getItemPosition(this.getNextScrollerIndex(a),c);this.scrollers[a].totalPixelsCopied<this.scrollers[a].canvas.width;)0==this.scrollers[a].totalPixelsCopied&&("rtl"==this.scrollDirection&&"rtl"==c||"ltr"==this.scrollDirection&&
"rtl"==c?(this.scrollers[a].startCanvasIndex=this.currentItemIndex,this.scrollers[a].startCanvasItem=this.items[this.currentItemIndex]):(this.scrollers[a].endCanvasIndex=this.currentItemIndex,this.scrollers[a].endCanvasItem=this.items[this.currentItemIndex])),this.currentItemIndex!=this.previousItemIndex&&("rtl"==this.scrollDirection?"rtl"==c?"forward"==this.scrollers[a].writeDirection&&this.scrollers[a].holdPositions.push({position:this.scrollers[a].writePosition,wasHeld:!1}):0!=b&&this.scrollers[a].holdPositions.push({position:this.scrollers[a].writePosition,
wasHeld:!1}):this.scrollers[a].holdPositions.push({position:this.scrollers[a].writePosition,wasHeld:!1})),"rtl"==this.scrollDirection?"rtl"==c?(b=this.scrollers[a].drawCanvasFromStart(this.items[this.currentItemIndex].canvas,b,this.scrollDirection),0==this.scrollers[a].endCanvasPosition&&0==this.scrollers[a].writePosition&&this.setNextItem(this.currentItemIndex),this.scrollers[a].endCanvasIndex=this.currentItemIndex,this.scrollers[a].endCanvasItem=this.items[this.currentItemIndex]):(b=this.scrollers[a].drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,
b),this.scrollers[a].startCanvasIndex=this.currentItemIndex,this.scrollers[a].startCanvasItem=this.items[this.currentItemIndex]):"ltr"==c?(b=this.scrollers[a].drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,b,this.scrollDirection),this.scrollers[a].startCanvasIndex=this.currentItemIndex,this.scrollers[a].startCanvasItem=this.items[this.currentItemIndex]):(b=this.scrollers[a].drawCanvasFromStart(this.items[this.currentItemIndex].canvas,b,this.scrollDirection),this.scrollers[a].endCanvasIndex=
this.currentItemIndex,this.scrollers[a].endCanvasItem=this.items[this.currentItemIndex]),b&&("forward"==this.scrollers[a].writeDirection?this.setNextItem(this.currentItemIndex):this.setPreviousItem(this.currentItemIndex)),b=0}else{for(b=this.getItemPosition(this.getNextScrollerIndex(a),c);this.scrollers[a].totalPixelsCopied<this.scrollers[a].canvas.width;)0==this.scrollers[a].totalPixelsCopied&&("rtl"==this.scrollDirection&&"rtl"==c||"ltr"==this.scrollDirection&&"rtl"==c?this.scrollers[a].startCanvasIndex=
this.currentItemIndex:this.scrollers[a].endCanvasIndex=this.currentItemIndex),(b="rtl"==c?this.scrollers[a].drawCanvasFromStart(this.items[this.currentItemIndex].canvas,b,this.scrollDirection):this.scrollers[a].drawCanvasFromEnd(this.items[this.currentItemIndex].canvas,b,this.scrollDirection,this.scrollers[this.getNextScrollerIndex(a)].writeDirection))&&("forward"==this.scrollers[a].writeDirection?this.setNextItem(this.currentItemIndex):this.setPreviousItem(this.currentItemIndex)),b=0;"rtl"==this.scrollDirection&&
"rtl"==c||"ltr"==this.scrollDirection&&"rtl"==c?this.scrollers[a].endCanvasIndex=this.currentItemIndex:this.scrollers[a].startCanvasIndex=this.currentItemIndex}this.isLoading=!1;this.scrollers[a].totalPixelsCopied=0};HorizontalScroll.prototype.getItemPosition=function(a,c){return"rtl"==c?this.getPositionFromEnd(a,c):this.getPositionFromStart(a,c)};
HorizontalScroll.prototype.getPositionFromStart=function(a,c){var b;b=this.scrollers[a].startCanvasPosition;this.currentItemIndex=this.scrollers[a].startCanvasIndex;"rtl"==this.scrollDirection&&"ltr"==c?0==b&&this.setPreviousItem(this.scrollers[a].startCanvasIndex):"ltr"==this.scrollDirection&&"ltr"==c&&(this.isLoading||0==b&&this.setNextItem(this.scrollers[a].startCanvasIndex));this.isLoading||(this.previousItemIndex=this.currentItemIndex);return b};
HorizontalScroll.prototype.getPositionFromEnd=function(a,c){var b;this.currentItemIndex=this.scrollers[a].endCanvasIndex;b=this.scrollers[a].endCanvasPosition;"ltr"==this.scrollDirection&&"rtl"==c?b==this.items[this.currentItemIndex].canvas.width&&(this.setPreviousItem(this.scrollers[a].endCanvasIndex),b=0):"rtl"==this.scrollDirection&&"rtl"==c&&b==this.items[this.currentItemIndex].canvas.width&&(this.setNextItem(this.scrollers[a].endCanvasIndex),b=0);this.isLoading||(this.previousItemIndex=this.currentItemIndex);
return b};HorizontalScroll.prototype.getNextScrollerIndex=function(a){a=++a;a>=this.scrollers.length&&(a=0);return a};HorizontalScroll.prototype.setNextItem=function(a){a=++a;a>=this.items.length&&(a=0);return this.currentItemIndex=a};HorizontalScroll.prototype.setPreviousItem=function(a){a=--a;0>a&&(a=this.items.length-1);return this.currentItemIndex=a};
HorizontalScroll.prototype.drawScene=function(){var a;if(!this.mouseDown&&!this.isStopped){this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var c=0;c<this.scrollers.length;c++){var b=this.scrollers[c];b.x-=this.speed;a="rtl"==this.scrollDirection?b.x+this.scroller.width:b.x-this.scroller.width;0>a&&"rtl"==this.scrollDirection?(b.x=this.scroller.width,b.x-=-a,this.adjustCanvas(c)):0<a&&"ltr"==this.scrollDirection&&(b.x=-this.scroller.width,b.x-=-a,this.adjustCanvas(c));this.drawCanvas(b.x,
c)}this.totalPixels+=Math.abs(this.speed);this.totalPixels>this.totalWidth&&(this.totalPixels-=this.totalWidth,$(this).trigger("done"))}};
HorizontalScroll.prototype.drawSceneByItem=function(){if(!this.mouseDown&&!this.isStopped){for(var a=0,c=0;c<this.scrollers.length;c++){var b=this.scrollers[c];if(0<b.holdPositions.length){for(var d=0;d<b.holdPositions.length;d++)if(b.x<=-b.holdPositions[d].position&&!b.holdPositions[d].wasHeld&&"rtl"==this.scrollDirection){a=b.x+b.holdPositions[d].position;b.x=-b.holdPositions[d].position;this.holdScroller(b,c,d);break}else if(b.x>=b.holdPositions[d].position&&!b.holdPositions[d].wasHeld&&"ltr"==
this.scrollDirection){a=b.x-b.holdPositions[d].position;b.x=b.holdPositions[d].position;this.holdScroller(b,c,d);break}else this.isHolding=!1;if(this.isHolding){b=this.getNextScrollerIndex(c);this.scrollers[b].x-=a;this.moveCanvas(c);this.drawCanvas(this.scrollers[b].x,b);break}}else this.isHolding=!1}if(!this.isHolding){this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(c=0;c<this.scrollers.length;c++)b=this.scrollers[c],b.x-=this.speed,this.moveCanvas(c),this.drawCanvas(b.x,
c)}}};HorizontalScroll.prototype.holdScroller=function(a,c,b){a.holdPositions[b].wasHeld=!0;this.context.clearRect(0,0,this.scroller.width,this.scroller.height);this.moveCanvas(c);this.drawCanvas(a.x,c);this.setHoldTimer();this.isHolding=!0};
HorizontalScroll.prototype.moveCanvas=function(a){var c=this.scrollers[a],b;b="rtl"==this.scrollDirection?c.x+this.scroller.width:c.x-this.scroller.width;0>b&&"rtl"==this.scrollDirection?(c.x=this.scroller.width,c.x-=-b,this.adjustCanvas(a)):0<b&&"ltr"==this.scrollDirection&&(c.x=-this.scroller.width,c.x-=-b,this.adjustCanvas(a))};
HorizontalScroll.prototype.drawCanvas=function(a,c){var b=this.scrollers[c].canvas;this.context.save();this.context.translate(a,0);this.context.drawImage(b,0,0,b.width,b.height);this.context.restore()};HorizontalScroll.prototype.setHoldTimer=function(){var a=this;clearTimeout(this.holdTimerID);this.itemsCount>this.items.length-1?(this.itemsCount=0,$(this).trigger("done")):(this.isStopped=this.isHolding=!0,this.holdTimerID=setTimeout(function(){a.isHolding=!1;a.isStopped=!1;a.itemsCount++},this.duration))};
HorizontalScroll.prototype.handleMouseDown=function(a){this.mouseDown=!0;this.lastMouseX=a.clientX};HorizontalScroll.prototype.handleMouseUp=function(){var a=this;this.mouseDown=!1;this.mouseMove?this.mouseMove=!1:(clearTimeout(this.interactivityTimerID),this.isStopped=!0,this.interactivityTimerID=setTimeout(function(){a.isStopped=!1},this.interactivityTimeout))};HorizontalScroll.prototype.handleMouseOut=function(){this.mouseDown=!1};
HorizontalScroll.prototype.handleMouseMove=function(a){if(this.mouseDown){clearTimeout(this.holdTimerID);this.isHolding=!1;var a=a.clientX,c=this.lastMouseX-a,b;this.mouseMove=!0;this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var d=0;d<this.scrollers.length;d++){var e=this.scrollers[d];e.x-=c;if("rtl"==this.scrollDirection){0<c?(b=e.x+this.scroller.width,0>b&&(e.x=this.scroller.width,e.x-=-b,this.adjustCanvas(d,"rtl"))):0>c&&(b=e.x-this.scroller.width,0<b&&(e.x=-this.scroller.width,
e.x-=-b,this.adjustCanvas(d,"ltr")));for(b=0;b<e.holdPositions.length;b++)e.x<=-e.holdPositions[b].position&&!e.holdPositions[b].wasHeld&&(e.holdPositions[b].wasHeld=!0)}else{0<c?(b=e.x+this.scroller.width,0>b&&(e.x=this.scroller.width,e.x-=-b,this.adjustCanvas(d,"rtl"))):0>c&&(b=e.x-this.scroller.width,0<b&&(e.x=-this.scroller.width,e.x-=-b,this.adjustCanvas(d,"ltr")));for(b=0;b<e.holdPositions.length;b++)e.x<=-e.holdPositions[b].position&&!e.holdPositions[b].wasHeld&&"forward"==e.writeDirection?
e.holdPositions[b].wasHeld=!0:e.x>=e.holdPositions[b].position&&(!e.holdPositions[b].wasHeld&&"backward"==e.writeDirection)&&(e.holdPositions[b].wasHeld=!0)}this.drawCanvas(e.x,d)}this.isStopped=!1;this.lastMouseX=a}};HorizontalScroll.prototype.tick=function(){var a=this;this.request=requestAnimFrame(function(){a.tick()});"item"==this.scrollBy?this.drawSceneByItem():this.drawScene()};HorizontalScroll.prototype.pause=function(){cancelRequestAnimFrame(this.request)};
HorizontalScroll.prototype.updateItem=function(a){var c=this,b=null,d=null;if(0<a.length)this.isStopped=!0,(b=this.items[this.dataIndex])?(this.totalWidth-=b.getWidth(),this.items[this.dataIndex]=null,b.destroy(),d=new Item(a.shift(),this.scroller,this.spacing,this.scrollDirection,this.dataIndex),d.initialize(function(){c.items[c.dataIndex]=this;c.totalWidth+=this.getWidth();d=null;c.dataIndex++;c.updateItem(a)})):(d=new Item(a.shift(),this.scroller,this.spacing,this.scrollDirection,this.dataIndex),
d.initialize(function(){c.items.push(this);c.totalWidth+=this.getWidth();d=null;c.dataIndex++;c.updateItem(a)}));else{for(var e=this.items.length-1;e>=this.dataIndex;e--)b=this.items[e],this.totalWidth-=b.getWidth(),this.items.pop(),b.destroy();this.dataIndex=0;this.isStopped=!1}};
function Scroller(a,c,b){this.canvas=document.createElement("canvas");this.canvas.width=c;this.canvas.height=b;this.context=this.canvas.getContext("2d");this.x=a;this.endCanvasItem=this.startCanvasItem=null;this.endCanvasPosition=this.startCanvasPosition=this.endCanvasIndex=this.startCanvasIndex=0;this.writeDirection="forward";this.writePosition=this.totalPixelsCopied=0;this.holdPositions=[]}
Scroller.prototype.drawCanvasFromStart=function(a,c,b){var d=a.getContext("2d"),e=this.canvas.width-this.totalPixelsCopied,f=!1,g=0,h=null;0==this.totalPixelsCopied&&(this.startCanvasPosition=c,this.context.clearRect(0,0,this.canvas.width,this.canvas.height));b="rtl"==b?0==c?a.width:a.width-c:a.width-c;b<=e?(0<b&&(h=d.getImageData(c,0,b,a.height)),g=b,this.totalPixelsCopied+=g,c=0,f=!0):(h=d.getImageData(c,0,e,a.height),g=e,this.totalPixelsCopied+=e,c+=e);h&&this.context.putImageData(h,this.writePosition,
0);this.writePosition+=g;this.endCanvasPosition=c;this.totalPixelsCopied>=this.canvas.width&&(this.writePosition=0);return f};
Scroller.prototype.drawCanvasFromEnd=function(a,c){var b=a.getContext("2d"),d=this.canvas.width-this.totalPixelsCopied,e=!1,f=0;0==c?c=f=a.width:f=c;0==this.totalPixelsCopied&&(this.endCanvasPosition=f,this.context.clearRect(0,0,this.canvas.width,this.canvas.height));f<=d?(b=b.getImageData(0,0,f,a.height),this.totalPixelsCopied+=f,c=0,e=!0):(b=b.getImageData(f-d,0,d,a.height),f=d,this.totalPixelsCopied+=d,c-=d);this.context.putImageData(b,this.canvas.width-this.totalPixelsCopied,0);this.startCanvasPosition=
c;this.writePosition+=f;this.totalPixelsCopied>=this.canvas.width&&(this.writePosition=0);return e};var svgCanvases=[];function Item(a,c,b,d,e,f){this.canvas=document.createElement("canvas");this.canvas.className="item";this.context=this.canvas.getContext("2d");this.context.canvas.height=c.height;this.data=a;this.writePosition=this.width=this.index=0;this.scroller=c;this.spacing=b;this.scrollDirection=d;this.isRefreshing=f;this.dataIndex=0;this.position="undefined"===typeof e?-1:e}
Item.prototype.getWidth=function(){return this.context.canvas.width};Item.prototype.initialize=function(a){this.callback=a;this.getImage()};
Item.prototype.getImage=function(){var a=this.data[this.dataIndex];a?"image"==a.type?(this.index=this.dataIndex,0<svgCanvases.length?($.each(svgCanvases,function(c,b){if(b.url==a.value)return a.svg=svgCanvases[c].canvas,!1}),a.svg?(this.width+=a.svg.width+this.spacing,this.dataIndex++,this.getImage()):this.loadImage(a.value)):this.loadImage(a.value)):(this.createTempText(this.data[this.dataIndex].value,this.data[this.dataIndex].fontRule),this.dataIndex++,this.getImage()):this.drawCanvas()};
Item.prototype.loadImage=function(a){var c={},b=this;c[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.TEXT;gadgets.io.makeRequest(a,function(a){if(a.data){var c=b.data[b.dataIndex];c.svg=a.data;b.createTempImage(b.dataIndex,c.svg,c.value)}b.dataIndex++;b.getImage()},c)};
Item.prototype.createTempImage=function(a,c,b){var d=document.createElement("canvas");d.getContext("2d");d.id="svg";d.height=this.scroller.height-10;d.width=this.scroller.height-10;document.body.appendChild(d);canvg("svg",c,{scaleHeight:!0,ignoreDimensions:!0});this.width+=d.width+this.spacing;this.data[a].svg=d;svgCanvases.push({url:b,canvas:d});document.body.removeChild(d)};
Item.prototype.createImage=function(a){"rtl"==this.scrollDirection?this.context.drawImage(this.data[a].svg,0,0,this.data[a].svg.width,this.data[a].svg.height,this.writePosition,5,this.data[a].svg.width,this.data[a].svg.height):this.context.drawImage(this.data[a].svg,0,0,this.data[a].svg.width,this.data[a].svg.height,this.writePosition+this.spacing,5,this.data[a].svg.width,this.data[a].svg.height);this.writePosition+=this.data[a].svg.width+this.spacing};
Item.prototype.createTempText=function(a,c){var b=document.createElement("canvas").getContext("2d");this.writeText(a,c,b);this.width+=b.measureText(a).width+this.spacing};Item.prototype.createText=function(a,c){this.writeText(a,c,this.context);this.writePosition+=this.context.measureText(a).width+this.spacing};
Item.prototype.writeText=function(a,c,b){var d=b.canvas.height/2,c=this.parseCSSRule(c);b.font=c[3]+c[2]+c[0];b.strokeStyle=c[1];b.textAlign="left";b.textBaseline="middle";b.save();b.translate(0,d);b.fillStyle=c[1];"rtl"==this.scrollDirection?b.fillText(a,this.writePosition,0):b.fillText(a,this.writePosition+this.spacing,0);b.restore()};
Item.prototype.drawCanvas=function(){var a=this.data.length;this.context.canvas.width=this.width;for(var c=0;c<a;c++)"text"==this.data[c].type?this.createText(this.data[c].value,this.data[c].fontRule):"image"==this.data[c].type&&this.data[c].svg&&this.createImage(c,this.data[c].svg);this.addCanvas();this.callback()};Item.prototype.addCanvas=function(){if(-1!=this.position){var a=$(".item").eq(this.position);0<a.length?$(this.canvas).insertBefore(a):document.body.appendChild(this.canvas)}else document.body.appendChild(this.canvas)};
Item.prototype.destroy=function(){document.body.removeChild(this.canvas);this.callback=this.scroller=this.data=this.canvas=this.context=null};Item.prototype.getFontHeight=function(a){var c=document.getElementsByTagName("body")[0],b=document.createElement("div"),d=document.createTextNode("M");b.setAttribute("style",a);c.appendChild(b);b.appendChild(d);a=b.offsetHeight;b.removeChild(d);c.removeChild(b);return a};
Item.prototype.parseCSSRule=function(a){var c=a.indexOf("{"),b=a.indexOf("}");a.substring(0,c);a=a.substring(++c,b).split(";");c=[];for(b=0;b<a.length;b++)c.push(a[b].substring(a[b].indexOf(":",0)+1));return c};