(function(e){function w(a,d,c,l,h){var j=a.contents(),f=!1;a.empty();for(var g=0,k=j.length;g<k&&!f;g++){var b=j[g],m=e(b);if("undefined"!=typeof b){a.append(m);if(h)a[a.is("table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, select, optgroup, option, textarea, script, style")?"after":"append"](h);3==b.nodeType?c.outerHeight()>l.maxHeight&&(f=x(m,d,c,l,h)):f=w(m,d,c,l,h);f||h&&h.remove()}}return f}function x(a,d,c,e,h){var j=!1,f=a[0];if("undefined"==typeof f)return!1;
for(var g="letter"==e.wrap?"":" ",k=r(f).split(g),b=-1,m=-1,t=0,u=k.length-1;t<=u;){var y=Math.floor((t+u)/2);if(y==m)break;m=y;p(f,k.slice(0,m+1).join(g)+e.ellipsis);c.outerHeight()>e.maxHeight?u=m:t=b=m}-1!=b&&!(1==k.length&&0==k[0].length)?(d=z(k.slice(0,b+1).join(g),e),j=!0,p(f,d)):(g=a.parent(),a.remove(),f=h?h.length:0,g.contents().size()>f?(j=g.contents().eq(-1-f),j=x(j,d,c,e,h)):(f=g.prev().contents().eq(-1)[0],"undefined"!=typeof f&&(d=z(r(f),e),p(f,d),g.remove(),j=!0)));return j}function z(a,
d){for(;-1<e.inArray(a.slice(-1),d.lastCharacter.remove);)a=a.slice(0,-1);0>e.inArray(a.slice(-1),d.lastCharacter.noEllipsis)&&(a+=d.ellipsis);return a}function v(a){return{width:a.outerWidth(),height:a.outerHeight()}}function p(a,e){a.innerText?a.innerText=e:a.nodeValue?a.nodeValue=e:a.textContent&&(a.textContent=e)}function r(a){return e(a).is(":visible")?0<e(a).children().length?r(e(a).children().get(0)):a.innerText?a.innerText:a.nodeValue?a.nodeValue:a.textContent?a.textContent:"":""}if(!e.fn.dotdotdot){e.fn.dotdotdot=
function(a){if(0==this.length){var d='No element found for "'+this.selector+'".',d="string"==typeof d?"dotdotdot: "+d:["dotdotdot:",d];"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(d);return this}if(1<this.length)return this.each(function(){e(this).dotdotdot(a)});var c=this;c.data("dotdotdot")&&c.trigger("destroy.dot");c.bind_events=function(){c.bind("update.dot",function(a,d){a.preventDefault();a.stopPropagation();var b=h,f;if("number"==typeof h.height)f=
h.height;else{f=c.outerHeight();for(var g=["paddingTop","paddingBottom"],q=0,s=g.length;q<s;q++){var n=parseInt(c.css(g[q]),10);isNaN(n)&&(n=0);f-=n}}b.maxHeight=f;h.maxHeight+=h.tolerance;if("undefined"!=typeof d){if("string"==typeof d||d instanceof HTMLElement)d=e("<div />").append(d).contents();d instanceof e&&(l=d)}k=c.wrapInner('<div class="dotdotdot" />').children();k.empty().append(l.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});b=g=!1;j.afterElement&&(g=j.afterElement.clone(!0),
j.afterElement.remove());if(k.outerHeight()>h.maxHeight)if("children"==h.wrap){b=k;f=h;q=b.children();s=!1;b.empty();for(var n=0,r=q.length;n<r;n++){var p=q.eq(n);b.append(p);g&&b.append(g);if(b.outerHeight()>f.maxHeight){p.remove();s=!0;break}else g&&g.remove()}b=s}else b=w(k,c,k,h,g);k.replaceWith(k.contents());k=null;e.isFunction(h.callback)&&h.callback.call(c[0],b,l);return j.isTruncated=b}).bind("isTruncated.dot",function(a,b){a.preventDefault();a.stopPropagation();"function"==typeof b&&b.call(c[0],
j.isTruncated);return j.isTruncated}).bind("originalContent.dot",function(a,b){a.preventDefault();a.stopPropagation();"function"==typeof b&&b.call(c[0],l);return l}).bind("destroy.dot",function(a){a.preventDefault();a.stopPropagation();c.unwatch().unbind_events().data("dotdotdot",!1)});return c};c.unbind_events=function(){c.unbind(".dot");return c};c.watch=function(){c.unwatch();if("window"==h.watch){var a=e(window),b=a.width(),d=a.height();a.bind("resize.dot"+j.dotId,function(){if(b!=a.width()||
d!=a.height()||!h.windowResizeFix)b=a.width(),d=a.height(),g&&clearInterval(g),g=setTimeout(function(){c.trigger("update.dot")},10)})}else f=v(c),g=setInterval(function(){var a=v(c);if(f.width!=a.width||f.height!=a.height)c.trigger("update.dot"),f=v(c)},100);return c};c.unwatch=function(){e(window).unbind("resize.dot"+j.dotId);g&&clearInterval(g);return c};var l=c.contents(),h=e.extend(!0,{},e.fn.dotdotdot.defaults,a),j={},f={},g=null,k=null,d=j,b;b=h.after;"undefined"==typeof b||!b?b=!1:"string"==
typeof b?(b=e(b,c),b=b.length?b:!1):b="object"==typeof b?"undefined"==typeof b.jquery?!1:b:!1;d.afterElement=b;j.isTruncated=!1;j.dotId=C++;c.data("dotdotdot",!0).bind_events().trigger("update.dot");h.watch&&c.watch();return c};e.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",lastCharacter:{remove:" ,;.!?".split(""),noEllipsis:[]},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1};var C=1,A=e.fn.html;e.fn.html=function(a){return"undefined"!=typeof a?this.data("dotdotdot")&&
"function"!=typeof a?this.trigger("update",[a]):A.call(this,a):A.call(this)};var B=e.fn.text;e.fn.text=function(a){if("undefined"!=typeof a){if(this.data("dotdotdot")){var d=e("<div />");d.text(a);a=d.html();d.remove();return this.trigger("update",[a])}return B.call(this,a)}return B.call(this)}}})(jQuery);