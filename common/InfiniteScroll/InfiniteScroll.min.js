(function(a){a.fn.infiniteScroll=function(q){var p,m=null,w=null,l=0,z=!0,x=!1,n=!1,r=!1,s=0,k=0,c={scrollBy:"item",direction:"up",duration:1E4,speed:"medium",swipingTimeout:5E3,toggleOddEven:!1,cloneItem:null};a.fn.reverse=[].reverse;window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)};window.cancelRequestAnimFrame=window.cancelAnimationFrame||
window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;q&&(a.extend(c,q),1E3>c.duration&&(c.duration=1E3));p="continuous"==c.scrollBy?"fastest"==c.speed?25:"fast"==c.speed?50:"medium"==c.speed?75:"slow"==c.speed?100:125:"fastest"==c.speed?200:"fast"==c.speed?400:"medium"==c.speed?600:"slow"==c.speed?800:1E3;return this.each(function(){function t(){return"ontouchstart"in window}function q(){!n&&
!r&&(m=setInterval(function(){requestAnimFrame(a.fn.infiniteScroll.scrollContinuously)},p))}function y(){!n&&!r&&("item"==c.scrollBy?a.fn.infiniteScroll.scrollByItem():"page"==c.scrollBy?a.fn.infiniteScroll.scrollByPage():a.error(c.scrollBy+" is not a valid value for scrollBy parameter."))}function u(b){c.toggleOddEven&&0!=a(".item").length%2&&(b.toggleClass("even"),b.toggleClass("odd"))}function A(){var b;"up"==c.direction?b=a(".lastItem:first"):"down"==c.direction&&(b=a(".lastItem:last"));x=b.position().top+
b.outerHeight(!0)<=d.outerHeight(!0)+d.position().top&&b.position().top>=d.position().top?!0:!1}function B(a){clearInterval(m);n=!0;t()?1==a.originalEvent.targetTouches.length&&(s=a.originalEvent.targetTouches[0].clientY):s=a.clientY}function C(){var g=a(".item").length-1;clearTimeout(w);w=setTimeout(function(){if("none"!=c.direction&&"item"!=c.scrollBy)if("up"==c.direction)a(".item").each(function(){if(0>a(this).position().top+a(this).outerHeight(!0))b.append(a(this)),b.css("marginTop",parseInt(b.css("marginTop"))+
a(this).outerHeight(!0)+"px");else return!1});else for(var e=g;0<=e;e--){var j=a(".item").eq(e);if(j.position().top>d.outerHeight(!0))b.prepend(j),b.css("marginTop",parseInt(b.css("marginTop"))-j.outerHeight(!0)+"px");else break}r=!1;a.fn.infiniteScroll.canScroll()&&"none"!=c.direction&&(clearInterval(m),"continuous"==c.scrollBy?q():(y(),m=setInterval(function(){y()},c.duration)))},c.swipingTimeout);r=!0;n=!1;d.trigger("onSwipeEnd")}function D(){n&&(n=!1,a.fn.infiniteScroll.start())}function E(g){var e,
j=0,f=a(".item:first"),h=a(".item:last");if(n&&(t()?1==g.originalEvent.targetTouches.length&&(e=g.originalEvent.targetTouches[0],e=e.clientY):e=g.clientY,k=k+s-e,!(Math.abs(k)<f.outerHeight(!0)))){if(0<k)if(b.css("marginTop",parseInt(b.css("marginTop"))-k+"px"),"item"==c.scrollBy)f.position().top+f.outerHeight(!0)<b.position().top&&b.css("marginTop","0px").append(f);else if("page"==c.scrollBy)a(".item").each(function(){if(a(this).position().top+a(this).outerHeight(!0)<b.position().top)b.css("marginTop",
parseInt(b.css("marginTop"))+a(this).outerHeight(!0)+"px").append(a(this));else return!1});else{if(h=a(".item:last").prev(),0<h.length)for(;h.position().top+h.outerHeight(!0)<=b.position().top+d.outerHeight(!0);)b.css("marginTop",parseInt(b.css("marginTop"))+f.outerHeight(!0)+"px").append(f),f=a(".item:first"),h=a(".item:last").prev()}else if(0>k)if("none"==c.direction||"none"==c.scrollBy||"item"==c.scrollBy){if(b.css("margin-top",parseInt(b.css("margin-top"))-k+"px"),f.position().top>=b.position().top)for(;j<
Math.abs(k);)b.css("margin-top",-h.outerHeight(!0)+"px").prepend(h),j+=h.outerHeight(!0),h=a(".item:last")}else if("page"==c.scrollBy)a(".item").reverse().each(function(){if(a(this).position().top>d.outerHeight(!0)+b.position().top)b.css("marginTop",parseInt(b.css("marginTop"))-a(this).outerHeight(!0)+"px").prepend(a(this));else return!1}),b.css("margin-top",parseInt(b.css("margin-top"))-k+"px");else if(b.css("margin-top",parseInt(b.css("margin-top"))-k+"px"),f=a(".item").eq(1),0<f.length)for(;f.position().top>=
b.position().top;)b.css("margin-top",parseInt(b.css("margin-top"))-h.outerHeight(!0)+"px").prepend(h),f=a(".item").eq(1),h=a(".item:last");k=0;s=e;r=!1;d.trigger("onSwipe")}}var d=a(this),b=d.find(".page");a.fn.infiniteScroll.start=function(){a.fn.infiniteScroll.canScroll()&&("none"!=c.direction&&"none"!=c.scrollBy)&&(clearInterval(m),"continuous"==c.scrollBy?q():m=setInterval(function(){y()},c.duration))};a.fn.infiniteScroll.stop=function(){clearInterval(m);clearTimeout(w);null!=d&&(t()?(d.unbind("touchstart"),
d.unbind("touchmove"),d.unbind("touchend"),d.unbind("touchleave")):(d.unbind("mousedown"),d.unbind("mousemove"),d.unbind("mouseup"),d.unbind("mouseleave")));b=d=null};a.fn.infiniteScroll.pause=function(){clearInterval(m)};a.fn.infiniteScroll.canScroll=function(){return b.height()>d.height()};a.fn.infiniteScroll.scrollToClass=function(b){var c=!1;a(".item").each(function(){if(a(this).hasClass(b))return c=!0,!1;a.fn.infiniteScroll.scrollByItem()});return c};a.fn.infiniteScroll.canScroll()&&(t()?d.bind({touchstart:function(a){B(a)},
touchmove:function(a){E(a)},touchend:function(){C()},touchleave:function(){D()}}):d.bind({mousedown:function(a){B(a)},mousemove:function(a){E(a)},mouseup:function(){C()},mouseleave:function(){D()}}));if(a.fn.infiniteScroll.canScroll())if(a(".item").removeClass("lastItem"),"item"==c.scrollBy||"continuous"==c.scrollBy)a(".item:last").addClass("lastItem");else if("page"==c.scrollBy){l=a(".item").length;a(".item:last").addClass("lastItem");b.append(a(".item").clone(!0));if(0!=l%2)for(var v=l;v<a(".item").length;v++)a(".item").eq(v).toggleClass("even"),
a(".item").eq(v).toggleClass("odd");"down"==c.direction&&b.css("marginTop",b.position().top-a(".item").eq(l).position().top+"px")}a.fn.infiniteScroll.scrollByItem=function(){if("up"==c.direction){var g=d.find(".item:first"),e=0;g&&(e=g.position().top+g.outerHeight(!0),c.cloneItem?c.cloneItem():a(".item:first").hasClass("delete")||b.append(g.clone(!0)),b.animate({marginTop:b.position().top+parseInt(b.css("marginTop"))-e+"px"},p,function(){g.remove();b.css("marginTop","0px");u(a(".item:last"));a(".item:last").hasClass("lastItem")&&
d.trigger("onLastItemScrolled");d.trigger("onScroll")}))}else{var e=d.find(".item:first"),j=d.find(".item:last"),f=0,h=!1;e&&(e.position().top>=b.position().top?(c.cloneItem?c.cloneItem():a(".item:last").hasClass("delete")||(u(a(".item:last")),b.prepend(j.clone(!0))),b.css("marginTop",parseInt(b.css("marginTop"))-j.outerHeight(!0)+"px"),f=j.outerHeight(!0),h=!0):f=b.position().top-e.position().top,b.animate({marginTop:parseInt(b.css("marginTop"))+f+"px"},p,function(){h&&j.remove();a(".item:last").hasClass("lastItem")&&
d.trigger("onLastItemScrolled");d.trigger("onScroll")}))}};a.fn.infiniteScroll.scrollByPage=function(){var g=0,e=0,j=!0;if("up"==c.direction)a(".item").each(function(){var b=a(this).outerHeight(!0);if(a(this).position().top+b>d.height()+d.position().top)return e=d.height()-a(this).position().top,j=!1}),j&&(e=d.height()),b.animate({marginTop:d.position().top-d.height()+e+"px"},p,function(){for(var c=a(".item").length-1;0<=c;c--){var e=a(".item").eq(c),f=e.position().top,h=e.outerHeight(!0);if(f+h<=
b.position().top){f=e.clone(!0);if(0==g)b.append(f);else{var j;j=1==g?b.find(".item:last"):b.find(".item").slice(-g,-g+1);f.insertBefore(j)}e.remove();b.css("marginTop",parseInt(b.css("marginTop"))+h+"px");g++}}d.trigger("onScroll");A();x&&d.trigger("onLastItemScrolled")});else if("down"==c.direction){var f=0;do{l--;0>l&&(l=a(".item").length-1);var h=a(".item").eq(l);f+h.outerHeight(!0)<=d.height()&&(f+=h.outerHeight(!0))}while(f+h.outerHeight(!0)<=d.height());b.animate({marginTop:parseInt(b.css("marginTop"))+
f+"px"},p,function(){a(".item").each(function(c){if(a(this).position().top>=b.position().top)return l=c,!1});a(".item").reverse().each(function(){if(a(this).position().top>d.outerHeight(!0)+b.position().top)b.prepend(a(this)),b.css("marginTop",parseInt(b.css("marginTop"))-a(this).outerHeight(!0)+"px");else return!1});d.trigger("onScroll");A();x&&d.trigger("onLastItemScrolled")})}};a.fn.infiniteScroll.scrollContinuously=function(){var g=a(".item:first"),e=a(".lastItem");"up"==c.direction?(b.css("marginTop",
parseInt(b.css("marginTop"))-1+"px"),0<e.length&&e.position().top+e.outerHeight(!0)<b.position().top&&d.trigger("onLastItemScrolled"),g.position().top+g.outerHeight(!0)<b.position().top&&(b.css("marginTop",parseInt(b.css("marginTop"))+g.outerHeight(!0)),b.append(g),u(g))):(g.position().top==b.position().top&&(b.prepend(a(".item:last")),b.css("marginTop",-a(".item:first").outerHeight(!0)),u(a(".item:first"))),z?z=!1:0<e.length&&e.position().top+e.outerHeight(!0)<=b.position().top&&d.trigger("onLastItemScrolled"),
b.css("marginTop",parseInt(b.css("marginTop"))+1+"px"))}})}})(jQuery);