var RiseVision=RiseVision||{};RiseVision.RSS={},RiseVision.RSS.Settings={},RiseVision.RSS.Controller={},RiseVision.RSS.Settings=function(){this.settings=new RiseVision.Common.Settings},RiseVision.RSS.Settings.prototype.initSettings=function(){var t=this;$(".colorPicker").click(function(){rssSettings.showColorPicker($(this).data("for"))}),$(".fontSelector").click(function(){rssSettings.showFontSelector($(this).data("for"))}),$("input:checkbox").change(function(){"author"==$(this).val()?$(this).is(":checked")?$("li.author").show():$("li.author").hide():"date"==$(this).val()&&($(this).is(":checked")?$("li.date").show():$("li.date").hide())}),$("input[name='layout']").change(function(){var t=$(this).val();!$("#scrollDirection").is(":visible")||"ltr"!=$("#scrollDirection").val()&&"rtl"!=$("#scrollDirection").val()?$(this).is(":checked")&&("4x1-headline.xml"==t||"2x1-headline.xml"==t||"1x2-headline.xml"==t||"custom"==t?($("li.headline").show(),$("li.story").show(),$("li.media").show()):"4x1-no-image.xml"==t?($("li.headline").show(),$("li.story").show(),$("li.media").hide()):"4x1-no-headline.xml"==t||"2x1-no-headline.xml"==t||"1x2-no-headline.xml"==t?($("li.headline").hide(),$("li.story").show(),$("li.media").show()):"4x1-no-image-no-headline.xml"==t?($("li.headline").hide(),$("li.story").show(),$("li.media").hide()):($("li.headline").hide(),$("li.story").hide(),$("li.media").show())):($("li.headline").show(),$("li.story").show(),$("li.media").hide())}),$("#transition").change(function(){"continuous"==$(this).val()||"page"==$(this).val()&&("ltr"==$("#scrollDirection").val()||"rtl"==$("#scrollDirection").val())?$("li.transitionHold").hide():$("li.transitionHold").show(),"fade"!=$(this).val()&&"none"!=$(this).val()?($("li.transition").show(),"item"==$(this).val()||"continuous"==$(this).val()?$("li.separator").show():$("li.separator").hide(),("ltr"==$("#scrollDirection").val()||"rtl"==$("#scrollDirection").val())&&($("li.itemsCount").hide(),$("li.layout").hide())):($("li.itemsCount").show(),$("li.transition").hide(),$("li.layout").show()),$("input[name='layout']").trigger("change"),t.setSeparatorVisibility()}),$("#scrollDirection").change(function(){!$(this).is(":visible")||"ltr"!=$(this).val()&&"rtl"!=$(this).val()?($("li.itemsCount").show(),$("li.layout").show(),$("li.media").show(),$("li.headlineColor").show(),$("li.storyColor").show(),$("li.authorColor").show(),$("li.dateColor").show(),"continuous"!=$("#transition").val()&&$("li.transitionHold").show()):($("li.itemsCount").hide(),$("li.layout").hide(),$("li.media").hide(),$("li.headlineColor").hide(),$("li.storyColor").hide(),$("li.authorColor").hide(),$("li.dateColor").hide(),"page"==$("#transition").val()&&$("li.transitionHold").hide()),$("input[name='layout']").trigger("change"),t.setSeparatorVisibility()}),$("#separator").change(function(){$(this).is(":visible")&&$(this).is(":checked")?$("li.separatorDetails").show():$("li.separatorDetails").hide()}),gadgets.rpc.call("","rscmd_getAdditionalParams",function(e){if(e){var i=new gadgets.Prefs;e=JSON.parse(e),$("#url").val(i.getString("url")),$("#queue").val(i.getString("queue")),$("#itemsCount").val(i.getString("itemsCount")),$("#transition").val(i.getString("transition")),$("#scrollDirection").val(i.getString("scrollDirection")),$("#scrollSpeed").val(i.getString("scrollSpeed")),$("#separator").attr("checked",i.getBool("separator")),$("#separatorColor").val(i.getString("separatorColor")),$("#separatorSize").val(i.getString("separatorSize")),$("#transitionHold").val(i.getString("transitionHold")),$("#transitionResumes").val(i.getString("transitionResumes")),$("#bgColor").val(i.getString("bgColor")),$("input[type='radio'][name='contentType']").each(function(){$(this).val()==i.getString("contentType")&&$(this).attr("checked","checked")}),$("#author").attr("checked",i.getBool("author")),$("#date").attr("checked",i.getBool("date")),$("input[type='radio'][name='layout']").each(function(){$(this).val()==i.getString("layout")&&$(this).attr("checked","checked")}),$("#layoutURL").val(i.getString("layoutURL")),i.getBool("separator")&&$("li.separatorDetails").show(),t.populateColor($("#separatorColor"),i.getString("separatorColor")),t.populateColor($("#bgColor"),i.getString("bgColor")),t.populateColor($("#headlineColor"),e.headlineColor),t.populateColor($("#storyColor"),e.storyColor),t.populateColor($("#authorColor"),e.authorColor),t.populateColor($("#dateColor"),e.dateColor),$("#headline_font-style").text(e.headline_font),$("#headline_font-style").data("css",e["headline_font-style"]),$("#headlinePadding").val(e.headlinePadding),$("#headlineColor").val(e.headlineColor),$("#story_font-style").text(e.story_font),$("#story_font-style").data("css",e["story_font-style"]),$("#storyPadding").val(e.storyPadding),$("#storyColor").val(e.storyColor),$("#mediaPadding").val(e.mediaPadding),$("#author_font-style").text(e.author_font),$("#author_font-style").data("css",e["author_font-style"]),$("#authorPadding").val(e.authorPadding),$("#authorColor").val(e.authorColor),$("#date_font-style").text(e.date_font),$("#date_font-style").data("css",e["date_font-style"]),$("#datePadding").val(e.datePadding),$("#dateColor").val(e.dateColor)}$("form ol li ol.drillDown li:visible:last").css({clear:"left","float":"left","margin-bottom":"10px"}),$("#settings").show(),$("input:checkbox").trigger("change"),$("#transition").trigger("change"),$("#scrollDirection").trigger("change")})},RiseVision.RSS.Settings.prototype.setSeparatorVisibility=function(){"up"!=$("#scrollDirection").val()&&"down"!=$("#scrollDirection").val()||"item"!=$("#transition").val()&&"continuous"!=$("#transition").val()?$("li.separator").hide():$("li.separator").show(),$("#separator").trigger("change")},RiseVision.RSS.Settings.prototype.populateColor=function(t,e){t.val(e),t.css("background-color",e)},RiseVision.RSS.Settings.prototype.showColorPicker=function(t){gadgets.rpc.call("","rscmd_openColorPicker",null,t,$("#"+t).val())},RiseVision.RSS.Settings.prototype.showFontSelector=function(t){gadgets.rpc.call("","rscmd_openFontSelector",null,t,$("#"+t).data("css"))},RiseVision.RSS.Settings.prototype.setColor=function(t,e){$("#"+t).val(e),$("#"+t).css("background-color",e)},RiseVision.RSS.Settings.prototype.setFont=function(t,e,i){$("#"+t).data("css",e),$("#"+t).text(i)},RiseVision.RSS.Settings.prototype.getSettings=function(){var t,e=!1,i=document.getElementsByClassName("errors")[0],s="",o=null;if($(".errors").empty(),$(".errors").css({display:"none"}),""!=$("#url").val){var n=new google.feeds.Feed($("#url").val());n.setNumEntries(1),n.load(function(n){return n.error&&(i.innerHTML+="RSS URL is invalid.<br />",e=!0),e=rssSettings.settings.validateRequired($("#url"),i,"RSS URL")?!0:e,e=rssSettings.settings.validateRequired($("#queue"),i,"Queue")?!0:e,e=rssSettings.settings.validateNumeric($("#queue"),i,"Queue")?!0:e,parseInt($("#queue").val())<=0&&(i.innerHTML+="Queue must be greater than 0.<br />",e=!0),e=rssSettings.settings.validateRequired($("#itemsCount"),i,"Items Count")?!0:e,e=rssSettings.settings.validateNumeric($("#itemsCount"),i,"Items Count")?!0:e,$("#itemsCount").is(":visible")&&parseInt($("#itemsCount").val())<=0&&(i.innerHTML+="Items Count must be greater than 0.<br />",e=!0),$("#separatorSize").is(":visible")&&(e=rssSettings.settings.validateNumeric($("#separatorSize"),i,"Separator Size")?!0:e),e=rssSettings.settings.validateRequired($("#transitionHold"),i,"Transition Hold")?!0:e,e=rssSettings.settings.validateNumeric($("#transitionHold"),i,"Transition Hold")?!0:e,$("#transitionHold").is(":visible")&&parseInt($("#transitionHold").val())<=0&&(i.innerHTML+="Transition Hold must be greater than 0.<br />",e=!0),e=rssSettings.settings.validateRequired($("#transitionResumes"),i,"Transition Resumes")?!0:e,e=rssSettings.settings.validateNumeric($("#transitionResumes"),i,"Transition Resumes")?!0:e,$("#transitionResumes").is(":visible")&&parseInt($("#transitionResumes").val())<=0&&(i.innerHTML+="Transition Resumes must be greater than 0.<br />",e=!0),e=rssSettings.settings.validateNumeric($("#headlinePadding"),i,"Headline Padding")?!0:e,e=rssSettings.settings.validateNumeric($("#storyPadding"),i,"Summary / Story Padding")?!0:e,e=rssSettings.settings.validateNumeric($("#mediaPadding"),i,"Media Padding")?!0:e,e=rssSettings.settings.validateNumeric($("#authorPadding"),i,"Author Padding")?!0:e,e=rssSettings.settings.validateNumeric($("#datePadding"),i,"Date Padding")?!0:e,"custom"==$("input[type='radio'][name='layout']:checked").val()&&(e=rssSettings.settings.validateRequired($("#layoutURL"),i,"Layout URL")?!0:e),e?($(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null):(s="up_url="+escape($("#url").val())+"&up_queue="+$("#queue").val()+"&up_itemsCount="+$("#itemsCount").val()+"&up_transition="+$("#transition").val()+"&up_scrollDirection="+$("#scrollDirection").val()+"&up_scrollSpeed="+$("#scrollSpeed").val(),s+="&up_separatorColor="+$("#separatorColor").val()+"&up_separatorSize="+$("#separatorSize").val()+"&up_transitionHold="+$("#transitionHold").val()+"&up_transitionResumes="+$("#transitionResumes").val()+"&up_bgColor="+$("#bgColor").val(),s+=$("#separator").is(":checked")?"&up_separator=true":"&up_separator=false",t=$("input[type='radio'][name='contentType']:checked"),t.length>0&&(s+="&up_contentType="+t.val()),s+=$("#author").is(":checked")?"&up_author=true":"&up_author=false",s+=$("#date").is(":checked")?"&up_date=true":"&up_date=false",t=$("input[type='radio'][name='layout']:checked"),t.length>0&&(s+="&up_layout="+t.val()),s+="&up_layoutURL="+$("#layoutURL").val(),o={params:s,additionalParams:JSON.stringify(rssSettings.saveAdditionalParams())},gadgets.rpc.call("","rscmd_saveSettings",null,o),void 0)})}},RiseVision.RSS.Settings.prototype.saveAdditionalParams=function(){var t={};return t.headline_font=$("#headline_font-style").text(),t["headline_font-style"]=$("#headline_font-style").data("css"),t.headlinePadding=""==$("#headlinePadding").val()?0:$("#headlinePadding").val(),t.headlineColor=$("#headlineColor").val(),t.story_font=$("#story_font-style").text(),t["story_font-style"]=$("#story_font-style").data("css"),t.storyPadding=""==$("#storyPadding").val()?0:$("#storyPadding").val(),t.storyColor=$("#storyColor").val(),t.mediaPadding=""==$("#mediaPadding").val()?0:$("#mediaPadding").val(),t.author_font=$("#author_font-style").text(),t["author_font-style"]=$("#author_font-style").data("css"),t.authorPadding=""==$("#authorPadding").val()?0:$("#authorPadding").val(),t.authorColor=$("#authorColor").val(),t.date_font=$("#date_font-style").text(),t["date_font-style"]=$("#date_font-style").data("css"),t.datePadding=""==$("#datePadding").val()?0:$("#datePadding").val(),t.dateColor=$("#dateColor").val(),t},RiseVision.RSS.Controller=function(){this.isFeedLoaded=!1,this.currentItemIndex=0,this.nextItemIndex=0,this.imageCount=0,this.feedLoadFailedInterval=5e3,this.refreshInterval=6e4,this.images=new Array,this.layout=prefs.getString("layout"),this.itemsCount=prefs.getInt("itemsCount"),this.transition=prefs.getString("transition"),this.transitionHold=1e3*prefs.getInt("transitionHold"),this.transitionResumes=1e3*prefs.getInt("transitionResumes"),this.scrollDirection=prefs.getString("scrollDirection"),this.startTimeout=new Date,this.timeLeft=0,this.isLoading=!0,this.isPlaying=!1,this.isPaused=!1,this.isDone=!1,this.isFadingIn=!1,this.isFadingOut=!1,this.supportedImages=new Array("image/bmp","image/gif","image/jpeg","image/png","image/tiff"),this.supportedVideos=new Array("video/mp4","video/webm","video/ogg"),this.util=RiseVision.Common.Utility,this.layoutURL="custom"==prefs.getString("layout")?prefs.getString("layoutURL"):"https://s3.amazonaws.com/Gadget-RSS/layouts/"+prefs.getString("layout"),this.isMediaLayout="4x1-no-image-no-headline"==prefs.getString("layout")||"4x1-no-image"==prefs.getString("layout")?!1:!0},RiseVision.RSS.Controller.prototype.getAdditionalParams=function(t,e){if("additionalParams"==t&&e){var i=document.createElement("style");e=JSON.parse(e),i.appendChild(document.createTextNode(e["headline_font-style"])),i.appendChild(document.createTextNode("a:active"+e["headline_font-style"])),i.appendChild(document.createTextNode("a:visited"+e["headline_font-style"])),i.appendChild(document.createTextNode(e["story_font-style"])),i.appendChild(document.createTextNode(e["author_font-style"])),i.appendChild(document.createTextNode(e["date_font-style"])),document.getElementsByTagName("head")[0].appendChild(i),controller.headlinePadding=parseInt(e.headlinePadding),controller.headlineColor=e.headlineColor,controller.storyPadding=parseInt(e.storyPadding),controller.storyColor=e.storyColor,controller.mediaPadding=parseInt(e.mediaPadding),controller.authorPadding=parseInt(e.authorPadding),controller.authorColor=e.authorColor,controller.datePadding=parseInt(e.datePadding),controller.dateColor=e.dateColor}controller.initialize()},RiseVision.RSS.Controller.prototype.initialize=function(){var t=this,e={};this.layoutURL&&(e[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.layoutURL,function(i){var s=i.data;if(s.getElementsByTagName("Style").length>0){var o=document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.innerHTML=s.getElementsByTagName("Style")[0].childNodes[1].nodeValue,o.appendChild(n)}0!=s.getElementsByTagName("Layout").length&&(t.item=s.getElementsByTagName("Layout")[0].childNodes[1].nodeValue,e[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,e[gadgets.io.RequestParameters.REFRESH_INTERVAL]=60,gadgets.io.makeRequest(prefs.getString("url"),function(e){t.onFeedLoaded(e)},e))},e))},RiseVision.RSS.Controller.prototype.loadFeed=function(){var t=this,e={},i=prefs.getString("url");this.feedLoadFailedTimer=setTimeout(function(){t.feedLoadFailed()},this.feedLoadFailedInterval),e[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,e[gadgets.io.RequestParameters.REFRESH_INTERVAL]=60,gadgets.io.makeRequest(i,function(e){0==e.errors.length&&(t.isFeedLoaded||(clearTimeout(t.feedLoadFailedTimer),t.onFeedLoaded(e)))},e)},RiseVision.RSS.Controller.prototype.onFeedLoaded=function(t){var e,i=prefs.getInt("queue");this.isFeedLoaded=!0;for(var s=t.data.getElementsByTagName("item").length-1;s>=i;s--)e=t.data.getElementsByTagName("item")[s],e.parentNode.removeChild(e);t.data&&t.data.getElementsByTagName("item").length>0?this.showFeed(t):(console.log("This feed has no items."),readyEvent())},RiseVision.RSS.Controller.prototype.feedLoadFailed=function(){this.isFeedLoaded=!0,"fade"==this.transition?(this.isFadingIn=!1,this.isFadingOut=!1,this.isPaused||this.showItem()):"none"==this.transition&&(this.isPaused||this.showItem())},RiseVision.RSS.Controller.prototype.showFeed=function(t){var e=[];if(this.isHorizontal())if(this.isLoading){this.feedData=t.data,this.items=this.feedData.getElementsByTagName("item"),$("#hiddenContainer").remove(),$("#container").remove();for(var i=0;i<this.items.length;i++)e.push(this.getHorizontalScrollData(this.items[i]));var s={width:prefs.getInt("rsW"),height:prefs.getInt("rsH"),scrollBy:this.transition,scrollDirection:this.scrollDirection,speed:prefs.getString("scrollSpeed"),duration:this.transitionHold,interactivityTimeout:this.transitionResumes};this.horizontalScroll=new RiseVision.Common.HorizontalScroll(s,e),$(this.horizontalScroll).bind({done:function(){doneEvent()}}),readyEvent()}else this.oldData=this.feedData,this.feedData=t.data,this.items=this.feedData.getElementsByTagName("item"),this.updateHorizontalScrollData();else null!=this.feedData&&(this.oldData=this.feedData),this.feedData=t.data,this.items=this.feedData.getElementsByTagName("item"),this.imageURLs=new Array,this.videos=new Array,this.isMediaLayout&&this.getMedia(),this.hasImage()&&this.isMediaLayout?this.preloadImages():"fade"==this.transition?(this.isFadingIn=!1,this.isFadingOut=!1,this.isLoading?this.init():this.showItem()):"none"==this.transition?this.isLoading?this.init():this.showItem():this.isLoading?this.init():this.updateVerticalScrollData()},RiseVision.RSS.Controller.prototype.init=function(){var t=this;if(this.playlists=[],$("#container").width(prefs.getString("rsW")),$("#container").height(prefs.getString("rsH")),"fade"==this.transition||"none"==this.transition?($(".page").bind({touchstart:function(){clearTimeout(t.showFeedTimer),t.showFeedTimer=setTimeout(function(){t.showNext()},t.transitionResumes)}}),this.addItems(),$(".item").each(function(e){t.nextItemIndex<t.items.length&&(t.populateItem(t.items[t.nextItemIndex],e,t.nextItemIndex),t.nextItemIndex++)})):(this.showAllItems(),$(".item").height(this.getItemHeight())),this.isLoading){if(this.videos.length>0&&("fade"==this.transition||"none"==this.transition)){for(var e=0;e<this.videos.length;e++)null!=this.videos[e]&&this.playlists.push({sources:[{file:this.videos[e].url,type:"video/quicktime"==this.videos[e].type?"mp4":""}]});this.playlists.length>0?$(".video").each(function(e){t.videosLoaded=0,$(this).attr("id","video"+e),t.initPlayer(e)}):readyEvent()}else this.videos.length>0&&(console.log("Videos are only supported for the Fade and None transitions."),$(".videoWrapper").hide()),readyEvent();"fade"!=this.transition&&"none"!=this.transition&&$("#container").infiniteScroll({direction:this.scrollDirection,scrollBy:this.transition,duration:this.transitionHold,speed:prefs.getString("scrollSpeed"),swipingTimeout:this.transitionResumes}).bind("onLastItemScrolled",function(){doneEvent()})}},RiseVision.RSS.Controller.prototype.addItems=function(){if(0==this.playlists.length){$(".item").remove();for(var t=0;t<this.itemsCount;t++)$(".page").append(this.item);this.applyStyle(),$(".item").height(this.getItemHeight())}},RiseVision.RSS.Controller.prototype.initPlayer=function(t){var e=this;this.dimensions=this.getMediaDimensions(t,this.videos[t]),jwplayer("video"+t).setup({playlist:this.playlists,width:this.dimensions.width,height:this.dimensions.height,primary:"flash",controls:!1,mute:!1}),jwplayer("video"+t).onReady(function(){var t;e.isLoading?(e.videosLoaded++,e.videosLoaded==$(".videoWrapper").length&&(t=e.currentItemIndex,$(".videoWrapper").each(function(e){jwplayer(e).playlistItem(t),jwplayer(e).play(!1),t++}),readyEvent())):(t=e.currentItemIndex,$(".videoWrapper").each(function(e){jwplayer(e).playlistItem(t),e>0&&jwplayer(e).play(!1),t++}))}),jwplayer("video"+t).onPause(function(t){var i=this;"BUFFERING"==t.oldstate||e.isPaused||(e.resumeVideoTimer=setTimeout(function(){i.play(!0)},e.transitionResumes))}),jwplayer("video"+t).onComplete(function(){var t=!1,i=e.currentItemIndex;("fade"==e.transition||"none"==e.transition)&&($(".videoWrapper").each(function(e){"PLAYING"==jwplayer(e).getState()?t=!0:"IDLE"==jwplayer(e).getState()&&(jwplayer(e).playlistItem(i),jwplayer(e).play(!1)),i++}),t||e.showNext())}),jwplayer("video"+t).onError(function(t){console.log(t)})},RiseVision.RSS.Controller.prototype.applyStyle=function(){$(".headline").css({padding:this.headlinePadding,"background-color":this.headlineColor}),$(".story").css({padding:this.storyPadding,"background-color":this.storyColor}),$(".image, .videoWrapper").css({padding:this.mediaPadding}),$(".author").css({padding:this.authorPadding,"background-color":this.authorColor}),$(".date").css({padding:this.datePadding,"background-color":this.dateColor})},RiseVision.RSS.Controller.prototype.getMedia=function(){for(var t,e,i,s,o,n,a,r=this.feedData.getElementsByTagName("item").length,l=0;r>l;l++){if(n=!1,t=this.items[l],story=this.getStory(t),e=this.util.getElementByNodeName(t,"media:content"),a=t.getElementsByTagName("enclosure"),null!=e){if(i=e[0].getAttribute("medium"),s=e[0].getAttribute("url"),o=e[0].getAttribute("type"),null!=i)"image"==i?this.urlExists(s,story)||(this.imageURLs.push(s),n=!0):"video"==i&&(this.urlExists(s,story)||(this.videos.push({url:s,type:o,width:e[0].getAttribute("width"),height:e[0].getAttribute("height"),position:0}),n=!0));else if(null!=o){for(var d in this.supportedImages)if(o==this.supportedImages[d]){this.urlExists(s,story)||(this.imageURLs.push(s),n=!0);break}if(!n)for(var d in this.supportedVideos)if(o==this.supportedVideos[d]){this.urlExists(s,story)||(this.videos.push({url:s,type:o,width:e[0].getAttribute("width"),height:e[0].getAttribute("height"),position:0}),n=!0);break}}}else if(null!=a&&a.length>0){s=a[0].getAttribute("url"),o=a[0].getAttribute("type");for(var d in this.supportedImages)if(o==this.supportedImages[d]){this.urlExists(s,story)||(this.imageURLs.push(s),n=!0);break}if(!n)for(var d in this.supportedVideos)if(o==this.supportedVideos[d]){this.urlExists(s,story)||(this.videos.push({url:s,type:o,position:0}),n=!0);break}}n||(this.imageURLs.push(null),this.videos.push(null))}},RiseVision.RSS.Controller.prototype.preloadImages=function(){var t=this.imageURLs.length;this.imageCount=0,this.images=new Array,this.loadImage(t)},RiseVision.RSS.Controller.prototype.loadImage=function(t){var e,i=this;null==this.imageURLs[this.imageCount]?this.onImageLoaded(null,t):(e=new Image,e.onload=function(){clearTimeout(i.feedLoadFailedTimer),i.onImageLoaded(e,t)},this.feedLoadFailedTimer=setTimeout(function(){i.feedLoadFailed()},this.feedLoadFailedInterval),e.src=this.imageURLs[this.imageCount])},RiseVision.RSS.Controller.prototype.onImageLoaded=function(t,e){this.images.push(t),this.imageCount++,e--,0==e?this.isLoading?this.init():"fade"==this.transition?(this.isFadingIn=!1,this.isFadingOut=!1,this.showItem()):"none"==this.transition?this.showItem():this.updateVerticalScrollData():this.loadImage(e)},RiseVision.RSS.Controller.prototype.populateItem=function(t,e,i){var s=this.util.getNodeValue(t.getElementsByTagName("title")),o=this.getStory(t),n=this.util.getNodeValue(this.util.getElementByNodeName(t,"dc:creator")),a=this.util.getNodeValue(t.getElementsByTagName("pubDate"));""==s?$(".headline").eq(e).hide():($(".headline a").eq(e).html(s),$(".headline").eq(e).show()),""!=o?("summary"==prefs.getString("contentType")?$(".story").eq(e).text(RiseVision.Common.Utility.truncate($("<div/>").html(RiseVision.Common.Utility.stripScripts(o)).text(),120)):($(".story").eq(e).html(RiseVision.Common.Utility.stripScripts(o)),$(".story").find("p").addClass("story_font-style"),$(".story").find("div").addClass("story_font-style"),$(".story").find("span").addClass("story_font-style")),$(".story").eq(e).show()):$(".story").eq(e).hide(),$(".separator").eq(e).show(),prefs.getBool("author")&&""!=n?($(".author").eq(e).html(n),$(".author").eq(e).show()):($(".author").eq(e).hide(),$(".separator").eq(e).hide()),prefs.getBool("date")&&""!=a?($(".date").eq(e).text(new Date(a).toString("MMMM dS, yyyy")),$(".date").eq(e).attr("datetime",new Date(a).toString("yyyy-MM-dd")),$(".date").eq(e).show()):($(".date").eq(e).hide(),$(".separator").eq(e).hide()),this.showSeparator()&&$(".item").css("border-bottom","solid "+prefs.getInt("separatorSize")+"px "+prefs.getString("separatorColor")),null!=this.images[i]&&this.images[i].src?($(".videoWrapper").eq(e).hide(),$(".image").eq(e).attr("src",this.images[i].src),$(".image").eq(e).show(),this.getMediaDimensions(e,this.images[i],$("#container .image").eq(e))):null!=this.videos[i]?($(".image").eq(e).hide(),$(".videoWrapper").eq(e).show(),this.isLoading||(jwplayer(e).playlistItem(i),jwplayer(e).play(!1))):($(".image").eq(e).hide(),$(".videoWrapper").eq(e).hide()),("fade"!=this.transition&&"none"!=this.transition&&0==this.playlists.length||this.isLoading)&&$(".item").eq(e).dotdotdot({height:this.getItemHeight()})},RiseVision.RSS.Controller.prototype.getMediaDimensions=function(t,e,i){var s,o,n,a={};return $("#hiddenContainer").empty(),$("#hiddenContainer").append($(".item").clone()),"2x1-headline.xml"==prefs.getString("layout")||"2x1-no-headline.xml"==prefs.getString("layout")?(a.width=.5*prefs.getString("rsW"),a.height=prefs.getString("rsH")/this.itemsCount-$("#hiddenContainer .textWrapper").eq(t).outerHeight(!0)-2*this.mediaPadding,0==$("#hiddenContainer .story").eq(t).length&&"2x1-headline.xml"==prefs.getString("layout")&&(a.width=prefs.getString("rsW")-2*this.mediaPadding)):"1x2-headline.xml"==prefs.getString("layout")||"1x2-no-headline.xml"==prefs.getString("layout")?(a.width=prefs.getString("rsW")-2*this.mediaPadding,a.height=(prefs.getString("rsH")/this.itemsCount-2*this.mediaPadding)/2):"4x1-headline.xml"==prefs.getString("layout")||"4x1-no-headline.xml"==prefs.getString("layout")?(a.width=.33*prefs.getString("rsW"),a.height=prefs.getString("rsH")/this.itemsCount-2*this.mediaPadding):"background.xml"==prefs.getString("layout")&&(a.width=prefs.getString("rsW")-2*this.mediaPadding,a.height=prefs.getString("rsH")/this.itemsCount-prefs.getInt("separatorSize")-2*this.mediaPadding),$.isEmptyObject(a)||(s=a.width/parseInt(e.width),o=a.height/parseInt(e.height),n=o>s?s:o,a.width=parseInt(parseInt(e.width)*n),a.height=parseInt(parseInt(e.height)*n),null!=i&&(i.width(a.width),i.height(a.height))),$("#hiddenContainer").empty(),a},RiseVision.RSS.Controller.prototype.getHorizontalScrollData=function(t){for(var e,i,s,o,n=[],a=!1,r=this.util.getNodeValue(t.getElementsByTagName("title")),l=this.getStory(t),d=this.util.getNodeValue(this.util.getElementByNodeName(t,"dc:creator")),h=this.util.getNodeValue(t.getElementsByTagName("pubDate")),u=0;u<document.styleSheets[2].cssRules.length;u++){var g=document.styleSheets[2].cssRules[u].cssText;-1==g.indexOf("@font-face")&&(-1!=g.indexOf("headline_font-style")&&(e=document.styleSheets[2].cssRules[u].cssText),-1!=g.indexOf("story_font-style")&&(i=document.styleSheets[2].cssRules[u].cssText),-1!=g.indexOf("author_font-style")&&(s=document.styleSheets[2].cssRules[u].cssText),-1!=g.indexOf("date_font-style")&&(o=document.styleSheets[2].cssRules[u].cssText))}return""!=r&&n.push({type:"text",value:r,fontRule:e,padding:this.headlinePadding,background:prefs.getString("headlineColor")}),prefs.getBool("author")&&""!=d&&(n.push({type:"text",value:d,fontRule:s,padding:this.authorPadding,background:prefs.getString("authorColor")}),a=!0),prefs.getBool("date")&&""!=h&&(a&&n.push({type:"text",value:" - ",fontRule:s,padding:this.authorPadding,background:prefs.getString("dateColor")}),n.push({type:"text",value:new Date(h).toString("MMMM dS, yyyy"),fontRule:o,padding:this.datePadding,background:prefs.getString("dateColor")})),null!=l&&(l="summary"==prefs.getString("contentType")?RiseVision.Common.Utility.truncate($("<div/>").html(RiseVision.Common.Utility.stripScripts(l)).text(),120):RiseVision.Common.Utility.unescapeHTML(RiseVision.Common.Utility.stripScripts(l)),n.push({type:"text",value:l,fontRule:i,padding:this.storyPadding,background:prefs.getString("storyColor")})),n},RiseVision.RSS.Controller.prototype.updateHorizontalScrollData=function(){var t=this,e=this.oldData.getElementsByTagName("item");null!=e&&null!=this.items&&(this.items.length!=e.length?$.each(this.items,function(e,i){t.updateItem(e,i)}):$.each(this.items,function(i,s){var o=e[i],n=!1;t.util.getNodeValue(s.getElementsByTagName("headline"))!=t.util.getNodeValue(o.getElementsByTagName("headline"))&&(n=!0),prefs.getBool("author")&&t.util.getNodeValue(s.getElementsByTagName("dc:creator"))!=t.util.getNodeValue(o.getElementsByTagName("dc:creator"))&&(n=!0),prefs.getBool("date")&&t.util.getNodeValue(s.getElementsByTagName("pubDate"))!=t.util.getNodeValue(o.getElementsByTagName("pubDate"))&&(n=!0),t.util.getNodeValue(s.getElementsByTagName("description"))!=t.util.getNodeValue(o.getElementsByTagName("description"))&&(n=!0),n&&t.updateItem(i,s)}))},RiseVision.RSS.Controller.prototype.updateItem=function(t,e){var i=[];i=this.getHorizontalScrollData(e),this.horizontalScroll.updateItem(t,i),i=null},RiseVision.RSS.Controller.prototype.showAllItems=function(){for(var t=this.items.length,e=0;t>e;e++)$(".page").append(this.item);this.applyStyle();for(var e=0;t>e;e++)this.populateItem(this.items[e],e,e)},RiseVision.RSS.Controller.prototype.updateVerticalScrollData=function(){var t,e,i,s,o,n,a,r,l=this,d=this.oldData.getElementsByTagName("item");$.each(this.items,function(h,u){if(t=d[h],e=l.util.getNodeValue(u.getElementsByTagName("link")),i=l.util.getNodeValue(u.getElementsByTagName("title")),s=l.getStory(u),o=l.util.getNodeValue(l.util.getElementByNodeName(u,"dc:creator")),n=l.util.getNodeValue(u.getElementsByTagName("pubDate")),a=l.util.getNodeValue(t.getElementsByTagName("link")),r=l.util.getNodeValue(t.getElementsByTagName("title")),e!=a||i!=r){var g=$(".item").eq(h);g.find(".headline a").text(RiseVision.Common.Utility.unescapeHTML(i)),g.find(".headline").show(),""!=s?("summary"==prefs.getString("contentType")?g.find(".story").eq(h).text(RiseVision.Common.Utility.truncate($("<div/>").html(RiseVision.Common.Utility.stripScripts(s)).text(),120)):g.find(".story").eq(h).html(RiseVision.Common.Utility.stripScripts(s)),g.find(".story").eq(h).show()):g.find(".story").eq(h).hide(),g.find(".separator").eq(h).show(),prefs.getBool("author")&&""!=o?(g.find(".author").eq(h).html(o),g.find(".author").eq(h).show()):(g.find(".author").eq(h).hide(),g.find(".separator").eq(h).hide()),prefs.getBool("date")&&""!=n?(g.find(".date").eq(h).text(new Date(n).toString("MMMM dS, yyyy")),g.find(".date").eq(h).attr("datetime",new Date(n).toString("yyyy-MM-dd")),g.find(".date").eq(h).show()):(g.find(".date").eq(h).hide(),g.find(".separator").eq(h).hide())}})},RiseVision.RSS.Controller.prototype.showItem=function(){var t,e=this;this.items&&(this.currentItemIndex>=this.items.length?(this.timeLeft=0,this.currentItemIndex=0,this.nextItemIndex=0,this.isDone=!0,doneEvent()):this.isLoading?(t=this.hasVideo(this.currentItemIndex),"fade"==this.transition&&(this.transitionHold=1e3*prefs.getInt("transitionHold")-600),t||this.startTimer()):(t=this.hasVideo(this.currentItemIndex),this.addItems(),$(".item").each(function(t){e.nextItemIndex<e.items.length?(e.populateItem(e.items[e.nextItemIndex],t,e.nextItemIndex),$(".item").eq(t).show()):$(".item").eq(t).hide(),e.nextItemIndex++}),"fade"==this.transition?(this.transitionHold=1e3*prefs.getInt("transitionHold")-1200,this.isFadingIn||this.isFadingOut||(this.isFadingIn=!0,t||($("#container").css({visibility:"hidden"}),$(".item").dotdotdot({height:this.getItemHeight()}),$("#container").css({visibility:"visible"})),$("#container").fadeTo("slow",1,function(){e.isFadingIn=!1,e.isPaused||(t?jwplayer(0).playlistItem(e.currentItemIndex):e.startTimer())}))):(t||$(".item").dotdotdot({height:this.getItemHeight()}),this.isPaused||(t?jwplayer(0).playlistItem(this.currentItemIndex):this.startTimer()))))},RiseVision.RSS.Controller.prototype.showNext=function(){"fade"==this.transition?this.fadeOut():this.transitionOut()},RiseVision.RSS.Controller.prototype.transitionOut=function(){var t=this;this.showFeedTimer=null,this.currentItemIndex=this.nextItemIndex,this.isPaused||setTimeout(function(){t.showItem.call(t)},1e3)},RiseVision.RSS.Controller.prototype.fadeOut=function(){var t=this;this.isFadingIn||this.isFadingOut||(this.showFeedTimer=null,this.isFadingOut=!0,$("#container").fadeTo("slow",.01,function(){t.isFadingOut=!1,t.currentItemIndex=t.nextItemIndex,t.isPaused||t.showItem()}))},RiseVision.RSS.Controller.prototype.startTimer=function(){var t=this;clearTimeout(this.showFeedTimer),this.showFeedTimer=setTimeout(function(){t.showNext()},this.transitionHold),this.isPaused||(this.startTimeout=new Date)},RiseVision.RSS.Controller.prototype.pauseTimer=function(){var t,e=!1;this.isPlaying&&(clearTimeout(this.showFeedTimer),clearTimeout(this.resumeVideoTimer),$(".videoWrapper").each(function(t){$(this).is(":visible")&&(jwplayer(t).play(!1),e=!0)}),$(".item:first").is(":visible")&&(this.timeLeft=this.transitionHold,this.timeLeft-=new Date-this.startTimeout,t=Math.round(this.timeLeft/1e3),this.timeLeft=1e3*t,(this.isDone||prefs.getInt("transitionHold")>=20&&10>=t)&&(this.timeLeft=0,this.isDone?this.isFeedLoaded?this.showItem():this.loadFeed():this.showNext())))},RiseVision.RSS.Controller.prototype.resumeTimer=function(){var t=this;if(this.hasVideo(this.currentItemIndex))this.isDone?this.isDone=!1:(this.showItem(),jwplayer(0).play(!0));
else{if(this.isLoading)return this.timeLeft=this.transitionHold,void(this.isFeedLoaded?this.showItem():this.loadFeed());this.isDone&&(this.timeLeft=this.transitionHold,this.isDone=!1),clearTimeout(this.showFeedTimer),this.showFeedTimer=setTimeout(function(){t.showNext()},this.timeLeft)}},RiseVision.RSS.Controller.prototype.getStory=function(t){var e=this.util.getElementByNodeName(t,"content:encoded");return null==e&&(e=this.util.getElementByNodeName(t,"description")),this.util.getNodeValue(e)},RiseVision.RSS.Controller.prototype.getItemHeight=function(){return this.showSeparator()?prefs.getInt("rsH")/this.itemsCount-prefs.getInt("separatorSize"):prefs.getInt("rsH")/this.itemsCount},RiseVision.RSS.Controller.prototype.expireUpdatesTimer=function(){this.refresh=!0},RiseVision.RSS.Controller.prototype.isHorizontal=function(){return"fade"!=this.transition&&"none"!=this.transition?"ltr"==this.scrollDirection||"rtl"==this.scrollDirection:!1},RiseVision.RSS.Controller.prototype.showSeparator=function(){return!prefs.getBool("separator")||"item"!=this.transition&&"continuous"!=this.transition||"up"!=this.scrollDirection&&"down"!=this.scrollDirection?!1:!0},RiseVision.RSS.Controller.prototype.hasImage=function(){if(this.imageURLs.length>0)for(var t=0;t<this.imageURLs.length;t++)if(null!=this.imageURLs[t])return!0;return!1},RiseVision.RSS.Controller.prototype.hasVideo=function(t){return this.videos?this.videos.length>0&&$(".videoWrapper").length>0&&null!=this.videos[t]?!0:!1:void 0},RiseVision.RSS.Controller.prototype.urlExists=function(t,e){return null!=t&&null!=e?-1==e.indexOf(t)?!1:!0:!1},RiseVision.RSS.Controller.prototype.play=function(){var t=this;this.isPlaying=!0,"fade"==this.transition||"none"==this.transition?(this.resumeTimer(),this.isPaused=!1):this.isHorizontal()?(this.isLoading&&setTimeout(function(){t.horizontalScroll.initialize(),t.horizontalScroll.tick()},3e3),this.isPaused&&(this.horizontalScroll.tick(),this.isPaused=!1)):(this.isPaused=!1,$("#container").infiniteScroll.start()),this.isLoading&&(this.isLoading=!1,setInterval(function(){t.isFeedLoaded=!1,"fade"!=t.transition&&"none"!=t.transition&&t.loadFeed()},this.refreshInterval))},RiseVision.RSS.Controller.prototype.pause=function(){"fade"==this.transition||"none"==this.transition?this.pauseTimer():this.isHorizontal()?this.horizontalScroll.pause():$("#container").infiniteScroll.pause(),this.isPaused=!0};