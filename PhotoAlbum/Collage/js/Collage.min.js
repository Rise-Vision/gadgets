function Collage(a){this.onLastPhotoShown=a;this.timeLeft=this.totalImages=this.current=0;this.timerID=null;this.isFirstCycle=!0;this.isPaused=!1;this.zoom=150;this.startTimeout=new Date;this.duration=1E3*(new gadgets.Prefs).getInt("duration")}Collage.prototype.initialize=function(){var a=$("<div>");a.attr("id","gallery");$("#container").append(a)};
Collage.prototype.addImage=function(a){var e=$("<div>"),b=$("<img>"),g=$("#gallery").width(),h=$("#gallery").height(),c=0,f=0,d="rotate("+(Math.floor(40*Math.random())-20)+"deg)",c=(new gadgets.Prefs).getBool("showCaptions");e.addClass("new");b.addClass("new");b.width(a.width+this.zoom);b.height(a.height+this.zoom);b.attr("src",a.src);a.caption&&c&&(c=$("<span>"),c.addClass("caption caption_font-style"),c.text(a.caption),e.append(c));e.append(b);$("#gallery").prepend(e);c=Math.floor(Math.random()*
g)-a.width/2;f=Math.floor(Math.random()*h)-a.height/2;b.parent().css({left:c+"px",bottom:f+"px",transform:d,"-moz-transform":d,"-ms-transform":d,"-o-transform":d,"-webkit-transform":d}).attr({height:b.height()+this.zoom,width:b.width()+this.zoom});this.totalImages++};
Collage.prototype.showNextPhoto=function(){var a=$("#gallery div").eq(this.current);this.current>this.totalImages-1?($(".new").toggleClass("old new"),this.totalImages=this.current=0,this.timeLeft=null,this.isFirstCycle=!1,this.onLastPhotoShown.call(window.photoAlbum)):(this.isFirstCycle||$("#gallery div").eq(this.totalImages).fadeOut("fast",function(){$(this).remove()}),a.animate({height:"-="+this.zoom+"px",width:"-="+this.zoom+"px",opacity:1,leaveTransforms:!0},1E3),$("#gallery img").eq(this.current).animate({height:"-="+
this.zoom+"px",width:"-="+this.zoom+"px",opacity:1,leaveTransforms:!0},1E3),this.current++,this.isPaused||this.startTimer())};Collage.prototype.play=function(){this.isPaused=!1;0<this.duration&&this.resumeTimer()};Collage.prototype.pause=function(){this.isPaused=!0;0<this.duration&&this.pauseTimer()};Collage.prototype.startTimer=function(){var a=this;this.timerID=setTimeout(function(){a.showNextPhoto()},this.duration);this.isPaused||(this.startTimeout=new Date)};
Collage.prototype.resumeTimer=function(){var a=this;this.timeLeft||(this.timeLeft=this.duration);this.timerID=setTimeout(function(){a.showNextPhoto()},this.timeLeft)};Collage.prototype.pauseTimer=function(){var a;clearTimeout(this.timerID);this.timeLeft=this.duration;this.timeLeft-=new Date-this.startTimeout;a=Math.round(this.timeLeft/1E3);this.timeLeft=1E3*a;0>=a&&(this.timeLeft=0)};