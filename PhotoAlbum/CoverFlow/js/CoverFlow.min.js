function CoverFlow(a,h){var b=new gadgets.Prefs;this.duration=1E3*b.getInt("duration");this.interactivityTimeout=b.getInt("interactivityTimeout");this.imageProps=a;this.onLastPhotoShown=h;this.autoAdvance=!1;this.interactivityTimer=this.advancePhotos=null;this.isPaused=!1;this.timeLeft=0;this.startTimeout=new Date;this.cf=null;this.isInitialLoad=this.isLoading=!0;this.imageCount=0}CoverFlow.prototype.setPhotos=function(a){this.imageProps=a};
CoverFlow.prototype.render=function(a,h){var b=this,k=this.imageProps.length;if(this.isInitialLoad){var c=new gadgets.Prefs;$(".ContentFlow");var e=$("<div>"),d=$("<div>"),g=$("<div>"),f=$("<div>"),m=$("<div>"),r=c.getInt("rsW"),s=c.getInt("rsH"),t=c.getBool("showNavigation");c.getBool("showCaptions");var n=c.getInt("scrollbarThickness"),c=c.getString("scrollbarColor");e.attr("id","cf");e.addClass("ContentFlow");d.addClass("loadIndicator");g.addClass("indicator");f.addClass("flow");m.addClass("globalCaption");
d.append(g);e.append(d);e.append(f);e.append(m);$("#container").append(e);t&&(d=$("<div>"),g=$("<div>"),f=$("<div>"),m=$("<hr>"),d.addClass("scrollbar"),g.addClass("slider"),f.addClass("position"),g.css({background:c,width:n+"px",height:n+"px","-webkit-border-radius":2*n+"px","-moz-border-radius":2*n+"px","border-radius":2*n+"px"}),m.css({color:c}),f.css({color:c}),g.append(f),d.append(m),d.append(g),e.append(d));this.cf=r>s?new ContentFlow("cf",{flowSpeedFactor:2,scaleFactor:2,maxItemHeight:$("#container").height()/
2,reflectionHeight:0}):new ContentFlow("cf",{flowSpeedFactor:2,scaleFactor:2,relativeItemPosition:"center",reflectionHeight:0});$.each(this.imageProps,function(a,d){b.addImage(b.imageProps[a].caption,"last",d.src,e,function(){b.imageCount++;if(b.imageCount==k){b.imageCount=0;b.isInitialLoad=!1;b.autoAdvance=!0;b.cf.moveTo("first",b.onMoved);b.configureSwipe();$("#container").append(e);if(1==b.cf.getNumberOfItems())b.onMoved(b);$(".slider").css("visibility","visible")}})})}else{var p=!1,l=[],q=[];
$.each(this.imageProps,function(a,d){b.cf.getItem(a);for(var e=b.cf.getNumberOfItems(),c=e;c>k;c--)b.cf.rmItem(c);a<e?b.cf.getItemSrc(a)==d.src?q.push(a):(l.push({src:d.src,caption:b.imageProps[a].caption}),p=!0):(l.push({src:d.src,caption:b.imageProps[a].caption}),p=!0);if(a==k-1)if(p)for(var f=0,g=!1,h=b.cf.getNumberOfItems(),c=0;c<l.length;c++)b.addImage(l[c].caption,"last",l[c].src,$(".ContentFlow"),function(){f++;if(f==l.length){for(var a=0;a<h;a++){for(var c=0;c<q.length;c++)if(a==q[c]){g=!0;
break}g||b.cf.rmItem(0);g=!1}b.cf.moveTo("first");$(".slider").css("visibility","visible")}});else b.cf.moveTo("first")});this.play()}};
CoverFlow.prototype.addImage=function(a,h,b,k,c){var e=$("<div>"),d=$("<img>");k=prefs.getBool("showCaptions");var g=this;e.addClass("item");d.addClass("content");if(k){var f=$("<div>");f.addClass("caption");f.addClass("caption_font-style");f.text(a)}d.load(function(){e.append(d);f&&e.append(f);g.cf.addItem(e.get(0),h,function(){c&&c()})});d.error(function(){console.log("Image could not be loaded: "+b);g.imageCount++});d.attr("src",b)};
CoverFlow.prototype.configureSwipe=function(){var a=this;$(".ContentFlow").swipe({swipe:function(h,b){"left"!=b&&"right"!=b||a.showNextPhoto(b)},threshold:50})};CoverFlow.prototype.onMoved=function(a){a.isLoading&&(window.photoAlbum.onRendered(window.photoAlbum),a.isLoading=!1)};
CoverFlow.prototype.showNextPhoto=function(a){a=a?"left"==a?this.cf.getActiveItem().index+1:this.cf.getActiveItem().index-1:this.cf.getActiveItem().index+1;a>this.imageProps.length-1?(this.autoAdvance=!0,this.timeLeft=null,this.isLoading=!0,this.onLastPhotoShown.call(window.photoAlbum)):(this.autoAdvance=!0,this.cf.moveTo(a),this.isPaused||this.startTimer())};CoverFlow.prototype.play=function(){this.isPaused=!1;0<this.duration&&this.resumeTimer()};
CoverFlow.prototype.pause=function(){this.isPaused=!0;0<this.duration&&this.pauseTimer()};CoverFlow.prototype.startTimer=function(){var a=this;this.advancePhotos=setTimeout(function(){a.showNextPhoto()},this.duration);this.isPaused||(this.startTimeout=new Date)};CoverFlow.prototype.resumeTimer=function(){var a=this;this.timeLeft||(this.timeLeft=this.duration);this.advancePhotos=setTimeout(function(){a.showNextPhoto()},this.timeLeft)};
CoverFlow.prototype.pauseTimer=function(){var a;clearTimeout(this.advancePhotos);this.timeLeft=this.duration;this.timeLeft-=new Date-this.startTimeout;a=Math.round(this.timeLeft/1E3);this.timeLeft=1E3*a;0>=a&&(this.timeLeft=0)};