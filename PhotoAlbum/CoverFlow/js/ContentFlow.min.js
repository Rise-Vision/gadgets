var ContentFlowGlobal={Flows:[],AddOns:{},scriptName:"ContentFlow.js",scriptElement:null,Browser:new function(){this.Opera=window.opera?!0:!1;this.IE6=(this.IE=document.all&&!this.Opera?!0:!1)&&"undefined"==typeof window.XMLHttpRequest?!0:!1;this.IE8=this.IE&&"undefined"!=typeof document.querySelectorAll?!0:!1;this.IE7=!this.IE||this.IE6||this.IE8?!1:!0;this.WebKit=/WebKit/i.test(navigator.userAgent)?!0:!1;this.iPhone=/iPhone|iPod/i.test(navigator.userAgent)?!0:!1;this.Chrome=/Chrome/i.test(navigator.userAgent)?
!0:!1;this.Safari=/Safari/i.test(navigator.userAgent)&&!this.Chrome?!0:!1;this.Konqueror4=(this.Konqueror="KDE"==navigator.vendor?!0:!1)&&/native code/.test(document.getElementsByClassName)?!0:!1;this.Gecko19=(this.Gecko=this.WebKit||"Gecko"!=navigator.product?!1:!0)&&Array.reduce?!0:!1},getAddOnConf:function(a){return this.AddOns[a]?this.AddOns[a].conf:{}},setAddOnConf:function(a,b){this.AddOns[a].setConfig(b)},getScriptElement:function(a){a=RegExp(a);for(var b=document.getElementsByTagName("script"),
d=0;d<b.length;d++)if(b[d].src&&a.test(b[d].src))return b[d];return""},getScriptPath:function(a,b){return a.src.replace(RegExp(b+".*"),"")},addScript:function(a){if(this.Browser.IE||this.Browser.WebKit||this.Browser.Konqueror)document.write('<script type="text/javascript" src="'+a+'">\x3c/script>');else{var b=document.createElement("script");b.src=a;b.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(b)}},addScripts:function(a,b){for(var d=0;d<filename.length;d++)this.addScript(basepath+
b[d])},addStylesheet:function(a){if(this.Browser.Gecko19){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("href",a);b.setAttribute("type","text/css");b.setAttribute("media","screen");document.getElementsByTagName("head")[0].appendChild(b)}else document.write('<link rel="stylesheet" href="'+a+'" type="text/css" media="screen" />')},addStylesheets:function(a,b){for(var d=0;d<filename.length;d++)this.addStylesheet(basepath+b[d])},initPath:function(){this.scriptElement=
this.getScriptElement(this.scriptName);this.scriptElement||(this.scriptName="ContentFlow.js",this.scriptElement=this.getScriptElement(this.scriptName));this.BaseDir=this.getScriptPath(this.scriptElement,this.scriptName);this.AddOnBaseDir||(this.AddOnBaseDir=this.BaseDir);this.CSSBaseDir||(this.CSSBaseDir="https://s3.amazonaws.com/Gadget-Photo-Album/CoverFlow/css/")},init:function(){this.addStylesheet(this.CSSBaseDir+"ContentFlow.css");this.loadAddOns=[];if(this.scriptElement.getAttribute("load"))for(var a=
this.loadAddOns=this.scriptElement.getAttribute("load").replace(/\ +/g," ").split(" "),b=0;b<a.length;b++)""!=a[b]&&this.addScript(this.AddOnBaseDir+"ContentFlowAddOn_"+a[b]+".js");var d=this;if(document.addEventListener)if(this.Browser.WebKit)var f=setInterval(function(){/loaded|complete/.test(document.readyState)&&(clearInterval(f),d.onloadInit())},10);else document.addEventListener("DOMContentLoaded",d.onloadInit,!1);else this.Browser.IE&&(document.write("<script id=__ie_cf_onload defer src=javascript:void(0)>\x3c/script>"),
document.getElementById("__ie_cf_onload").onreadystatechange=function(){if("complete"==this.readyState)d.onloadInit()});window.addEvent("load",d.onloadInit,!1)},onloadInit:function(){if(!arguments.callee.done){for(var a=0;a<ContentFlowGlobal.loadAddOns.length;a++)if(!ContentFlowGlobal.AddOns[ContentFlowGlobal.loadAddOns[a]]){window.setTimeout(ContentFlowGlobal.onloadInit,10);return}arguments.callee.done=!0;if(window.Element&&Element.implement&&document.all&&!window.opera)for(var b in window.CFElement.prototype)window.Element.prototype[b]||
(a={},a[b]=window.CFElement.prototype[b],Element.implement(a));for(a=0;a<ContentFlowGlobal.Flows.length;a++)ContentFlowGlobal.Flows[a].init();b=document.getElementsByTagName("div");a=0;a:for(;a<b.length;a++)if(b[a].className.match(/\bContentFlow\b/)){for(var d=0;d<ContentFlowGlobal.Flows.length;d++)if(b[a]==ContentFlowGlobal.Flows[d].Container)continue a;(new ContentFlow(b[a],{},!1)).init()}}}};ContentFlowGlobal.initPath();
var ContentFlowAddOn=function(a,b,d){if("undefined"==typeof d||!1!=d)ContentFlowGlobal.AddOns[a]=this;this.name=a;b||(b={});this.methods=b;this.conf={};this.methods.conf&&(this.setConfig(this.methods.conf),delete this.methods.conf);this.scriptpath=ContentFlowGlobal.AddOnBaseDir;b.init&&b.init.bind(this)(this)};
ContentFlowAddOn.prototype={Browser:ContentFlowGlobal.Browser,addScript:ContentFlowGlobal.addScript,addScripts:ContentFlowGlobal.addScripts,addStylesheet:function(a){a||(a=this.scriptpath+"ContentFlowAddOn_"+this.name+".css");ContentFlowGlobal.addStylesheet(a)},addStylesheets:ContentFlowGlobal.addStylesheets,setConfig:function(a){for(var b in a)this.conf[b]=a[b]},_init:function(a){this.methods.ContentFlowConf&&a.setConfig(this.methods.ContentFlowConf)}};
var ContentFlowGUIElement=function(a,b){b.setDimensions=function(){this.dimensions=this.getDimensions();this.center={x:this.dimensions.width/2,y:this.dimensions.height/2};this.position=this.findPos()};b.addObserver=function(b,f){var e=this.eventMethod=f.bind(a);this.observedEvent=b;this.addEvent(b,e,!1)};b.makeDraggable=function(a,b,e){this.stopDrag=function(b){b||(b=window.event);if(this.Browser.iPhone){if(window.removeEvent("touchemove",a,!1),!this.ontochmove){var g=b.target;g.firstChild&&(g=g.firstChild);
var f=document.createEvent("MouseEvents");f.initEvent("click",!0,!0);g.dispatchEvent(f)}}else window.removeEvent("mousemove",a,!1);e(b)}.bind(this);this.initDrag=function(a){a||(a=window.event);var d=a;a.touches&&(d=a.touches[0]);this.mouseX=d.clientX;this.mouseY=d.clientY;b(a)}.bind(this);var g=this.startDrag=function(b){b||(b=window.event);var e=this.stopDrag;if(this.Browser.iPhone){var g=this;g.ontouchmove=!1;window.addEvent("touchmove",function(b){g.ontouchmove=!0;a(b)},!1);b.preventDefault();
window.addEvent("touchend",e,!1)}else window.addEvent("mousemove",a,!1),window.addEvent("mouseup",e,!1);b.preventDefault&&b.preventDefault()}.bind(this);this.Browser.iPhone?this.addEventListener("touchstart",g,!1):this.addEvent("mousedown",g,!1)};b.Browser=ContentFlowGlobal.Browser;$CF(b).setDimensions();return b};
function ContentFlowItem(a,b,d){this.CFobj=a;this._activeElement=a.conf.activeElement;this.next=this.pre=null;this.clickItem=function(a){a||(a=window.event);a=a.target?a.target:a.srcElement;a=a.itemIndex?a.itemIndex:a.parentNode.itemIndex;var b=this.items[a];if(this._activeItem==b)this.conf.onclickActiveItem(b);else!1!=this.conf.onclickInactiveItem(b)&&this.moveToIndex(a)}.bind(a);this.setIndex=function(a){this.index=a;this.element.itemIndex=a};this.getIndex=function(){return this.index};if("IMG"==
$CF(b).nodeName){var f=document.createElement("div");f.className="item";var e=b.parentNode.replaceChild(f,b);e.className="content";f.appendChild(e);b.title&&(e=document.createElement("div"),e.className="caption",e.innerHTML=b.title,f.appendChild(e));b=f}this.element=$CF(b);this.item=b;"undefined"!=typeof d&&this.setIndex(d);this.content=this.element.getChildrenByClassName("content")[0];this.caption=this.element.getChildrenByClassName("caption")[0];this.label=this.element.getChildrenByClassName("label")[0];
if("IMG"==this.content.nodeName){a._imagesToLoad++;var g=function(){a._imagesToLoad--;this.image=this.content;this.setImageFormat(this.image);0<a.conf.reflectionHeight&&this.addReflection();this.initClick();a._addItemCueProcess(!0)}.bind(this);if(this.content.complete&&0<this.content.width)window.setTimeout(g,100);else if(this.Browser.IE&&!this.content.onload)var k=this,h=window.setInterval(function(){k.content.complete&&0<k.content.width&&(window.clearInterval(h),g())},10);else this.content.onload=
window.setTimeout(g,100)}else this.initClick(),a._addItemCueProcess(!0)}
ContentFlowItem.prototype={Browser:ContentFlowGlobal.Browser,makeActive:function(){this.element.addClassName("active");this.CFobj.conf.onMakeActive(this)},makeInactive:function(){this.element.removeClassName("active");this.CFobj.conf.onMakeInactive(this)},initClick:function(){this[this._activeElement].addEvent("click",this.clickItem,!1)},setImageFormat:function(a){if(this.Browser.IE6||this.Browser.IE7)a.style.width="auto";a.origProportion=a.width/a.height;a.setAttribute("origProportion",a.width/a.height);
if(this.Browser.IE6||this.Browser.IE7)a.style.width="";1>=a.origProportion?a.addClassName("portray"):a.addClassName("landscape")},addReflection:function(){var a=this.CFobj,b,d=this.content;if(this.Browser.IE){var f="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";if(a._reflectionColorRGB){if("transparent"==a.conf.reflectionColor){var e=b=this.reflection=document.createElement("img");b.src=d.src}else{b=this.reflection=document.createElement("div");e=document.createElement("img");
e.src=d.src;b.width=e.width;b.height=e.height;e.style.width="100%";e.style.height="100%";var g=a._reflectionColorRGB;b.style.backgroundColor="#"+g.hR+g.hG+g.hB;b.appendChild(e)}f+=" progid:DXImageTransform.Microsoft.Alpha(opacity=0, finishOpacity=50, style=1, finishX=0, startY="+100*a.conf.reflectionHeight+" finishY=0)"}else e=b=this.reflection=document.createElement("img"),b.src=d.src;f+=" progid:DXImageTransform.Microsoft.Matrix(M11=1, M12=0, M21=0, M22="+1/a.conf.reflectionHeight+")";ContentFlowGlobal.Browser.IE6&&
d.src.match(/\.png$/)&&(d.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d.src+"', sizingMethod=scale )",d.filterString="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d.src+"', sizingMethod=scale )",f+=" progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d.src+"', sizingMethod=scale )",d.origSrc=d.src,d.src="images/blank.gif",e.src="images/blank.gif");b.filterString=f;e.style.filter=f}else if(f=a._reflectionWithinImage?this.canvas=$CF(document.createElement("canvas")):
b=this.reflection=document.createElement("canvas"),f.getContext){if(a._reflectionWithinImage)for(e=0;e<d.attributes.length;e++)f.setAttributeNode(d.attributes[e].cloneNode(!0));var e=f.getContext("2d"),g=a.maxHeight,g=a._scaleImageSize(this,{width:g,height:g},g),k=g.width,g=g.height;a._reflectionWithinImage?(f.width=k,f.height=g,this.setImageFormat(f),f.height=g*(1+a.conf.reflectionHeight+a.conf.reflectionGap)):(f.width=k,f.height=g*a.conf.reflectionHeight);e.save();a._reflectionWithinImage&&e.drawImage(d,
0,0,k,g);var h=a._reflectionWithinImage?2*g*(1+a.conf.reflectionGap/2):d.height;e.translate(0,h-1);e.scale(1,-1);e.drawImage(d,0,0,k,g);e.restore();if(a._reflectionColorRGB){k=e.createLinearGradient(0,0,0,f.height);h=[0,0.5,1];"transparent"==a._reflectionColor&&(e.globalCompositeOperation="destination-in",h=[1,0.5,0]);var l=a._reflectionColorRGB.iR,m=a._reflectionColorRGB.iG,n=a._reflectionColorRGB.iB;a._reflectionWithinImage?(k.addColorStop(0,"rgba("+l+","+m+","+n+","+h[0]+")"),k.addColorStop(g/
f.height,"rgba("+l+","+m+","+n+","+h[0]+")"),k.addColorStop(g/f.height,"rgba("+l+","+m+","+n+","+h[1]+")")):k.addColorStop(0,"rgba("+l+","+m+","+n+","+h[1]+")");k.addColorStop(1,"rgba("+l+","+m+","+n+","+h[2]+")");e.fillStyle=k;e.fillRect(0,0,f.width,f.height)}a._reflectionWithinImage&&(d.parentNode.replaceChild(f,d),this.origContent=this.content=f,delete this.image)}else a._reflectionWithinImage=!1,delete this.reflection;b&&(b.className="reflection",this.element.appendChild(b),this.caption&&this.element.appendChild(this.caption))}};
function ContentFlow(a,b){if(a)ContentFlowGlobal.Flows[0]=this,this.Container=a,this._userConf=b?b:{},this.conf={},this._loadedAddOns=[];else throw"ContentFlow ERROR: No flow container node or id given";this.isInit||this._init()}
ContentFlow.prototype={_imagesToLoad:0,_activeItem:0,_currentPosition:0,_targetPosition:0,_stepLock:!1,_millisecondsPerStep:40,_reflectionWithinImage:!0,Browser:ContentFlowGlobal.Browser,_defaultConf:{useAddOns:"all",biggestItemPos:0,loadingTimeout:3E4,activeElement:"content",maxItemHeight:0,scaleFactor:1,scaleFactorLandscape:1.33,scaleFactorPortrait:1,fixItemSize:!1,relativeItemPosition:"top center",circularFlow:!0,verticalFlow:!1,visibleItems:-1,endOpacity:1,startItem:"center",scrollInFrom:"pre",
flowSpeedFactor:1,flowDragFriction:1,scrollWheelSpeed:1,keys:{13:function(){this.conf.onclickActiveItem(this._activeItem)},37:function(){this.moveTo("pre")},38:function(){this.moveTo("visibleNext")},39:function(){this.moveTo("next")},40:function(){this.moveTo("visiblePre")}},reflectionColor:"transparent",reflectionHeight:0.5,reflectionGap:0,onInit:function(){},onclickInactiveItem:function(a){},onclickActiveItem:function(a){},onMakeInactive:function(a){},onMakeActive:function(a){},onReachTarget:function(a){},
onMoveTo:function(a){var b=window.coverFlow;if(0<b.duration&&!b.autoAdvance){var d=this;clearTimeout(b.advancePhotos);clearTimeout(b.interactivityTimer);b.interactivityTimer=setTimeout(function(){b.autoAdvance=!0;d.moveTo(d.getActiveItem().index+1);b.resumeTimer()},1E3*b.interactivityTimeout)}b.autoAdvance=!1},onDrawItem:function(a){},onclickPreButton:function(a){this.moveToIndex("pre");return Event.stop(a)},onclickNextButton:function(a){this.moveToIndex("next");return Event.stop(a)},calcStepWidth:function(a){var b=
this.conf.visibleItems,d=this.items.length,d=0==d?1:d;return Math.abs(a)>b?0<a?a-b:a+b:b>=this.items.length?a/d:a*(b/d)},calcSize:function(a){a=1/(Math.abs(a.relativePosition)+1);return{width:a,height:a}},calcCoordinates:function(a){var b=this.conf.visibleItems,d=1-1/Math.exp(0.75*Math.abs(a.relativePosition));return{x:a.side*b/(b+1)*d,y:1}},calcZIndex:function(a){return-Math.abs(a.relativePositionNormed)},calcFontSize:function(a){return a.size.height},calcOpacity:function(a){return Math.max(1-(1-
this.conf.endOpacity)*Math.sqrt(Math.abs(a.relativePositionNormed)),this.conf.endOpacity)}},_checkIndex:function(a){a=Math.max(a,0);return a=Math.min(a,this.itemsLastIndex)},_setLastIndex:function(){this.itemsLastIndex=this.items.length-1},_getItemByIndex:function(a){return this.items[this._checkIndex(a)]},_getItemByPosition:function(a){return this._getItemByIndex(this._getIndexByPosition(a))},_getPositionByIndex:function(a){if(!this.conf.circularFlow)return this._checkIndex(a);var b=this._getIndexByPosition(this._currentPosition);
a-=b;Math.abs(a)>a+this.items.length?a+=this.items.length:Math.abs(a)>Math.abs(a-this.items.length)&&(a-=this.items.length);return this._currentPosition+a},_getIndexByPosition:function(a){var b=0>a?0:1,d=(Math.round(a)+b)%this.items.length;return d=0<d?d-b:0>d?d+(this.items.length-b):0>a?0:this.items.length-1},_getIndexByKeyWord:function(a,b,d){b=b?b:this._activeItem?this._activeItem.index:0;if(isNaN(a))switch(a){case "first":case "start":b=0;break;case "last":case "end":b=this.itemsLastIndex;break;
case "middle":case "center":b=Math.round(this.itemsLastIndex/2);break;case "right":case "next":b+=1;break;case "left":case "pre":case "previous":b-=1;break;case "visible":case "visiblePre":case "visibleLeft":b-=this.conf.visibleItems;break;case "visibleNext":case "visibleRight":b+=this.conf.visibleItems}else b=a;!1!=d&&(b=this._checkIndex(b));return b},_setCaptionLabel:function(a){this.Position&&!this.Slider.locked&&this.Position.setLabel(a);this._setGlobalCaption()},getAddOnConf:function(a){return ContentFlowGlobal.getAddOnConf(a)},
setAddOnConf:function(a,b){ContentFlowGlobal.setAddOnConf(a,b)},init:function(){this.isInit||this._init()},setConfig:function(a){if(a){var b=this._defaultConf,d;for(d in a)if("undefined"!=b[d])switch(d){case "scrollInFrom":case "startItem":if("number"==typeof a[d]||"string"==typeof a[d])this.conf[d]=a[d];break;default:typeof(b[d]==a[d])&&(this.conf[d]="function"==typeof a[d]?a[d].bind(this):a[d])}switch(this.conf.reflectionColor){case 0<=this.conf.reflectionColor.search(/#[0-9a-fA-F]{6}/)?this.conf.reflectionColor:
this.conf.reflectionColor+"x":this._reflectionColorRGB={hR:this.conf.reflectionColor.slice(1,3),hG:this.conf.reflectionColor.slice(3,5),hB:this.conf.reflectionColor.slice(5,7),iR:parseInt(this.conf.reflectionColor.slice(1,3),16),iG:parseInt(this.conf.reflectionColor.slice(3,5),16),iB:parseInt(this.conf.reflectionColor.slice(5,7),16)};break;default:this._reflectionColor="transparent",this._reflectionColorRGB={hR:0,hG:0,hB:0,iR:0,iG:0,iB:0}}this.items&&(0>this.conf.visibleItems&&(this.conf.visibleItems=
Math.round(Math.sqrt(this.items.length))),this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1));if(this.conf.relativeItemPosition){a=this.conf.relativeItemPosition;a=a.replace(/above/,"top").replace(/below/,"bottom");d=null;b=a.match(/left|right/);d=a.match(/top|bottom/);c=a.match(/center/);b||(b="center");d||(d=c?"center":"top");var f={left:function(a){return-1},center:function(a){return 0},right:function(a){return 1}}[b],e={top:function(a){return-1},center:function(a){return 0},
bottom:function(a){return 1}}[d];this.conf.calcRelativeItemPosition=function(a){var b=f(a.size);a=e(a.size);return{x:b,y:a}};this.conf.relativeItemPosition=null}this._reflectionType&&"clientside"!=this._reflectionType&&(this.conf.reflectionHeight=0)}},getItem:function(a){return this.items[this._checkIndex(Math.round(a))]},getItemSrc:function(a){return this.items[this._checkIndex(Math.round(a))].content.getAttribute("src")},getActiveItem:function(){return this._activeItem},getNumberOfItems:function(){return this.items.length},
resize:function(){this._initSizes();this._initStep()},moveToPosition:function(a,b){this.conf.circularFlow||(a=this._checkIndex(a));this._targetPosition=a;this.conf.onMoveTo(this._getItemByPosition(a));this._initStep(!1,b)},moveToIndex:function(a){this._targetPosition=Math.round(this._getPositionByIndex(this._getIndexByKeyWord(a,this._activeItem.index,!this.conf.circularFlow)));this.conf.onMoveTo(this._getItemByPosition(this._targetPosition));this._initStep()},moveToItem:function(a){this.moveToIndex(a.itemIndex?
a.itemIndex:a.index)},moveTo:function(a,b){this.onMoved=b;"object"==typeof a?this.moveToItem(a):isNaN(a)||a==Math.floor(a)&&a<this.items.length?this.moveToIndex(a):this.moveToPosition(a)},_addItemCue:[],_addItemCueProcess:function(a){var b=this._addItemCue;!0==a&&b.shift();if(0<b.length&&!b[0].p){b[0].p=!0;var d=this;window.setTimeout(function(){d._addItem(b[0].el,b[0].i,b[0].onItemAdded)},5<b.length?1:40)}},addItem:function(a,b,d){this._addItemCue.push({el:a,i:b,p:!1,onItemAdded:d});1==this._addItemCue.length&&
this._addItemCueProcess()},_addItem:function(a,b,d){if("string"==typeof b)switch(b){case "first":case "start":b=0;break;case "last":case "end":b=isNaN(this.itemsLastIndex)?0:this.itemsLastIndex;b+=1;break;default:b=this._getIndexByKeyWord(b)}$(".slider").css("visibility","hidden");b=Math.max(b,0);b=Math.min(b,this.itemsLastIndex+1);b=isNaN(b)?0:b;this.Flow.appendChild(a);this.resize();a=new ContentFlowItem(this,a,b);0==this.items.length?(this.resize(),this.conf.circularFlow&&(a.pre=a,a.next=a)):(b==
this.itemsLastIndex+1?(a.pre=this.items[this.itemsLastIndex],a.next=a.pre.next):(a.next=this.items[b],a.pre=a.next.pre),a.pre&&(a.pre.next=a),a.next&&(a.next.pre=a));this.items.splice(b,0,a);for(a=b;a<this.items.length;a++)this.items[a].setIndex(a);this._setLastIndex();0>this.conf.origVisibleItems&&(this.conf.visibleItems=Math.round(Math.sqrt(this.items.length)));this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1);Math.round(this._getPositionByIndex(b))<=Math.round(this._targetPosition)&&
(this._targetPosition++,this.conf.circularFlow||(this._targetPosition=Math.min(this._targetPosition,this.itemsLastIndex)));this._getPositionByIndex(b)<=this._currentPosition&&(this._currentPosition++,this.conf.circularFlow||(this._currentPosition=Math.min(this._currentPosition,this.itemsLastIndex)));var f=this;window.setTimeout(function(){1==f.items.length?(f._currentPosition=-0.01,f._targetPosition=0,f.resize()):f._initStep();d()},100);return b},rmItem:function(a){"undefined"==a&&(a=this._activeItem.index);
a=this._getIndexByKeyWord(a);if(!this.items[a])return null;var b=this.items[a];b.pre&&(b.pre.next=b.next);b.next&&(b.next.pre=b.pre);this.items.splice(a,1);for(var d=a;d<this.items.length;d++)this.items[d].setIndex(d);this._setLastIndex();0>this.conf.origVisibleItems&&(this.conf.visibleItems=Math.round(Math.sqrt(this.items.length)));this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1);Math.round(this._getPositionByIndex(a))<Math.round(this._targetPosition)&&(this._targetPosition--,
this.conf.circularFlow||(this._targetPosition=this._checkIndex(this._targetPosition)));this._getPositionByIndex(a)<this._currentPosition&&(this._currentPosition--,this.conf.circularFlow||(this._currentPosition=this._checkIndex(this._currentPosition)));this._activeItem=this._getItemByPosition(this._currentPosition);a=b.element.parentNode.removeChild(b.element);var f=this;window.setTimeout(function(){f._initStep()},10);return a},_init:function(){if("string"==typeof this.Container){var a=document.getElementById(this.Container);
if(a)this.Container=a;else throw"ContentFlow ERROR: No element with id '"+this.Container+"' found!";}$CF(this.Container).addClassName("ContentFlow");a=$CF(this.Container).getChildrenByClassName("flow")[0];if(!a)throw"ContentFlow ERROR: No element with class'flow' found!";this.Flow=new ContentFlowGUIElement(this,a);if(a=this.Container.getChildrenByClassName("scrollbar")[0])if(this.Scrollbar=new ContentFlowGUIElement(this,a),a=this.Scrollbar.getChildrenByClassName("slider")[0])if(this.Slider=new ContentFlowGUIElement(this,
a),a=this.Slider.getChildrenByClassName("position")[0])this.Position=new ContentFlowGUIElement(this,a);this.setConfig(this._defaultConf);this._initAddOns();this.setConfig(this._userConf);this._initSizes();a=this.Flow.getChildrenByClassName("item");this.items=[];for(var b=0;b<a.length;b++){var d=this.items[b]=new ContentFlowItem(this,a[b],b);0<b&&(d.pre=this.items[b-1],d.pre.next=d)}this._setLastIndex();this.conf.circularFlow&&0<this.items.length&&(a=this.items[0],a.pre=this.items[this.items.length-
1],a.pre.next=a);this._initGUI();"content"!=this._activeElement&&(this._activeElement="element");this.conf.origVisibleItems=this.conf.visibleItems;0>this.conf.visibleItems&&(this.conf.visibleItems=Math.round(Math.sqrt(this.items.length)));this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1);this._targetPosition=this._getIndexByKeyWord(this.conf.startItem,0);a=this._getIndexByKeyWord(this.conf.scrollInFrom,this._targetPosition);switch(this.conf.scrollInFrom){case "next":case "right":a-=
0.5;break;case "pre":case "previous":case "left":a+=0.5}this._currentPosition=a;var f=new Date,e=this,g=window.setInterval(function(){if(0==e._imagesToLoad||new Date-f>e._loadingTimeout){clearInterval(g);e._activeItem=e.getItem(e._currentPosition);e._activeItem&&(e._activeItem.makeActive(),e._setCaptionLabel(e._activeItem.index));e.Flow.style.visibility="visible";e.loadIndicator&&(e.loadIndicator.style.display="none");e.Scrollbar&&(e.Scrollbar.style.visibility="visible");e.resize();for(var a=0;a<
e._loadedAddOns.length;a++){var b=ContentFlowGlobal.AddOns[e._loadedAddOns[a]];b.methods.afterContentFlowInit&&b.methods.afterContentFlowInit(e)}e.conf.onInit()}},10);this.isInit=!0},_initAddOns:function(){var a=[];this._userConf.useAddOns?"string"==typeof this._userConf.useAddOns?a=this._userConf.useAddOns.split(" "):"array"==typeof this._userConf.useAddOns&&(a=this._userConf.useAddOns):a=this.Container.getAttribute("useAddOns")?this.Container.getAttribute("useAddOns").split(" "):this.conf.useAddOns.split(" ");
for(var b=0;b<a.length;b++)if("none"==a[b]){a=[];break}else if("all"==a[b]){var a=[],d;for(d in ContentFlowGlobal.AddOns)a.push(d);break}for(b=0;b<a.length;b++)if(d=ContentFlowGlobal.AddOns[a[b]])if(this._loadedAddOns.push(a[b]),d._init(this),this.Container.addClassName("ContentFlowAddOn_"+d.name),d.methods.onloadInit)d.methods.onloadInit(this)},_initGUI:function(){var a=this.resize.bind(this);window.addEvent("resize",a,!1);for(var a=this.Container.getElementsByTagName("div"),b=0;b<a.length;b++)if($CF(a[b]).hasClassName("preButton")){var d=
this.conf.onclickPreButton;a[b].addEvent("click",d,!1)}else if(a[b].hasClassName("nextButton")){var f=a[b],d=this.conf.onclickNextButton;f.addEvent("click",d,!1)}0!=this.conf.scrollWheelSpeed&&(a=this._wheel.bind(this),window.addEventListener&&this.Container.addEventListener("DOMMouseScroll",a,!1),this.Container.onmousewheel=a);var e=this._keyStroke.bind(this);if(this.conf.keys&&!this.Browser.iPhone)if(document.addEventListener)if(this.Browser.Opera)this.Container.addEvent("keydown",e);else{var g=
document.createElement("div");g.addClassName("mouseoverCheckElement");this.Container.appendChild(g);this.Browser.WebKit?document.body.addEvent("keydown",function(a){0<g.offsetLeft&&e(a)}):window.addEvent("keydown",function(a){0<g.offsetLeft&&e(a)})}else this.Container.onkeydown=e;0<this.conf.flowDragFriction&&(a=function(a){var b=a;a.touches&&(b=a.touches[0]);a=b.clientX;b=b.clientY;if(this.conf.verticalFlow)var d=b-this.Flow.mouseY,e=this.Flow.dimensions.height;else d=a-this.Flow.mouseX,e=this.Flow.dimensions.width;
d=this._currentPosition-2*(d/e*(2*this.conf.visibleItems+1))*this.conf.visibleItems/this.conf.flowDragFriction;this.Flow.mouseX=a;this.Flow.mouseY=b;this.moveToPosition(d,!0)}.bind(this),b=function(){},d=function(a){a=Math.round(this._targetPosition);0.001<Math.abs(a-this._currentPosition)&&this.moveToPosition(a)}.bind(this),this.Flow.makeDraggable(a,b,d));this.Scrollbar&&(a=function(a){a||(a=window.event);this.Scrollbar.clickLocked?this.Scrollbar.clickLocked=!1:(a=Math.round((a.clientX-this.Scrollbar.position.left)/
this.Scrollbar.dimensions.width*this.itemsLastIndex),this.moveToIndex(a))}.bind(this),this.Scrollbar.addObserver("click",a));this.Slider&&(this.Browser.IE6&&(a=document.createElement("div"),a.className="virtualSlider",this.Slider.appendChild(a)),this.Slider.setPosition=function(a){a=a-Math.floor(a)+this._getIndexByPosition(Math.floor(a));0>Math.round(a)?a=this.itemsLastIndex:0>=a?a=0:Math.round(a)>this.itemsLastIndex?a=0:a>=this.itemsLastIndex&&(a=this.itemsLastIndex);this.Slider.style.left=(1<this.items.length?
a/this.itemsLastIndex*this.Scrollbar.dimensions.width:0.5*this.Scrollbar.dimensions.width)-this.Slider.center.x+"px";this.Slider.style.top=this.Scrollbar.center.y-this.Slider.center.y+"px"}.bind(this),b=function(a){this.Scrollbar.clickLocked=!0}.bind(this),a=function(a){var b=a;a.touches&&(b=a.touches[0]);a=this._checkIndex((b.clientX-this.Scrollbar.position.left)/this.Scrollbar.dimensions.width*this.itemsLastIndex);this._targetPosition=this._getPositionByIndex(a);this.Slider.setPosition(a);this.Position&&
this.Position.setLabel(a);this._initStep(!0,!0)}.bind(this),d=function(a){this._targetPosition=Math.round(this._targetPosition);this.conf.onMoveTo(this._getItemByPosition(this._targetPosition));this._initStep(!0)}.bind(this),this.Slider.makeDraggable(a,b,d));this.Position&&(this.Position.setLabel=function(a){a=this._checkIndex(Math.round(a));this.Position.innerHTML=this.items&&this.items[a].label?this.items[a].label.innerHTML:a+1}.bind(this));this.globalCaption=this.Container.getChildrenByClassName("globalCaption")[0];
this.loadIndicator=this.Container.getChildrenByClassName("loadIndicator")[0]},_initSizes:function(a){this._initMaxHeight();a=this._initScrollbarSize();!this.conf.verticalFlow&&(this.Container.style.height&&"auto"!=this.Container.style.height)&&(this.maxHeight-=a);if(this._activeItem){a=this._findBiggestItem();var b=this.Flow.findPos();this.conf.verticalFlow?(this.Flow.style.width=a.width.width+"px",this.Flow.style.height=3*a.width.width*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px"):
this.Flow.style.height=a.height.height+(a.height.top-b.top)+"px";b=this.conf.verticalFlow?a.width.width:a.height.height;this.Flow.style.marginBottom=-(b-b/(1+this.conf.reflectionHeight+this.conf.reflectionGap))+"px";this.Flow.dimensions=this.Flow.getDimensions();this.Flow.center=this.conf.verticalFlow?{x:this.Flow.dimensions.height/2,y:a.width.width/2}:{x:this.Flow.dimensions.width/2,y:a.height.height/2}}},_initScrollbarSize:function(){var a,b,d;if(a=this.Scrollbar){a.setDimensions();var f=a.dimensions.height;
if(b=this.Slider)if(b.setDimensions(),f+=b.dimensions.height,d=this.Position){var e=d.innerHTML,g=maxW=0;d.style.width="auto";if(this.items)for(var k=0;k<this.items.length;k++){var h=this.items[k];d.innerHTML=h.label?h.label.innerHTML:h.index;var h=d.clientHeight,l=d.clientWidth;h>g&&(g=h);l>maxW&&(maxW=l)}else d.innerHTML="&nbsp;",g=d.clientHeight,maxW=d.clientWidth;d.innerHTML=e;d.setDimensions();d.style.width=maxW+"px";d.style.left=(b.dimensions.width-maxW)/2+"px";b=d.position.top-b.position.top;
0<b?(b+=-a.dimensions.height+g,a.style.marginBottom=b+"px"):(b*=-1,a.style.marginTop=b+"px");f+=b}}else f=0;return f},_initMaxHeight:function(){if(this.conf.verticalFlow)var a=screen.width/screen.height,b=this.Container.style.width,d=this.Container.clientWidth,f=this.Flow.style.width,e=this.Flow.clientWidth,g=this.Flow.clientHeight;else a=screen.height/screen.width,b=this.Container.style.height,d=this.Container.clientHeight,f=this.Flow.style.height,e=this.Flow.clientHeight,g=this.Flow.clientWidth;
this.ContainerOldDim&&(b=this.ContainerOldDim);this.FlowOldDim&&(f=this.FlowOldDim);this.FlowOldDim=this.ContainerOldDim="auto";0>=this.conf.maxItemHeight?(this.maxHeight=g/3*a/1*this.conf.scaleFactor,this.conf.verticalFlow&&(0==this.maxHeight||this.maxHeight>e)&&(this.maxHeight=e),b&&"auto"!=b?(a=this.conf.verticalFlow?0:this.conf.reflectionGap,this.maxHeight=d/(this.conf.scaleFactor*(1+(this.conf.verticalFlow?0:this.conf.reflectionHeight)+a)),this.ContainerOldDim=b):f&&"auto"!=f&&(a=this.conf.verticalFlow?
0:this.conf.reflectionGap,this.maxHeight=e/(this.conf.scaleFactor*(1+this.conf.reflectionHeight+a)),this.FlowOldDim=f)):this.maxHeight=this.conf.maxItemHeight},_findBiggestItem:function(){var a=this._activeItem,b=maxFlowSize={width:{width:0,left:0,height:0,top:0,item:null,rI:0},height:{width:0,left:0,height:0,top:0,item:null,rI:0}},d=function(a,d){var e=a.element;e.style.display="block";var f=e.findPos(),g=e.clientHeight,p=e.clientWidth;g+f.top>=b.height.height+b.height.top&&(b.height.height=g,b.height.top=
f.top,b.height.item=a,b.height.rI=d);p+f.left>=b.width.width+b.width.left&&(b.width.width=p,b.width.left=f.left,b.width.item=a,b.width.rI=d);e.style.display="none"},f=this._currentPosition;this._currentPosition=this.conf.visibleItems+1;for(var e=-this.conf.visibleItems;e<=this.conf.visibleItems;e++)a.element.style.display="none",this._positionItem(a,e),d(a,e);a=b.height.rI;for(e=0;e<this.items.length;e++){var g=this.items[e];g.element.style.display="none";this._positionItem(g,a);d(g,a)}this._currentPosition=
f;return b},_keyStroke:function(a){a||(a=window.event);if(a.which)var b=a.which;else a.keyCode&&(b=a.keyCode);return this.conf.keys[b]?(this.conf.keys[b].bind(this)(),Event.stop(a)):!0},_wheel:function(a){a||(a=window.event);var b=0;a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail/3);if(b){var d=this._targetPosition,d=0>b?d+1*this.conf.scrollWheelSpeed:d-1*this.conf.scrollWheelSpeed;this.moveToPosition(Math.round(d))}return Event.stop(a)},_setGlobalCaption:function(){this.globalCaption&&(this.globalCaption.innerHTML=
"",this._activeItem&&this._activeItem.caption&&this.globalCaption.appendChild(this._activeItem.caption.cloneNode(!0)))},_initStep:function(a,b){this.Slider&&(this.Slider.locked=a?!0:!1);this._holdPos=!0==b?!0:!1;this._stepLock||(this._stepLock=!0,this._step())},_step:function(){var a=this._targetPosition-this._currentPosition,b=Math.abs(a);if(0.001<b){this._currentPosition+=this.conf.flowSpeedFactor*this.conf.calcStepWidth(a,b,this.items.length,this.conf.visibleItems);if((a=this.items[this._getIndexByPosition(this._currentPosition)])&&
a!=this._activeItem&&(this._activeItem&&this._activeItem.makeInactive(),this._activeItem=a,this._activeItem.makeActive(),this._setCaptionLabel(this._activeItem.index),0.5>=Math.abs(this._targetPosition-this._currentPosition)))this.conf.onReachTarget(this._activeItem);this._positionItems();a=this._step.bind(this);window.setTimeout(a,this._millisecondsPerStep)}else this._holdPos?this._stepLock=!1:(this.Slider&&(this.Slider.locked=!1),this._currentPosition=Math.round(this._currentPosition),this.Position&&
(!this.Slider.locked&&this._activeItem)&&this._setCaptionLabel(this._activeItem.index),this._positionItems(),this._stepLock=!1,this.onMoved&&(this.onMoved(window.coverFlow),this.onMoved=null));this.Slider&&!this.Slider.locked&&this.Slider.setPosition(this._currentPosition)},_positionItems:function(){if(this._lastStart)for(var a=this._lastStart;a;){a.element.style.display="none";a=a.next;if(a==this._lastStart)break;if(a&&a.pre==this._lastEnd)break}else this._lastStart=this._activeItem;if(this._activeItem){var b=
this._activeItem,a=b.pre,d=b.next;this._positionItem(b,0);for(b=1;b<=this.conf.visibleItems&&2*b<this.items.length;b++)a&&(this._positionItem(a,-b),this._lastStart=a,a=a.pre),d&&(this._positionItem(d,b),this._lastEnd=d,d=d.next)}},_positionItem:function(a,b){var d=this.conf,f=d.verticalFlow,e=a.element.style,g=a.position=this._currentPosition+b,g=a.relativePosition=Math.round(g)-this._currentPosition;a.relativePositionNormed=0<d.visibleItems?g/d.visibleItems:0;g=(0>g?-1:1)*(0==g?0:1);a.side=g;g=d.calcSize(a);
g.height=Math.max(g.height,0);g.width=Math.max(g.width,0);a.content.origProportion&&(g=this._scaleImageSize(a,g));a.size=g;var k=a.coordinates=d.calcCoordinates(a),h=a.relativeItemPosition=d.calcRelativeItemPosition(a),l=a.zIndex=d.calcZIndex(a),m=a.fontSize=d.calcFontSize(a);a.opacity=d.calcOpacity(a);g.height*=this.maxHeight;g.width*=this.maxHeight;var n=this.Flow.center.x*(1+k.x)+(h.x-1)*(f?g.height:g.width)/2,k=this.maxHeight/2*(1+k.y)+(h.y-1)*(f?g.width:g.height)/2;e.left=(f?k:n)+"px";e.top=
(f?n:k)+"px";this._setItemSize(a,g);1!=d.endOpacity&&this._setItemOpacity(a);this.Browser.IE||(e.fontSize=100*m+"%");e.zIndex=32768+Math.round(l*this.items.length);d.onDrawItem(a);e.visibility="visible";e.display="block"},_scaleImageSize:function(a,b,d){var f=this.conf.scaleFactorLandscape,e=this.conf.scaleFactorPortrait,g=this.conf.verticalFlow,k=a.content.origProportion,h=b.width,l=b.height,m=a.content;g?1>=k?("max"!=f&&1!=f&&(h=Math.min(l*f*k,d?d:1)),l=h/k):1<k&&(l="max"==e?d?d:1:1!=e?Math.min(h*
e/k,d?d:1):h/k,h=l*k):1<k?("max"!=f&&1!=f&&(h*=f,l=Math.min(h/k,d?d:1)),h=l*k):1>=k&&("max"==e?h=d?d:1:1!=e?(l*=e,h=Math.min(l*k,d?d:1)):h=l*k,l=h/k);l=isNaN(l)?0:l;h=isNaN(h)?0:h;return!d&&this.conf.fixItemSize?(f=b.width/b.height,d=Math.max(b.width,b.height),l=this._scaleImageSize(a,{width:d,height:d},d),1>f?(l=l.height/b.height,h=l*k/f):(h=l.width/b.width,l=h/k*f),k=100*l,d=100*h,h=100*((1-h)/2),g=100*((1-l)/f)*(g?0.5:1),m.style.height=k+"%",a.reflection&&(a.reflection.style.height=k*this.conf.reflectionHeight+
"%"),m.style.width=d+"%",a.reflection&&(a.reflection.style.width=d+"%"),m.style.marginLeft=h+"%",a.reflection&&(a.reflection.style.marginLeft=h+"%"),m.style.marginTop=g+"%",a.element.style.overflow="hidden",b):{width:h,height:l}},_setItemSize:function(){return ContentFlowGlobal.Browser.IE?function(a,b){if(!this.conf.fixItemSize)a.content.style.height=b.height+"px";else if(ContentFlowGlobal.Browser.IE6){var d=parseInt(a.content.style.height)/100;a.content.style.height=b.height*d+"px";d=parseInt(a.content.style.marginTop)/
100;a.content.style.marginTop=b.height*d+"px"}a.reflection&&(d=parseInt(a.content.style.height),a.reflection.style.height=d*this.conf.reflectionHeight+"px",a.reflection.style.marginTop=d*this.conf.reflectionGap+"px");a.element.style.width=b.width+"px";a.element.style.height=b.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px"}:function(a,b){a.reflection?(a.element.style.height=b.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px",a.reflection.style.marginTop=b.height*
this.conf.reflectionGap+"px"):a.element.style.height=this._reflectionWithinImage?b.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px":b.height+"px";a.element.style.width=b.width+"px"}}(),_setItemOpacity:function(){return ContentFlowGlobal.Browser.IE6?function(a){if(a.content.origSrc&&a.content.origSrc.match(/\.png$/)){var b=a.content.src;a.content.src=a.content.origSrc;a.content.style.filter=a.content.filterString+" progid:DXImageTransform.Microsoft.BasicImage(opacity="+a.opacity+
")";a.content.src=b}else a.content.style.filter="progid:DXImageTransform.Microsoft.BasicImage(opacity="+a.opacity+")";a.reflection&&(a.reflection.style.filter=a.reflection.filterString+"progid:DXImageTransform.Microsoft.BasicImage(opacity="+a.opacity+")")}:ContentFlowGlobal.Browser.IE?function(a){a.element.style.filter="progid:DXImageTransform.Microsoft.BasicImage(opacity="+a.opacity+")"}:function(a){a.element.style.opacity=a.opacity}}()};
Function.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}});Math.erf2||(Math.erf2=function(a){var b=-(8*(Math.PI-3)/(3*Math.PI*(Math.PI-4)));a*=a;return 1-Math.pow(Math.E,-a*(4/Math.PI+b*a)/(1+b*a))});Math._2PI05||(Math._2PI05=Math.sqrt(2*Math.PI));Math.normDist||(Math.normDist=function(a,b,d){b||(b=1);d||(d=0);a||(a=-d);return 1/(b*Math._2PI05)*Math.pow(Math.E,-(a-d)*(a-d)/(2*b*b))});
Math.normedNormDist||(Math.normedNormDist=function(a,b,d){return this.normDist(a,b,d)/this.normDist(d,b,d)});Math.exp||(Math.exp=function(a){return Math.pow(Math.E,a)});Math.ln||(Math.ln=Math.log);Math.log2||(Math.log2=function(a){return Math.log(a)/Math.LN2});Math.log10||(Math.log10=function(a){return Math.log(a)/Math.LN10});Math.logerithm||(Math.logerithm=function(a,b){return b&&b!=Math.E?2==b?Math.log2(a):10==b?Math.log10(a):Math.log(a)/Math.log(b):Math.log(a)});if(!Event)var Event={};
Event.stop||(Event.stop=function(a){a.cancelBubble=!0;a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();return!1});window.$CF=document.all&&!window.opera?function(a){if("string"==typeof a)return window.$CF(document.getElementById(a));CFElement.prototype.extend&&(a&&!a.extend)&&CFElement.prototype.extend(a);return a}:function(a){return a};
window.HTMLElement?CFElement=window.HTMLElement:(CFElement={prototype:{}},CFElement.prototype.extend=function(a){for(var b in this)a[b]||(a[b]=this[b])});CFElement.findPos||(CFElement.prototype.findPos=function(){var a=this,b=curtop=0;try{if(a.offsetParent)for(b=a.offsetLeft,curtop=a.offsetTop;a=a.offsetParent;)b+=a.offsetLeft,curtop+=a.offsetTop}catch(d){}return{left:b,top:curtop}});CFElement.getDimensions||(CFElement.prototype.getDimensions=function(){return{width:this.clientWidth,height:this.clientHeight}});
CFElement.hasClassName||(CFElement.prototype.hasClassName=function(a){return RegExp("\\b"+a+"\\b").test(this.className)});CFElement.addClassName||(CFElement.prototype.addClassName=function(a){this.hasClassName(a)||(this.className+=(this.className?" ":"")+a)});CFElement.removeClassName||(CFElement.prototype.removeClassName=function(a){this.className=this.className.replace(RegExp("\\b"+a+"\\b"),"").replace(/\s\s/g," ")});
CFElement.toggleClassName||(CFElement.prototype.toggleClassName=function(a){this.hasClassName(a)?this.removeClassName(a):this.addClassName(a)});CFElement.getChildrenByClassName||(CFElement.prototype.getChildrenByClassName=function(a){for(var b=[],d=0;d<this.childNodes.length;d++){var f=this.childNodes[d];1==f.nodeType&&$CF(f).hasClassName(a)&&b.push(f)}return b});
CFElement.addEvent||(CFElement.prototype.addEvent=function(a,b,d){this.addEventListener?this.addEventListener(a,b,d):this.attachEvent("on"+a,b)});CFElement.removeEvent||(CFElement.prototype.removeEvent=function(a,b,d){this.removeEventListener?this.removeEventListener(a,b,d):this.detachEvent("on"+a,b)});window.addEvent||(window.addEvent=function(a,b,d){this.addEventListener?this.addEventListener(a,b,d):"load"!=a&&"resize"!=a?document.attachEvent("on"+a,b):this.attachEvent("on"+a,b)});
window.removeEvent||(window.removeEvent=function(a,b,d){this.removeEventListener?this.removeEventListener(a,b,d):"load"!=a&&"resize"!=a?document.detachEvent("on"+a,b):this.detachEvent("on"+a,b)});ContentFlowGlobal.init();