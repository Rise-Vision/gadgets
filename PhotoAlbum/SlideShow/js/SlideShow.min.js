function SlideShow(a){var b=new gadgets.Prefs;this.duration=1E3*b.getInt("duration")-1200;this.interactivityTimeout=b.getInt("interactivityTimeout");this.nextIndex=this.current=this.totalImages=0;this.isInteracting=this.isLoading=!1;this.onLastPhotoShown=a;this.interactivityTimer=this.showPhotoTimer=null;this.isPaused=!1;this.timeLeft=0;this.startTimeout=new Date;this.isFadingOut=this.isFadingIn=!1}
SlideShow.prototype.initialize=function(){var a,b=this;a=$("<div>");var c=$("<ul>"),d=(new gadgets.Prefs).getBool("showNavigation");a.attr("id","slideshow");c.addClass("slides");a.append(c);d&&(c=$("<span>"),d=$("<span>"),c.addClass("arrow previous"),d.addClass("arrow next"),a.append(c).append(d));$("#container").append(a);a=RiseVision.Common.Utility.isTouchDevice()?"touchstart":"click";$("#slideshow .arrow").on(a,function(){b.cancelAutoCycling();$(this).hasClass("next")?b.nextIndex=b.current>=b.totalImages-
1?0:b.current+1:b.nextIndex=0>=b.current?b.totalImages-1:b.current-1;b.transitionOut()});this.configureSwipe()};
SlideShow.prototype.addImage=function(a){var b=new gadgets.Prefs;b.getInt("rsW");b.getInt("rsH");var c=b.getBool("showCaptions"),b=$("#slideshow ul"),d=$("<li>"),e=$("<div>"),f=$("<img>");f.width(a.width);f.height(a.height);f.attr("src",a.src);e.css({"margin-top":a.marginTop,"margin-left":a.marginLeft});a.caption&&c&&(c=$("<span>"),c.addClass("caption caption_font-style"),c.text(a.caption),d.append(c));e.append(f);d.hide();d.append(e);b.append(d);this.totalImages++};
SlideShow.prototype.configureSwipe=function(){var a=this;$("#slideshow").swipe({swipe:function(b,c){if("left"==c||"right"==c)a.cancelAutoCycling(),a.nextIndex="left"==c?a.current>=a.totalImages-1?0:a.current+1:0>=a.current?a.totalImages-1:a.current-1,a.showNextPhoto(!0,c)},threshold:50})};
SlideShow.prototype.cancelAutoCycling=function(){if(0<this.duration){var a=this;clearTimeout(this.showPhotoTimer);clearTimeout(this.interactivityTimer);this.isInteracting=!0;this.interactivityTimer=setTimeout(function(){a.isInteracting=!1;a.transitionOut()},1E3*this.interactivityTimeout)}};
SlideShow.prototype.showNextPhoto=function(a,b){var c=$("#slideshow li"),d=c.eq(this.current),e=this,f;f=c.eq(this.nextIndex);this.current=this.nextIndex;if(a){var g,h;"left"==b?(g="slideInLeft",h="slideOutLeft"):(g="slideInRight",h="slideOutRight");f.bind("webkitAnimationEnd",function(){f.removeClass(g);f.unbind("webkitAnimationEnd")});d.bind("webkitAnimationEnd",function(){e.getNextIndex();d.hide();d.removeClass(h);d.unbind("webkitAnimationEnd")});f.removeClass(h).addClass(g).show();d.removeClass(g).addClass(h)}else this.isFadingIn||
this.isFadingOut||(this.isFadingIn=!0,f.fadeIn("slow",function(){e.isFadingIn=!1;$(this).addClass("visible");e.isPaused||e.isInteracting||e.startTimer();0<e.duration&&e.getNextIndex()}))};SlideShow.prototype.getNextIndex=function(){this.nextIndex=this.current>=this.totalImages-1?0:this.current+1};SlideShow.prototype.startTimer=function(){var a=this;clearTimeout(this.showPhotoTimer);this.showPhotoTimer=setTimeout(function(){a.transitionOut()},this.duration);this.isPaused||(this.startTimeout=new Date)};
SlideShow.prototype.resumeTimer=function(){$("#slideshow li");var a=$("#slideshow li:first"),b=this;0==this.timeLeft?(this.timeLeft=this.duration,this.isLoading?(this.isLoading=!1,this.isFadingIn||this.isFadingOut||(this.isFadingOut=!0,a.fadeOut("slow",function(){b.isFadingOut=!1;$(this).removeClass("visible");a.remove();b.isPaused||b.showNextPhoto(!1)}))):0<$(".visible").length?this.transitionOut():this.showNextPhoto(!1)):(clearTimeout(this.showPhotoTimer),this.showPhotoTimer=setTimeout(function(){b.transitionOut()},
this.timeLeft))};SlideShow.prototype.pauseTimer=function(){var a;clearTimeout(this.showPhotoTimer);this.timeLeft=this.duration;this.timeLeft-=new Date-this.startTimeout;a=Math.round(this.timeLeft/1E3);this.timeLeft=1E3*a;0>=a&&(this.timeLeft=0,this.transitionOut())};SlideShow.prototype.play=function(){this.isPaused=!1;this.resumeTimer()};SlideShow.prototype.pause=function(){this.isPaused=!0;this.pauseTimer()};
SlideShow.prototype.transitionOut=function(){var a=$("#slideshow li").eq(this.current),b=this;this.showPhotoTimer=null;0<this.totalImages&&this.current>=this.totalImages-1?($("#slideshow li:not(:last)").remove(),this.totalImages=this.current=this.timeLeft=0,this.isLoading=!0,this.onLastPhotoShown.call(window.photoAlbum)):this.isFadingIn||this.isFadingOut||(this.isFadingOut=!0,a.fadeOut("slow",function(){b.isFadingOut=!1;$(this).removeClass("visible");b.isPaused||b.showNextPhoto(!1)}))};