function PhotoAlbum(){var c=new gadgets.Prefs;this.url=c.getString("url");this.visualOption=c.getString("visualOption");this.maxImages=c.getInt("maxImages");this.entries=null;this.isLoading=!0;this.isStarted=this.isLastPhoto=this.isFeedLoaded=!1;this.feedLoadFailedTimer=null;this.feedLoadFailedCount=0;this.images=[];this.captions=[];this.imageCount=0}
PhotoAlbum.prototype.initialize=function(){var c=this;$.ajaxSetup({cache:!0});"slideShow"==this.visualOption?($("<link/>",{rel:"stylesheet",type:"text/css",href:"https://s3.amazonaws.com/Gadget-Photo-Album/SlideShow/css/SlideShow.css"}).appendTo("head"),$.getScript("https://s3.amazonaws.com/Gadget-Photo-Album/SlideShow/js/SlideShow.min.js",function(){c.loadFeed()})):"collage"==this.visualOption?($("<link/>",{rel:"stylesheet",type:"text/css",href:"https://s3.amazonaws.com/Gadget-Photo-Album/Collage/css/Collage.css"}).appendTo("head"),
$.getScript("https://s3.amazonaws.com/Gadget-Photo-Album/Collage/js/Collage.min.js",function(){c.loadFeed()})):"coverFlow"==this.visualOption&&this.loadFeed()};
PhotoAlbum.prototype.loadFeed=function(){var c=this,b={};b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM;b[gadgets.io.RequestParameters.REFRESH_INTERVAL]=60;this.feedLoadFailedTimer=setTimeout(function(){c.feedLoadFailed()},5E3);gadgets.io.makeRequest(this.url,function(a){0==a.errors.length&&(clearTimeout(c.feedLoadFailedTimer),c.onFeedLoaded(a))},b)};
PhotoAlbum.prototype.onFeedLoaded=function(c){var b;this.isFeedLoaded=!0;for(var a=c.data.getElementsByTagName("item").length-1;a>=this.maxImages;a--)b=c.data.getElementsByTagName("item")[a],b.parentNode.removeChild(b);c.data&&0<c.data.getElementsByTagName("item").length?(this.entries=c.data.getElementsByTagName("item"),this.loadPhotos()):(console.log("This feed has no items."),readyEvent())};
PhotoAlbum.prototype.loadPhotos=function(){var c,b,a,d,f,e;self=this;prefs=new gadgets.Prefs;rsW=prefs.getInt("rsW");rsH=prefs.getInt("rsH");supportedTypes=["image/bmp","image/gif","image/jpeg","image/png","image/tiff"];this.oldImages=this.images;this.images=[];this.captions=[];$.each(this.entries,function(h,k){c=$(this).find("group");if(0<c.length){if(b=c.find("content"),0<b.length)for(var g in supportedTypes)if(b.attr("type")==supportedTypes[g]){e={};f=b.attr("url");self.addCaption(c.find("title").text(),
c.find("description").text(),f);e.src=f;e.caption=self.captions[h].caption;self.images.push(e);self.load(e.src,h);break}}else if(b=$(this).find("content"),0<b.length)for(g in supportedTypes){if(b.attr("type")==supportedTypes[g]){e={};a=$(this).find("title");d=$(this).find("description");f=b.attr("url");a=1<a.length?$(a[1]).text():$(a).text();d=1<d.length?$(d[1]).text():$(d).text();self.addCaption(a,d,f);e.src=f;e.caption=self.captions[h].caption;self.images.push(e);self.load(e.src,h);break}}else self.isLoading&&
(self.isLoading=!1,readyEvent())})};PhotoAlbum.prototype.addCaption=function(c,b,a,d){c=-1!=this.url.indexOf("https://picasaweb.google.com",0)?null==b||""==b?c:b:null==c||""==c?b:c;d?this.captions.unshift({src:a,caption:c}):this.captions.push({src:a,caption:c})};PhotoAlbum.prototype.load=function(c,b){"slideShow"==this.visualOption?this.loadSlideShow(c,b):"coverFlow"==this.visualOption?this.loadCoverFlow(c,b):this.loadCollage(c,b)};
PhotoAlbum.prototype.loadSlideShow=function(c,b){var a=this,d=new gadgets.Prefs,f=d.getInt("rsW"),d=d.getInt("rsH"),f={url:c+"?imgmax=1600&dummy="+Math.ceil(100*Math.random()),rsW:f,rsH:d,callback:function(e,d){for(var f=!1,g=0;g<a.oldImages.length;g++)if(c==a.oldImages[g].src){a.images[b].width=a.oldImages[g].width;a.images[b].height=a.oldImages[g].height;a.images[b].marginTop=a.oldImages[g].marginTop;a.images[b].marginLeft=a.oldImages[g].marginLeft;f=!0;break}f||(a.images[b].width=e,a.images[b].height=
d,a.images[b].marginTop=-(d/2)+"px",a.images[b].marginLeft=-(e/2)+"px");window.slideShow||(window.slideShow=new SlideShow(a.onLastPhotoShown),window.slideShow.initialize());a.isLoading&&window.slideShow.addImage(a.images[b]);a.imageCount++;a.onImageLoaded()},onerror:function(){for(var e=0;e<a.oldImages.length;e++)if(c==a.oldImages[e].src){a.images[b].width=a.oldImages[e].width;a.images[b].height=a.oldImages[e].height;a.images[b].marginTop=a.oldImages[e].marginTop;a.images[b].marginLeft=a.oldImages[e].marginLeft;
break}a.imageCount++;a.onImageLoaded();console.log("Error loading image "+c)}};RiseVision.Common.Utility.scaleToFit(f)};
PhotoAlbum.prototype.loadCoverFlow=function(c,b){var a=this,d=new gadgets.Prefs,f=d.getInt("rsW"),d=d.getInt("rsH"),f={url:c+"?imgmax=1600&dummy="+Math.ceil(100*Math.random()),rsW:f,rsH:d,callback:function(e,d){for(var f=!1,g=0;g<a.oldImages.length;g++)if(c==a.oldImages[g].src){a.images[b].width=a.oldImages[g].width;a.images[b].height=a.oldImages[g].height;a.images[b].marginTop=a.oldImages[g].marginTop;a.images[b].marginLeft=a.oldImages[g].marginLeft;f=!0;break}f||(a.images[b].width=e,a.images[b].height=
d,a.images[b].marginTop=-(d/2)+"px",a.images[b].marginLeft=-(e/2)+"px");a.imageCount++;a.onImageLoaded()},onerror:function(){for(var e=0;e<a.oldImages.length;e++)if(c==a.oldImages[e].src){a.images[b].width=a.oldImages[e].width;a.images[b].height=a.oldImages[e].height;a.images[b].marginTop=a.oldImages[e].marginTop;a.images[b].marginLeft=a.oldImages[e].marginLeft;break}a.imageCount++;a.onImageLoaded();console.log("Error loading image "+c)}};RiseVision.Common.Utility.scaleToFit(f)};
PhotoAlbum.prototype.loadCollage=function(c,b){var a=this,d=(new gadgets.Prefs).getInt("maxSize"),d={url:c+"?imgmax=1600&dummy="+Math.ceil(100*Math.random()),rsW:d,rsH:d,callback:function(d,e){for(var h=!1,k=0;k<a.oldImages.length;k++)if(c==a.oldImages[k].src){a.images[b].width=a.oldImages[k].width;a.images[b].height=a.oldImages[k].height;h=!0;break}h||(a.images[b].width=d,a.images[b].height=e);window.collage||(window.collage=new Collage(a.onLastPhotoShown),window.collage.initialize());a.isLoading&&
window.collage.addImage(a.images[b]);a.imageCount++;a.onImageLoaded()},onerror:function(){for(var d=0;d<a.oldImages.length;d++)if(c==a.oldImages[d].src){a.images[b].width=a.oldImages[d].width;a.images[b].height=a.oldImages[d].height;break}a.imageCount++;a.onImageLoaded();console.log("Error loading image "+c)}};RiseVision.Common.Utility.scaleToFit(d)};
PhotoAlbum.prototype.onImageLoaded=function(){var c=0,b=this.images.length;if("slideShow"==this.visualOption){if(!this.isLoading){if(this.imageCount==b){for(c=0;c<b;c++)window.slideShow.addImage(this.images[c]);window.slideShow.play()}}else if(10==this.imageCount||this.imageCount==b&&!this.isStarted)this.isStarted=!0,readyEvent();this.imageCount==b&&(this.imageCount=0,this.isLoading=this.isStarted=!1)}else if("coverFlow"==this.visualOption)this.imageCount==b&&(window.coverFlow?window.coverFlow.setPhotos(this.images):
window.coverFlow=new CoverFlow(this.images,this.onLastPhotoShown),window.coverFlow.render(this.onRendered,this),this.imageCount=0);else{if(!this.isLoading){if(this.imageCount==b){for(c=b-1;0<=c;c--)window.collage.addImage(this.images[c]);window.collage.play()}}else if(10==this.imageCount||this.imageCount==b&&!this.isStarted)this.isStarted=!0,readyEvent();this.imageCount==b&&(this.imageCount=0,this.isLoading=this.isStarted=!1)}};
PhotoAlbum.prototype.onRendered=function(c){c.isLoading?(c.isLoading=!1,readyEvent()):"slideShow"==c.visualOption?window.slideShow.play():"coverFlow"==c.visualOption&&window.coverFlow.play()};PhotoAlbum.prototype.onLastPhotoShown=function(){this.isFeedLoaded=!1;this.isLastPhoto=!0;doneEvent()};
PhotoAlbum.prototype.feedLoadFailed=function(){var c,b=this.images.length;this.feedLoadFailedCount++;if("slideShow"==this.visualOption){if(null!=window.slideShow){for(c=0;c<b;c++)window.slideShow.addImage(this.images[c]);window.slideShow.play()}}else if("coverFlow"==this.visualOption)null!=window.coverFlow&&window.coverFlow.render(this.onRendered,this);else if("collage"==this.visualOption&&null!=window.collage){for(c=b-1;0<=c;c--)window.collage.addImage(this.images[c]);window.collage.play()}};
PhotoAlbum.prototype.play=function(){this.isFeedLoaded?"slideShow"==this.visualOption?window.slideShow.play():"coverFlow"==this.visualOption?window.coverFlow.play():window.collage.play():this.loadFeed()};PhotoAlbum.prototype.pause=function(){"slideShow"==this.visualOption?window.slideShow.pause():"coverFlow"==this.visualOption?window.coverFlow.pause():window.collage.pause()};