function Venue(){var t=new gadgets.Prefs;this.location=t.getString("location"),this.showCrown=t.getBool("showCrown"),this.showTips=t.getBool("showTips"),this.showSpecials=t.getBool("showSpecials"),this.showPhotos=t.getBool("showPhotos"),this.showMayor=t.getBool("showMayor"),this.showCheckIns=t.getBool("showCheckIns"),this.showQR=t.getBool("showQR"),this.layoutURL=t.getString("layoutURL")?t.getString("layoutURL"):"https://s3.amazonaws.com/Gadget-Foursquare/Default.xml",this.rsW=t.getInt("rsW"),this.rsH=t.getInt("rsH"),this.mayor=new Object,this.tips=[],this.specials=[],this.photos=[],this.tipsIndex=0,this.specialsIndex=0,this.photosIndex=0,this.hasTips=!1,this.hasSpecials=!1,this.hasPhotos=!1,this.contentTimer=null,this.updateTimerExpired=!1,this.refreshInterval=1e4,this.updateInterval=6e4,this.isLoading=!0,this.isUpdating=!1,this.currentContentType=null,this.contentTypes={tips:"tips",specials:"specials",photos:"photos"}}Venue.prototype.loadLayout=function(){var t={},e=this,s=$("<link>");this.styleURL&&(s.attr({type:"text/css",rel:"stylesheet",href:this.styleURL}),$("head").append(s)),this.layoutURL&&(t[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.layoutURL,function(t){var s=t.data;if(s.getElementsByTagName("Style").length>0){var i=document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.innerHTML=s.getElementsByTagName("Style")[0].childNodes[1].nodeValue,i.appendChild(o)}0!=s.getElementsByTagName("Layout").length&&($("#container").html(s.getElementsByTagName("Layout")[0].childNodes[1].nodeValue),$("#container").append("<div class='error'></div>"),e.getData())},t))},Venue.prototype.getData=function(){gadgets.rpc.call("","rsparam_get",null,(new gadgets.Prefs).getString("id"),"social:foursquare")},Venue.prototype.processData=function(t,e,s){if(s){var i=JSON.parse(s);t.token=i.access,i.access?(t.venueID="display"==t.location&&i.displayLocation?i.displayLocation:i.companyLocation,t.getVenue()):(t.showError("Please create a Foursquare Social Connection for your Company or Display before using this Gadget."),readyEvent())}else t.isLoading=!1,t.showError("Please create a Foursquare Social Connection for your Company or Display before using this Gadget."),readyEvent()},Venue.prototype.getVenue=function(){var t={},e=this;this.tips=[],this.specials=[],this.photos=[],this.hasTips=!1,this.hasSpecials=!1,this.hasPhotos=!1,t[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.JSON,t[gadgets.io.RequestParameters.REFRESH_INTERVAL]=60,gadgets.io.makeRequest("https://api.foursquare.com/v2/venues/"+this.venueID+"?oauth_token="+this.token+"&v=20131212",function(t){if(t.data){var s,i,o=t.data.response.venue,n=0;if($("#content").show(),$(".error").hide(),0==o.mayor.count?($("#crown").hide(),$("#mayor").hide(),$(".mayor").hide(),$(".noMayor").show()):o.mayor.user&&(e.showMayor?$(".photo").attr("src",o.mayor.user.photo?o.mayor.user.photo.prefix+"110x110"+o.mayor.user.photo.suffix:""):$(".photo").remove(),$(".message").show(),$(".noMayor").hide(),$(".mayorName").text(o.mayor.user.firstName?o.mayor.user.firstName:""),$(".mayorCheckins").text(o.mayor.count)),e.showCrown||$("#crown").hide(),e.showCheckIns||$("#description").hide(),o.stats&&$(".checkins").text(o.stats.checkinsCount?o.stats.checkinsCount:0),e.showQR?$(".qrCode").attr("src","https://chart.googleapis.com/chart?cht=qr&chs=110x110&chld=H|0&chl="+encodeURIComponent("https://foursquare.com/mobile/venue/"+e.venueID)):$("#qr").remove(),e.showTips)for(s=0;s<o.tips.groups.length;s++)for(i=0;i<o.tips.groups[s].items.length;i++){var a=new Date(1e3*o.tips.groups[s].items[i].createdAt);e.tips[n]=new Object,e.tips[n].name=o.tips.groups[s].items[i].user.firstName,e.tips[n].photo=o.tips.groups[s].items[i].user.photo,e.tips[n].text=o.tips.groups[s].items[i].text,e.tips[n].date=a.toString("MMMM d, yyyy"),e.hasTips=!0,n++}if(e.showSpecials)for(s=0;s<o.specials.length;s++,i++)e.specials[s]=new Object,e.specials[s].icon=o.specials[s].icon,e.specials[s].title=o.specials[s].title,e.specials[s].text=o.specials[s].message,e.hasSpecials=!0;if(n=0,e.showPhotos){for(s=0;s<o.photos.groups.length;s++)for(i=0;i<o.photos.groups[s].items.length;i++)e.photos[n]=new Object,e.photos[n].url=o.photos.groups[s].items[i].prefix+"original"+o.photos.groups[s].items[i].suffix,e.photos[n].width=o.photos.groups[s].items[i].width,e.photos[n].height=o.photos.groups[s].items[i].height,e.hasPhotos=!0,n++;if(e.hasPhotos){e.rsW>e.rsH?($("#lower").height($("#container").height()-$("#upper").outerHeight(!0)),e.cf&&(e.cf=null,$(".flow").empty()),e.cf=new ContentFlow("cf",{flowSpeedFactor:2,scaleFactor:1,maxItemHeight:.5*$("#lower").height(),reflectionHeight:0})):e.cf=new ContentFlow("cf",{flowSpeedFactor:2,scaleFactor:1,reflectionHeight:0});var p=0,h=e.photos.length;$.each(e.photos,function(t,s){var i=$("<div class='item'>"),o=$("<img class='content'>");o.load(function(){i.append(o),e.cf.addItem(i.get(0),"last",function(){p++,p==h&&(1==h?(e.hideCoverFlow(),e.setContentType(),e.isLoading=!1,readyEvent()):e.cf.moveTo("first",function(){e.hideCoverFlow(),e.setContentType(),e.isLoading=!1,readyEvent()}))})}),o.error(function(){console.log("Image could not be loaded: "+s.url),p++}),o.attr("src",s.url)})}else e.setContentType(),e.isLoading=!1,readyEvent()}else e.setContentType(),e.isLoading=!1,readyEvent();setTimeout(function(){e.expireUpdatesTimer(e)},e.updateInterval)}else t.errors.length>0&&("400 Error"==t.errors[0]?e.showError(e.venueID+" is not a valid Venue ID."):"401 Error"==t.errors[0]&&e.showError("The Foursquare token has been revoked. Please generate a new one.")),e.isLoading=!1,readyEvent()},t)},Venue.prototype.showError=function(t){var e=this;$("#content").hide(),$(".error").text(t).show(),setTimeout(function(){e.getData()},this.updateInterval)},Venue.prototype.setContentType=function(){this.currentContentType?this.currentContentType==this.contentTypes.tips?this.hasSpecials?this.currentContentType=this.contentTypes.specials:this.hasPhotos&&(this.currentContentType=this.contentTypes.photos):this.currentContentType==this.contentTypes.specials?this.hasPhotos?this.currentContentType=this.contentTypes.photos:this.hasTips&&(this.currentContentType=this.contentTypes.tips):this.hasTips?(this.currentContentType=this.contentTypes.tips,$("#wrapper").show()):this.hasSpecials&&(this.currentContentType=this.contentTypes.specials,$("#wrapper").show()):this.hasTips?this.currentContentType=this.contentTypes.tips:this.hasSpecials?this.currentContentType=this.contentTypes.specials:this.hasPhotos?this.currentContentType=this.contentTypes.photos:($("#tips").hide(),$("#specials").hide(),this.hideCoverFlow()),this.showContent()},Venue.prototype.showContent=function(){switch(this.currentContentType){case this.contentTypes.tips:this.displayTips();break;case this.contentTypes.specials:this.displaySpecials();break;case this.contentTypes.photos:this.showNextPhoto()}},Venue.prototype.displayTips=function(){$("#wrapper");this.tipsIndex==this.tips.length?(this.tipsIndex=0,this.setContentType()):this.isLoading||(0==this.tipsIndex?!this.hasSpecials&&!this.hasPhotos&&this.tips.length<=2?this.fadeInTips():$("#wrapper").hasClass("fadeOut")?this.fadeInTips():this.fadeOutTips():this.fadeOutTips())},Venue.prototype.fadeOutTips=function(){var t=this;$("#wrapper").bind("webkitTransitionEnd",function(e){t.fadeInTips(),$(this).unbind(e)}),$("#wrapper").addClass("fadeOut").removeClass("fadeIn")},Venue.prototype.fadeInTips=function(){var t=this,e=$("#wrapper");this.hideCoverFlow(),e.show(),$("#specials").hide(),$("#tips").show(),$(".tipPhotoWrapper").show(),$(".tipWrapper").show(),this.loadTips(),e.hasClass("fadeIn")?t.startTimer():(e.bind("webkitTransitionEnd",function(e){t.startTimer(),$(this).unbind(e)}),e.addClass("fadeIn").removeClass("fadeOut"))},Venue.prototype.loadTips=function(){var t=this;$(".tipPhoto").each(function(e){return t.tipsIndex==t.tips.length&&e==$(".tipPhoto").length-1?($(".tipPhotoWrapper").slice(e).hide(),$(".tipWrapper").slice(e).hide(),!1):($(this).attr("src",t.tips[t.tipsIndex].photo.prefix+"110x110"+t.tips[t.tipsIndex].photo.suffix),$(".tip").eq(e).text(t.tips[t.tipsIndex].text),$(".tipName").eq(e).text(t.tips[t.tipsIndex].name),$(".tipDate").eq(e).text(t.tips[t.tipsIndex].date),void t.tipsIndex++)})},Venue.prototype.displaySpecials=function(){$("#wrapper");this.specialsIndex==this.specials.length?(this.specialsIndex=0,this.setContentType()):this.isLoading||(0==this.specialsIndex?!this.hasTips&&!this.hasPhotos&&this.specials.length<=2?this.fadeInSpecials():$("#wrapper").hasClass("fadeOut")?this.fadeInSpecials():this.fadeOutSpecials():this.fadeOutSpecials())},Venue.prototype.fadeOutSpecials=function(){var t=this;$("#wrapper").bind("webkitTransitionEnd",function(e){t.fadeInSpecials(),$(this).unbind(e)}),$("#wrapper").addClass("fadeOut").removeClass("fadeIn")},Venue.prototype.fadeInSpecials=function(){var t=this,e=$("#wrapper");this.hideCoverFlow(),e.show(),$("#tips").hide(),$("#specials").show(),$(".specialLogoWrapper").show(),$(".specialWrapper").show(),this.loadSpecials(),e.hasClass("fadeIn")?t.startTimer():(e.bind("webkitTransitionEnd",function(e){t.startTimer(),$(this).unbind(e)}),e.addClass("fadeIn").removeClass("fadeOut"))},Venue.prototype.loadSpecials=function(){var t=this;$(".specialLogo").each(function(e){return t.specialsIndex==t.specials.length&&e==$(".specialLogo").length-1?($(".specialLogoWrapper").slice(e).hide(),$(".specialWrapper").slice(e).hide(),!1):($(this).attr("src","//foursquare.com/img/specials/"+t.specials[t.specialsIndex].icon+".png"),$(".specialTitle").eq(e).text(t.specials[t.specialsIndex].title),$(".special").eq(e).text(t.specials[t.specialsIndex].text),void t.specialsIndex++)})},Venue.prototype.showNextPhoto=function(){var t=this,e=$("#wrapper");this.photosIndex==this.photos.length?(this.photosIndex=0,this.setContentType()):this.isLoading||(this.cf.moveTo(this.photosIndex),0==this.photosIndex&&(e.hasClass("fadeIn")?(e.bind("webkitTransitionEnd",function(s){e.hide(),t.showCoverFlow(),$(this).unbind(s)}),e.addClass("fadeOut").removeClass("fadeIn")):(e.hide(),this.showCoverFlow())),this.photosIndex++,this.startTimer())},Venue.prototype.startTimer=function(){var t=this;this.contentTimer=setTimeout(function(){t.checkForUpdates(),t.isUpdating?(t.currentContentType==t.contentTypes.tips?t.tipsIndex=0:t.currentContentType==t.contentTypes.specials?t.specialsIndex=0:t.photosIndex=0,t.updateTimerExpired=!1,t.getData()):t.currentContentType==t.contentTypes.tips?t.displayTips():t.currentContentType==t.contentTypes.specials?t.displaySpecials():t.showNextPhoto()},this.refreshInterval)},Venue.prototype.hideCoverFlow=function(){$("#cf").css({top:"10000px"}),$("#photos").addClass("photoFadeOut").removeClass("fadeIn")},Venue.prototype.showCoverFlow=function(){$("#cf").css({top:""}),$("#photos").addClass("fadeIn").removeClass("photoFadeOut")},Venue.prototype.startContentTimer=function(){this.currentContentType==this.contentTypes.tips?this.fadeInTips():this.currentContentType==this.contentTypes.specials?this.fadeInSpecials():this.currentContentType==this.contentTypes.photos&&this.showNextPhoto()},Venue.prototype.stopContentTimer=function(){clearTimeout(this.contentTimer)},Venue.prototype.expireUpdatesTimer=function(t){t.updateTimerExpired=!0},Venue.prototype.checkForUpdates=function(){this.isUpdating=!1,this.updateTimerExpired&&(this.currentContentType==this.contentTypes.tips&&this.tipsIndex==this.tips.length?this.isUpdating=!0:this.currentContentType==this.contentTypes.specials&&this.specialsIndex==this.specials.length&&0==this.tips.length?this.isUpdating=!0:this.currentContentType==this.contentTypes.photos&&this.photosIndex==this.photos.length&&0==this.tips.length&&0==this.specials.length?this.isUpdating=!0:this.currentContentType||(this.isUpdating=!0))};