var prefs=new gadgets.Prefs,chMode=prefs.getBool("channelMode"),autoPlay=prefs.getBool("autoPlay"),isLoading=!0,currentVideo=0,videoTotal=0,bytesLoaded=0,moogaloop=null;
function initVimeo(){var a={};a[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.JSON;chMode?gadgets.io.makeRequest("http://vimeo.com/api/v2/channel/"+prefs.getString("File")+"/videos.json",function(a){a.data?(videoTotal=a.data.length,channelVideos=a.data,videoID=channelVideos[currentVideo].id,embedPlayer()):console.log("No videos found in channel")},a):(videoID=prefs.getString("File"),embedPlayer())}
function embedPlayer(){var a={clip_id:videoID,api:1,player_id:"moogaloop",api_ready:"onLoad"};bytesLoaded=0;swfobject.embedSWF("http://vimeo.com/moogaloop.swf","moogaloop","100%","100%","9.0.0","expressInstall.swf",a,{allowscriptaccess:"always",allowfullscreen:"true",wmode:"transparent"})}
function onLoad(a){moogaloop=document.getElementById(a);moogaloop.api_setVolume(prefs.getInt("volume")/100);moogaloop.api_addEventListener("play","onPlay");moogaloop.api_addEventListener("loadProgress","onLoadProgress");moogaloop.api_addEventListener("finish","onFinish");isLoading?readyEvent():chMode&&play()}function onPlay(){autoPlay=!0}function onLoadProgress(a){try{bytesLoaded=parseFloat(a.percent)}catch(b){console.log(args)}}
function onFinish(){chMode?(currentVideo++,currentVideo>=videoTotal?doneEvent():(videoID=channelVideos[currentVideo].id,embedPlayer())):doneEvent()}function play(){autoPlay&&(chMode?isLoading?start():currentVideo>=videoTotal?(currentVideo=0,videoID=channelVideos[currentVideo].id,embedPlayer()):0==currentVideo?prefs.getBool("loop")&&start():start():(isLoading||!isLoading&&prefs.getBool("loop"))&&start());isLoading=!1}
function start(){moogaloop.api_play();setTimeout(function(){0==bytesLoaded&&chMode&&(currentVideo++,currentVideo>=videoTotal?doneEvent():(videoID=channelVideos[currentVideo].id,embedPlayer()))},5E3)}function pause(){moogaloop.api_pause()}function stop(){moogaloop.api_pause()};