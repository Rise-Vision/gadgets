"use strict";var RiseVision=RiseVision||{};RiseVision.Directory={},RiseVision.Directory.Settings={},RiseVision.Directory.Controller={},RiseVision.Directory.Settings=function(){this.settings=new RiseVision.Common.Settings,this.picker=new RiseVision.Common.Picker,this.viz=new RiseVision.Common.Visualization,this.baseURL="",this.headerRows="0",this.range=""},RiseVision.Directory.Settings.prototype.initSettings=function(){var a=this;$("#googleDrive").click(function(){a.picker.showPicker($(this).data("for"),google.picker.ViewId.SPREADSHEETS)}),$("input[name='cells']").change(function(){var b=$(this).val();"range"==b?(a.range=$("#range").val(),$("#rangeContainer").show()):(a.range="",$("#rangeContainer").hide()),a.showDataURLOptions()}),$("#range").blur(function(){a.range=$(this).val(),a.showDataURLOptions()}),$("#headerRows").change(function(){a.headerRows=$(this).val(),a.showDataURLOptions()}),$("#sheet").change(function(){a.showDataURLOptions()}),$("#cardImage").on("blur",function(a){var b=$(this).val();b&&isNaN(b)?$("li.cardImage").show():$("li.cardImage").hide()}),$("#cardTitle").on("blur",function(a){var b=$(this).val();b&&isNaN(b)?$("li.cardTitle").show():$("li.cardTitle").hide()}),$("#cardSubtitle").on("blur",function(a){var b=$(this).val();b&&isNaN(b)?$("li.cardSubtitle").show():$("li.cardSubtitle").hide()}),$("#cardDetail").on("blur",function(a){var b=$(this).val();b&&isNaN(b)?$("li.cardDetail").show():$("li.cardDetail").hide()}),$(".colorPicker").on("click",function(a){directorySettings.showColorPicker($(this).data("for"))}),$(".fontSelector").on("click",function(a){directorySettings.showFontSelector($(this).data("for"))}),$("#scrollDirection").on("change",function(a){"none"==$(this).val()?$("li.scroll").hide():$("li.scroll").show()}),$("#scrollBy").on("change",function(a){"continuous"==$(this).val()?$("li.scrollHold").hide():$("li.scrollHold").show()}),$("#nav").on("change",function(a){var b=$(this).val();"none"==b?$("li.nav").hide():$("li.nav").show(),"left"==b||"right"==b?$("li.horizontal").hide():$("li.horizontal").show()}),$("#colCount").on("change",function(a){directorySettings.buildColumnsUI()}),$("#showCard").on("click",function(a){$(this).is(":checked")?$("li.card").show():$("li.card").hide()}),$("#cardUseDefault").on("click",function(a){$(this).is(":checked")?$("li.cardLayoutURL").hide():$("li.cardLayoutURL").show()}),$("#useDefault").on("click",function(a){$(this).is(":checked")?$("li.layoutURL").hide():$("li.layoutURL").show()}),prefs.getString("url")&&($("#url").val(prefs.getString("url")),""!=prefs.getString("docID")&&(this.docID=prefs.getString("docID"),this.picker.getSheets({docID:prefs.getString("docID"),callback:function(b){null!=b&&(a.onSheetsLoaded(b),$("#sheet").val(unescape(prefs.getString("sheet"))),$("li.more").show())}}),$("input[type='radio'][name='cells']").each(function(){$(this).val()==prefs.getString("cells")&&($(this).attr("checked","checked"),"range"==$(this).val()&&$("#rangeContainer").show())}),$("#range").val(prefs.getString("range")),$("#headerRows").val(prefs.getString("headerRows"))),$("#refresh").val(prefs.getInt("refresh")),$("#imageCol").val(prefs.getString("imageCol")),$("#scrollDirection").val(prefs.getString("scrollDirection")),$("#scrollBy").val(prefs.getString("scrollBy")),$("#scrollHold").val(prefs.getInt("scrollHold")),$("#scrollSpeed").val(prefs.getString("scrollSpeed")),$("#scrollResumes").val(prefs.getInt("scrollResumes")),$("#rowPadding").val(prefs.getInt("rowPadding")),$("#nav").val(prefs.getString("nav")),$("#showAll").val(prefs.getInt("showAll")),$("#navMargin").val(prefs.getInt("navMargin")),$("#rowHeight").val(prefs.getInt("rowHeight")),$("#colPadding").val(prefs.getInt("colPadding")),$("#colCount").val(prefs.getInt("colCount")),$("#showCard").attr("checked",prefs.getBool("showCard")),$("#useDefault").attr("checked",prefs.getBool("useDefault")),$("#layoutURL").val(prefs.getString("layoutURL")),this.populateColor($("#rowColor"),prefs.getString("rowColor")),this.populateColor($("#altRowColor"),prefs.getString("altRowColor")),this.populateColor($("#bgColor"),prefs.getString("bgColor")),this.populateColor($("#navColor"),prefs.getString("navColor")),this.populateColor($("#navBgColor"),prefs.getString("navBgColor")),this.populateColor($("#headingColor"),prefs.getString("headingColor")),this.populateColor($("#headingBgColor"),prefs.getString("headingBgColor")),this.populateColor($("#headingSortColor"),prefs.getString("headingSortColor"))),$("#colCount").trigger("change"),gadgets.rpc.call("","rscmd_getAdditionalParams",function(b){if(b){b=JSON.parse(b),$("#data_font-style").text(b.data_font),$("#data_font-style").data("css",b["data_font-style"]),$("#nav_font-style").text(b.nav_font),$("#nav_font-style").data("css",b["nav_font-style"]),$("#heading_font-style").text(b.heading_font),$("#heading_font-style").data("css",b["heading_font-style"]),$("#cardLocation").val(b.cardLocation),$("#cardWidth").val(b.cardWidth),$("#cardTimeout").val(b.cardTimeout),$("#cardBorder").attr("checked",b.cardBorder),$("#cardImage").val(b.cardImage),$("#cardImageAlign").val(b.cardImageAlign),$("#cardImageWidth").val(b.cardImageWidth),$("#cardImagePadding").val(b.cardImagePadding),$("#cardTitle").val(b.cardTitle),$("#cardTitle_font-style").text(b.cardTitle_font),$("#cardTitle_font-style").data("css",b["cardTitle_font-style"]),$("#cardTitlePadding").val(b.cardTitlePadding),$("#cardSubtitle").val(b.cardSubtitle),$("#cardSubtitle_font-style").text(b.cardSubtitle_font),$("#cardSubtitle_font-style").data("css",b["cardSubtitle_font-style"]),$("#cardSubtitlePadding").val(b.cardSubtitlePadding),$("#cardDetail").val(b.cardDetail),$("#cardDetail_font-style").text(b.cardDetail_font),$("#cardDetail_font-style").data("css",b["cardDetail_font-style"]),$("#cardDetailPadding").val(b.cardDetailPadding),$("#cardUseDefault").attr("checked",b.cardUseDefault),$("#cardLayoutURL").val(b.cardLayoutURL),a.populateColor($("#cardBgColor"),b.cardBgColor),a.populateColor($("#closeBorderColor"),b.closeBorderColor),a.populateColor($("#closeFillColor"),b.closeFillColor);for(var c=0;c<parseInt($("#colCount").val());c++)a.initColumns(c+1,b.columns[c])}$("#cardImage").trigger("blur"),$("#cardTitle").trigger("blur"),$("#cardSubtitle").trigger("blur"),$("#cardDetail").trigger("blur"),$("#scrollDirection").trigger("change"),$("#scrollBy").trigger("change"),$("#nav").trigger("change"),$("#showCard").triggerHandler("click"),$("#cardUseDefault").triggerHandler("click"),$("#useDefault").triggerHandler("click"),$("#settings").show()})},RiseVision.Directory.Settings.prototype.populateColor=function(a,b){a.val(b),a.css("background-color",b)},RiseVision.Directory.Settings.prototype.initColumns=function(a,b){$("#column"+a).val(b.column),$("#alignment"+a).val(b.alignment),$("#width"+a).val(b.width),$("#headerText"+a).val(b.header)},RiseVision.Directory.Settings.prototype.buildColumnsUI=function(){var a=parseInt($("#colCount").val()),b=$(".column").length;if(isNaN(a)||0==a)$(".formatting").hide();else if(a==b)$(".formatting").show();else if(a<b)$(".formatting").hide(),$(".formatting:lt("+a+")").show();else{$(".formatting").show();for(var c=b+1;c<=a;c++){var d=document.createElement("li"),e=document.createElement("ol");e.setAttribute("class","formatting drillDown"),$(e).append($("<li></li>").append("<label for='column"+c+"'><a href='#' class='tooltip'>Column*:<span>Column of the spreadsheet that the formatting should apply to (e.g. A or AW)</span></a></label>").append("<input id='column"+c+"' name='column"+c+"' type='text' class='column short' />")).append($("<li></li>").append("<label for='alignment"+c+"'>Alignment:</label>").append("<select id='alignment"+c+"' name='alignment"+c+"' class='alignment short'><option value='left' selected='selected'>Left</option><option value='center'>Center</option><option value='right'>Right</option></select>")).append($("<li></li>").append("<label for='width"+c+"'>Width (pixels):</label>").append("<input id='width"+c+"' name='width"+c+"' type='text' class='width short' value='100' />")).append($("<li></li>").append("<label for='headerText"+c+c+"'><a href='#' class='tooltip'>Header Text:<span>Custom header text. If not specified, the header from the spreadsheet will be used.</span></a></label>").append("<input id='headerText"+c+"' name='headerText"+c+"' type='text' class='headerText short' />")),$(d).append(e),$(".horizontal").append(d)}}},RiseVision.Directory.Settings.prototype.showColorPicker=function(a){gadgets.rpc.call("","rscmd_openColorPicker",null,a,$("#"+a).val())},RiseVision.Directory.Settings.prototype.showFontSelector=function(a){gadgets.rpc.call("","rscmd_openFontSelector",null,a,$("#"+a).data("css"))},RiseVision.Directory.Settings.prototype.setColor=function(a,b){$("#"+a).val(b),$("#"+a).css("background-color",b)},RiseVision.Directory.Settings.prototype.setFont=function(a,b,c){$("#"+a).data("css",b),$("#"+a).text(c)},RiseVision.Directory.Settings.prototype.setURL=function(a,b){$("#"+a).val(""),directorySettings.picker.getSheets({docID:b.id,callback:function(a){null!=a&&(directorySettings.docID=b.id,directorySettings.onSheetsLoaded(a),directorySettings.showDataURLOptions())}})},RiseVision.Directory.Settings.prototype.onSheetsLoaded=function(a){$("#sheet").empty();for(var b=0;b<a.length;b++)document.getElementById("sheet").add(a[b])},RiseVision.Directory.Settings.prototype.showDataURLOptions=function(){var a=this.picker.getURL({baseURL:$("#sheet").val(),headerRows:this.headerRows,range:this.range});$(".errors").empty(),$(".errors").css({display:"none"}),$("#url").val(a),$("li.more").show()},RiseVision.Directory.Settings.prototype.getSettings=function(){var f,a=!1,b=document.getElementsByClassName("errors")[0],c=$("#nav").val(),d="",e=null;return $(".errors").empty(),$(".errors").css({display:"none"}),a=!!directorySettings.settings.validateRequired($("#url"),b,"Data URL")||a,a=!!directorySettings.settings.validateNumeric($("#refresh"),b,"Data Refresh")||a,a=!!directorySettings.settings.validateNumeric($("#scrollHold"),b,"Scroll Hold")||a,a=!!directorySettings.settings.validateNumeric($("#scrollResumes"),b,"Scroll Resumes")||a,a=!!directorySettings.settings.validateNumeric($("#rowPadding"),b,"Row Padding")||a,a=!!directorySettings.settings.validateNumeric($("#showAll"),b,"Return to All after x seconds")||a,a=!!directorySettings.settings.validateNumeric($("#navMargin"),b,"Margin")||a,a=!!directorySettings.settings.validateNumeric($("#rowHeight"),b,"Row Height")||a,a=!!directorySettings.settings.validateNumeric($("#colPadding"),b,"Column Padding")||a,a=!!directorySettings.settings.validateNumeric($("#cardWidth"),b,"Pop Up Card Width")||a,a=!!directorySettings.settings.validateNumeric($("#cardTimeout"),b,"Timeout")||a,a=!!directorySettings.settings.validateNumeric($("#cardImageWidth"),b,"Pop Up Card Image Width")||a,a=!!directorySettings.settings.validateNumeric($("#cardImagePadding"),b,"Pop Up Card Image Padding")||a,a=!!directorySettings.settings.validateNumeric($("#cardTitlePadding"),b,"Title Column Padding")||a,a=!!directorySettings.settings.validateNumeric($("#cardSubtitlePadding"),b,"Subtitle Column Padding")||a,a=!!directorySettings.settings.validateNumeric($("#cardDetailPadding"),b,"Detail Column Padding")||a,a=!!directorySettings.settings.validateRequired($("#cardLayoutURL"),b,"Card Layout URL")||a,a=!!directorySettings.settings.validateRequired($("#layoutURL"),b,"Layout URL")||a,parseInt($("#colCount").val())>0&&($(".column").each(function(c){a=!!directorySettings.settings.validateRequired($(this),b,"Column")||a}),$(".width").each(function(c){a=!!directorySettings.settings.validateNumeric($(this),b,"Column Width")||a})),a?($(".errors").css("display","inline-block"),$("#wrapper").scrollTop(0),null):(d="up_url="+escape($("#url").val()),null!=directorySettings.docID&&(d+="&up_docID="+directorySettings.docID,f=$("input[type='radio'][name='cells']:checked"),f.length>0&&(d+="&up_cells="+f.val()+"&up_range="+$("#range").val()),d+="&up_sheet="+escape($("#sheet").val())+"&up_headerRows="+$("#headerRows").val()),d+="&up_refresh="+$("#refresh").val()+"&up_imageCol="+$("#imageCol").val()+"&up_rowColor="+$("#rowColor").val()+"&up_altRowColor="+$("#altRowColor").val()+"&up_bgColor="+$("#bgColor").val()+"&up_rowPadding="+$("#rowPadding").val()+"&up_nav="+c+"&up_showAll="+$("#showAll").val()+"&up_scrollDirection="+$("#scrollDirection").val()+"&up_scrollBy="+$("#scrollBy").val()+"&up_scrollSpeed="+$("#scrollSpeed").val()+"&up_scrollResumes="+$("#scrollResumes").val()+"&up_scrollHold="+$("#scrollHold").val()+"&up_navMargin="+$("#navMargin").val()+"&up_navColor="+$("#navColor").val()+"&up_navBgColor="+$("#navBgColor").val()+"&up_headingColor="+$("#headingColor").val()+"&up_headingBgColor="+$("#headingBgColor").val()+"&up_headingSortColor="+$("#headingSortColor").val()+"&up_rowHeight="+$("#rowHeight").val()+"&up_colPadding="+$("#colPadding").val()+"&up_colCount="+$("#colCount").val(),d+=$("#showCard").is(":checked")?"&up_showCard=true":"&up_showCard=false",d+=$("#useDefault").is(":checked")?"&up_useDefault=true":"&up_useDefault=false",d+="&up_layoutURL="+escape($("#layoutURL").val()),e={params:d,additionalParams:JSON.stringify(directorySettings.saveAdditionalParams())},gadgets.rpc.call("","rscmd_saveSettings",null,e),void 0)},RiseVision.Directory.Settings.prototype.saveAdditionalParams=function(){var a={},b=[];a.heading_font=$("#heading_font-style").text(),a["heading_font-style"]=$("#heading_font-style").data("css"),a.data_font=$("#data_font-style").text(),a["data_font-style"]=$("#data_font-style").data("css"),a.nav_font=$("#nav_font-style").text(),a["nav_font-style"]=$("#nav_font-style").data("css"),a.cardLocation=$("#cardLocation").val(),a.cardWidth=$("#cardWidth").val(),a.cardTimeout=$("#cardTimeout").val(),$("#cardBorder").is(":checked")?a.cardBorder=!0:a.cardBorder=!1,a.cardBgColor=$("#cardBgColor").val(),a.cardImage=$("#cardImage").val(),a.cardImageAlign=$("#cardImageAlign").val(),a.cardImageWidth=$("#cardImageWidth").val(),a.cardImagePadding=$("#cardImagePadding").val(),a.closeBorderColor=$("#closeBorderColor").val(),a.closeFillColor=$("#closeFillColor").val(),a.cardTitle=$("#cardTitle").val(),a.cardTitle_font=$("#cardTitle_font-style").text(),a["cardTitle_font-style"]=$("#cardTitle_font-style").data("css"),a.cardTitlePadding=$("#cardTitlePadding").val(),a.cardSubtitle=$("#cardSubtitle").val(),a.cardSubtitle_font=$("#cardSubtitle_font-style").text(),a["cardSubtitle_font-style"]=$("#cardSubtitle_font-style").data("css"),a.cardSubtitlePadding=$("#cardSubtitlePadding").val(),a.cardDetail=$("#cardDetail").val(),a.cardDetail_font=$("#cardDetail_font-style").text(),a["cardDetail_font-style"]=$("#cardDetail_font-style").data("css"),a.cardDetailPadding=$("#cardDetailPadding").val(),$("#cardUseDefault").is(":checked")?a.cardUseDefault=!0:a.cardUseDefault=!1,a.cardLayoutURL=$("#cardLayoutURL").val();for(var c=0;c<parseInt($("#colCount").val());c++)b.push(directorySettings.saveFormatSettings(c+1,b));return a.columns=b,a},RiseVision.Directory.Settings.prototype.saveFormatSettings=function(a){return{column:$("#column"+a).val(),alignment:$("#alignment"+a).val(),width:$("#width"+a).val(),header:$("#headerText"+a).val()}},RiseVision.Directory.Controller=function(){this.url=prefs.getString("url"),this.refresh=prefs.getInt("refresh"),this.imageCol=prefs.getString("imageCol").toUpperCase(),this.rowPadding=prefs.getInt("rowPadding")/2+"px",this.colPadding=prefs.getInt("colPadding")/2+"px",this.nav=prefs.getString("nav"),this.showAll=1e3*prefs.getInt("showAll"),this.useDefault=prefs.getBool("useDefault"),this.useDefault?this.layoutURL="":this.layoutURL=prefs.getString("layoutURL"),this.imageIndex=-1,this.cardImageIndex=-1,this.cardTitleIndex=-1,this.cardSubtitleIndex=-1,this.cardDetailIndex=-1,this.imageTotal=0,this.isLoading=!0,this.isSwiping=!1,this.isTable=!1,this.column="A",this.columns={},this.sortIndex=0,this.sortDirection="asc",this.sortConfig={bDestroy:!0,bFilter:!1,bInfo:!1,bLengthChange:!1,bPaginate:!1,sScrollY:"500px"},this.viz=new RiseVision.Common.Visualization,this.verticalLayout="https://s3.amazonaws.com/Gadget-Directory/css/Vertical.css",this.horizontalLayout="https://s3.amazonaws.com/Gadget-Directory/css/Horizontal.css"},RiseVision.Directory.Controller.prototype.getAdditionalParams=function(a,b){if("additionalParams"==a&&b){var c=document.createElement("style");b=JSON.parse(b),c.appendChild(document.createTextNode(b["heading_font-style"])),c.appendChild(document.createTextNode(b["data_font-style"])),c.appendChild(document.createTextNode(b["nav_font-style"])),c.appendChild(document.createTextNode(b["cardTitle_font-style"])),c.appendChild(document.createTextNode(b["cardSubtitle_font-style"])),c.appendChild(document.createTextNode(b["cardDetail_font-style"])),c.appendChild(document.createTextNode("#nav ul li a:active, #nav ul li a:visited"+b["nav_font-style"])),document.getElementsByTagName("head")[0].appendChild(c),controller.columns=b.columns,controller.cardLocation=b.cardLocation,controller.cardWidth=b.cardWidth,controller.cardTimeout=1e3*b.cardTimeout,controller.cardBorder=b.cardBorder,controller.cardBgColor=b.cardBgColor,b.cardImage&&(controller.cardImage=b.cardImage.toUpperCase()),controller.cardImageAlign=b.cardImageAlign,controller.cardImageWidth=b.cardImageWidth,controller.cardImagePadding=b.cardImagePadding,controller.closeBorderColor=b.closeBorderColor,controller.closeFillColor=b.closeFillColor,b.cardTitle&&(controller.cardTitle=b.cardTitle.toUpperCase()),controller.cardTitlePadding=b.cardTitlePadding,b.cardSubtitle&&(controller.cardSubtitle=b.cardSubtitle.toUpperCase()),controller.cardSubtitlePadding=b.cardSubtitlePadding,b.cardDetail&&(controller.cardDetail=b.cardDetail.toUpperCase()),controller.cardDetailPadding=b.cardDetailPadding,controller.cardUseDefault=b.cardUseDefault,controller.cardLayoutURL=b.cardLayoutURL}controller.init()},RiseVision.Directory.Controller.prototype.init=function(){var a=this,b={};document.createElement("link");this.useDefault?(this.isVerticalLayout()?RiseVision.Common.Utility.loadCSS(this.verticalLayout):RiseVision.Common.Utility.loadCSS(this.horizontalLayout),a.cardUseDefault?a.getListings("all"):a.loadCustomCard()):(b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.layoutURL,function(b){var c=b.data;if(c.getElementsByTagName("Style").length>0){var d=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",e.innerHTML=c.getElementsByTagName("Style")[0].childNodes[1].nodeValue,d.appendChild(e)}a.directory=c.getElementsByTagName("Layout")[0].childNodes[1].nodeValue,a.cardUseDefault?a.getListings("all"):a.loadCustomCard()},b))},RiseVision.Directory.Controller.prototype.loadCustomCard=function(){var a={},b=this;a[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.cardLayoutURL,function(a){var c=a.data;if(c.getElementsByTagName("Style").length>0){var d=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",e.innerHTML=c.getElementsByTagName("Style")[0].childNodes[1].nodeValue,d.appendChild(e)}$("#card.default").remove(),$("#container").append(c.getElementsByTagName("Layout")[0].childNodes[1].nodeValue),b.getListings("all")},a)},RiseVision.Directory.Controller.prototype.configureNavigation=function(a){var b=this;a.alphaNav({position:prefs.getString("nav"),margin:prefs.getInt("navMargin"),selectedColor:prefs.getString("navColor"),selectedBackground:prefs.getString("navBgColor"),onclick:function(a){b.onAlphaNavClicked(a)}})},RiseVision.Directory.Controller.prototype.onAlphaNavClicked=function(a){if(clearTimeout(this.showAllTimer),this.isTable){var b=null;0!=$(".sorting_asc").length?(b=$(".sorting_asc"),this.sortDirection="asc"):0!=$(".sorting_desc").length&&(b=$(".sorting_desc"),this.sortDirection="desc"),b&&b.length>0&&($(".dataTables_scrollHead th").index($(".sorting_asc"))>=0?this.sortIndex=$(".dataTables_scrollHead th").index($(".sorting_asc")):this.sortIndex=$(".dataTables_scrollHead th").index($(".sorting_desc")))}this.getListings(a)},RiseVision.Directory.Controller.prototype.getListings=function(a){var b=this,c="select *",d=null;$("#container").width(prefs.getString("rsW")),$("#container").height(prefs.getString("rsH")),"all"!=a&&"none"!=this.nav&&(this.isTable&&this.hasHeadings()&&(1==$(".dataTables_scrollHeadInner .sorting_asc").length?this.column=$(".dataTables_scrollHeadInner .sorting_asc").attr("id"):1==$(".dataTables_scrollHeadInner .sorting_desc").length&&(this.column=$(".dataTables_scrollHeadInner .sorting_desc").attr("id"))),c=c+" where "+this.column+" starts with upper('"+a+"') or "+this.column+" starts with lower('"+a+"')"),d={url:this.url,refreshInterval:this.refresh,queryString:c,callback:function(a){if(null!=a){var e,c=a.getNumberOfRows(),d=a.getNumberOfColumns();if(b.data=a,b.imagesLoaded=0,b.cols=[],0==c)$("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty(),$("#scrollContainer").append("<div class='noData'>No matching records found</div>"),b.isLoading?readyEvent():b.startShowAllTimer();else{for(e=0;e<d;e++)b.cols.push(a.getColumnId(e));for(e=0;e<d;e++)if(b.imageCol&&b.cols[e]===b.imageCol){b.imageIndex=e;break}if(prefs.getBool("showCard")){if(b.cardImage)for(e=0;e<d;e++)if(b.cols[e]===b.cardImage){b.cardImageIndex=e;break}if(b.cardTitle)for(e=0;e<d;e++)if(b.cols[e]===b.cardTitle){b.cardTitleIndex=e;break}if(b.cardSubtitle)for(e=0;e<d;e++)if(b.cols[e]===b.cardSubtitle){b.cardSubtitleIndex=e;break}if(b.cardDetail)for(e=0;e<d;e++)if(b.cols[e]===b.cardDetail){b.cardDetailIndex=e;break}}b.hasImage=b.imageIndex!=-1,b.hasImage&&(b.imageTotal=c),b.isLoading&&b.hasImage&&(b.useDefault?b.sortIndex=1:b.sortIndex=0==b.imageIndex?1:b.imageIndex-1),$("#scrollContainer").hide(),b.useDefault?b.isVerticalLayout()?b.buildVerticalLayout.call(b):b.buildHorizontalLayout.call(b):b.showCustomLayout.call(b)}}}},this.viz.getData(d)},RiseVision.Directory.Controller.prototype.buildVerticalLayout=function(){var a=document.createElement("ul"),b=this.data.getNumberOfRows(),c=this.data.getNumberOfColumns(),d=!0;a.setAttribute("class","page"),this.isLoading||($("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty()),$("#scrollContainer").append(a);for(var f=0;f<b;f++){$(".page").append("<li class='listing item'><div class='content'></div></li>"),$(".listing:last").data("row",f);for(var g=0;g<c;g++)this.showColumn(g)&&g!=this.imageIndex&&(d?(this.data.getFormattedValue(f,g)&&$(".content:last").append("<p class='heading_font-style'>"+this.data.getFormattedValue(f,g)+"</p>"),d=!1):this.data.getFormattedValue(f,g)&&$(".content:last").append("<span class='data_font-style'>"+this.data.getFormattedValue(f,g)+"</span><br />")),g==c-1&&($(".listing:last").append("<hr>"),d=!0,this.hasImage&&this.loadImage(f,this.imageIndex,this.onImageLoaded,this.onImageError))}this.hasImage||($(".content").css("margin-left","0%"),this.initDirectory())},RiseVision.Directory.Controller.prototype.buildHorizontalLayout=function(){var a=document.createElement("table"),b=this.data.getNumberOfRows(),c=this.data.getNumberOfColumns();this.isTable=!0,a.setAttribute("id","directory"),a.setAttribute("class","page"),this.isLoading||($(".dataTables_scrollBody").infiniteScroll.stop(),$("#scrollContainer").empty(),$("#nav").hide()),$("#scrollContainer").append(a);for(var e=0;e<b;e++)this.renderRow(e);if(c>0&&this.renderHeadings(!0),this.hasImage)if(this.imageTotal>0)for(var e=0;e<b;e++)this.loadImage(e,this.imageIndex,this.onBgImageLoaded,this.onBgImageError);else this.initTable();else this.initTable()},RiseVision.Directory.Controller.prototype.showCustomLayout=function(){var d,a=this.data.getNumberOfRows(),b=this.data.getNumberOfColumns();if(this.isLoading||($("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty()),$("#scrollContainer").append(this.directory),d=$(".listing"),this.isTable=$("#scrollContainer").find("table#directory").length>0,this.isTable){if(b!==$(".listing > td").length)return void console.log("The number of columns in the spreadsheet does not match the number of columns in the layout file. Please ensure that these are the same.");this.renderHeadings(!1)}for(var e=1;e<a;e++)$(".listing:last").after(d.clone());for(var e=0;e<a;e++){$(".listing").eq(e).data("row",e);for(var f=0;f<b;f++){var g=$("."+this.cols[f]).eq(e);g.length>0&&f!=this.imageIndex&&g.html(this.data.getFormattedValue(e,f)),f==b-1&&this.hasImage&&(this.isTable?this.loadImage(e,this.imageIndex,this.onBgImageLoaded,this.onBgImageError):this.loadImage(e,this.imageIndex,this.onImageLoaded,this.onImageError))}}0==this.imageTotal&&(this.isTable?this.initTable():this.initDirectory())},RiseVision.Directory.Controller.prototype.configureCard=function(){var a=this,b=this.cardWidth/prefs.getInt("rsW")*100+"%",c=this.cardImageWidth,d=$("#close").width()/2+"em";prefs.getBool("showCard")&&(this.isLoading&&($("#card").css("width",b),$("#card").css("background-color",this.cardBgColor),this.cardBorder&&$("#card").addClass("cardBorder"),"topRight"==this.cardImageAlign?$("#image").addClass("right"):"topLeft"==this.cardImageAlign?$("#image").addClass("left"):$("#image").addClass("center"),$("#image").css("padding",this.cardImagePadding),this.cardImageIndex!=-1&&($("#card").show(),c=c/$("#card").outerWidth(!0)*100+"%",$("#card").hide(),"center"!=this.cardImageAlign&&$("#image").css("width",c)),$("#close").css("color",this.closeBorderColor),$("#close").css("background-color",this.closeFillColor),$("#close").css("border-color",this.closeBorderColor),$("#close").css({"-webkit-border-radius":d,"-moz-border-radius":d,"border-radius":d}),$("#close").on("click",function(){return clearTimeout(a.cardCloseTimer),$("#card").bPopup().close(),!1}),$("#title").css("padding",this.cardTitlePadding),$("#subtitle").css("padding",this.cardSubtitlePadding),$("#detail").css("padding",this.cardDetailPadding)),$(".listing").on("click",function(b){var d=$(this).data("row");a.isSwiping?a.isSwiping=!1:d>=0&&(a.cardTitleIndex!=-1&&$("#title").html(a.data.getFormattedValue(d,a.cardTitleIndex)),a.cardSubtitleIndex!=-1&&$("#subtitle").html(a.data.getFormattedValue(d,a.cardSubtitleIndex)),a.cardDetailIndex!=-1&&$("#detail").html(a.data.getFormattedValue(d,a.cardDetailIndex)),a.cardImageIndex!=-1?a.loadImage(d,a.cardImageIndex,function(b,d){$("#image").empty(),$("#image").append(d),"center"==a.cardImageAlign&&$("#image > img").css("width",c),a.showCard()},function(){$("#image").empty(),a.showCard()}):a.showCard())}))},RiseVision.Directory.Controller.prototype.showCard=function(){var a={modalClose:!1},b=0,c=0;"left"==this.cardLocation?a.position=[b,"auto"]:"right"==this.cardLocation?(b=prefs.getInt("rsW")-$("#card").outerWidth(!0),a.position=[b,"auto"]):"top"==this.cardLocation?a.position=["auto",c]:"bottom"==this.cardLocation&&(c=prefs.getInt("rsH")-$("#card").outerHeight(!0),a.position=["auto",c]),$("#card").bPopup(a),this.cardCloseTimer=setTimeout(function(){$("#card").bPopup().close()},this.cardTimeout)},RiseVision.Directory.Controller.prototype.renderHeadings=function(a){for(var c,f,g,h,i,b=document.createElement("tr"),d=this.hasHeadings(),e=this.data.getNumberOfColumns(),j=0;j<e;j++)c=document.createElement("th"),d?(!a||a&&this.showColumn(j))&&$("."+this.cols[j]).length>0&&(c.setAttribute("id",this.cols[j]),c.setAttribute("class","nowrap heading_font-style"),$(c).html(this.data.getColumnLabel(j)),this.hasImage&&j==this.imageIndex?this.useDefault?$(b).prepend(c):$(b).append(c):(f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("div"),f.setAttribute("class","arrow"),g.setAttribute("class","indicator"),h.setAttribute("class","indicator1"),i.setAttribute("class","indicator2"),"asc"==this.sortDirection?($(f).html("&darr;"),$(h).html("A"),$(i).html("Z")):($(f).html("&uarr;"),$(h).html("Z"),$(i).html("A")),$(c).append(f),$(g).append(h),$(g).append(i),$(c).append(g),$(b).append(c))):this.showColumn(j)&&$(b).append(c);$("table").prepend($("<thead>").append(b))},RiseVision.Directory.Controller.prototype.hasHeadings=function(){for(var a=!1,b=this.data.getNumberOfColumns(),c=0;c<b;c++){var d=this.data.getColumnLabel(c);if(d){a=!0;break}}return a},RiseVision.Directory.Controller.prototype.renderRow=function(a){var b=document.createElement("tr"),c=this.data.getNumberOfColumns();b.setAttribute("class","listing item"),$(b).data("row",a);for(var d=0;d<c;d++)if(this.showColumn(d)){var e="",f="";e=this.data.getFormattedValue(a,d),f=this.data.getProperty(a,d,"style"),f&&(f=f.substring(0,f.indexOf("font-family:"))),this.hasImage&&d==this.imageIndex?this.addImage(b,this.cols[d]):this.addCell(b,e,f,this.cols[d])}$("table").append(b)},RiseVision.Directory.Controller.prototype.addImage=function(a,b){var c=document.createElement("td");c.setAttribute("class",b+" image"),$(a).prepend(c)},RiseVision.Directory.Controller.prototype.addCell=function(a,b,c,d){var e=document.createElement("td");c&&e.setAttribute("style",c),e.setAttribute("class",d+" data_font-style"),$(e).html(b),$(a).append(e)},RiseVision.Directory.Controller.prototype.loadImage=function(a,b,c,d){var e=this,f=new Image;f.onload=function(){c&&c.call(e,a,this)},f.onerror=function(){d&&d.call(e,a,this)},f.src=this.data.getFormattedValue(a,b)},RiseVision.Directory.Controller.prototype.onImageLoaded=function(a,b){var c=document.createElement("div");c.setAttribute("class","image"),$(c).css({background:"url("+this.data.getFormattedValue(a,this.imageIndex)+") center center no-repeat"}),$(".listing").eq(a).prepend(c),this.onAllImagesLoaded()},RiseVision.Directory.Controller.prototype.onImageError=function(a,b){var c=document.createElement("div");c.setAttribute("class","image"),$(".listing").eq(a).prepend(c),this.onAllImagesLoaded()},RiseVision.Directory.Controller.prototype.onAllImagesLoaded=function(){this.imagesLoaded++,this.imagesLoaded==this.imageTotal&&this.initDirectory()},RiseVision.Directory.Controller.prototype.initDirectory=function(){var b=this;$("#scrollContainer").show(),$(".content").css({"padding-top":this.rowPadding,"padding-bottom":this.rowPadding}),$(".listing:odd").addClass("odd"),$(".listing:even").addClass("even"),$(".listing").each(function(a){$(".image").eq(a).css("height",$(".listing").eq(a).height())}),$(".image").css({"margin-top":this.rowPadding,"margin-bottom":this.rowPadding}),$("#scrollContainer").infiniteScroll({scrollBy:prefs.getString("scrollBy"),direction:prefs.getString("scrollDirection"),duration:1e3*prefs.getInt("scrollHold"),speed:prefs.getString("scrollSpeed"),swipingTimeout:1e3*prefs.getInt("scrollResumes"),toggleOddEven:!0}).bind("onSwipe",function(a){b.isSwiping=!0}).bind("onSwipeEnd",function(a){b.isSwiping=!1}),this.configureCard(),$("#container").width("100%"),$("#container").height("100%"),this.isLoading?(this.configureNavigation($("#container")),readyEvent()):($("#scrollContainer").infiniteScroll.start(),this.startShowAllTimer())},RiseVision.Directory.Controller.prototype.startShowAllTimer=function(){var a=this;"all"!=$("#nav ul li.selected").attr("id")&&this.showAll&&(this.showAllTimer=setTimeout(function(){$("#nav ul li.selected a").css({background:"","-webkit-border-radius":"","-moz-border-radius":"","border-radius":""}),$("#nav ul li.selected a").css("color",""),$("#nav ul li.selected").removeClass("selected"),$("#nav ul li#all").addClass("selected");var b=$("#nav ul li a").width()/2+"em";$("#nav ul li.selected a").css({background:prefs.getString("navBgColor"),"-webkit-border-radius":b,"-moz-border-radius":b,"border-radius":b}),$("#nav ul li.selected a").css("color",prefs.getString("navColor")),a.onAlphaNavClicked("all")},this.showAll))},RiseVision.Directory.Controller.prototype.onBgImageLoaded=function(a,b){var c=$(".listing").eq(a).find(".image"),d=$("<img>");c.length>0&&(d.attr("src",this.data.getFormattedValue(a,this.imageIndex)),d.css("max-width",b.width),d.css("max-height",b.height),
  c.append(d)),this.onAllBackgroundImagesLoaded()},RiseVision.Directory.Controller.prototype.onBgImageError=function(){this.onAllBackgroundImagesLoaded()},RiseVision.Directory.Controller.prototype.onAllBackgroundImagesLoaded=function(){this.imagesLoaded++,this.imagesLoaded==this.imageTotal&&this.initTable()},RiseVision.Directory.Controller.prototype.loadCardImage=function(){for(var a=this.data.getNumberOfRows(),b=0;b<a;b++)this.loadImage(b,this.cardImageIndex)},RiseVision.Directory.Controller.prototype.initTable=function(){var b,c,a=this;this.formatColumns($("th")),this.hasImage?this.useDefault?this.sortConfig.aoColumnDefs=[{bSortable:!1,aTargets:[0]}]:this.sortConfig.aoColumnDefs=[{bSortable:!1,aTargets:[this.imageIndex]}]:this.sortConfig.aoColumnDefs=[],$.each(this.columns,function(c,d){d.width&&(b=$("."+d.column+":first").parent().children().index($("."+d.column+":first")),a.sortConfig.aoColumnDefs.push({sWidth:d.width,aTargets:[b]}))}),this.sortConfig.aaSorting=[[this.sortIndex,this.sortDirection]],$("#scrollContainer").show(),$("#nav").show(),c=Math.max.apply(null,$(".image").map(function(){return $(this).height()}).get()),$(".image img").height(c),$("#directory").dataTable(this.sortConfig),this.hasHeadings()||$(".dataTables_wrapper table thead").css("display","none"),$(".dataTables_scrollHead table thead tr, .dataTables_scrollBody table tbody tr").height(prefs.getInt("rowHeight")),$(".dataTables_scrollHead table thead tr th, td").css({"padding-top":this.rowPadding,"padding-bottom":this.rowPadding}),$("table thead tr th, td").css({"padding-left":this.colPadding,"padding-right":this.colPadding}),$("table tr th:first-child, td:first-child").css({"padding-left":"10px"}),$("table tr th:last-child, td:last-child").css({"padding-right":"10px"}),this.configureCard(),this.isLoading&&this.configureNavigation($("#container")),this.isVerticalLayout()?$(".dataTables_scrollBody").height($("#container").outerHeight(!0)-$(".dataTables_scrollHead").height()):($("#scrollContainer").height($("#container").outerHeight(!0)-$("#nav").outerHeight(!0)),$(".dataTables_scrollBody").height($("#container").outerHeight(!0)-$("#nav").outerHeight(!0)-$(".dataTables_scrollHead").height())),$(".dataTables_scrollBody").infiniteScroll({scrollBy:prefs.getString("scrollBy"),direction:prefs.getString("scrollDirection"),duration:1e3*prefs.getInt("scrollHold"),speed:prefs.getString("scrollSpeed"),swipingTimeout:1e3*prefs.getInt("scrollResumes"),toggleOddEven:!0}).bind("onSwipe",function(b){a.isSwiping=!0}).bind("onSwipeEnd",function(b){a.isSwiping=!1}),$("#container").width("100%"),$("#container").height("100%"),this.isLoading?readyEvent():($(".dataTables_scrollBody").infiniteScroll.start(),this.startShowAllTimer())},RiseVision.Directory.Controller.prototype.formatColumns=function(a){var b=this;$.each(this.columns,function(c,d){if(d.column){var g,e=$("."+d.column),f=$("."+d.column+":first").parent().children().index($("."+d.column+":first"));e.length>0&&(d.header&&a.eq(f).html(d.header),b.isLoading&&d.width&&(g=parseInt(d.width),g=g/prefs.getInt("rsW")*100+"%",d.width=g),b.hasImage&&0==f?e.find("div").css("background-position",d.alignment):e.css("text-align",d.alignment),a.eq(f).css("text-align",d.alignment))}})},RiseVision.Directory.Controller.prototype.showColumn=function(a){return a!=this.cardTitleIndex&&a!=this.cardSubtitleIndex&&a!=this.cardDetailIndex&&a!=this.cardImageIndex},RiseVision.Directory.Controller.prototype.setTimer=function(){var a=this;$.idleTimer(6e4),$(document).bind("idle.idleTimer",function(){$.idleTimer("destroy"),a.showTab(a.tabIDs[0])})},RiseVision.Directory.Controller.prototype.isVerticalLayout=function(){return"left"==this.nav||"right"==this.nav},RiseVision.Directory.Controller.prototype.onresize=function(){$(".listing").each(function(a){$(".image").eq(a).css("height",$(".listing").eq(a).height())}),$(".image").css({"margin-top":this.rowPadding,"margin-bottom":this.rowPadding})},RiseVision.Directory.Controller.prototype.play=function(){this.isLoading=!1,this.isTable?$(".dataTables_scrollBody").infiniteScroll.start():$("#scrollContainer").infiniteScroll.start()},RiseVision.Directory.Controller.prototype.pause=function(){this.isTable?$(".dataTables_scrollBody").infiniteScroll.pause():$("#scrollContainer").infiniteScroll.pause()};