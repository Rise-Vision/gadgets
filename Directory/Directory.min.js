var RiseVision=RiseVision||{};RiseVision.Directory={};RiseVision.Directory.Settings={};RiseVision.Directory.Controller={};RiseVision.Directory.Settings=function(){this.settings=new RiseVision.Common.Settings;this.picker=new RiseVision.Common.Picker;this.viz=new RiseVision.Common.Visualization;this.baseURL="";this.headerRows="0";this.range=""};
RiseVision.Directory.Settings.prototype.initSettings=function(){var b=this;$("#googleDrive").click(function(){b.picker.showPicker($(this).data("for"),google.picker.ViewId.SPREADSHEETS)});$("input[name='cells']").change(function(){"range"==$(this).val()?(b.range=$("#range").val(),$("#rangeContainer").show()):(b.range="",$("#rangeContainer").hide());b.showDataURLOptions()});$("#range").blur(function(){b.range=$(this).val();b.showDataURLOptions()});$("#headerRows").change(function(){b.headerRows=$(this).val();
b.showDataURLOptions()});$("#sheet").change(function(){b.showDataURLOptions()});$("#cardImage").on("blur",function(a){(a=$(this).val())&&isNaN(a)?$("li.cardImage").show():$("li.cardImage").hide()});$("#cardTitle").on("blur",function(a){(a=$(this).val())&&isNaN(a)?$("li.cardTitle").show():$("li.cardTitle").hide()});$("#cardSubtitle").on("blur",function(a){(a=$(this).val())&&isNaN(a)?$("li.cardSubtitle").show():$("li.cardSubtitle").hide()});$("#cardDetail").on("blur",function(a){(a=$(this).val())&&
isNaN(a)?$("li.cardDetail").show():$("li.cardDetail").hide()});$(".colorPicker").on("click",function(a){directorySettings.showColorPicker($(this).data("for"))});$(".fontSelector").on("click",function(a){directorySettings.showFontSelector($(this).data("for"))});$("#scrollDirection").on("change",function(a){"none"==$(this).val()?$("li.scroll").hide():$("li.scroll").show()});$("#scrollBy").on("change",function(a){"continuous"==$(this).val()?$("li.scrollHold").hide():$("li.scrollHold").show()});$("#nav").on("change",
function(a){a=$(this).val();"none"==a?$("li.nav").hide():$("li.nav").show();"left"==a||"right"==a?$("li.horizontal").hide():$("li.horizontal").show()});$("#colCount").on("change",function(a){directorySettings.buildColumnsUI()});$("#showCard").on("click",function(a){$(this).is(":checked")?$("li.card").show():$("li.card").hide()});$("#cardUseDefault").on("click",function(a){$(this).is(":checked")?$("li.cardLayoutURL").hide():$("li.cardLayoutURL").show()});$("#useDefault").on("click",function(a){$(this).is(":checked")?
$("li.layoutURL").hide():$("li.layoutURL").show()});prefs.getString("url")&&($("#url").val(prefs.getString("url")),""!=prefs.getString("docID")&&(this.docID=prefs.getString("docID"),this.picker.getSheets({docID:prefs.getString("docID"),callback:function(a){null!=a&&(b.onSheetsLoaded(a),$("#sheet").val(unescape(prefs.getString("sheet"))),$("li.more").show())}}),$("input[type='radio'][name='cells']").each(function(){$(this).val()==prefs.getString("cells")&&($(this).attr("checked","checked"),"range"==
$(this).val()&&$("#rangeContainer").show())}),$("#range").val(prefs.getString("range")),$("#headerRows").val(prefs.getString("headerRows"))),$("#refresh").val(prefs.getInt("refresh")),$("#imageCol").val(prefs.getString("imageCol")),$("#scrollDirection").val(prefs.getString("scrollDirection")),$("#scrollBy").val(prefs.getString("scrollBy")),$("#scrollHold").val(prefs.getInt("scrollHold")),$("#scrollSpeed").val(prefs.getString("scrollSpeed")),$("#scrollResumes").val(prefs.getInt("scrollResumes")),$("#rowPadding").val(prefs.getInt("rowPadding")),
$("#nav").val(prefs.getString("nav")),$("#showAll").val(prefs.getInt("showAll")),$("#navMargin").val(prefs.getInt("navMargin")),$("#rowHeight").val(prefs.getInt("rowHeight")),$("#colPadding").val(prefs.getInt("colPadding")),$("#colCount").val(prefs.getInt("colCount")),$("#showCard").attr("checked",prefs.getBool("showCard")),$("#useDefault").attr("checked",prefs.getBool("useDefault")),$("#layoutURL").val(prefs.getString("layoutURL")),this.populateColor($("#rowColor"),prefs.getString("rowColor")),this.populateColor($("#altRowColor"),
prefs.getString("altRowColor")),this.populateColor($("#bgColor"),prefs.getString("bgColor")),this.populateColor($("#navColor"),prefs.getString("navColor")),this.populateColor($("#navBgColor"),prefs.getString("navBgColor")),this.populateColor($("#headingColor"),prefs.getString("headingColor")),this.populateColor($("#headingBgColor"),prefs.getString("headingBgColor")),this.populateColor($("#headingSortColor"),prefs.getString("headingSortColor")));$("#colCount").trigger("change");gadgets.rpc.call("",
"rscmd_getAdditionalParams",function(a){if(a){a=JSON.parse(a);$("#data_font-style").text(a.data_font);$("#data_font-style").data("css",a["data_font-style"]);$("#nav_font-style").text(a.nav_font);$("#nav_font-style").data("css",a["nav_font-style"]);$("#heading_font-style").text(a.heading_font);$("#heading_font-style").data("css",a["heading_font-style"]);$("#cardLocation").val(a.cardLocation);$("#cardWidth").val(a.cardWidth);$("#cardTimeout").val(a.cardTimeout);$("#cardBorder").attr("checked",a.cardBorder);
$("#cardImage").val(a.cardImage);$("#cardImageAlign").val(a.cardImageAlign);$("#cardImageWidth").val(a.cardImageWidth);$("#cardImagePadding").val(a.cardImagePadding);$("#cardTitle").val(a.cardTitle);$("#cardTitle_font-style").text(a.cardTitle_font);$("#cardTitle_font-style").data("css",a["cardTitle_font-style"]);$("#cardTitlePadding").val(a.cardTitlePadding);$("#cardSubtitle").val(a.cardSubtitle);$("#cardSubtitle_font-style").text(a.cardSubtitle_font);$("#cardSubtitle_font-style").data("css",a["cardSubtitle_font-style"]);
$("#cardSubtitlePadding").val(a.cardSubtitlePadding);$("#cardDetail").val(a.cardDetail);$("#cardDetail_font-style").text(a.cardDetail_font);$("#cardDetail_font-style").data("css",a["cardDetail_font-style"]);$("#cardDetailPadding").val(a.cardDetailPadding);$("#cardUseDefault").attr("checked",a.cardUseDefault);$("#cardLayoutURL").val(a.cardLayoutURL);b.populateColor($("#cardBgColor"),a.cardBgColor);b.populateColor($("#closeBorderColor"),a.closeBorderColor);b.populateColor($("#closeFillColor"),a.closeFillColor);
for(var d=0;d<parseInt($("#colCount").val());d++)b.initColumns(d+1,a.columns[d])}$("#cardImage").trigger("blur");$("#cardTitle").trigger("blur");$("#cardSubtitle").trigger("blur");$("#cardDetail").trigger("blur");$("#scrollDirection").trigger("change");$("#scrollBy").trigger("change");$("#nav").trigger("change");$("#showCard").triggerHandler("click");$("#cardUseDefault").triggerHandler("click");$("#useDefault").triggerHandler("click");$("#settings").show()})};
RiseVision.Directory.Settings.prototype.populateColor=function(b,a){b.val(a);b.css("background-color",a)};RiseVision.Directory.Settings.prototype.initColumns=function(b,a){$("#column"+b).val(a.column);$("#alignment"+b).val(a.alignment);$("#width"+b).val(a.width);$("#headerText"+b).val(a.header)};
RiseVision.Directory.Settings.prototype.buildColumnsUI=function(){var b=parseInt($("#colCount").val()),a=$(".column").length;if(isNaN(b)||0==b)$(".formatting").hide();else if(b==a)$(".formatting").show();else if(b<a)$(".formatting").hide(),$(".formatting:lt("+b+")").show();else for($(".formatting").show(),a+=1;a<=b;a++){var d=document.createElement("li"),c=document.createElement("ol");c.setAttribute("class","formatting drillDown");$(c).append($("<li></li>").append("<label for='column"+a+"'><a href='#' class='tooltip'>Column*:<span>Column of the spreadsheet that the formatting should apply to (e.g. A or AW)</span></a></label>").append("<input id='column"+
a+"' name='column"+a+"' type='text' class='column short' />")).append($("<li></li>").append("<label for='alignment"+a+"'>Alignment:</label>").append("<select id='alignment"+a+"' name='alignment"+a+"' class='alignment short'><option value='left' selected='selected'>Left</option><option value='center'>Center</option><option value='right'>Right</option></select>")).append($("<li></li>").append("<label for='width"+a+"'>Width (pixels):</label>").append("<input id='width"+a+"' name='width"+a+"' type='text' class='width short' value='100' />")).append($("<li></li>").append("<label for='headerText"+
a+a+"'><a href='#' class='tooltip'>Header Text:<span>Custom header text. If not specified, the header from the spreadsheet will be used.</span></a></label>").append("<input id='headerText"+a+"' name='headerText"+a+"' type='text' class='headerText short' />"));$(d).append(c);$(".horizontal").append(d)}};RiseVision.Directory.Settings.prototype.showColorPicker=function(b){gadgets.rpc.call("","rscmd_openColorPicker",null,b,$("#"+b).val())};
RiseVision.Directory.Settings.prototype.showFontSelector=function(b){gadgets.rpc.call("","rscmd_openFontSelector",null,b,$("#"+b).data("css"))};RiseVision.Directory.Settings.prototype.setColor=function(b,a){$("#"+b).val(a);$("#"+b).css("background-color",a)};RiseVision.Directory.Settings.prototype.setFont=function(b,a,d){$("#"+b).data("css",a);$("#"+b).text(d)};
RiseVision.Directory.Settings.prototype.setURL=function(b,a){$("#"+b).val("");directorySettings.picker.getSheets({docID:a.id,callback:function(b){null!=b&&(directorySettings.docID=a.id,directorySettings.onSheetsLoaded(b),directorySettings.showDataURLOptions())}})};RiseVision.Directory.Settings.prototype.onSheetsLoaded=function(b){$("#sheet").empty();for(var a=0;a<b.length;a++)document.getElementById("sheet").add(b[a])};
RiseVision.Directory.Settings.prototype.showDataURLOptions=function(){var b=this.picker.getURL({baseURL:$("#sheet").val(),headerRows:this.headerRows,range:this.range});$(".errors").empty();$(".errors").css({display:"none"});$("#url").val(b);$("li.more").show()};
RiseVision.Directory.Settings.prototype.getSettings=function(){var b=!1,a=document.getElementsByClassName("errors")[0],d=$("#nav").val(),c="",c=null,e;$(".errors").empty();$(".errors").css({display:"none"});b=directorySettings.settings.validateRequired($("#url"),a,"Data URL")?!0:b;b=directorySettings.settings.validateNumeric($("#refresh"),a,"Data Refresh")?!0:b;b=directorySettings.settings.validateNumeric($("#scrollHold"),a,"Scroll Hold")?!0:b;b=directorySettings.settings.validateNumeric($("#scrollResumes"),
a,"Scroll Resumes")?!0:b;b=directorySettings.settings.validateNumeric($("#rowPadding"),a,"Row Padding")?!0:b;b=directorySettings.settings.validateNumeric($("#showAll"),a,"Return to All after x seconds")?!0:b;b=directorySettings.settings.validateNumeric($("#navMargin"),a,"Margin")?!0:b;b=directorySettings.settings.validateNumeric($("#rowHeight"),a,"Row Height")?!0:b;b=directorySettings.settings.validateNumeric($("#colPadding"),a,"Column Padding")?!0:b;b=directorySettings.settings.validateNumeric($("#cardWidth"),
a,"Pop Up Card Width")?!0:b;b=directorySettings.settings.validateNumeric($("#cardTimeout"),a,"Timeout")?!0:b;b=directorySettings.settings.validateNumeric($("#cardImageWidth"),a,"Pop Up Card Image Width")?!0:b;b=directorySettings.settings.validateNumeric($("#cardImagePadding"),a,"Pop Up Card Image Padding")?!0:b;b=directorySettings.settings.validateNumeric($("#cardTitlePadding"),a,"Title Column Padding")?!0:b;b=directorySettings.settings.validateNumeric($("#cardSubtitlePadding"),a,"Subtitle Column Padding")?
!0:b;b=directorySettings.settings.validateNumeric($("#cardDetailPadding"),a,"Detail Column Padding")?!0:b;b=directorySettings.settings.validateRequired($("#cardLayoutURL"),a,"Card Layout URL")?!0:b;b=directorySettings.settings.validateRequired($("#layoutURL"),a,"Layout URL")?!0:b;0<parseInt($("#colCount").val())&&($(".column").each(function(d){b=directorySettings.settings.validateRequired($(this),a,"Column")?!0:b}),$(".width").each(function(d){b=directorySettings.settings.validateNumeric($(this),
a,"Column Width")?!0:b}));if(b)return $(".errors").css("display","inline-block"),$("#wrapper").scrollTop(0),null;c="up_url="+escape($("#url").val());null!=directorySettings.docID&&(c+="&up_docID="+directorySettings.docID,e=$("input[type='radio'][name='cells']:checked"),0<e.length&&(c+="&up_cells="+e.val()+"&up_range="+$("#range").val()),c+="&up_sheet="+escape($("#sheet").val())+"&up_headerRows="+$("#headerRows").val());c+="&up_refresh="+$("#refresh").val()+"&up_imageCol="+$("#imageCol").val()+"&up_rowColor="+
$("#rowColor").val()+"&up_altRowColor="+$("#altRowColor").val()+"&up_bgColor="+$("#bgColor").val()+"&up_rowPadding="+$("#rowPadding").val()+"&up_nav="+d+"&up_showAll="+$("#showAll").val()+"&up_scrollDirection="+$("#scrollDirection").val()+"&up_scrollBy="+$("#scrollBy").val()+"&up_scrollSpeed="+$("#scrollSpeed").val()+"&up_scrollResumes="+$("#scrollResumes").val()+"&up_scrollHold="+$("#scrollHold").val()+"&up_navMargin="+$("#navMargin").val()+"&up_navColor="+$("#navColor").val()+"&up_navBgColor="+
$("#navBgColor").val()+"&up_headingColor="+$("#headingColor").val()+"&up_headingBgColor="+$("#headingBgColor").val()+"&up_headingSortColor="+$("#headingSortColor").val()+"&up_rowHeight="+$("#rowHeight").val()+"&up_colPadding="+$("#colPadding").val()+"&up_colCount="+$("#colCount").val();c=$("#showCard").is(":checked")?c+"&up_showCard=true":c+"&up_showCard=false";c=$("#useDefault").is(":checked")?c+"&up_useDefault=true":c+"&up_useDefault=false";c+="&up_layoutURL="+escape($("#layoutURL").val());c={params:c,
additionalParams:JSON.stringify(directorySettings.saveAdditionalParams())};gadgets.rpc.call("","rscmd_saveSettings",null,c)};
RiseVision.Directory.Settings.prototype.saveAdditionalParams=function(){var b={},a=[];b.heading_font=$("#heading_font-style").text();b["heading_font-style"]=$("#heading_font-style").data("css");b.data_font=$("#data_font-style").text();b["data_font-style"]=$("#data_font-style").data("css");b.nav_font=$("#nav_font-style").text();b["nav_font-style"]=$("#nav_font-style").data("css");b.cardLocation=$("#cardLocation").val();b.cardWidth=$("#cardWidth").val();b.cardTimeout=$("#cardTimeout").val();$("#cardBorder").is(":checked")?
b.cardBorder=!0:b.cardBorder=!1;b.cardBgColor=$("#cardBgColor").val();b.cardImage=$("#cardImage").val();b.cardImageAlign=$("#cardImageAlign").val();b.cardImageWidth=$("#cardImageWidth").val();b.cardImagePadding=$("#cardImagePadding").val();b.closeBorderColor=$("#closeBorderColor").val();b.closeFillColor=$("#closeFillColor").val();b.cardTitle=$("#cardTitle").val();b.cardTitle_font=$("#cardTitle_font-style").text();b["cardTitle_font-style"]=$("#cardTitle_font-style").data("css");b.cardTitlePadding=
$("#cardTitlePadding").val();b.cardSubtitle=$("#cardSubtitle").val();b.cardSubtitle_font=$("#cardSubtitle_font-style").text();b["cardSubtitle_font-style"]=$("#cardSubtitle_font-style").data("css");b.cardSubtitlePadding=$("#cardSubtitlePadding").val();b.cardDetail=$("#cardDetail").val();b.cardDetail_font=$("#cardDetail_font-style").text();b["cardDetail_font-style"]=$("#cardDetail_font-style").data("css");b.cardDetailPadding=$("#cardDetailPadding").val();$("#cardUseDefault").is(":checked")?b.cardUseDefault=
!0:b.cardUseDefault=!1;b.cardLayoutURL=$("#cardLayoutURL").val();for(var d=0;d<parseInt($("#colCount").val());d++)a.push(directorySettings.saveFormatSettings(d+1,a));b.columns=a;return b};RiseVision.Directory.Settings.prototype.saveFormatSettings=function(b){return{column:$("#column"+b).val(),alignment:$("#alignment"+b).val(),width:$("#width"+b).val(),header:$("#headerText"+b).val()}};
RiseVision.Directory.Controller=function(){this.url=prefs.getString("url");this.refresh=prefs.getInt("refresh");this.imageCol=prefs.getString("imageCol").toUpperCase();this.rowPadding=prefs.getInt("rowPadding")/2+"px";this.colPadding=prefs.getInt("colPadding")/2+"px";this.nav=prefs.getString("nav");this.showAll=1E3*prefs.getInt("showAll");this.layoutURL=(this.useDefault=prefs.getBool("useDefault"))?"":prefs.getString("layoutURL");this.cardDetailIndex=this.cardSubtitleIndex=this.cardTitleIndex=this.cardImageIndex=
this.imageIndex=-1;this.imageTotal=0;this.isLoading=!0;this.isTable=this.isSwiping=!1;this.column="A";this.columns={};this.sortIndex=0;this.sortDirection="asc";this.sortConfig={bDestroy:!0,bFilter:!1,bInfo:!1,bLengthChange:!1,bPaginate:!1,sScrollY:"500px"};this.viz=new RiseVision.Common.Visualization;this.verticalLayout="//s3.amazonaws.com/Gadget-Directory/css/Vertical.css";this.horizontalLayout="//s3.amazonaws.com/Gadget-Directory/css/Horizontal.css"};
RiseVision.Directory.Controller.prototype.getAdditionalParams=function(b,a){if("additionalParams"==b&&a){var d=document.createElement("style");a=JSON.parse(a);d.appendChild(document.createTextNode(a["heading_font-style"]));d.appendChild(document.createTextNode(a["data_font-style"]));d.appendChild(document.createTextNode(a["nav_font-style"]));d.appendChild(document.createTextNode(a["cardTitle_font-style"]));d.appendChild(document.createTextNode(a["cardSubtitle_font-style"]));d.appendChild(document.createTextNode(a["cardDetail_font-style"]));
d.appendChild(document.createTextNode("#nav ul li a:active, #nav ul li a:visited"+a["nav_font-style"]));document.getElementsByTagName("head")[0].appendChild(d);controller.columns=a.columns;controller.cardLocation=a.cardLocation;controller.cardWidth=a.cardWidth;controller.cardTimeout=1E3*a.cardTimeout;controller.cardBorder=a.cardBorder;controller.cardBgColor=a.cardBgColor;a.cardImage&&(controller.cardImage=a.cardImage.toUpperCase());controller.cardImageAlign=a.cardImageAlign;controller.cardImageWidth=
a.cardImageWidth;controller.cardImagePadding=a.cardImagePadding;controller.closeBorderColor=a.closeBorderColor;controller.closeFillColor=a.closeFillColor;a.cardTitle&&(controller.cardTitle=a.cardTitle.toUpperCase());controller.cardTitlePadding=a.cardTitlePadding;a.cardSubtitle&&(controller.cardSubtitle=a.cardSubtitle.toUpperCase());controller.cardSubtitlePadding=a.cardSubtitlePadding;a.cardDetail&&(controller.cardDetail=a.cardDetail.toUpperCase());controller.cardDetailPadding=a.cardDetailPadding;
controller.cardUseDefault=a.cardUseDefault;controller.cardLayoutURL=a.cardLayoutURL}controller.init()};
RiseVision.Directory.Controller.prototype.init=function(){var b=this,a={};document.createElement("link");this.useDefault?(this.isVerticalLayout()?RiseVision.Common.Utility.loadCSS(this.verticalLayout):RiseVision.Common.Utility.loadCSS(this.horizontalLayout),b.cardUseDefault?b.getListings("all"):b.loadCustomCard()):(a[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.layoutURL,function(a){a=a.data;if(0<a.getElementsByTagName("Style").length){var c=document.getElementsByTagName("head")[0],
e=document.createElement("style");e.type="text/css";e.innerHTML=a.getElementsByTagName("Style")[0].childNodes[1].nodeValue;c.appendChild(e)}b.directory=a.getElementsByTagName("Layout")[0].childNodes[1].nodeValue;b.cardUseDefault?b.getListings("all"):b.loadCustomCard()},a))};
RiseVision.Directory.Controller.prototype.loadCustomCard=function(){var b={},a=this;b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM;gadgets.io.makeRequest(this.cardLayoutURL,function(b){b=b.data;if(0<b.getElementsByTagName("Style").length){var c=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css";e.innerHTML=b.getElementsByTagName("Style")[0].childNodes[1].nodeValue;c.appendChild(e)}$("#card.default").remove();$("#container").append(b.getElementsByTagName("Layout")[0].childNodes[1].nodeValue);
a.getListings("all")},b)};RiseVision.Directory.Controller.prototype.configureNavigation=function(b){var a=this;b.alphaNav({position:prefs.getString("nav"),margin:prefs.getInt("navMargin"),selectedColor:prefs.getString("navColor"),selectedBackground:prefs.getString("navBgColor"),onclick:function(b){a.onAlphaNavClicked(b)}})};
RiseVision.Directory.Controller.prototype.onAlphaNavClicked=function(b){clearTimeout(this.showAllTimer);if(this.isTable){var a=null;0!=$(".sorting_asc").length?(a=$(".sorting_asc"),this.sortDirection="asc"):0!=$(".sorting_desc").length&&(a=$(".sorting_desc"),this.sortDirection="desc");a&&0<a.length&&(0<=$(".dataTables_scrollHead th").index($(".sorting_asc"))?this.sortIndex=$(".dataTables_scrollHead th").index($(".sorting_asc")):this.sortIndex=$(".dataTables_scrollHead th").index($(".sorting_desc")))}this.getListings(b)};
RiseVision.Directory.Controller.prototype.getListings=function(b){var a=this,d="select *",c=null;$("#container").width(prefs.getString("rsW"));$("#container").height(prefs.getString("rsH"));"all"!=b&&"none"!=this.nav&&(this.isTable&&this.hasHeadings()&&(1==$(".dataTables_scrollHeadInner .sorting_asc").length?this.column=$(".dataTables_scrollHeadInner .sorting_asc").attr("id"):1==$(".dataTables_scrollHeadInner .sorting_desc").length&&(this.column=$(".dataTables_scrollHeadInner .sorting_desc").attr("id"))),
d=d+" where "+this.column+" starts with upper('"+b+"') or "+this.column+" starts with lower('"+b+"')");c={url:this.url,refreshInterval:this.refresh,queryString:d,callback:function(b){if(null!=b){var d=b.getNumberOfRows(),c=b.getNumberOfColumns(),f;a.data=b;a.imagesLoaded=0;a.cols=[];if(0==d)$("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty(),$("#scrollContainer").append("<div class='noData'>No matching records found</div>"),a.isLoading?readyEvent():a.startShowAllTimer();else{for(f=
0;f<c;f++)a.cols.push(b.getColumnId(f));for(f=0;f<c;f++)if(a.imageCol&&a.cols[f]===a.imageCol){a.imageIndex=f;break}if(prefs.getBool("showCard")){if(a.cardImage)for(f=0;f<c;f++)if(a.cols[f]===a.cardImage){a.cardImageIndex=f;break}if(a.cardTitle)for(f=0;f<c;f++)if(a.cols[f]===a.cardTitle){a.cardTitleIndex=f;break}if(a.cardSubtitle)for(f=0;f<c;f++)if(a.cols[f]===a.cardSubtitle){a.cardSubtitleIndex=f;break}if(a.cardDetail)for(f=0;f<c;f++)if(a.cols[f]===a.cardDetail){a.cardDetailIndex=f;break}}a.hasImage=
-1==a.imageIndex?!1:!0;a.hasImage&&(a.imageTotal=d);a.isLoading&&a.hasImage&&(a.sortIndex=a.useDefault?1:0==a.imageIndex?1:a.imageIndex-1);$("#scrollContainer").hide();a.useDefault?a.isVerticalLayout()?a.buildVerticalLayout.call(a):a.buildHorizontalLayout.call(a):a.showCustomLayout.call(a)}}}};this.viz.getData(c)};
RiseVision.Directory.Controller.prototype.buildVerticalLayout=function(){var b=document.createElement("ul"),a=this.data.getNumberOfRows(),d=this.data.getNumberOfColumns(),c=!0;b.setAttribute("class","page");this.isLoading||($("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty());$("#scrollContainer").append(b);for(b=0;b<a;b++){$(".page").append("<li class='listing item'><div class='content'></div></li>");$(".listing:last").data("row",b);for(var e=0;e<d;e++)this.showColumn(e)&&e!=
this.imageIndex&&(c?(this.data.getFormattedValue(b,e)&&$(".content:last").append("<p class='heading_font-style'>"+this.data.getFormattedValue(b,e)+"</p>"),c=!1):this.data.getFormattedValue(b,e)&&$(".content:last").append("<span class='data_font-style'>"+this.data.getFormattedValue(b,e)+"</span><br />")),e==d-1&&($(".listing:last").append("<hr>"),c=!0,this.hasImage&&this.loadImage(b,this.imageIndex,this.onImageLoaded,this.onImageError))}this.hasImage||($(".content").css("margin-left","0%"),this.initDirectory())};
RiseVision.Directory.Controller.prototype.buildHorizontalLayout=function(){var b=document.createElement("table"),a=this.data.getNumberOfRows(),d=this.data.getNumberOfColumns();this.isTable=!0;b.setAttribute("id","directory");b.setAttribute("class","page");this.isLoading||($(".dataTables_scrollBody").infiniteScroll.stop(),$("#scrollContainer").empty(),$("#nav").hide());$("#scrollContainer").append(b);for(b=0;b<a;b++)this.renderRow(b);0<d&&this.renderHeadings(!0);if(this.hasImage)if(0<this.imageTotal)for(b=
0;b<a;b++)this.loadImage(b,this.imageIndex,this.onBgImageLoaded,this.onBgImageError);else this.initTable();else this.initTable()};
RiseVision.Directory.Controller.prototype.showCustomLayout=function(){var b=this.data.getNumberOfRows(),a=this.data.getNumberOfColumns(),d;this.isLoading||($("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty());$("#scrollContainer").append(this.directory);d=$(".listing");if(this.isTable=0<$("#scrollContainer").find("table#directory").length?!0:!1){if(a!==$(".listing > td").length){console.log("The number of columns in the spreadsheet does not match the number of columns in the layout file. Please ensure that these are the same.");
return}this.renderHeadings(!1)}for(var c=1;c<b;c++)$(".listing:last").after(d.clone());for(c=0;c<b;c++)for($(".listing").eq(c).data("row",c),d=0;d<a;d++){var e=$("."+this.cols[d]).eq(c);0<e.length&&d!=this.imageIndex&&e.html(this.data.getFormattedValue(c,d));d==a-1&&this.hasImage&&(this.isTable?this.loadImage(c,this.imageIndex,this.onBgImageLoaded,this.onBgImageError):this.loadImage(c,this.imageIndex,this.onImageLoaded,this.onImageError))}0==this.imageTotal&&(this.isTable?this.initTable():this.initDirectory())};
RiseVision.Directory.Controller.prototype.configureCard=function(){var b=this,a=this.cardWidth/prefs.getInt("rsW")*100+"%",d=this.cardImageWidth,c=$("#close").width()/2+"em";prefs.getBool("showCard")&&(this.isLoading&&($("#card").css("width",a),$("#card").css("background-color",this.cardBgColor),this.cardBorder&&$("#card").addClass("cardBorder"),"topRight"==this.cardImageAlign?$("#image").addClass("right"):"topLeft"==this.cardImageAlign?$("#image").addClass("left"):$("#image").addClass("center"),
$("#image").css("padding",this.cardImagePadding),-1!=this.cardImageIndex&&($("#card").show(),d=d/$("#card").outerWidth(!0)*100+"%",$("#card").hide(),"center"!=this.cardImageAlign&&$("#image").css("width",d)),$("#close").css("color",this.closeBorderColor),$("#close").css("background-color",this.closeFillColor),$("#close").css("border-color",this.closeBorderColor),$("#close").css({"-webkit-border-radius":c,"-moz-border-radius":c,"border-radius":c}),$("#close").on("click",function(){clearTimeout(b.cardCloseTimer);
$("#card").bPopup().close();return!1}),$("#title").css("padding",this.cardTitlePadding),$("#subtitle").css("padding",this.cardSubtitlePadding),$("#detail").css("padding",this.cardDetailPadding)),$(".listing").on("click",function(a){a=$(this).data("row");b.isSwiping?b.isSwiping=!1:0<=a&&(-1!=b.cardTitleIndex&&$("#title").html(b.data.getFormattedValue(a,b.cardTitleIndex)),-1!=b.cardSubtitleIndex&&$("#subtitle").html(b.data.getFormattedValue(a,b.cardSubtitleIndex)),-1!=b.cardDetailIndex&&$("#detail").html(b.data.getFormattedValue(a,
b.cardDetailIndex)),-1!=b.cardImageIndex?b.loadImage(a,b.cardImageIndex,function(a,c){$("#image").empty();$("#image").append(c);"center"==b.cardImageAlign&&$("#image > img").css("width",d);b.showCard()},function(){$("#image").empty();b.showCard()}):b.showCard())}))};
RiseVision.Directory.Controller.prototype.showCard=function(){var b={modalClose:!1},a=0,d=0;"left"==this.cardLocation?b.position=[a,"auto"]:"right"==this.cardLocation?(a=prefs.getInt("rsW")-$("#card").outerWidth(!0),b.position=[a,"auto"]):"top"==this.cardLocation?b.position=["auto",d]:"bottom"==this.cardLocation&&(d=prefs.getInt("rsH")-$("#card").outerHeight(!0),b.position=["auto",d]);$("#card").bPopup(b);this.cardCloseTimer=setTimeout(function(){$("#card").bPopup().close()},this.cardTimeout)};
RiseVision.Directory.Controller.prototype.renderHeadings=function(b){for(var a=document.createElement("tr"),d,c=this.hasHeadings(),e=this.data.getNumberOfColumns(),g,h,f,l,k=0;k<e;k++)d=document.createElement("th"),c?(!b||b&&this.showColumn(k))&&0<$("."+this.cols[k]).length&&(d.setAttribute("id",this.cols[k]),d.setAttribute("class","nowrap heading_font-style"),$(d).html(this.data.getColumnLabel(k)),this.hasImage&&k==this.imageIndex?this.useDefault?$(a).prepend(d):$(a).append(d):(g=document.createElement("div"),
h=document.createElement("div"),f=document.createElement("div"),l=document.createElement("div"),g.setAttribute("class","arrow"),h.setAttribute("class","indicator"),f.setAttribute("class","indicator1"),l.setAttribute("class","indicator2"),"asc"==this.sortDirection?($(g).html("&darr;"),$(f).html("A"),$(l).html("Z")):($(g).html("&uarr;"),$(f).html("Z"),$(l).html("A")),$(d).append(g),$(h).append(f),$(h).append(l),$(d).append(h),$(a).append(d))):this.showColumn(k)&&$(a).append(d);$("table").prepend($("<thead>").append(a))};
RiseVision.Directory.Controller.prototype.hasHeadings=function(){for(var b=!1,a=this.data.getNumberOfColumns(),d=0;d<a;d++)if(this.data.getColumnLabel(d)){b=!0;break}return b};
RiseVision.Directory.Controller.prototype.renderRow=function(b){var a=document.createElement("tr"),d=this.data.getNumberOfColumns();a.setAttribute("class","listing item");$(a).data("row",b);for(var c=0;c<d;c++)if(this.showColumn(c)){var e="",g="",e=this.data.getFormattedValue(b,c);(g=this.data.getProperty(b,c,"style"))&&(g=g.substring(0,g.indexOf("font-family:")));this.hasImage&&c==this.imageIndex?this.addImage(a,this.cols[c]):this.addCell(a,e,g,this.cols[c])}$("table").append(a)};
RiseVision.Directory.Controller.prototype.addImage=function(b,a){var d=document.createElement("td");d.setAttribute("class",a+" image");$(b).prepend(d)};RiseVision.Directory.Controller.prototype.addCell=function(b,a,d,c){var e=document.createElement("td");d&&e.setAttribute("style",d);e.setAttribute("class",c+" data_font-style");$(e).html(a);$(b).append(e)};
RiseVision.Directory.Controller.prototype.loadImage=function(b,a,d,c){var e=this,g=new Image;g.onload=function(){d&&d.call(e,b,this)};g.onerror=function(){c&&c.call(e,b,this)};g.src=this.data.getFormattedValue(b,a)};RiseVision.Directory.Controller.prototype.onImageLoaded=function(b,a){var d=document.createElement("div");d.setAttribute("class","image");$(d).css({background:"url("+this.data.getFormattedValue(b,this.imageIndex)+") center center no-repeat"});$(".listing").eq(b).prepend(d);this.onAllImagesLoaded()};
RiseVision.Directory.Controller.prototype.onImageError=function(b,a){var d=document.createElement("div");d.setAttribute("class","image");$(".listing").eq(b).prepend(d);this.onAllImagesLoaded()};RiseVision.Directory.Controller.prototype.onAllImagesLoaded=function(){this.imagesLoaded++;this.imagesLoaded==this.imageTotal&&this.initDirectory()};
RiseVision.Directory.Controller.prototype.initDirectory=function(){var b=this;$("#scrollContainer").show();$(".content").css({"padding-top":this.rowPadding,"padding-bottom":this.rowPadding});$(".listing:odd").addClass("odd");$(".listing:even").addClass("even");$(".listing").each(function(a){$(".image").eq(a).css("height",$(".listing").eq(a).height())});$(".image").css({"margin-top":this.rowPadding,"margin-bottom":this.rowPadding});$("#scrollContainer").infiniteScroll({scrollBy:prefs.getString("scrollBy"),
direction:prefs.getString("scrollDirection"),duration:1E3*prefs.getInt("scrollHold"),speed:prefs.getString("scrollSpeed"),swipingTimeout:1E3*prefs.getInt("scrollResumes"),toggleOddEven:!0}).bind("onSwipe",function(a){b.isSwiping=!0}).bind("onSwipeEnd",function(a){b.isSwiping=!1});this.configureCard();$("#container").width("100%");$("#container").height("100%");this.isLoading?(this.configureNavigation($("#container")),readyEvent()):($("#scrollContainer").infiniteScroll.start(),this.startShowAllTimer())};
RiseVision.Directory.Controller.prototype.startShowAllTimer=function(){var b=this;"all"!=$("#nav ul li.selected").attr("id")&&this.showAll&&(this.showAllTimer=setTimeout(function(){$("#nav ul li.selected a").css({background:"","-webkit-border-radius":"","-moz-border-radius":"","border-radius":""});$("#nav ul li.selected a").css("color","");$("#nav ul li.selected").removeClass("selected");$("#nav ul li#all").addClass("selected");var a=$("#nav ul li a").width()/2+"em";$("#nav ul li.selected a").css({background:prefs.getString("navBgColor"),
"-webkit-border-radius":a,"-moz-border-radius":a,"border-radius":a});$("#nav ul li.selected a").css("color",prefs.getString("navColor"));b.onAlphaNavClicked("all")},this.showAll))};RiseVision.Directory.Controller.prototype.onBgImageLoaded=function(b,a){var d=$(".listing").eq(b).find(".image"),c=$("<img>");0<d.length&&(c.attr("src",this.data.getFormattedValue(b,this.imageIndex)),d.append(c));this.onAllBackgroundImagesLoaded()};RiseVision.Directory.Controller.prototype.onBgImageError=function(){this.onAllBackgroundImagesLoaded()};
RiseVision.Directory.Controller.prototype.onAllBackgroundImagesLoaded=function(){this.imagesLoaded++;this.imagesLoaded==this.imageTotal&&this.initTable()};RiseVision.Directory.Controller.prototype.loadCardImage=function(){for(var b=this.data.getNumberOfRows(),a=0;a<b;a++)this.loadImage(a,this.cardImageIndex)};
RiseVision.Directory.Controller.prototype.initTable=function(){var b=this,a;this.formatColumns($("th"));this.sortConfig.aoColumnDefs=this.hasImage?this.useDefault?[{bSortable:!1,aTargets:[0]}]:[{bSortable:!1,aTargets:[this.imageIndex]}]:[];$.each(this.columns,function(d,c){c.width&&(a=$("."+c.column+":first").parent().children().index($("."+c.column+":first")),b.sortConfig.aoColumnDefs.push({sWidth:c.width,aTargets:[a]}))});this.sortConfig.aaSorting=[[this.sortIndex,this.sortDirection]];$("#scrollContainer").show();
$("#nav").show();$("#directory").dataTable(this.sortConfig);this.hasHeadings()||$(".dataTables_wrapper table thead").css("display","none");$(".dataTables_scrollHead table thead tr, .dataTables_scrollBody table tbody tr").height(prefs.getInt("rowHeight"));$(".dataTables_scrollHead table thead tr th, td").css({"padding-top":this.rowPadding,"padding-bottom":this.rowPadding});$("table thead tr th, td").css({"padding-left":this.colPadding,"padding-right":this.colPadding});$("table tr th:first-child, td:first-child").css({"padding-left":"10px"});
$("table tr th:last-child, td:last-child").css({"padding-right":"10px"});$("table").css("border-collapse","collapse");this.configureCard();this.isLoading&&this.configureNavigation($("#container"));this.isVerticalLayout()?$(".dataTables_scrollBody").height($("#container").outerHeight(!0)-$(".dataTables_scrollHead").height()):($("#scrollContainer").height($("#container").outerHeight(!0)-$("#nav").outerHeight(!0)),$(".dataTables_scrollBody").height($("#container").outerHeight(!0)-$("#nav").outerHeight(!0)-
$(".dataTables_scrollHead").height()));$(".dataTables_scrollBody").infiniteScroll({scrollBy:prefs.getString("scrollBy"),direction:prefs.getString("scrollDirection"),duration:1E3*prefs.getInt("scrollHold"),speed:prefs.getString("scrollSpeed"),swipingTimeout:1E3*prefs.getInt("scrollResumes"),toggleOddEven:!0}).bind("onSwipe",function(a){b.isSwiping=!0}).bind("onSwipeEnd",function(a){b.isSwiping=!1});$("#container").width("100%");$("#container").height("100%");this.isLoading?readyEvent():($(".dataTables_scrollBody").infiniteScroll.start(),
this.startShowAllTimer())};
RiseVision.Directory.Controller.prototype.formatColumns=function(b){var a=this;$.each(this.columns,function(d,c){if(c.column){var e=$("."+c.column),g=$("."+c.column+":first").parent().children().index($("."+c.column+":first")),h;0<e.length&&(c.header&&b.eq(g).html(c.header),a.isLoading&&c.width&&(h=parseInt(c.width),h=h/prefs.getInt("rsW")*100+"%",c.width=h),a.hasImage&&0==g?e.find("div").css("background-position",c.alignment):e.css("text-align",c.alignment),b.eq(g).css("text-align",c.alignment))}})};
RiseVision.Directory.Controller.prototype.showColumn=function(b){return b!=this.cardTitleIndex&&b!=this.cardSubtitleIndex&&b!=this.cardDetailIndex&&b!=this.cardImageIndex};RiseVision.Directory.Controller.prototype.setTimer=function(){var b=this;$.idleTimer(6E4);$(document).bind("idle.idleTimer",function(){$.idleTimer("destroy");b.showTab(b.tabIDs[0])})};RiseVision.Directory.Controller.prototype.isVerticalLayout=function(){return"left"==this.nav||"right"==this.nav};
RiseVision.Directory.Controller.prototype.onresize=function(){$(".listing").each(function(b){$(".image").eq(b).css("height",$(".listing").eq(b).height())});$(".image").css({"margin-top":this.rowPadding,"margin-bottom":this.rowPadding})};RiseVision.Directory.Controller.prototype.play=function(){this.isLoading=!1;this.isTable?$(".dataTables_scrollBody").infiniteScroll.start():$("#scrollContainer").infiniteScroll.start()};
RiseVision.Directory.Controller.prototype.pause=function(){this.isTable?$(".dataTables_scrollBody").infiniteScroll.pause():$("#scrollContainer").infiniteScroll.pause()};