"use strict";var RiseVision=RiseVision||{};RiseVision.Directory={},RiseVision.Directory.Settings={},RiseVision.Directory.Controller={},RiseVision.Directory.Settings=function(){this.settings=new RiseVision.Common.Settings,this.picker=new RiseVision.Common.Picker,this.viz=new RiseVision.Common.Visualization,this.baseURL="",this.headerRows="0",this.range=""},RiseVision.Directory.Settings.prototype.initSettings=function(){var t=this;$("#googleDrive").click(function(){t.picker.showPicker($(this).data("for"),google.picker.ViewId.SPREADSHEETS)}),$("input[name='cells']").change(function(){var e=$(this).val();"range"==e?(t.range=$("#range").val(),$("#rangeContainer").show()):(t.range="",$("#rangeContainer").hide()),t.showDataURLOptions()}),$("#range").blur(function(){t.range=$(this).val(),t.showDataURLOptions()}),$("#headerRows").change(function(){t.headerRows=$(this).val(),t.showDataURLOptions()}),$("#sheet").change(function(){t.showDataURLOptions()}),$("#cardImage").on("blur",function(){var t=$(this).val();t&&isNaN(t)?$("li.cardImage").show():$("li.cardImage").hide()}),$("#cardTitle").on("blur",function(){var t=$(this).val();t&&isNaN(t)?$("li.cardTitle").show():$("li.cardTitle").hide()}),$("#cardSubtitle").on("blur",function(){var t=$(this).val();t&&isNaN(t)?$("li.cardSubtitle").show():$("li.cardSubtitle").hide()}),$("#cardDetail").on("blur",function(){var t=$(this).val();t&&isNaN(t)?$("li.cardDetail").show():$("li.cardDetail").hide()}),$(".colorPicker").on("click",function(){directorySettings.showColorPicker($(this).data("for"))}),$(".fontSelector").on("click",function(){directorySettings.showFontSelector($(this).data("for"))}),$("#scrollDirection").on("change",function(){"none"==$(this).val()?$("li.scroll").hide():$("li.scroll").show()}),$("#scrollBy").on("change",function(){"continuous"==$(this).val()?$("li.scrollHold").hide():$("li.scrollHold").show()}),$("#nav").on("change",function(){var t=$(this).val();"none"==t?$("li.nav").hide():$("li.nav").show(),"left"==t||"right"==t?$("li.horizontal").hide():$("li.horizontal").show()}),$("#colCount").on("change",function(){directorySettings.buildColumnsUI()}),$("#showCard").on("click",function(){$(this).is(":checked")?$("li.card").show():$("li.card").hide()}),$("#cardUseDefault").on("click",function(){$(this).is(":checked")?$("li.cardLayoutURL").hide():$("li.cardLayoutURL").show()}),$("#useDefault").on("click",function(){$(this).is(":checked")?$("li.layoutURL").hide():$("li.layoutURL").show()}),prefs.getString("url")&&($("#url").val(prefs.getString("url")),""!=prefs.getString("docID")&&(this.docID=prefs.getString("docID"),this.picker.getSheets({docID:prefs.getString("docID"),callback:function(e){null!=e&&(t.onSheetsLoaded(e),$("#sheet").val(unescape(prefs.getString("sheet"))),$("li.more").show())}}),$("input[type='radio'][name='cells']").each(function(){$(this).val()==prefs.getString("cells")&&($(this).attr("checked","checked"),"range"==$(this).val()&&$("#rangeContainer").show())}),$("#range").val(prefs.getString("range")),$("#headerRows").val(prefs.getString("headerRows"))),$("#refresh").val(prefs.getInt("refresh")),$("#imageCol").val(prefs.getString("imageCol")),$("#scrollDirection").val(prefs.getString("scrollDirection")),$("#scrollBy").val(prefs.getString("scrollBy")),$("#scrollHold").val(prefs.getInt("scrollHold")),$("#scrollSpeed").val(prefs.getString("scrollSpeed")),$("#scrollResumes").val(prefs.getInt("scrollResumes")),$("#rowPadding").val(prefs.getInt("rowPadding")),$("#nav").val(prefs.getString("nav")),$("#showAll").val(prefs.getInt("showAll")),$("#navMargin").val(prefs.getInt("navMargin")),$("#rowHeight").val(prefs.getInt("rowHeight")),$("#colPadding").val(prefs.getInt("colPadding")),$("#colCount").val(prefs.getInt("colCount")),$("#showCard").attr("checked",prefs.getBool("showCard")),$("#useDefault").attr("checked",prefs.getBool("useDefault")),$("#layoutURL").val(prefs.getString("layoutURL")),this.populateColor($("#rowColor"),prefs.getString("rowColor")),this.populateColor($("#altRowColor"),prefs.getString("altRowColor")),this.populateColor($("#bgColor"),prefs.getString("bgColor")),this.populateColor($("#navColor"),prefs.getString("navColor")),this.populateColor($("#navBgColor"),prefs.getString("navBgColor")),this.populateColor($("#headingColor"),prefs.getString("headingColor")),this.populateColor($("#headingBgColor"),prefs.getString("headingBgColor")),this.populateColor($("#headingSortColor"),prefs.getString("headingSortColor"))),$("#colCount").trigger("change"),gadgets.rpc.call("","rscmd_getAdditionalParams",function(e){if(e){e=JSON.parse(e),$("#data_font-style").text(e.data_font),$("#data_font-style").data("css",e["data_font-style"]),$("#nav_font-style").text(e.nav_font),$("#nav_font-style").data("css",e["nav_font-style"]),$("#heading_font-style").text(e.heading_font),$("#heading_font-style").data("css",e["heading_font-style"]),$("#cardLocation").val(e.cardLocation),$("#cardWidth").val(e.cardWidth),$("#cardTimeout").val(e.cardTimeout),$("#cardBorder").attr("checked",e.cardBorder),$("#cardImage").val(e.cardImage),$("#cardImageAlign").val(e.cardImageAlign),$("#cardImageWidth").val(e.cardImageWidth),$("#cardImagePadding").val(e.cardImagePadding),$("#cardTitle").val(e.cardTitle),$("#cardTitle_font-style").text(e.cardTitle_font),$("#cardTitle_font-style").data("css",e["cardTitle_font-style"]),$("#cardTitlePadding").val(e.cardTitlePadding),$("#cardSubtitle").val(e.cardSubtitle),$("#cardSubtitle_font-style").text(e.cardSubtitle_font),$("#cardSubtitle_font-style").data("css",e["cardSubtitle_font-style"]),$("#cardSubtitlePadding").val(e.cardSubtitlePadding),$("#cardDetail").val(e.cardDetail),$("#cardDetail_font-style").text(e.cardDetail_font),$("#cardDetail_font-style").data("css",e["cardDetail_font-style"]),$("#cardDetailPadding").val(e.cardDetailPadding),$("#cardUseDefault").attr("checked",e.cardUseDefault),$("#cardLayoutURL").val(e.cardLayoutURL),t.populateColor($("#cardBgColor"),e.cardBgColor),t.populateColor($("#closeBorderColor"),e.closeBorderColor),t.populateColor($("#closeFillColor"),e.closeFillColor);for(var i=0;i<parseInt($("#colCount").val());i++)t.initColumns(i+1,e.columns[i])}$("#cardImage").trigger("blur"),$("#cardTitle").trigger("blur"),$("#cardSubtitle").trigger("blur"),$("#cardDetail").trigger("blur"),$("#scrollDirection").trigger("change"),$("#scrollBy").trigger("change"),$("#nav").trigger("change"),$("#showCard").triggerHandler("click"),$("#cardUseDefault").triggerHandler("click"),$("#useDefault").triggerHandler("click"),$("#settings").show()})},RiseVision.Directory.Settings.prototype.populateColor=function(t,e){t.val(e),t.css("background-color",e)},RiseVision.Directory.Settings.prototype.initColumns=function(t,e){$("#column"+t).val(e.column),$("#alignment"+t).val(e.alignment),$("#width"+t).val(e.width),$("#headerText"+t).val(e.header)},RiseVision.Directory.Settings.prototype.buildColumnsUI=function(){var t=parseInt($("#colCount").val()),e=$(".column").length;if(isNaN(t)||0==t)$(".formatting").hide();else if(t==e)$(".formatting").show();else if(e>t)$(".formatting").hide(),$(".formatting:lt("+t+")").show();else{$(".formatting").show();for(var i=e+1;t>=i;i++){var a=document.createElement("li"),o=document.createElement("ol");o.setAttribute("class","formatting drillDown"),$(o).append($("<li></li>").append("<label for='column"+i+"'><a href='#' class='tooltip'>Column*:<span>Column of the spreadsheet that the formatting should apply to (e.g. A or AW)</span></a></label>").append("<input id='column"+i+"' name='column"+i+"' type='text' class='column short' />")).append($("<li></li>").append("<label for='alignment"+i+"'>Alignment:</label>").append("<select id='alignment"+i+"' name='alignment"+i+"' class='alignment short'><option value='left' selected='selected'>Left</option><option value='center'>Center</option><option value='right'>Right</option></select>")).append($("<li></li>").append("<label for='width"+i+"'>Width (pixels):</label>").append("<input id='width"+i+"' name='width"+i+"' type='text' class='width short' value='100' />")).append($("<li></li>").append("<label for='headerText"+i+i+"'><a href='#' class='tooltip'>Header Text:<span>Custom header text. If not specified, the header from the spreadsheet will be used.</span></a></label>").append("<input id='headerText"+i+"' name='headerText"+i+"' type='text' class='headerText short' />")),$(a).append(o),$(".horizontal").append(a)}}},RiseVision.Directory.Settings.prototype.showColorPicker=function(t){gadgets.rpc.call("","rscmd_openColorPicker",null,t,$("#"+t).val())},RiseVision.Directory.Settings.prototype.showFontSelector=function(t){gadgets.rpc.call("","rscmd_openFontSelector",null,t,$("#"+t).data("css"))},RiseVision.Directory.Settings.prototype.setColor=function(t,e){$("#"+t).val(e),$("#"+t).css("background-color",e)},RiseVision.Directory.Settings.prototype.setFont=function(t,e,i){$("#"+t).data("css",e),$("#"+t).text(i)},RiseVision.Directory.Settings.prototype.setURL=function(t,e){$("#"+t).val(""),directorySettings.picker.getSheets({docID:e.id,callback:function(t){null!=t&&(directorySettings.docID=e.id,directorySettings.onSheetsLoaded(t),directorySettings.showDataURLOptions())}})},RiseVision.Directory.Settings.prototype.onSheetsLoaded=function(t){$("#sheet").empty();for(var e=0;e<t.length;e++)document.getElementById("sheet").add(t[e])},RiseVision.Directory.Settings.prototype.showDataURLOptions=function(){var t=this.picker.getURL({baseURL:$("#sheet").val(),headerRows:this.headerRows,range:this.range});$(".errors").empty(),$(".errors").css({display:"none"}),$("#url").val(t),$("li.more").show()},RiseVision.Directory.Settings.prototype.getSettings=function(){var t,e=!1,i=document.getElementsByClassName("errors")[0],a=$("#nav").val(),o="",r=null;return $(".errors").empty(),$(".errors").css({display:"none"}),e=directorySettings.settings.validateRequired($("#url"),i,"Data URL")?!0:e,e=directorySettings.settings.validateNumeric($("#refresh"),i,"Data Refresh")?!0:e,e=directorySettings.settings.validateNumeric($("#scrollHold"),i,"Scroll Hold")?!0:e,e=directorySettings.settings.validateNumeric($("#scrollResumes"),i,"Scroll Resumes")?!0:e,e=directorySettings.settings.validateNumeric($("#rowPadding"),i,"Row Padding")?!0:e,e=directorySettings.settings.validateNumeric($("#showAll"),i,"Return to All after x seconds")?!0:e,e=directorySettings.settings.validateNumeric($("#navMargin"),i,"Margin")?!0:e,e=directorySettings.settings.validateNumeric($("#rowHeight"),i,"Row Height")?!0:e,e=directorySettings.settings.validateNumeric($("#colPadding"),i,"Column Padding")?!0:e,e=directorySettings.settings.validateNumeric($("#cardWidth"),i,"Pop Up Card Width")?!0:e,e=directorySettings.settings.validateNumeric($("#cardTimeout"),i,"Timeout")?!0:e,e=directorySettings.settings.validateNumeric($("#cardImageWidth"),i,"Pop Up Card Image Width")?!0:e,e=directorySettings.settings.validateNumeric($("#cardImagePadding"),i,"Pop Up Card Image Padding")?!0:e,e=directorySettings.settings.validateNumeric($("#cardTitlePadding"),i,"Title Column Padding")?!0:e,e=directorySettings.settings.validateNumeric($("#cardSubtitlePadding"),i,"Subtitle Column Padding")?!0:e,e=directorySettings.settings.validateNumeric($("#cardDetailPadding"),i,"Detail Column Padding")?!0:e,e=directorySettings.settings.validateRequired($("#cardLayoutURL"),i,"Card Layout URL")?!0:e,e=directorySettings.settings.validateRequired($("#layoutURL"),i,"Layout URL")?!0:e,parseInt($("#colCount").val())>0&&($(".column").each(function(){e=directorySettings.settings.validateRequired($(this),i,"Column")?!0:e}),$(".width").each(function(){e=directorySettings.settings.validateNumeric($(this),i,"Column Width")?!0:e})),e?($(".errors").css("display","inline-block"),$("#wrapper").scrollTop(0),null):(o="up_url="+escape($("#url").val()),null!=directorySettings.docID&&(o+="&up_docID="+directorySettings.docID,t=$("input[type='radio'][name='cells']:checked"),t.length>0&&(o+="&up_cells="+t.val()+"&up_range="+$("#range").val()),o+="&up_sheet="+escape($("#sheet").val())+"&up_headerRows="+$("#headerRows").val()),o+="&up_refresh="+$("#refresh").val()+"&up_imageCol="+$("#imageCol").val()+"&up_rowColor="+$("#rowColor").val()+"&up_altRowColor="+$("#altRowColor").val()+"&up_bgColor="+$("#bgColor").val()+"&up_rowPadding="+$("#rowPadding").val()+"&up_nav="+a+"&up_showAll="+$("#showAll").val()+"&up_scrollDirection="+$("#scrollDirection").val()+"&up_scrollBy="+$("#scrollBy").val()+"&up_scrollSpeed="+$("#scrollSpeed").val()+"&up_scrollResumes="+$("#scrollResumes").val()+"&up_scrollHold="+$("#scrollHold").val()+"&up_navMargin="+$("#navMargin").val()+"&up_navColor="+$("#navColor").val()+"&up_navBgColor="+$("#navBgColor").val()+"&up_headingColor="+$("#headingColor").val()+"&up_headingBgColor="+$("#headingBgColor").val()+"&up_headingSortColor="+$("#headingSortColor").val()+"&up_rowHeight="+$("#rowHeight").val()+"&up_colPadding="+$("#colPadding").val()+"&up_colCount="+$("#colCount").val(),o+=$("#showCard").is(":checked")?"&up_showCard=true":"&up_showCard=false",o+=$("#useDefault").is(":checked")?"&up_useDefault=true":"&up_useDefault=false",o+="&up_layoutURL="+escape($("#layoutURL").val()),r={params:o,additionalParams:JSON.stringify(directorySettings.saveAdditionalParams())},gadgets.rpc.call("","rscmd_saveSettings",null,r),void 0)},RiseVision.Directory.Settings.prototype.saveAdditionalParams=function(){var t={},e=[];t.heading_font=$("#heading_font-style").text(),t["heading_font-style"]=$("#heading_font-style").data("css"),t.data_font=$("#data_font-style").text(),t["data_font-style"]=$("#data_font-style").data("css"),t.nav_font=$("#nav_font-style").text(),t["nav_font-style"]=$("#nav_font-style").data("css"),t.cardLocation=$("#cardLocation").val(),t.cardWidth=$("#cardWidth").val(),t.cardTimeout=$("#cardTimeout").val(),t.cardBorder=$("#cardBorder").is(":checked")?!0:!1,t.cardBgColor=$("#cardBgColor").val(),t.cardImage=$("#cardImage").val(),t.cardImageAlign=$("#cardImageAlign").val(),t.cardImageWidth=$("#cardImageWidth").val(),t.cardImagePadding=$("#cardImagePadding").val(),t.closeBorderColor=$("#closeBorderColor").val(),t.closeFillColor=$("#closeFillColor").val(),t.cardTitle=$("#cardTitle").val(),t.cardTitle_font=$("#cardTitle_font-style").text(),t["cardTitle_font-style"]=$("#cardTitle_font-style").data("css"),t.cardTitlePadding=$("#cardTitlePadding").val(),t.cardSubtitle=$("#cardSubtitle").val(),t.cardSubtitle_font=$("#cardSubtitle_font-style").text(),t["cardSubtitle_font-style"]=$("#cardSubtitle_font-style").data("css"),t.cardSubtitlePadding=$("#cardSubtitlePadding").val(),t.cardDetail=$("#cardDetail").val(),t.cardDetail_font=$("#cardDetail_font-style").text(),t["cardDetail_font-style"]=$("#cardDetail_font-style").data("css"),t.cardDetailPadding=$("#cardDetailPadding").val(),t.cardUseDefault=$("#cardUseDefault").is(":checked")?!0:!1,t.cardLayoutURL=$("#cardLayoutURL").val();for(var i=0;i<parseInt($("#colCount").val());i++)e.push(directorySettings.saveFormatSettings(i+1,e));return t.columns=e,t},RiseVision.Directory.Settings.prototype.saveFormatSettings=function(t){return{column:$("#column"+t).val(),alignment:$("#alignment"+t).val(),width:$("#width"+t).val(),header:$("#headerText"+t).val()}},RiseVision.Directory.Controller=function(){this.url=prefs.getString("url"),this.refresh=prefs.getInt("refresh"),this.imageCol=prefs.getString("imageCol").toUpperCase(),this.rowPadding=prefs.getInt("rowPadding")/2+"px",this.colPadding=prefs.getInt("colPadding")/2+"px",this.nav=prefs.getString("nav"),this.showAll=1e3*prefs.getInt("showAll"),this.useDefault=prefs.getBool("useDefault"),this.layoutURL=this.useDefault?"":prefs.getString("layoutURL"),this.imageIndex=-1,this.cardImageIndex=-1,this.cardTitleIndex=-1,this.cardSubtitleIndex=-1,this.cardDetailIndex=-1,this.imageTotal=0,this.isLoading=!0,this.isSwiping=!1,this.isTable=!1,this.column="A",this.columns={},this.sortIndex=0,this.sortDirection="asc",this.sortConfig={bDestroy:!0,bFilter:!1,bInfo:!1,bLengthChange:!1,bPaginate:!1,sScrollY:"500px"},this.viz=new RiseVision.Common.Visualization,this.verticalLayout="//s3.amazonaws.com/Gadget-Directory/css/Vertical.css",this.horizontalLayout="//s3.amazonaws.com/Gadget-Directory/css/Horizontal.css"},RiseVision.Directory.Controller.prototype.getAdditionalParams=function(t,e){if("additionalParams"==t&&e){var i=document.createElement("style");e=JSON.parse(e),i.appendChild(document.createTextNode(e["heading_font-style"])),i.appendChild(document.createTextNode(e["data_font-style"])),i.appendChild(document.createTextNode(e["nav_font-style"])),i.appendChild(document.createTextNode(e["cardTitle_font-style"])),i.appendChild(document.createTextNode(e["cardSubtitle_font-style"])),i.appendChild(document.createTextNode(e["cardDetail_font-style"])),i.appendChild(document.createTextNode("#nav ul li a:active, #nav ul li a:visited"+e["nav_font-style"])),document.getElementsByTagName("head")[0].appendChild(i),controller.columns=e.columns,controller.cardLocation=e.cardLocation,controller.cardWidth=e.cardWidth,controller.cardTimeout=1e3*e.cardTimeout,controller.cardBorder=e.cardBorder,controller.cardBgColor=e.cardBgColor,e.cardImage&&(controller.cardImage=e.cardImage.toUpperCase()),controller.cardImageAlign=e.cardImageAlign,controller.cardImageWidth=e.cardImageWidth,controller.cardImagePadding=e.cardImagePadding,controller.closeBorderColor=e.closeBorderColor,controller.closeFillColor=e.closeFillColor,e.cardTitle&&(controller.cardTitle=e.cardTitle.toUpperCase()),controller.cardTitlePadding=e.cardTitlePadding,e.cardSubtitle&&(controller.cardSubtitle=e.cardSubtitle.toUpperCase()),controller.cardSubtitlePadding=e.cardSubtitlePadding,e.cardDetail&&(controller.cardDetail=e.cardDetail.toUpperCase()),controller.cardDetailPadding=e.cardDetailPadding,controller.cardUseDefault=e.cardUseDefault,controller.cardLayoutURL=e.cardLayoutURL}controller.init()},RiseVision.Directory.Controller.prototype.init=function(){{var t=this,e={};document.createElement("link")}this.useDefault?(RiseVision.Common.Utility.loadCSS(this.isVerticalLayout()?this.verticalLayout:this.horizontalLayout),t.cardUseDefault?t.getListings("all"):t.loadCustomCard()):(e[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.layoutURL,function(e){var i=e.data;if(i.getElementsByTagName("Style").length>0){var a=document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.innerHTML=i.getElementsByTagName("Style")[0].childNodes[1].nodeValue,a.appendChild(o)}t.directory=i.getElementsByTagName("Layout")[0].childNodes[1].nodeValue,t.cardUseDefault?t.getListings("all"):t.loadCustomCard()},e))},RiseVision.Directory.Controller.prototype.loadCustomCard=function(){var t={},e=this;t[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.cardLayoutURL,function(t){var i=t.data;if(i.getElementsByTagName("Style").length>0){var a=document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.innerHTML=i.getElementsByTagName("Style")[0].childNodes[1].nodeValue,a.appendChild(o)}$("#card.default").remove(),$("#container").append(i.getElementsByTagName("Layout")[0].childNodes[1].nodeValue),e.getListings("all")},t)},RiseVision.Directory.Controller.prototype.configureNavigation=function(t){var e=this;t.alphaNav({position:prefs.getString("nav"),margin:prefs.getInt("navMargin"),selectedColor:prefs.getString("navColor"),selectedBackground:prefs.getString("navBgColor"),onclick:function(t){e.onAlphaNavClicked(t)}})},RiseVision.Directory.Controller.prototype.onAlphaNavClicked=function(t){if(clearTimeout(this.showAllTimer),this.isTable){var e=null;0!=$(".sorting_asc").length?(e=$(".sorting_asc"),this.sortDirection="asc"):0!=$(".sorting_desc").length&&(e=$(".sorting_desc"),this.sortDirection="desc"),e&&e.length>0&&(this.sortIndex=$(".dataTables_scrollHead th").index($(".dataTables_scrollHead th").index($(".sorting_asc"))>=0?$(".sorting_asc"):$(".sorting_desc")))}this.getListings(t)},RiseVision.Directory.Controller.prototype.getListings=function(t){var e=this,i="select *",a=null;$("#container").width(prefs.getString("rsW")),$("#container").height(prefs.getString("rsH")),"all"!=t&&"none"!=this.nav&&(this.isTable&&this.hasHeadings()&&(1==$(".dataTables_scrollHeadInner .sorting_asc").length?this.column=$(".dataTables_scrollHeadInner .sorting_asc").attr("id"):1==$(".dataTables_scrollHeadInner .sorting_desc").length&&(this.column=$(".dataTables_scrollHeadInner .sorting_desc").attr("id"))),i=i+" where "+this.column+" starts with upper('"+t+"') or "+this.column+" starts with lower('"+t+"')"),a={url:this.url,refreshInterval:this.refresh,queryString:i,callback:function(t){if(null!=t){var i,a=t.getNumberOfRows(),o=t.getNumberOfColumns();if(e.data=t,e.imagesLoaded=0,e.cols=[],0==a)$("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty(),$("#scrollContainer").append("<div class='noData'>No matching records found</div>"),e.isLoading?readyEvent():e.startShowAllTimer();else{for(i=0;o>i;i++)e.cols.push(t.getColumnId(i));for(i=0;o>i;i++)if(e.imageCol&&e.cols[i]===e.imageCol){e.imageIndex=i;break}if(prefs.getBool("showCard")){if(e.cardImage)for(i=0;o>i;i++)if(e.cols[i]===e.cardImage){e.cardImageIndex=i;break}if(e.cardTitle)for(i=0;o>i;i++)if(e.cols[i]===e.cardTitle){e.cardTitleIndex=i;break}if(e.cardSubtitle)for(i=0;o>i;i++)if(e.cols[i]===e.cardSubtitle){e.cardSubtitleIndex=i;break}if(e.cardDetail)for(i=0;o>i;i++)if(e.cols[i]===e.cardDetail){e.cardDetailIndex=i;break}}e.hasImage=-1==e.imageIndex?!1:!0,e.hasImage&&(e.imageTotal=a),e.isLoading&&e.hasImage&&(e.sortIndex=e.useDefault?1:0==e.imageIndex?1:e.imageIndex-1),$("#scrollContainer").hide(),e.useDefault?e.isVerticalLayout()?e.buildVerticalLayout.call(e):e.buildHorizontalLayout.call(e):e.showCustomLayout.call(e)}}}},this.viz.getData(a)},RiseVision.Directory.Controller.prototype.buildVerticalLayout=function(){var t=document.createElement("ul"),e=this.data.getNumberOfRows(),i=this.data.getNumberOfColumns(),a=!0;t.setAttribute("class","page"),this.isLoading||($("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty()),$("#scrollContainer").append(t);for(var o=0;e>o;o++){$(".page").append("<li class='listing item'><div class='content'></div></li>"),$(".listing:last").data("row",o);for(var r=0;i>r;r++)this.showColumn(r)&&r!=this.imageIndex&&(a?(this.data.getFormattedValue(o,r)&&$(".content:last").append("<p class='heading_font-style'>"+this.data.getFormattedValue(o,r)+"</p>"),a=!1):this.data.getFormattedValue(o,r)&&$(".content:last").append("<span class='data_font-style'>"+this.data.getFormattedValue(o,r)+"</span><br />")),r==i-1&&($(".listing:last").append("<hr>"),a=!0,this.hasImage&&this.loadImage(o,this.imageIndex,this.onImageLoaded,this.onImageError))}this.hasImage||($(".content").css("margin-left","0%"),this.initDirectory())},RiseVision.Directory.Controller.prototype.buildHorizontalLayout=function(){var t=document.createElement("table"),e=this.data.getNumberOfRows(),i=this.data.getNumberOfColumns();this.isTable=!0,t.setAttribute("id","directory"),t.setAttribute("class","page"),this.isLoading||($(".dataTables_scrollBody").infiniteScroll.stop(),$("#scrollContainer").empty(),$("#nav").hide()),$("#scrollContainer").append(t);for(var a=0;e>a;a++)this.renderRow(a);if(i>0&&this.renderHeadings(!0),this.hasImage)if(this.imageTotal>0)for(var a=0;e>a;a++)this.loadImage(a,this.imageIndex,this.onBgImageLoaded,this.onBgImageError);else this.initTable();else this.initTable()},RiseVision.Directory.Controller.prototype.showCustomLayout=function(){var t,e=this.data.getNumberOfRows(),i=this.data.getNumberOfColumns();if(this.isLoading||($("#scrollContainer").infiniteScroll.stop(),$("#scrollContainer").empty()),$("#scrollContainer").append(this.directory),t=$(".listing"),this.isTable=$("#scrollContainer").find("table#directory").length>0?!0:!1,this.isTable){if(i!==$(".listing > td").length)return void console.log("The number of columns in the spreadsheet does not match the number of columns in the layout file. Please ensure that these are the same.");this.renderHeadings(!1)}for(var a=1;e>a;a++)$(".listing:last").after(t.clone());for(var a=0;e>a;a++){$(".listing").eq(a).data("row",a);for(var o=0;i>o;o++){var r=$("."+this.cols[o]).eq(a);r.length>0&&o!=this.imageIndex&&r.html(this.data.getFormattedValue(a,o)),o==i-1&&this.hasImage&&(this.isTable?this.loadImage(a,this.imageIndex,this.onBgImageLoaded,this.onBgImageError):this.loadImage(a,this.imageIndex,this.onImageLoaded,this.onImageError))}}0==this.imageTotal&&(this.isTable?this.initTable():this.initDirectory())},RiseVision.Directory.Controller.prototype.configureCard=function(){var t=this,e=this.cardWidth/prefs.getInt("rsW")*100+"%",i=this.cardImageWidth,a=$("#close").width()/2+"em";prefs.getBool("showCard")&&(this.isLoading&&($("#card").css("width",e),$("#card").css("background-color",this.cardBgColor),this.cardBorder&&$("#card").addClass("cardBorder"),$("#image").addClass("topRight"==this.cardImageAlign?"right":"topLeft"==this.cardImageAlign?"left":"center"),$("#image").css("padding",this.cardImagePadding),-1!=this.cardImageIndex&&($("#card").show(),i=i/$("#card").outerWidth(!0)*100+"%",$("#card").hide(),"center"!=this.cardImageAlign&&$("#image").css("width",i)),$("#close").css("color",this.closeBorderColor),$("#close").css("background-color",this.closeFillColor),$("#close").css("border-color",this.closeBorderColor),$("#close").css({"-webkit-border-radius":a,"-moz-border-radius":a,"border-radius":a}),$("#close").on("click",function(){return clearTimeout(t.cardCloseTimer),$("#card").bPopup().close(),!1}),$("#title").css("padding",this.cardTitlePadding),$("#subtitle").css("padding",this.cardSubtitlePadding),$("#detail").css("padding",this.cardDetailPadding)),$(".listing").on("click",function(){var e=$(this).data("row");t.isSwiping?t.isSwiping=!1:e>=0&&(-1!=t.cardTitleIndex&&$("#title").html(t.data.getFormattedValue(e,t.cardTitleIndex)),-1!=t.cardSubtitleIndex&&$("#subtitle").html(t.data.getFormattedValue(e,t.cardSubtitleIndex)),-1!=t.cardDetailIndex&&$("#detail").html(t.data.getFormattedValue(e,t.cardDetailIndex)),-1!=t.cardImageIndex?t.loadImage(e,t.cardImageIndex,function(e,a){$("#image").empty(),$("#image").append(a),"center"==t.cardImageAlign&&$("#image > img").css("width",i),t.showCard()},function(){$("#image").empty(),t.showCard()}):t.showCard())}))},RiseVision.Directory.Controller.prototype.showCard=function(){var t={modalClose:!1},e=0,i=0;"left"==this.cardLocation?t.position=[e,"auto"]:"right"==this.cardLocation?(e=prefs.getInt("rsW")-$("#card").outerWidth(!0),t.position=[e,"auto"]):"top"==this.cardLocation?t.position=["auto",i]:"bottom"==this.cardLocation&&(i=prefs.getInt("rsH")-$("#card").outerHeight(!0),t.position=["auto",i]),$("#card").bPopup(t),this.cardCloseTimer=setTimeout(function(){$("#card").bPopup().close()},this.cardTimeout)},RiseVision.Directory.Controller.prototype.renderHeadings=function(t){for(var e,i,a,o,r,l=document.createElement("tr"),s=this.hasHeadings(),n=this.data.getNumberOfColumns(),d=0;n>d;d++)e=document.createElement("th"),s?(!t||t&&this.showColumn(d))&&$("."+this.cols[d]).length>0&&(e.setAttribute("id",this.cols[d]),e.setAttribute("class","nowrap heading_font-style"),$(e).html(this.data.getColumnLabel(d)),this.hasImage&&d==this.imageIndex?this.useDefault?$(l).prepend(e):$(l).append(e):(i=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div"),i.setAttribute("class","arrow"),a.setAttribute("class","indicator"),o.setAttribute("class","indicator1"),r.setAttribute("class","indicator2"),"asc"==this.sortDirection?($(i).html("&darr;"),$(o).html("A"),$(r).html("Z")):($(i).html("&uarr;"),$(o).html("Z"),$(r).html("A")),$(e).append(i),$(a).append(o),$(a).append(r),$(e).append(a),$(l).append(e))):this.showColumn(d)&&$(l).append(e);$("table").prepend($("<thead>").append(l))},RiseVision.Directory.Controller.prototype.hasHeadings=function(){for(var t=!1,e=this.data.getNumberOfColumns(),i=0;e>i;i++){var a=this.data.getColumnLabel(i);if(a){t=!0;break}}return t},RiseVision.Directory.Controller.prototype.renderRow=function(t){var e=document.createElement("tr"),i=this.data.getNumberOfColumns();e.setAttribute("class","listing item"),$(e).data("row",t);for(var a=0;i>a;a++)if(this.showColumn(a)){var o="",r="";o=this.data.getFormattedValue(t,a),r=this.data.getProperty(t,a,"style"),r&&(r=r.substring(0,r.indexOf("font-family:"))),this.hasImage&&a==this.imageIndex?this.addImage(e,this.cols[a]):this.addCell(e,o,r,this.cols[a])}$("table").append(e)},RiseVision.Directory.Controller.prototype.addImage=function(t,e){var i=document.createElement("td");i.setAttribute("class",e+" image"),$(t).prepend(i)},RiseVision.Directory.Controller.prototype.addCell=function(t,e,i,a){var o=document.createElement("td");i&&o.setAttribute("style",i),o.setAttribute("class",a+" data_font-style"),$(o).html(e),$(t).append(o)},RiseVision.Directory.Controller.prototype.loadImage=function(t,e,i,a){var o=this,r=new Image;r.onload=function(){i&&i.call(o,t,this)},r.onerror=function(){a&&a.call(o,t,this)},r.src=this.data.getFormattedValue(t,e)},RiseVision.Directory.Controller.prototype.onImageLoaded=function(t){var e=document.createElement("div");e.setAttribute("class","image"),$(e).css({background:"url("+this.data.getFormattedValue(t,this.imageIndex)+") center center no-repeat"}),$(".listing").eq(t).prepend(e),this.onAllImagesLoaded()},RiseVision.Directory.Controller.prototype.onImageError=function(t){var e=document.createElement("div");e.setAttribute("class","image"),$(".listing").eq(t).prepend(e),this.onAllImagesLoaded()},RiseVision.Directory.Controller.prototype.onAllImagesLoaded=function(){this.imagesLoaded++,this.imagesLoaded==this.imageTotal&&this.initDirectory()},RiseVision.Directory.Controller.prototype.initDirectory=function(){var t=this;$("#scrollContainer").show(),$(".content").css({"padding-top":this.rowPadding,"padding-bottom":this.rowPadding}),$(".listing:odd").addClass("odd"),$(".listing:even").addClass("even"),$(".listing").each(function(t){$(".image").eq(t).css("height",$(".listing").eq(t).height())}),$(".image").css({"margin-top":this.rowPadding,"margin-bottom":this.rowPadding}),$("#scrollContainer").infiniteScroll({scrollBy:prefs.getString("scrollBy"),direction:prefs.getString("scrollDirection"),duration:1e3*prefs.getInt("scrollHold"),speed:prefs.getString("scrollSpeed"),swipingTimeout:1e3*prefs.getInt("scrollResumes"),toggleOddEven:!0}).bind("onSwipe",function(){t.isSwiping=!0}).bind("onSwipeEnd",function(){t.isSwiping=!1}),this.configureCard(),$("#container").width("100%"),$("#container").height("100%"),this.isLoading?(this.configureNavigation($("#container")),readyEvent()):($("#scrollContainer").infiniteScroll.start(),this.startShowAllTimer())},RiseVision.Directory.Controller.prototype.startShowAllTimer=function(){var t=this;"all"!=$("#nav ul li.selected").attr("id")&&this.showAll&&(this.showAllTimer=setTimeout(function(){$("#nav ul li.selected a").css({background:"","-webkit-border-radius":"","-moz-border-radius":"","border-radius":""}),$("#nav ul li.selected a").css("color",""),$("#nav ul li.selected").removeClass("selected"),$("#nav ul li#all").addClass("selected");var e=$("#nav ul li a").width()/2+"em";$("#nav ul li.selected a").css({background:prefs.getString("navBgColor"),"-webkit-border-radius":e,"-moz-border-radius":e,"border-radius":e}),$("#nav ul li.selected a").css("color",prefs.getString("navColor")),t.onAlphaNavClicked("all")},this.showAll))},RiseVision.Directory.Controller.prototype.onBgImageLoaded=function(t,e){var i=$(".listing").eq(t).find(".image"),a=$("<img>");i.length>0&&(a.attr("src",this.data.getFormattedValue(t,this.imageIndex)),a.height(0),a.css("max-width",e.width),a.css("max-height",e.height),i.append(a)),this.onAllBackgroundImagesLoaded()},RiseVision.Directory.Controller.prototype.onBgImageError=function(){this.onAllBackgroundImagesLoaded()},RiseVision.Directory.Controller.prototype.onAllBackgroundImagesLoaded=function(){this.imagesLoaded++,this.imagesLoaded==this.imageTotal&&this.initTable()
},RiseVision.Directory.Controller.prototype.loadCardImage=function(){for(var t=this.data.getNumberOfRows(),e=0;t>e;e++)this.loadImage(e,this.cardImageIndex)},RiseVision.Directory.Controller.prototype.initTable=function(){var t,e,i=this;this.formatColumns($("th")),this.sortConfig.aoColumnDefs=this.hasImage?this.useDefault?[{bSortable:!1,aTargets:[0]}]:[{bSortable:!1,aTargets:[this.imageIndex]}]:[],$.each(this.columns,function(e,a){a.width&&(t=$("."+a.column+":first").parent().children().index($("."+a.column+":first")),i.sortConfig.aoColumnDefs.push({sWidth:a.width,aTargets:[t]}))}),this.sortConfig.aaSorting=[[this.sortIndex,this.sortDirection]],$("#scrollContainer").show(),$("#nav").show(),e=Math.max.apply(null,$(".image").map(function(){return $(this).height()}).get()),$(".image img").height(e),$("#directory").dataTable(this.sortConfig),this.hasHeadings()||$(".dataTables_wrapper table thead").css("display","none"),$(".dataTables_scrollHead table thead tr, .dataTables_scrollBody table tbody tr").height(prefs.getInt("rowHeight")),$(".dataTables_scrollHead table thead tr th, td").css({"padding-top":this.rowPadding,"padding-bottom":this.rowPadding}),$("table thead tr th, td").css({"padding-left":this.colPadding,"padding-right":this.colPadding}),$("table tr th:first-child, td:first-child").css({"padding-left":"10px"}),$("table tr th:last-child, td:last-child").css({"padding-right":"10px"}),this.configureCard(),this.isLoading&&this.configureNavigation($("#container")),this.isVerticalLayout()?$(".dataTables_scrollBody").height($("#container").outerHeight(!0)-$(".dataTables_scrollHead").height()):($("#scrollContainer").height($("#container").outerHeight(!0)-$("#nav").outerHeight(!0)),$(".dataTables_scrollBody").height($("#container").outerHeight(!0)-$("#nav").outerHeight(!0)-$(".dataTables_scrollHead").height())),$(".dataTables_scrollBody").infiniteScroll({scrollBy:prefs.getString("scrollBy"),direction:prefs.getString("scrollDirection"),duration:1e3*prefs.getInt("scrollHold"),speed:prefs.getString("scrollSpeed"),swipingTimeout:1e3*prefs.getInt("scrollResumes"),toggleOddEven:!0}).bind("onSwipe",function(){i.isSwiping=!0}).bind("onSwipeEnd",function(){i.isSwiping=!1}),$("#container").width("100%"),$("#container").height("100%"),this.isLoading?readyEvent():($(".dataTables_scrollBody").infiniteScroll.start(),this.startShowAllTimer())},RiseVision.Directory.Controller.prototype.formatColumns=function(t){var e=this;$.each(this.columns,function(i,a){if(a.column){var o,r=$("."+a.column),l=$("."+a.column+":first").parent().children().index($("."+a.column+":first"));r.length>0&&(a.header&&t.eq(l).html(a.header),e.isLoading&&a.width&&(o=parseInt(a.width),o=o/prefs.getInt("rsW")*100+"%",a.width=o),e.hasImage&&0==l?r.find("div").css("background-position",a.alignment):r.css("text-align",a.alignment),t.eq(l).css("text-align",a.alignment))}})},RiseVision.Directory.Controller.prototype.showColumn=function(t){return t!=this.cardTitleIndex&&t!=this.cardSubtitleIndex&&t!=this.cardDetailIndex&&t!=this.cardImageIndex},RiseVision.Directory.Controller.prototype.setTimer=function(){var t=this;$.idleTimer(6e4),$(document).bind("idle.idleTimer",function(){$.idleTimer("destroy"),t.showTab(t.tabIDs[0])})},RiseVision.Directory.Controller.prototype.isVerticalLayout=function(){return"left"==this.nav||"right"==this.nav},RiseVision.Directory.Controller.prototype.onresize=function(){$(".listing").each(function(t){$(".image").eq(t).css("height",$(".listing").eq(t).height())}),$(".image").css({"margin-top":this.rowPadding,"margin-bottom":this.rowPadding})},RiseVision.Directory.Controller.prototype.play=function(){this.isLoading=!1,this.isTable?$(".dataTables_scrollBody").infiniteScroll.start():$("#scrollContainer").infiniteScroll.start()},RiseVision.Directory.Controller.prototype.pause=function(){this.isTable?$(".dataTables_scrollBody").infiniteScroll.pause():$("#scrollContainer").infiniteScroll.pause()};