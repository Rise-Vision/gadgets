var RiseVision=RiseVision||{};RiseVision.WeatherSettings={};RiseVision.WeatherSettings=function(){this.settings=new RiseVision.Common.Settings};
RiseVision.WeatherSettings.prototype.initSettings=function(){var a=this;$(".colorPicker").on("click",function(a){weather.showColorPicker($(this).data("for"))});$(".fontSelector").on("click",function(a){weather.showFontSelector($(this).data("for"))});$("#layout").on("change",function(a){"3Day"==$(this).val()?$("li.current").hide():$("li.current").show();"current"==$(this).val()?$("li.forecast").hide():$("li.forecast").show();"custom"==$(this).val()?$("li.layoutURL").show():$("li.layoutURL").hide()});
$("#address").on("change",function(a){"custom"==$(this).val()?$("li.customAddress").show():$("li.customAddress").hide()});$("#description").on("change",function(a){"custom"==$(this).val()?$("li.customDescription").show():$("li.customDescription").hide()});$("#showOther").on("click",function(a){$(this).is(":checked")?$("li.other").show():$("li.other").hide()});gadgets.rpc.call("","rscmd_getAdditionalParams",function(b){b&&(b=JSON.parse(b),$("#layout").val(prefs.getString("layout")),$("#layoutURL").val(prefs.getString("layoutURL")),
$("#address").val(prefs.getString("address")),$("#customAddress").val(prefs.getString("customAddress")),$("#description").val(prefs.getString("description")),$("#showOther").attr("checked",prefs.getBool("showOther")),$("#language").val(prefs.getString("language")),$("#unit").val(prefs.getString("unit")),$("#windSpeed").val(prefs.getString("windSpeed")),$("#bgColor").val(prefs.getString("bgColor")),$("#terms").attr("checked",prefs.getBool("terms")),a.populateColor($("#bgColor"),prefs.getString("bgColor")),
$("#temp_font-style").text(b.temp_font),$("#temp_font-style").data("css",b["temp_font-style"]),$("#forecastTemp_font-style").text(b.forecastTemp_font),$("#forecastTemp_font-style").data("css",b["forecastTemp_font-style"]),$("#forecastDay_font-style").text(b.forecastDay_font),$("#forecastDay_font-style").data("css",b["forecastDay_font-style"]),$("#address_font-style").text(b.address_font),$("#address_font-style").data("css",b["address_font-style"]),$("#customDescription").val(b.customDescription),
$("#other_font-style").text(b.other_font),$("#other_font-style").data("css",b["other_font-style"]));$("#layout").trigger("change");$("#address").trigger("change");$("#description").trigger("change");$("#showOther").triggerHandler("click");$("#settings").show()})};RiseVision.WeatherSettings.prototype.populateColor=function(a,b){a.val(b);a.css("background-color",b)};RiseVision.WeatherSettings.prototype.showColorPicker=function(a){gadgets.rpc.call("","rscmd_openColorPicker",null,a,$("#"+a).val())};
RiseVision.WeatherSettings.prototype.showFontSelector=function(a){gadgets.rpc.call("","rscmd_openFontSelector",null,a,$("#"+a).data("css"))};RiseVision.WeatherSettings.prototype.setColor=function(a,b){$("#"+a).val(b);$("#"+a).css("background-color",b)};RiseVision.WeatherSettings.prototype.setFont=function(a,b,c){$("#"+a).data("css",b);$("#"+a).text(c)};
RiseVision.WeatherSettings.prototype.getSettings=function(){var a=!1,b=document.getElementsByClassName("errors")[0],c="",c=null;$(".errors").empty();a=weather.settings.validateRequired($("#layoutURL"),b,"Layout URL")?!0:a;a=weather.settings.validateRequired($("#customAddress"),b,"Your Custom Address")?!0:a;if(a=weather.settings.validateRequired($("#customDescription"),b,"Your Custom Description")?!0:a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null;c=
"up_layout="+$("#layout").val()+"&up_layoutURL="+escape($("#layoutURL").val())+"&up_address="+$("#address").val()+"&up_customAddress="+$("#customAddress").val()+"&up_description="+$("#description").val()+"&up_language="+$("#language").val()+"&up_unit="+$("#unit").val()+"&up_windSpeed="+$("#windSpeed").val()+"&up_bgColor="+$("#bgColor").val();c=$("#showOther").is(":checked")?c+"&up_showOther=true":c+"&up_showOther=false";c=$("#terms").is(":checked")?c+"&up_terms=true":c+"&up_terms=false";c={params:c,
additionalParams:JSON.stringify(weather.saveAdditionalParams())};$(".errors").css({display:"none"});return c};
RiseVision.WeatherSettings.prototype.saveAdditionalParams=function(){var a={};a.temp_font=$("#temp_font-style").text();a["temp_font-style"]=$("#temp_font-style").data("css");a.forecastTemp_font=$("#forecastTemp_font-style").text();a["forecastTemp_font-style"]=$("#forecastTemp_font-style").data("css");a.forecastDay_font=$("#forecastDay_font-style").text();a["forecastDay_font-style"]=$("#forecastDay_font-style").data("css");a.address_font=$("#address_font-style").text();a["address_font-style"]=$("#address_font-style").data("css");
a.customDescription=$("#customDescription").val();a.other_font=$("#other_font-style").text();a["other_font-style"]=$("#other_font-style").data("css");return a};RiseVision.Weather={};
RiseVision.Weather=function(){var a=prefs.getInt("rsW"),b=prefs.getInt("rsH"),c=prefs.getString("layout");this.isLoading=!0;this.refreshInterval=18E5;this.errorInterval=6E4;this.hostURL="https://s3.amazonaws.com/Gadget-Weather/";this.url=unescape("%68%74%74%70%3a%2f%2f%77%77%77%2e%74%69%6e%62%75%77%65%61%74%68%65%72%2e%63%6f%6d%2f%77%78%5f%66%65%65%64%2f%77%78%5f%63%75%72%72%65%6e%74%5f%65%78%74%65%6e%64%65%64%5f%62%79%5f%6e%61%6d%65%2e%70%68%70%3f%70%61%73%73%63%6f%64%65%3d%72%69%73%65%64%69%73%70%6c%61%79%25%37%43%64%6b%61%63%26%6d%65%74%72%69%63%3d%66%61%6c%73%65");this.geoURL=
unescape("%68%74%74%70%3a%2f%2f%77%77%77%2e%74%69%6e%62%75%77%65%61%74%68%65%72%2e%63%6f%6d%2f%77%78%5f%66%65%65%64%2f%77%78%5f%63%75%72%72%65%6e%74%5f%65%78%74%65%6e%64%65%64%5f%62%79%5f%6c%61%74%6c%6f%6e%2e%70%68%70%3f%70%61%73%73%63%6f%64%65%3d%72%69%73%65%64%69%73%70%6c%61%79%25%37%43%64%6b%61%63%26%6d%65%74%72%69%63%3d%66%61%6c%73%65");this.layoutURL="custom"==c?prefs.getString("layoutURL"):"current"==c?b>a?this.hostURL+"Current/Current-Portrait.xml":this.hostURL+"Current/Current-Landscape.xml":
"3Day"==c?b>a?this.hostURL+"3Day/3Day-Portrait.xml":this.hostURL+"3Day/3Day-Landscape.xml":b>a?this.hostURL+"CurrentAnd3Day/CurrentAnd3Day-Portrait.xml":this.hostURL+"CurrentAnd3Day/CurrentAnd3Day-Landscape.xml"};
RiseVision.Weather.prototype.getAdditionalParams=function(a,b){var c;"additionalParams"==a?b&&(c=document.createElement("style"),b=JSON.parse(b),c.appendChild(document.createTextNode(b["temp_font-style"])),c.appendChild(document.createTextNode(b["forecastTemp_font-style"])),c.appendChild(document.createTextNode(b["forecastDay_font-style"])),c.appendChild(document.createTextNode(b["address_font-style"])),c.appendChild(document.createTextNode(b["other_font-style"])),document.getElementsByTagName("head")[0].appendChild(c),
weather.customDescription=b.customDescription,weather.init()):"displayAddress"==a&&(b&&(c=JSON.parse(b),weather.weatherURL=weather.url+"&language="+prefs.getString("language")+"&name="+encodeURIComponent(c.city+","+c.province)+"&dummy="+Math.ceil(100*Math.random())),weather.getWeather())};
RiseVision.Weather.prototype.init=function(){var a,b,c,k=this,l={};l[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM;gadgets.io.makeRequest(this.layoutURL,function(l){a=l.data;0<a.getElementsByTagName("Style").length&&(a.getElementsByTagName("Style")[0].getAttribute("url")?loadCSS(a.getElementsByTagName("Style")[0].getAttribute("url")):(b=document.getElementsByTagName("head")[0],c=document.createElement("style"),c.type="text/css",c.innerHTML=a.getElementsByTagName("Style")[0].childNodes[1].nodeValue,
b.appendChild(c)));$("#container").append(a.getElementsByTagName("Layout")[0].childNodes[1].nodeValue);k.getLocation()},l)};
RiseVision.Weather.prototype.getLocation=function(){var a=prefs.getString("id"),b=prefs.getString("address"),c=prefs.getString("customAddress");"geolocation"==b?this.useGeolocation():"display"==b?a&&gadgets.rpc.call("","rsparam_get",null,a,"displayAddress"):"custom"==b&&""!=c&&(this.weatherURL=this.url+"&language="+prefs.getString("language")+"&name="+encodeURIComponent(c)+"&dummy="+Math.ceil(100*Math.random()),this.getWeather())};
RiseVision.Weather.prototype.useGeolocation=function(){var a=this;this.supportsGeolocation()&&navigator.geolocation.getCurrentPosition(function(b){a.getPosition.call(a,b)},function(b){console.log("Unable to obtain geolocation position.");setTimeout(function(){a.getLocation()},a.errorInterval)})};RiseVision.Weather.prototype.supportsGeolocation=function(){return!!navigator.geolocation};
RiseVision.Weather.prototype.getPosition=function(a){this.weatherURL=this.geoURL+"&language="+prefs.getString("language")+"&lat="+a.coords.latitude+"&lon="+a.coords.longitude+"&dummy="+Math.ceil(100*Math.random());this.getWeather()};RiseVision.Weather.prototype.getWeather=function(){var a=this,b={};this.weatherURL?(b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.weatherURL,function(b){a.showWeather(b)},b)):this.useGeolocation()};
RiseVision.Weather.prototype.showWeather=function(a){var b=this,c=[],k=(new Date).getDay()+1,l=7<k+1?1:k+1,u=7<l+1?1:l+1,f=!1,h=!1,g=prefs.getString("description"),e=prefs.getString("windSpeed"),p=prefs.getString("layout"),d,r,q,m,n,s,t;if(0<a.errors.length)console.log("Unable to connect to the weather service at "+new Date+". Please check your Internet connection."),setTimeout(function(){b.getLocation()},b.errorInterval);else{if(a.data)if(0<a.data.getElementsByTagName("cw_error").length)this.retry();
else{a=a.data;$("#outer").show();$("#error").hide();$.each(a.getElementsByTagName("observation"),function(a,b){r=b.getAttribute("icon_name");if(null!=r&&"cw_no_report_icon"!=r)return d=this,!1});null==d&&(d=a.getElementsByTagName("observation")[0]);d&&"3Day"!=p&&(d.getAttribute("icon_name")?(this.loadImage(d.getAttribute("icon_name"),$(".currentIcon")),$(".currentIcon").attr("title",d.getAttribute("description"))):$(".currentIcon").hide(),$(".currentTemp").html("celsius"==prefs.getString("unit")?
this.convertTemp(d.getAttribute("temperature"))+"&#176;C":this.convertTemp(d.getAttribute("temperature"))+"&#176;F"));"custom"==g?($("#city").text(this.customDescription),h=!0):"service"==g&&(e=a.getElementsByTagName("location")[0])&&(h=e.getAttribute("city_name"),e.getAttribute("state_name")&&(h+=", "+e.getAttribute("state_name")),$("#city").text(h),h=!0);if(d)if(prefs.getBool("showOther")){g=prefs.getString("language");f=d.getAttribute("wind_short");e=prefs.getString("windSpeed");if("en"==g)q="Humidity ",
g="Wind ",m=" at ",n="mph"==e?" mph":" kph";else if("es"==g)q="Humedad ",g="Viento ",m=" en ",n="mph"==e?" mph":" kph";else if("de"==g)q="Luftfeuchtigkeit ",g="Wind ",m=" bei ",n="mph"==e?" mph":" kph";else if("fr"==g)q="Humidit\u00e9 ",g="Vent ",m=" \u00e0 ",n="mph"==e?" mph":" kph";else switch(q="\u0412\u043b\u0430\u0436\u043d\u043e\u0441\u0442\u044c ",g="\u0412\u0435\u0442\u0435\u0440",m=", ",n="mph"==e?" \u043c\u0438\u043b\u044c/\u0447\u0430\u0441":" \u043a\u043c/\u0447",f){case "N":case "\u0421":f=
"\u0441\u0435\u0432\u0435\u0440\u043d\u044b\u0439";break;case "S":case "\u042e":f="\u044e\u0436\u043d\u044b\u0439";break;case "E":case "\u0412":f="\u0432\u043e\u0441\u0442\u043e\u0447\u043d\u044b\u0439";break;case "W":case "\u0417":f="\u0437\u0430\u043f\u0430\u0434\u043d\u044b\u0439";break;case "NE":case "\u0421\u0412":f="\u0441\u0435\u0432\u0435\u0440\u043e-\u0432\u043e\u0441\u0442\u043e\u0447\u043d\u044b\u0439";break;case "SE":case "\u042e\u0412":f="\u044e\u0433\u043e-\u0432\u043e\u0441\u0442\u043e\u0447\u043d\u044b\u0439";
break;case "NW":case "\u0421\u0417":f="\u0441\u0435\u0432\u0435\u0440\u043e-\u0437\u0430\u043f\u0430\u0434\u043d\u044b\u0439";break;case "SW":case "\u042e\u0417":f="\u044e\u0433\u043e-\u0437\u0430\u043f\u0430\u0434\u043d\u044b\u0439"}isNaN(d.getAttribute("humidity"))||$("#humidity").text(q+d.getAttribute("humidity")+"%");"mph"===e?d.getAttribute("wind_short")&&d.getAttribute("wind_speed")&&$("#wind").text(g+" "+f+m+parseInt(d.getAttribute("wind_speed"))+n):"kph"===e&&d.getAttribute("wind_short")&&
d.getAttribute("wind_speed")&&(e=parseInt(d.getAttribute("wind_speed")),e=Math.round(1.609344*e),$("#wind").text(g+" "+f+m+e+n));f=!0}else $("#humidityAndWind").hide();f||h||$("#info").hide();if(h=a.getElementsByTagName("forecast")){if("current"!=p)for(i=0;i<h.length;i++)p=h[i].getAttribute("day_of_week"),p==k?c[0]=h[i]:p==l?c[1]=h[i]:p==u&&(c[2]=h[i]);$(".icon").each(function(a){c[a].getAttribute("icon_name")?(b.loadImage(c[a].getAttribute("icon_name"),$(this)),$(this).attr("title",c[a].getAttribute("description"))):
$(this).hide()});$(".day").each(function(a){$(this).html(c[a].getAttribute("weekday"))});$(".temp").each(function(a){s=b.convertTemp(c[a].getAttribute("low_temp"));t=b.convertTemp(c[a].getAttribute("high_temp"));$(this).html(s+"&#176; / "+t+"&#176;")})}setTimeout(function(){b.getLocation()},this.refreshInterval)}else this.retry();this.isLoading&&(this.isLoading=!1,readyEvent())}};
RiseVision.Weather.prototype.retry=function(){var a=this;this.isLoading&&($("#error").text("Unable to retrieve weather data for that location.").show(),$("#outer").hide());setTimeout(function(){a.getLocation()},this.errorInterval)};RiseVision.Weather.prototype.loadImage=function(a,b){var c=new Image,k=this.hostURL+"images/"+a+".png";c.onload=function(){b.attr("src",k)};c.onerror=function(){console.log("Image "+a+" not found on "+new Date+" for "+$("#city").text())};c.src=k};
RiseVision.Weather.prototype.convertTemp=function(a){return"celsius"==prefs.getString("unit")?parseInt(5*(a-32)/9):parseInt(a)};