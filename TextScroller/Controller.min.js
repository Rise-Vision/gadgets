function Controller(b,c){this.scroller=b;this.text=RiseVision.Common.Utility.unescapeHTML(c.getString("text"));this.direction=c.getString("direction");this.prefs=c;this.item=null;this.scrollers=[];this.mouseMove=this.mouseDown=!1;this.lastMouseX=0;this.interactivityTimeout=5E3;this.interactivityTimerID;this.isStopped=!1;this.totalPixels=0;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();window.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}Controller.prototype.initCanvas=function(){this.context=this.scroller.getContext("2d");this.scroller.width=this.prefs.getString("rsW");this.scroller.height=this.prefs.getString("rsH")};
Controller.prototype.initContent=function(){for(var b=0;3>b;b++)"rtl"===this.direction?(this.scrollers[b]=new Scroller(b*this.scroller.width,this.scroller.width,this.scroller.height),this.speed=3):(this.scrollers[b]=new Scroller(-b*this.scroller.width,this.scroller.width,this.scroller.height),this.speed=-3);this.item=new Item(this.text);for(b=0;b<this.scrollers.length;b++)this.adjustCanvas(b);readyEvent()};
Controller.prototype.drawScene=function(){var b;if(!this.mouseDown&&!this.isStopped){this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var c=0;c<this.scrollers.length;c++)this.scrollers[c].setX(this.speed),b="rtl"===this.direction?this.scrollers[c].getX()+this.scroller.width:this.scrollers[c].getX()-this.scroller.width,0>b&&"rtl"===this.direction?(this.scrollers[c].resetX(2*this.scroller.width),this.scrollers[c].setX(-b),this.adjustCanvas(c)):0<b&&"ltr"===this.direction&&(this.scrollers[c].resetX(2*
-this.scroller.width),this.scrollers[c].setX(-b),this.adjustCanvas(c)),this.context.save(),this.context.translate(this.scrollers[c].getX(),0),this.drawCanvas(c),this.context.restore();this.totalPixels+=Math.abs(this.speed);this.totalPixels>this.item.getWidth()&&(this.totalPixels-=this.item.getWidth(),doneEvent())}};Controller.prototype.drawCanvas=function(b){this.context.drawImage(this.scrollers[b].canvas,0,0,this.scrollers[b].canvas.width,this.scrollers[b].canvas.height)};
Controller.prototype.adjustCanvas=function(b,c){var a=0;c||(c=this.direction);a=this.getItemPosition(b,c);"rtl"===c?(this.scrollers[b].setWritePosition(0),this.scrollers[b].drawCanvasFromStart(this.item.canvas,a)):(this.scrollers[b].setWritePosition(this.scroller.width),this.scrollers[b].drawCanvasFromEnd(this.item.canvas,a))};
Controller.prototype.getItemPosition=function(b,c){var a=b;"rtl"===this.direction?"rtl"===c?(a--,0>a&&(a=this.scrollers.length-1),a=this.scrollers[a].getEndCanvasPosition(),a===this.item.canvas.width&&(a=0)):(a++,a>=this.scrollers.length&&(a=0),a=this.scrollers[a].getStartCanvasPosition(),0===a&&(a=this.item.canvas.width)):"rtl"===c?(a++,a>=this.scrollers.length&&(a=0),a=this.scrollers[a].getEndCanvasPosition(),a===this.item.canvas.width&&(a=0)):(a--,0>a&&(a=this.scrollers.length-1),a=this.scrollers[a].getStartCanvasPosition(),
0===a&&(a=this.item.canvas.width));return a};Controller.prototype.handleMouseDown=function(b){this.mouseDown=!0;this.lastMouseX=b.clientX};Controller.prototype.handleMouseUp=function(b){var c=this;this.mouseDown=!1;this.mouseMove?this.mouseMove=!1:(clearTimeout(this.interactivityTimerID),this.isStopped=!0,this.interactivityTimerID=setTimeout(function(){c.isStopped=!1},this.interactivityTimeout))};Controller.prototype.handleMouseOut=function(b){this.mouseDown=!1};
Controller.prototype.handleMouseMove=function(b){if(this.mouseDown){b=b.clientX;var c=this.lastMouseX-b,a;this.mouseMove=!0;this.context.clearRect(0,0,this.scroller.width,this.scroller.height);for(var d=0;d<this.scrollers.length;d++)this.scrollers[d].setX(c),"rtl"===this.direction?0<c?(a=this.scrollers[d].getX()+this.scroller.width,0>a&&(this.scrollers[d].resetX(2*this.scroller.width),this.scrollers[d].setX(-a),this.adjustCanvas(d,"rtl"))):0>c&&(a=this.scrollers[d].getX()-2*this.scroller.width,0<
a&&(this.scrollers[d].resetX(-this.scroller.width),this.scrollers[d].setX(-a),this.adjustCanvas(d,"ltr"))):0<c?(a=this.scrollers[d].getX()+2*this.scroller.width,0>a&&(this.scrollers[d].resetX(this.scroller.width),this.scrollers[d].setX(-a),this.adjustCanvas(d,"rtl"))):0>c&&(a=this.scrollers[d].getX()-this.scroller.width,0<a&&(this.scrollers[d].resetX(2*-this.scroller.width),this.scrollers[d].setX(-a),this.adjustCanvas(d,"ltr"))),this.context.save(),this.context.translate(this.scrollers[d].getX(),
0),this.drawCanvas(d),this.context.restore();this.isStopped=!1;this.lastMouseX=b}};Controller.prototype.tick=function(){var b=this;this.request=requestAnimFrame(function(){b.tick()});this.drawScene()};Controller.prototype.pause=function(){cancelRequestAnimFrame(this.request)};Controller.prototype.initialize=function(){this.initCanvas();this.initContent()};