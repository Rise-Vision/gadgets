var RiseVision=RiseVision||{};RiseVision.Spreadsheet={};
RiseVision.Spreadsheet=function(){var a=new gadgets.Prefs,b=unescape(a.getString("layoutURL"));this.prefs=a;this.url=unescape(a.getString("url"));this.useLayoutURL=a.getBool("useLayoutURL");this.isDefaultLayout=!a.getBool("useLayoutURL")||b&&"https://s3.amazonaws.com/Gadget-Spreadsheet/layouts/Table/Table.xml"!=b?!1:!0;this.layoutURL=b?b:"https://s3.amazonaws.com/Gadget-Spreadsheet/layouts/Table/Table.xml";this.scrollBy=a.getString("scrollBy");this.scrollDirection=a.getString("scrollDirection");this.duration=
1E3*a.getInt("duration");this.scrollSpeed=a.getString("scrollSpeed");this.interactivityTimeout=1E3*a.getInt("interactivityTimeout");this.spacing=parseInt(a.getInt("spacing")/2)+"px";this.colPadding=parseInt(a.getInt("colPadding")/2)+"px";this.colCount=a.getInt("colCount");this.interval=a.getInt("interval");this.showStale=a.getBool("showStale");this.condition1=a.getInt("condition1");this.condition2=a.getInt("condition2");this.condition3=a.getInt("condition3");this.condition1Action=a.getString("condition1Action");
this.condition2Action=a.getString("condition2Action");this.condition3Action=a.getString("condition3Action");this.rsW=a.getInt("rsW");this.rsH=a.getInt("rsH");this.isPaused=this.isLoading=!0;this.noDataFound=!1;this.columns={};this.sortConfig={bDestroy:!0,bFilter:!1,bInfo:!1,bLengthChange:!1,bPaginate:!1,bSort:!1,sScrollY:"500px"};this.settings=new RiseVision.Common.Settings;this.picker=new RiseVision.Common.Picker;this.viz=new RiseVision.Common.Visualization;this.baseURL="";this.headerRows="0";this.range=
""};
RiseVision.Spreadsheet.prototype.initSettings=function(){var a=this;this.url&&($("#url").val(this.url),""!=prefs.getString("docID")&&(this.docID=prefs.getString("docID"),this.picker.getSheets({docID:prefs.getString("docID"),callback:function(b){null!=b&&(a.onSheetsLoaded(b),$("#sheet").val(unescape(prefs.getString("sheet"))),$("li.more").show())}}),$("input[type='radio'][name='cells']").each(function(){$(this).val()==prefs.getString("cells")&&($(this).attr("checked","checked"),"range"==$(this).val()&&$("#rangeContainer").show())}),
$("#range").val(prefs.getString("range")),$("#headerRows").val(prefs.getString("headerRows")),this.range=prefs.getString("range"),this.headerRows=prefs.getString("headerRows")),$("#interval").val(this.interval),$("#scrollBy").val(this.scrollBy),$("#scrollDirection").val(this.scrollDirection),$("#scrollSpeed").val(this.scrollSpeed),$("#scrollResumes").val(prefs.getInt("interactivityTimeout")),$("#rowPadding").val(prefs.getInt("spacing")),$("#colPadding").val(prefs.getInt("colPadding")),$("#colCount").val(this.colCount),
$("#backgroundColor").val(prefs.getString("backgroundColor")),$("#rowColor").val(prefs.getString("rowColor")),$("#alternateRowColor").val(prefs.getString("alternateRowColor")),$("#scrollHold").val(prefs.getInt("duration")),$("#useDefaultURL").attr("checked",!this.useLayoutURL),$("#layoutURL").val(this.layoutURL));this.onScrollByChanged();this.onScrollDirectionChanged();this.onLayoutURLChanged();this.buildColumnFormatUI();$("#scrollBy").change(function(){a.onScrollByChanged()});$("#scrollDirection").change(function(){a.onScrollDirectionChanged()});
$("#useDefaultURL").click(function(){a.onLayoutURLChanged()});$("#colCount").change(function(){a.buildColumnFormatUI()});$("#googleDrive").click(function(){a.picker.showPicker($(this).data("for"),google.picker.ViewId.SPREADSHEETS)});$("input[name='cells']").change(function(){"range"==$(this).val()?(a.range=$("#range").val(),$("#rangeContainer").show()):(a.range="",$("#rangeContainer").hide());a.showDataURLOptions()});$("#range").blur(function(){a.range=$(this).val();a.showDataURLOptions()});$("#headerRows").change(function(){a.headerRows=
$(this).val();a.showDataURLOptions()});$("#sheet").change(function(){a.showDataURLOptions()});gadgets.rpc.call("","rscmd_getAdditionalParams",function(b){if(b){b=JSON.parse(b);a.populateColor($("#backgroundColor"),prefs.getString("backgroundColor"));a.populateColor($("#rowColor"),prefs.getString("rowColor"));a.populateColor($("#alternateRowColor"),prefs.getString("alternateRowColor"));$("#heading_font-style").text(b.heading_font);$("#heading_font-style").data("css",b["heading_font-style"]);$("#data_font-style").text(b.data_font);
$("#data_font-style").data("css",b["data_font-style"]);for(var d=0;d<parseInt($("#colCount").val());d++)a.initFormatSettings(d+1,b.columns[d])}$("#settings").show()})};RiseVision.Spreadsheet.prototype.initFormatSettings=function(a,b){$("#column"+a).val(b.column);$("#alignment"+a).val(b.alignment);$("#width"+a).val(b.width);$("#decimals"+a).val(b.decimals);$("#sign"+a).val(b.sign);$("#condition"+a+"Action").val(b.condition);$("#headerText"+a).val(b.header)};
RiseVision.Spreadsheet.prototype.onScrollByChanged=function(){"continuous"==$("#scrollBy").val()?$("li.scrollHold").hide():$("li.scrollHold").show()};RiseVision.Spreadsheet.prototype.onScrollDirectionChanged=function(){var a=$("#scrollDirection").val();"none"==a?$("li.scroll").hide():$("li.scroll").show();"rtl"==a||"ltr"==a?$("li.headingFont, li.useDefaultURL, li.layoutURL").hide():($("li.headingFont, li.useDefaultURL").show(),$("#useDefaultURL").is(":checked")||$("li.layoutURL").show())};
RiseVision.Spreadsheet.prototype.onLayoutURLChanged=function(){$("#useDefaultURL").is(":checked")?$("li.layoutURL").hide():$("li.useDefaultURL").is(":visible")&&$("li.layoutURL").show()};
RiseVision.Spreadsheet.prototype.buildColumnFormatUI=function(){var a=parseInt($("#colCount").val()),b=$(".column").length;if(isNaN(a)||0==a)$(".formatting").hide();else if(a==b)$(".formatting").show();else if(a<b)$(".formatting").hide(),$(".formatting:lt("+a+")").show();else for($(".formatting").show(),b+=1;b<=a;b++){var d=$("<li></li>"),c=$("<ol class='formatting drillDown'></ol>");$(c).append($("<li></li>").append("<label for='column"+b+"'><a href='#' class='tooltip'>Column*:<span>Column of the spreadsheet that the formatting should apply to (e.g. A or AW)</span></a></label>").append("<input id='column"+
b+"' name='column"+b+"' type='text' class='column short' />")).append($("<li></li>").append("<label for='alignment"+b+"'>Alignment:</label>").append("<select id='alignment"+b+"' name='alignment"+b+"' class='alignment short'><option value='left' selected='selected'>Left</option><option value='center'>Center</option><option value='right'>Right</option></select>")).append($("<li></li>").append("<label for='width"+b+"'>Width (pixels):</label>").append("<input id='width"+b+"' name='width"+b+"' type='text' class='width short' value='100' />")).append($("<li></li>").append("<label for='decimals"+
b+"'>Decimals:</label>").append("<select id='decimals"+b+"' name='decimals"+b+"' class='decimals short'><option value='0'>0</option><option value='1'>1</option><option value='2' selected='selected'>2</option><option value='3'>3</option><option value='4'>4</option></select>")).append($("<li></li>").append("<label for='sign"+b+"'><a href='#' class='tooltip'>Sign:<span>How to display positive and negative numbers</span></a></label>").append("<select id='sign"+b+"' name='sign"+b+"' class='sign short'><option value='none' selected='selected'>None</option><option value='minus'>-</option><option value='plusMinus'>+/-</option><option value='parentheses'>( )</option><option value='arrow'>Arrow</option></select>")).append($("<li></li>").append("<label for='condition"+
b+"'><a href='#' class='tooltip'>Color Condition:<span>Whether or not to use color to indicate positive or negative values, or to indicate a change in value</span></a></label>").append("<select id='condition"+b+"Action' name='condition"+b+"Action' class='condition medium'><option value='none' selected='selected'>None</option><option value='changeUp'>Change Up Green Down Red</option><option value='changeDown'>Change Down Green Up Red</option><option value='valuePositive'>Value Positive Green Negative Red</option><option value='valueNegative'>Value Negative Green Positive Red</option></select>")).append($("<li></li>").append("<label for='headerText"+
b+b+"'><a href='#' class='tooltip'>Header Text:<span>Custom header text. If not specified, the header from the spreadsheet will be used.</span></a></label>").append("<input id='headerText"+b+"' name='headerText"+b+"' type='text' class='headerText short' />"));d.append(c);$("#backgroundColor").parent().before(d)}};RiseVision.Spreadsheet.prototype.showColorPicker=function(a){gadgets.rpc.call("","rscmd_openColorPicker",null,a,$("#"+a).val())};
RiseVision.Spreadsheet.prototype.showFontSelector=function(a){gadgets.rpc.call("","rscmd_openFontSelector",null,a,$("#"+a).data("css"))};RiseVision.Spreadsheet.prototype.populateColor=function(a,b){a.val(b);a.css("background-color",b)};RiseVision.Spreadsheet.prototype.setColor=function(a,b){$("#"+a).val(b);$("#"+a).css("background-color",b)};RiseVision.Spreadsheet.prototype.setFont=function(a,b,d){$("#"+a).data("css",b);$("#"+a).text(d)};
RiseVision.Spreadsheet.prototype.setURL=function(a,b){$("#"+a).val("");spreadsheet.picker.getSheets({docID:b.id,callback:function(a){null!=a&&(spreadsheet.docID=b.id,spreadsheet.onSheetsLoaded(a),spreadsheet.showDataURLOptions())}})};RiseVision.Spreadsheet.prototype.onSheetsLoaded=function(a){$("#sheet").empty();for(var b=0;b<a.length;b++)document.getElementById("sheet").add(a[b])};
RiseVision.Spreadsheet.prototype.showDataURLOptions=function(){var a=this.picker.getURL({baseURL:$("#sheet").val(),headerRows:this.headerRows,range:this.range});$(".errors").empty();$(".errors").css({display:"none"});$("#url").val(a);$("li.more").show()};
RiseVision.Spreadsheet.prototype.getSettings=function(){var a=!1,b=document.getElementsByClassName("errors")[0],d="",c=null,e;$(".errors").empty();$(".errors").css({display:"none"});if(""!=$("#url").val())c={url:$("#url").val()+(-1==$("#url").val().indexOf("?")?"?":"&")+"dummy="+Math.ceil(100*Math.random()),refreshInterval:0,callback:function(c){if(null!=c){a=spreadsheet.settings.validateRequired($("#url"),b,"Data URL")?!0:a;a=spreadsheet.settings.validateNumeric($("#interval"),b,"Data Refresh")?
!0:a;a=spreadsheet.settings.validateNumeric($("#scrollHold"),b,"Scroll Hold")?!0:a;a=spreadsheet.settings.validateNumeric($("#scrollResumes"),b,"Scroll Resumes")?!0:a;a=spreadsheet.settings.validateNumeric($("#rowPadding"),b,"Row Padding")?!0:a;a=spreadsheet.settings.validateNumeric($("#colPadding"),b,"Column Padding")?!0:a;0<parseInt($("#colCount").val())&&($(".column").each(function(c){a=spreadsheet.settings.validateRequired($(this),b,"Column")?!0:a}),$(".width").each(function(c){a=spreadsheet.settings.validateNumeric($(this),
b,"Column Width")?!0:a}));if(a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null;d="up_url="+escape($("#url").val());null!=spreadsheet.docID&&(d+="&up_docID="+spreadsheet.docID,e=$("input[type='radio'][name='cells']:checked"),0<e.length&&(d+="&up_cells="+e.val()+"&up_range="+$("#range").val()),d+="&up_sheet="+escape($("#sheet").val())+"&up_headerRows="+$("#headerRows").val());d+="&up_interval="+$("#interval").val()+"&up_scrollBy="+$("#scrollBy").val()+"&up_duration="+
$("#scrollHold").val()+"&up_scrollDirection="+$("#scrollDirection").val()+"&up_scrollSpeed="+$("#scrollSpeed").val()+"&up_interactivityTimeout="+$("#scrollResumes").val()+"&up_spacing="+$("#rowPadding").val()+"&up_colPadding="+$("#colPadding").val()+"&up_colCount="+$("#colCount").val()+"&up_backgroundColor="+$("#backgroundColor").val()+"&up_rowColor="+$("#rowColor").val()+"&up_alternateRowColor="+$("#alternateRowColor").val();d=$("#useDefaultURL").is(":checked")?d+"&up_useLayoutURL=false":d+"&up_useLayoutURL=true";
$("#layoutURL").is(":visible")&&(d+="&up_layoutURL="+escape($("#layoutURL").val()));c=[];for(var f=0;f<parseInt($("#colCount").val());f++)spreadsheet.saveFormatSettings(f+1,c);c={heading_font:$("#heading_font-style").text(),"heading_font-style":$("#heading_font-style").data("css"),data_font:$("#data_font-style").text(),"data_font-style":$("#data_font-style").data("css"),columns:c};c={params:d,additionalParams:JSON.stringify(c)};gadgets.rpc.call("","rscmd_saveSettings",null,c)}else return $(".errors").append("The spreadsheet could not be read. Please ensure that the Data URL is correct and that the spreadsheet has been published to the web."),
$(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null}},spreadsheet.viz.getData(c);else if(a=spreadsheet.settings.validateRequired($("#url"),b,"Data URL")?!0:a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null};
RiseVision.Spreadsheet.prototype.saveFormatSettings=function(a,b){b.push({column:$("#column"+a).val(),alignment:$("#alignment"+a).val(),width:$("#width"+a).val(),decimals:$("#decimals"+a).val(),sign:$("#sign"+a).val(),condition:$("#condition"+a+"Action").val(),header:$("#headerText"+a).val()})};
RiseVision.Spreadsheet.prototype.getAdditionalParams=function(a,b){if("additionalParams"==a&&b){var d=document.createElement("style");b=JSON.parse(b);d.appendChild(document.createTextNode(b["heading_font-style"]));d.appendChild(document.createTextNode(b["data_font-style"]));d.appendChild(document.createTextNode("a:active"+b["data_font-style"]));document.getElementsByTagName("head")[0].appendChild(d);spreadsheet.columns=b.columns}spreadsheet.initialize()};
RiseVision.Spreadsheet.prototype.initialize=function(){var a=this,b={};this.useLayoutURL||this.isHorizontal()||a.loadCSS("https://s3.amazonaws.com/Gadget-Spreadsheet/layouts/Table/Table.css");this.useLayoutURL?(b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(encodeURI(this.layoutURL),function(b){b=b.data;if(0<b.getElementsByTagName("Style").length)if(b.getElementsByTagName("Style")[0].getAttribute("url"))a.loadCSS(b.getElementsByTagName("Style")[0].getAttribute("url"));
else{var c=document.getElementsByTagName("head")[0],e=document.createElement("style");e.innerHTML=b.getElementsByTagName("Style")[0].childNodes[1].nodeValue;c.appendChild(e)}a.layout=b.getElementsByTagName("Layout")[0].childNodes[1].nodeValue;a.getData()},b)):this.getData()};RiseVision.Spreadsheet.prototype.loadCSS=function(a){var b=$("<link>");b.attr({type:"text/css",rel:"stylesheet",href:a});$("head").append(b)};
RiseVision.Spreadsheet.prototype.getData=function(a){var b=this;a&&(this.url=a);this.isHorizontal()?this.initHorizontalScroll():this.viz.getData({url:this.url,refreshInterval:this.interval,callback:function(a){b.onDataLoaded.call(b,a)}})};RiseVision.Spreadsheet.prototype.onDataLoaded=function(a){null==a?this.isLoading&&(this.isLoading=!1,readyEvent()):(this.pause(),this.data=a,this.useLayoutURL?this.showCustomLayout():this.showDefaultLayout())};
RiseVision.Spreadsheet.prototype.showDefaultLayout=function(){if(!this.checkForNoData()){this.isLoading||null==this.dataTable||this.dataTable.fnClearTable(!1);this.cols=[];for(var a=0,b=this.data.getNumberOfColumns();a<b;a++)this.cols.push(this.data.getColumnId(a));this.isLoading?this.createDataTable():$(".dataTables_scrollHeadInner .page th").length!=this.data.getNumberOfColumns()?(this.dataTable.fnDestroy(!0),this.dataTable=null,this.createDataTable()):(this.updateHeadings(),this.addRows());$(".dataTables_scrollHead table tr th, td").css({"padding-top":this.spacing,
"padding-bottom":this.spacing,"padding-left":this.colPadding,"padding-right":this.colPadding});$(".dataTables_scrollHead table tr th:first-child, td:first-child").css({"padding-left":"10px"});$(".dataTables_scrollHead table tr th:last-child, td:last-child").css({"padding-right":"10px"});this.setFontSizes();this.configureScrolling();this.handleConditions();this.isLoading?(this.isLoading=!1,readyEvent()):$(".dataTables_scrollBody").infiniteScroll.start()}};
RiseVision.Spreadsheet.prototype.createDataTable=function(){var a=this,b;$("#container").width(prefs.getString("rsW"));$("#container").height(prefs.getString("rsH"));$(".page").empty();0<this.data.getNumberOfColumns()&&this.renderHeadings();for(var d=0,c=this.data.getNumberOfRows();d<c;d++)this.renderRow(this.data.getNumberOfColumns(),d);this.formatColumns($(".page th"));this.sortConfig.aoColumnDefs=[];$.each(this.columns,function(c,d){d.width&&(b=$("."+d.column+":first").parent().children().index($("."+
d.column+":first")),a.sortConfig.aoColumnDefs.push({sWidth:d.width,aTargets:[b]}))});this.dataTable=$(".page").dataTable(this.sortConfig);$(".dataTables_scrollBody").height(($("#container").outerHeight(!0)-$(".dataTables_scrollHead").height())/this.rsH*100+"%")};
RiseVision.Spreadsheet.prototype.showCustomLayout=function(){if(!this.checkForNoData()){var a=null,b=$("<thead />"),d=null;this.cols=[];this.imagesLoaded=0;$("#container").empty();$("#container").append(this.layout);for(var a=$("#header table tbody").html(),d=$(".repeat"),c=0;c<this.data.getNumberOfColumns();c++)this.cols.push(this.data.getColumnId(c));this.imageTotal=$(".image").length*this.data.getNumberOfRows()+$(".qrCode").length*this.data.getNumberOfRows();for(var e=0,g=this.data.getNumberOfRows();e<
g;e++){0<e&&d.parent().append(d.clone());for(var c=0,f=this.cols.length;c<f;c++){var h=$("."+this.cols[c]+":last");h&&(h.hasClass("image")?this.loadImage(this.data.getValue(e,c),h):h.hasClass("qrCode")?this.data.getValue(e,c)?this.loadImage("https://chart.googleapis.com/chart?cht=qr&chs=100x100&chld=H|0&chl="+encodeURIComponent(this.data.getValue(e,c)),h):this.imageTotal--:(this.data.getColumnType(c),h.html(this.data.getFormattedValue(e,c))))}}a&&(b.append(a),$(".page").prepend(b),$("#header").remove());
0==this.imageTotal&&this.finalizeCustomLayout()}};
RiseVision.Spreadsheet.prototype.finalizeCustomLayout=function(){0<$(this.layout).find("table").length&&(this.formatColumns($(".page th")),this.dataTable=$(".page").dataTable(this.sortConfig),$(".dataTables_scrollHead table tr th, td").css({"padding-top":this.spacing,"padding-bottom":this.spacing,"padding-left":this.colPadding,"padding-right":this.colPadding}),$(".dataTables_scrollHead table tr th:first-child, td:first-child").css({"padding-left":"10px"}),$(".dataTables_scrollHead table tr th:last-child, td:last-child").css({"padding-right":"10px"}),
$(".dataTables_scrollBody").height(($("#container").outerHeight(!0)-$(".dataTables_scrollHead").height())/this.rsH*100+"%"));this.setFontSizes();this.buildMenu();this.handleConditions();this.configureScrolling();this.isLoading?(this.isLoading=!1,readyEvent()):$(".dataTables_scrollBody").infiniteScroll.start()};
RiseVision.Spreadsheet.prototype.buildMenu=function(){var a=this,b=!1,d=$("<div class='tableMenuWrapper' />"),c=$("<a href='#' class='tableMenuButton data_font-style'>Display</a>"),e=$("<div class='tableMenu tableMenuHidden data_font-style'><ul /></div>"),g=null;$(".dataTables_scrollHead th").each(function(a){if($(this).is(".persist, .essential, .optional"))return b=!0,!1});b&&($(".dataTables_scrollHead th").each(function(b){var c=$(this),d=c.attr("class");$("tbody tr").each(function(){var a=$(this).find("th, td").eq(b);
d&&a.addClass(d)});c.is(".persist")||(g=$("<li><input type='checkbox' id='toggleCol"+b+"' value='"+b+"' /> <label for='toggleCol"+b+"'>"+c.html()+"</label></li>"),e.find("ul").append(g),g.find("input").change(function(){var b=parseInt($(this).val()),d=a.dataTable.fnSettings().aoColumns[b].bVisible,e=b+1;a.dataTable.fnSetColumnVis(b,d?!1:!0);c.css("display","table-cell");$("tr > td:nth-child("+e+")").css("display","table-cell")}).bind("updateCheck",function(){var b=parseInt($(this).val());"table-cell"==
c.css("display")?($(this).attr("checked",!0),a.dataTable.fnSetColumnVis(b,!0)):($(this).attr("checked",!1),a.dataTable.fnSetColumnVis(b,!1))}))}),$(e.find("input")).each(function(a){$(this).trigger("updateCheck")}),$(window).bind("orientationchange resize",function(){e.find("input").trigger("updateCheck")}),c.click(function(){e.toggleClass("tableMenuHidden");return!1}),d.append(c).append(e),$(".dataTables_scrollHead table").before(d),$(document).click(function(a){$(a.target).is(e)||$(a.target).is(e.find("*"))||
e.addClass("tableMenuHidden")}))};
RiseVision.Spreadsheet.prototype.formatColumns=function(a){var b=this;$.each(this.columns,function(d,c){if(c.column){var e=$("."+c.column),g=$("."+c.column+":first").parent().children().index($("."+c.column+":first")),f;0<e.length&&(c.header&&a.eq(g).html(c.header),b.isLoading&&c.width&&(f=parseInt(c.width),f=f/b.rsW*100+"%",c.width=f),a.eq(g).css("text-align",c.alignment),e.css("text-align",c.alignment),e.each(function(a){if($(this).text()&&!isNaN($(this).text()))if($(this).text(parseFloat($(this).text()).toFixed(c.decimals)),a=
$(this).text(),"none"==c.sign)$(this).html(Math.abs(a).toFixed(c.decimals));else if("minus"!=c.sign)if("plusMinus"==c.sign)0<parseFloat(a)&&$(this).html("+"+a);else if("parentheses"==c.sign)0>parseFloat(a)&&$(this).html("("+Math.abs(a).toFixed(c.decimals)+")");else if("arrow"==c.sign){var b=$("<img class='arrow'>");b.height($(this).height());$(this).html(Math.abs(a).toFixed(c.decimals));0>parseFloat(a)?b.attr("src","https://s3.amazonaws.com/risecontentlogos/financial/animated-red-arrow.gif"):0<=parseFloat(a)&&
b.attr("src","https://s3.amazonaws.com/risecontentlogos/financial/animated-green-arrow.gif");$(this).prepend(b)}}))}})};RiseVision.Spreadsheet.prototype.setFontSizes=function(){var a=parseInt($(".heading_font-style").css("font-size")),b=parseInt($(".data_font-style").css("font-size")),a=a/16,b=b/16;$(".heading_font-style").css("font-size",a+"em");$(".data_font-style, .tableMenuButton").css("font-size",b+"em")};
RiseVision.Spreadsheet.prototype.loadImage=function(a,b){var d=this,c=new Image;c.onload=function(){b.append(this);d.onImageLoaded()};c.onerror=function(){d.onImageLoaded()};c.src=a};RiseVision.Spreadsheet.prototype.onImageLoaded=function(){this.imagesLoaded++;this.imagesLoaded==this.imageTotal&&this.finalizeCustomLayout()};
RiseVision.Spreadsheet.prototype.configureScrolling=function(){0<$(".dataTables_scrollBody").length?$(".dataTables_scrollBody").infiniteScroll({direction:this.scrollDirection,scrollBy:this.scrollBy,duration:this.duration,speed:this.scrollSpeed,swipingTimeout:this.interactivityTimeout}):0<$("#scrollContainer").length&&$("#scrollContainer").infiniteScroll({direction:this.scrollDirection,scrollBy:this.scrollBy,duration:this.duration,speed:this.scrollSpeed,swipingTimeout:this.interactivityTimeout})};
RiseVision.Spreadsheet.prototype.hasHeadings=function(){for(var a=!1,b=0;b<this.data.getNumberOfColumns();b++){var d=this.data.getColumnLabel(b);if(null!=d&&""!=d){a=!0;break}}return a};RiseVision.Spreadsheet.prototype.renderHeadings=function(){for(var a=$("<thead>"),b=$("<tr>"),d=this.hasHeadings(),c=0;c<this.data.getNumberOfColumns();c++){var e=$("<th class='heading_font-style'>");d&&e.html(this.data.getColumnLabel(c));b.append(e)}a.append(b);$(".page").append(a)};
RiseVision.Spreadsheet.prototype.updateHeadings=function(){for(var a,b=this.hasHeadings(),d=0;d<this.data.getNumberOfColumns();d++)a=$(".page thead th").eq(d),b&&0<a.length&&a.html(this.data.getColumnLabel(d))};RiseVision.Spreadsheet.prototype.renderRow=function(a,b){for(var d=$("<tr class='item'>"),c=0;c<a;c++){var e="",g="",e=this.data.getFormattedValue(b,c);(g=this.data.getProperty(b,c,"style"))&&(g=g.substring(0,g.indexOf("font-family:")));this.addCell(d,e,g,this.cols[c])}$(".page").append(d)};
RiseVision.Spreadsheet.prototype.addCell=function(a,b,d,c){var e=$("<td>");""!=d&&e.attr("style",d);e.addClass("data_font-style "+c);e.html(b);a.append(e)};
RiseVision.Spreadsheet.prototype.addRows=function(){for(var a=0,b=0,d=this.data.getNumberOfRows(),c=this.data.getNumberOfColumns(),e;a<d;a++){e=[];for(b=0;b<c;b++)e.push(this.data.getFormattedValue(a,b));this.dataTable.fnAddData(e)}$(".dataTables_scrollBody table tbody tr").addClass("item");$(".dataTables_scrollBody table tbody tr td").addClass("data_font-style");for(b=0;b<c;b++)$(".dataTables_scrollBody table tbody tr td:nth-child("+(b+1)+")").addClass(this.cols[b]);this.formatColumns($(".page th"))};
RiseVision.Spreadsheet.prototype.checkForNoData=function(){return"NODATA"==this.data.getColumnId(0)?(!this.noDataFound&&this.showStale&&(this.noDataFound=!0,$(".item").contents().each(function(a){$(this).html($(this).html()+"*")})),this.isLoading||(0<$(".dataTables_scrollBody").length?$(".dataTables_scrollBody").infiniteScroll.start():0<$("#scrollContainer").length&&$("#scrollContainer").infiniteScroll.start()),!0):this.noDataFound=!1};
RiseVision.Spreadsheet.prototype.handleConditions=function(){var a=this,b=-1;0<this.interval&&(this.conditions||(this.conditions={}),$.each(this.columns,function(d,c){"changeUp"==c.condition||"changeDown"==c.condition?a.conditions.columns&&($.each(a.conditions.columns,function(a,d){if(d.column==c.column)return b=a,!1}),a.checkConditions(a.conditions.columns[b],c.condition)):"valuePositive"!=c.condition&&"valueNegative"!=c.condition||a.checkSigns(c.column,c.condition)}),this.saveConditions())};
RiseVision.Spreadsheet.prototype.checkSigns=function(a,b){for(var d=$("."+a+":first").parent().children().index($("."+a+":first")),c=0,e=this.data.getNumberOfRows();c<e;c++){var g=this.data.getValue(c,d);isNaN(g)&&(g=g.replace(/[^0-9\.-]+/g,""),g=parseFloat(g));if(!isNaN(g)){var f=$("."+this.cols[d]).eq(c);"valuePositive"==b?0<=g?f.addClass("valuePositivePositive"):f.addClass("valuePositiveNegative"):0>g?f.addClass("valueNegativeNegative"):f.addClass("valueNegativePositive")}}};
RiseVision.Spreadsheet.prototype.checkConditions=function(a,b){for(var d=$("."+a.column+":first").parent().children().index($("."+a.column+":first")),c=0,e=this.data.getNumberOfRows();c<e;c++){var g=this.data.getValue(c,d),f=a.values[c];isNaN(g)&&(g=g.replace(/[^0-9\.-]+/g,""),g=parseFloat(g));isNaN(f)&&(f=f.replace(/[^0-9\.-]+/g,""),f=parseFloat(f));if(g!=f&&!isNaN(g)&&!isNaN(f)){var h=$("."+a.column).eq(c);"changeUp"==b?g>f?h.addClass("changeUpIncrease"):h.addClass("changeUpDecrease"):g<f?h.addClass("changeDownDecrease"):
h.addClass("changeDownIncrease")}}};RiseVision.Spreadsheet.prototype.saveConditions=function(){var a=this;i=0;a.conditions.columns=[];$.each(this.columns,function(b,d){if("changeUp"==d.condition||"changeDown"==d.condition)a.conditions.columns.push({column:d.column,values:[]}),a.saveCondition(a.conditions.columns[i].values,d.column),i++})};
RiseVision.Spreadsheet.prototype.saveCondition=function(a,b){for(var d=$("."+b+":first").parent().children().index($("."+b+":first")),c=0,e=this.data.getNumberOfRows();c<e;c++)a.push(this.data.getValue(c,d))};RiseVision.Spreadsheet.prototype.isHorizontal=function(){return"rtl"==this.scrollDirection||"ltr"==this.scrollDirection};
RiseVision.Spreadsheet.prototype.initHorizontalScroll=function(){var a=this,b=document.styleSheets[2].cssRules;this.viz.getData({url:this.url,refreshInterval:this.interval,callback:function(d){for(var c=d.getNumberOfRows(),e="",g,f=0;f<b.length;f++)if(".data_font-style"==b[f].selectorText){e=b[f].cssText;break}a.isLoading&&($("#container").remove(),a.isLoading=!1);if(null==a.horizontalScroll){if(0<c){g=[];for(f=0;f<c;f++)g.push(a.getHorizontalScrollData(f,d,e));a.horizontalScroll=new RiseVision.Common.HorizontalScroll({width:a.rsW,
height:a.rsH,scrollBy:a.prefs.getString("scrollBy"),scrollDirection:a.prefs.getString("scrollDirection"),duration:1E3*a.prefs.getInt("duration"),speed:a.scrollSpeed,interactivityTimeout:a.interactivityTimeout,spacing:a.prefs.getInt("spacing")},g);$(a.horizontalScroll).bind({done:function(){doneEvent()}});setTimeout(function(){a.horizontalScroll.initialize()},1E3)}}else if(0==c)a.horizontalScroll.clear();else for(f=0;f<c;f++)g=a.getHorizontalScrollData(f,d,e),a.horizontalScroll.updateItem(f,g)}})};
RiseVision.Spreadsheet.prototype.getHorizontalScrollData=function(a,b,d){for(var c=b.getNumberOfColumns(),e="",g=[],f=0;f<c;f++)e=""==e?b.getFormattedValue(a,f):e+" "+b.getFormattedValue(a,f);g.push({type:"text",value:e,fontRule:d});return g};
RiseVision.Spreadsheet.prototype.play=function(){this.isHorizontal()||(0<$(".dataTables_scrollBody").length?$(".dataTables_scrollBody").infiniteScroll.start():0<$("#scrollContainer").length&&$("#scrollContainer").infiniteScroll.start());this.isPaused&&(this.isPaused=!1,this.isHorizontal()&&this.horizontalScroll.tick())};
RiseVision.Spreadsheet.prototype.pause=function(){this.isPaused=!0;this.isHorizontal()?this.horizontalScroll.pause():this.isLoading||(0<$(".dataTables_scrollBody").length?$(".dataTables_scrollBody").infiniteScroll.pause():0<$("#scrollContainer").length&&$("#scrollContainer").infiniteScroll.pause())};