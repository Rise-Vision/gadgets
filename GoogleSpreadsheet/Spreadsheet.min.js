var RiseVision=RiseVision||{};RiseVision.Spreadsheet={},RiseVision.Spreadsheet=function(){var a=new gadgets.Prefs,b="https://s3.amazonaws.com/Gadget-Spreadsheet/layouts/Table/Table.xml",c=unescape(a.getString("layoutURL"));this.prefs=a,this.url=unescape(a.getString("url")),this.useLayoutURL=a.getBool("useLayoutURL"),this.isDefaultLayout=!(!a.getBool("useLayoutURL")||c&&c!=b),this.layoutURL=c?c:b,this.scrollBy=a.getString("scrollBy"),this.scrollDirection=a.getString("scrollDirection"),this.duration=1e3*a.getInt("duration"),this.scrollSpeed=a.getString("scrollSpeed"),this.interactivityTimeout=1e3*a.getInt("interactivityTimeout"),this.spacing=parseInt(a.getInt("spacing")/2)+"px",this.colPadding=parseInt(a.getInt("colPadding")/2)+"px",this.colCount=a.getInt("colCount"),this.interval=a.getInt("interval"),this.showStale=a.getBool("showStale"),this.condition1=a.getInt("condition1"),this.condition2=a.getInt("condition2"),this.condition3=a.getInt("condition3"),this.condition1Action=a.getString("condition1Action"),this.condition2Action=a.getString("condition2Action"),this.condition3Action=a.getString("condition3Action"),this.rsW=a.getInt("rsW"),this.rsH=a.getInt("rsH"),this.isLoading=!0,this.isPaused=!0,this.noDataFound=!1,this.columns={},this.sortConfig={bDestroy:!0,bFilter:!1,bInfo:!1,bLengthChange:!1,bPaginate:!1,bSort:!1,sScrollY:"500px"},this.settings=new RiseVision.Common.Settings,this.picker=new RiseVision.Common.Picker,this.viz=new RiseVision.Common.Visualization,this.baseURL="",this.headerRows="0",this.range=""},RiseVision.Spreadsheet.prototype.initSettings=function(){var a=this;this.url&&($("#url").val(this.url),""!=prefs.getString("docID")&&(this.docID=prefs.getString("docID"),this.picker.getSheets({docID:prefs.getString("docID"),callback:function(b){null!=b&&(a.onSheetsLoaded(b),$("#sheet").val(unescape(prefs.getString("sheet"))),$("li.more").show())}}),$("input[type='radio'][name='cells']").each(function(){$(this).val()==prefs.getString("cells")&&($(this).attr("checked","checked"),"range"==$(this).val()&&$("#rangeContainer").show())}),$("#range").val(prefs.getString("range")),$("#headerRows").val(prefs.getString("headerRows")),this.range=prefs.getString("range"),this.headerRows=prefs.getString("headerRows")),$("#interval").val(this.interval),$("#scrollBy").val(this.scrollBy),$("#scrollDirection").val(this.scrollDirection),$("#scrollSpeed").val(this.scrollSpeed),$("#scrollResumes").val(prefs.getInt("interactivityTimeout")),$("#rowPadding").val(prefs.getInt("spacing")),$("#colPadding").val(prefs.getInt("colPadding")),$("#colCount").val(this.colCount),$("#backgroundColor").val(prefs.getString("backgroundColor")),$("#rowColor").val(prefs.getString("rowColor")),$("#alternateRowColor").val(prefs.getString("alternateRowColor")),$("#scrollHold").val(prefs.getInt("duration")),$("#useDefaultURL").attr("checked",!this.useLayoutURL),$("#layoutURL").val(this.layoutURL)),this.onScrollByChanged(),this.onScrollDirectionChanged(),this.onLayoutURLChanged(),this.buildColumnFormatUI(),$("#scrollBy").change(function(){a.onScrollByChanged()}),$("#scrollDirection").change(function(){a.onScrollDirectionChanged()}),$("#useDefaultURL").click(function(){a.onLayoutURLChanged()}),$("#colCount").change(function(){a.buildColumnFormatUI()}),$("#googleDrive").click(function(){a.picker.showPicker($(this).data("for"),google.picker.ViewId.SPREADSHEETS)}),$("input[name='cells']").change(function(){var b=$(this).val();"range"==b?(a.range=$("#range").val(),$("#rangeContainer").show()):(a.range="",$("#rangeContainer").hide()),a.showDataURLOptions()}),$("#range").blur(function(){a.range=$(this).val(),a.showDataURLOptions()}),$("#headerRows").change(function(){a.headerRows=$(this).val(),a.showDataURLOptions()}),$("#sheet").change(function(){a.showDataURLOptions()}),gadgets.rpc.call("","rscmd_getAdditionalParams",function(b){if(b){b=JSON.parse(b),a.populateColor($("#backgroundColor"),prefs.getString("backgroundColor")),a.populateColor($("#rowColor"),prefs.getString("rowColor")),a.populateColor($("#alternateRowColor"),prefs.getString("alternateRowColor")),$("#heading_font-style").text(b.heading_font),$("#heading_font-style").data("css",b["heading_font-style"]),$("#data_font-style").text(b.data_font),$("#data_font-style").data("css",b["data_font-style"]);for(var c=0;c<parseInt($("#colCount").val());c++)a.initFormatSettings(c+1,b.columns[c])}$("#settings").show()})},RiseVision.Spreadsheet.prototype.initFormatSettings=function(a,b){$("#column"+a).val(b.column),$("#alignment"+a).val(b.alignment),$("#width"+a).val(b.width),$("#decimals"+a).val(b.decimals),$("#sign"+a).val(b.sign),$("#condition"+a+"Action").val(b.condition),$("#headerText"+a).val(b.header)},RiseVision.Spreadsheet.prototype.onScrollByChanged=function(){"continuous"==$("#scrollBy").val()?$("li.scrollHold").hide():$("li.scrollHold").show()},RiseVision.Spreadsheet.prototype.onScrollDirectionChanged=function(){var a=$("#scrollDirection").val();"none"==a?$("li.scroll").hide():$("li.scroll").show(),"rtl"==a||"ltr"==a?$("li.headingFont, li.useDefaultURL, li.layoutURL").hide():($("li.headingFont, li.useDefaultURL").show(),$("#useDefaultURL").is(":checked")||$("li.layoutURL").show())},RiseVision.Spreadsheet.prototype.onLayoutURLChanged=function(){$("#useDefaultURL").is(":checked")?$("li.layoutURL").hide():$("li.useDefaultURL").is(":visible")&&$("li.layoutURL").show()},RiseVision.Spreadsheet.prototype.buildColumnFormatUI=function(){var a=parseInt($("#colCount").val()),b=$(".column").length;if(isNaN(a)||0==a)$(".formatting").hide();else if(a==b)$(".formatting").show();else if(a<b)$(".formatting").hide(),$(".formatting:lt("+a+")").show();else{$(".formatting").show();for(var c=b+1;c<=a;c++){var d=$("<li></li>"),e=$("<ol class='formatting drillDown'></ol>");$(e).append($("<li></li>").append("<label for='column"+c+"'><a href='#' class='tooltip'>Column*:<span>Column of the spreadsheet that the formatting should apply to (e.g. A or AW)</span></a></label>").append("<input id='column"+c+"' name='column"+c+"' type='text' class='column short' />")).append($("<li></li>").append("<label for='alignment"+c+"'>Alignment:</label>").append("<select id='alignment"+c+"' name='alignment"+c+"' class='alignment short'><option value='left' selected='selected'>Left</option><option value='center'>Center</option><option value='right'>Right</option></select>")).append($("<li></li>").append("<label for='width"+c+"'>Width (pixels):</label>").append("<input id='width"+c+"' name='width"+c+"' type='text' class='width short' value='100' />")).append($("<li></li>").append("<label for='decimals"+c+"'>Decimals:</label>").append("<select id='decimals"+c+"' name='decimals"+c+"' class='decimals short'><option value='0'>0</option><option value='1'>1</option><option value='2' selected='selected'>2</option><option value='3'>3</option><option value='4'>4</option></select>")).append($("<li></li>").append("<label for='sign"+c+"'><a href='#' class='tooltip'>Sign:<span>How to display positive and negative numbers</span></a></label>").append("<select id='sign"+c+"' name='sign"+c+"' class='sign short'><option value='none' selected='selected'>None</option><option value='minus'>-</option><option value='plusMinus'>+/-</option><option value='parentheses'>( )</option><option value='arrow'>Arrow</option></select>")).append($("<li></li>").append("<label for='condition"+c+"'><a href='#' class='tooltip'>Color Condition:<span>Whether or not to use color to indicate positive or negative values, or to indicate a change in value</span></a></label>").append("<select id='condition"+c+"Action' name='condition"+c+"Action' class='condition medium'><option value='none' selected='selected'>None</option><option value='changeUp'>Change Up Green Down Red</option><option value='changeDown'>Change Down Green Up Red</option><option value='valuePositive'>Value Positive Green Negative Red</option><option value='valueNegative'>Value Negative Green Positive Red</option></select>")).append($("<li></li>").append("<label for='headerText"+c+c+"'><a href='#' class='tooltip'>Header Text:<span>Custom header text. If not specified, the header from the spreadsheet will be used.</span></a></label>").append("<input id='headerText"+c+"' name='headerText"+c+"' type='text' class='headerText short' />")),d.append(e),$("#backgroundColor").parent().before(d)}}},RiseVision.Spreadsheet.prototype.showColorPicker=function(a){gadgets.rpc.call("","rscmd_openColorPicker",null,a,$("#"+a).val())},RiseVision.Spreadsheet.prototype.showFontSelector=function(a){gadgets.rpc.call("","rscmd_openFontSelector",null,a,$("#"+a).data("css"))},RiseVision.Spreadsheet.prototype.populateColor=function(a,b){a.val(b),a.css("background-color",b)},RiseVision.Spreadsheet.prototype.setColor=function(a,b){$("#"+a).val(b),$("#"+a).css("background-color",b)},RiseVision.Spreadsheet.prototype.setFont=function(a,b,c){$("#"+a).data("css",b),$("#"+a).text(c)},RiseVision.Spreadsheet.prototype.setURL=function(a,b){$("#"+a).val(""),spreadsheet.picker.getSheets({docID:b.id,callback:function(a){null!=a&&(spreadsheet.docID=b.id,spreadsheet.onSheetsLoaded(a),spreadsheet.showDataURLOptions())}})},RiseVision.Spreadsheet.prototype.onSheetsLoaded=function(a){$("#sheet").empty();for(var b=0;b<a.length;b++)document.getElementById("sheet").add(a[b])},RiseVision.Spreadsheet.prototype.showDataURLOptions=function(){var a=this.picker.getURL({baseURL:$("#sheet").val(),headerRows:this.headerRows,range:this.range});$(".errors").empty(),$(".errors").css({display:"none"}),$("#url").val(a),$("li.more").show()},RiseVision.Spreadsheet.prototype.getSettings=function(){var f,a=!1,b=document.getElementsByClassName("errors")[0],c="",e=null;if($(".errors").empty(),$(".errors").css({display:"none"}),""!=$("#url").val())e={url:$("#url").val()+($("#url").val().indexOf("?")==-1?"?":"&")+"dummy="+Math.ceil(100*Math.random()),refreshInterval:0,callback:function(d){if(null==d)return $(".errors").append("The spreadsheet could not be read. Please ensure that the Data URL is correct and that the spreadsheet has been published to the web."),$(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null;if(a=!!spreadsheet.settings.validateRequired($("#url"),b,"Data URL")||a,a=!!spreadsheet.settings.validateNumeric($("#interval"),b,"Data Refresh")||a,a=!!spreadsheet.settings.validateNumeric($("#scrollHold"),b,"Scroll Hold")||a,a=!!spreadsheet.settings.validateNumeric($("#scrollResumes"),b,"Scroll Resumes")||a,a=!!spreadsheet.settings.validateNumeric($("#rowPadding"),b,"Row Padding")||a,a=!!spreadsheet.settings.validateNumeric($("#colPadding"),b,"Column Padding")||a,parseInt($("#colCount").val())>0&&($(".column").each(function(c){a=!!spreadsheet.settings.validateRequired($(this),b,"Column")||a}),$(".width").each(function(c){a=!!spreadsheet.settings.validateNumeric($(this),b,"Column Width")||a})),a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null;c="up_url="+escape($("#url").val()),null!=spreadsheet.docID&&(c+="&up_docID="+spreadsheet.docID,f=$("input[type='radio'][name='cells']:checked"),f.length>0&&(c+="&up_cells="+f.val()+"&up_range="+$("#range").val()),c+="&up_sheet="+escape($("#sheet").val())+"&up_headerRows="+$("#headerRows").val()),c+="&up_interval="+$("#interval").val()+"&up_scrollBy="+$("#scrollBy").val()+"&up_duration="+$("#scrollHold").val()+"&up_scrollDirection="+$("#scrollDirection").val()+"&up_scrollSpeed="+$("#scrollSpeed").val()+"&up_interactivityTimeout="+$("#scrollResumes").val()+"&up_spacing="+$("#rowPadding").val()+"&up_colPadding="+$("#colPadding").val()+"&up_colCount="+$("#colCount").val()+"&up_backgroundColor="+$("#backgroundColor").val()+"&up_rowColor="+$("#rowColor").val()+"&up_alternateRowColor="+$("#alternateRowColor").val(),c+=$("#useDefaultURL").is(":checked")?"&up_useLayoutURL=false":"&up_useLayoutURL=true",$("#layoutURL").is(":visible")&&(c+="&up_layoutURL="+escape($("#layoutURL").val()));for(var e=[],g=0;g<parseInt($("#colCount").val());g++)spreadsheet.saveFormatSettings(g+1,e);var h={heading_font:$("#heading_font-style").text(),"heading_font-style":$("#heading_font-style").data("css"),data_font:$("#data_font-style").text(),"data_font-style":$("#data_font-style").data("css"),columns:e},i={params:c,additionalParams:JSON.stringify(h)};gadgets.rpc.call("","rscmd_saveSettings",null,i)}},spreadsheet.viz.getData(e);else if(a=!!spreadsheet.settings.validateRequired($("#url"),b,"Data URL")||a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null},RiseVision.Spreadsheet.prototype.saveFormatSettings=function(a,b){b.push({column:$("#column"+a).val(),alignment:$("#alignment"+a).val(),width:$("#width"+a).val(),decimals:$("#decimals"+a).val(),sign:$("#sign"+a).val(),condition:$("#condition"+a+"Action").val(),header:$("#headerText"+a).val()})},RiseVision.Spreadsheet.prototype.getAdditionalParams=function(a,b){if("additionalParams"==a&&b){var c=document.createElement("style");b=JSON.parse(b),c.appendChild(document.createTextNode(b["heading_font-style"])),c.appendChild(document.createTextNode(b["data_font-style"])),c.appendChild(document.createTextNode("a:active"+b["data_font-style"])),document.getElementsByTagName("head")[0].appendChild(c),spreadsheet.columns=b.columns}spreadsheet.initialize()},RiseVision.Spreadsheet.prototype.initialize=function(){var a=this,b={};this.useLayoutURL||this.isHorizontal()||a.loadCSS("https://s3.amazonaws.com/Gadget-Spreadsheet/layouts/Table/Table.css"),this.useLayoutURL?(b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(encodeURI(this.layoutURL),function(b){var c=b.data;if(c.getElementsByTagName("Style").length>0)if(c.getElementsByTagName("Style")[0].getAttribute("url"))a.loadCSS(c.getElementsByTagName("Style")[0].getAttribute("url"));else{var e=document.getElementsByTagName("head")[0],f=document.createElement("style");f.innerHTML=c.getElementsByTagName("Style")[0].childNodes[1].nodeValue,e.appendChild(f)}a.layout=c.getElementsByTagName("Layout")[0].childNodes[1].nodeValue,a.getData()},b)):this.getData()},RiseVision.Spreadsheet.prototype.loadCSS=function(a){var b=$("<link>");b.attr({type:"text/css",rel:"stylesheet",href:a}),$("head").append(b)},RiseVision.Spreadsheet.prototype.getData=function(a){var b=this;if(a&&(this.url=a),this.isHorizontal())this.initHorizontalScroll();else{var c={url:this.url,refreshInterval:this.interval,callback:function(a){b.onDataLoaded.call(b,a)}};this.viz.getData(c)}},RiseVision.Spreadsheet.prototype.onDataLoaded=function(a){null==a?this.isLoading&&(this.isLoading=!1,readyEvent()):(this.pause(),this.data=a,this.useLayoutURL?this.showCustomLayout():this.showDefaultLayout())},RiseVision.Spreadsheet.prototype.showDefaultLayout=function(){if(!this.checkForNoData()){this.isLoading||null==this.dataTable||this.dataTable.fnClearTable(!1),this.cols=[];for(var a=0,b=this.data.getNumberOfColumns();a<b;a++)this.cols.push(this.data.getColumnId(a));this.isLoading?this.createDataTable():$(".dataTables_scrollHeadInner .page th").length!=this.data.getNumberOfColumns()?(this.dataTable.fnDestroy(!0),this.dataTable=null,this.createDataTable()):(this.updateHeadings(),this.addRows()),$(".dataTables_scrollHead table tr th, td").css({"padding-top":this.spacing,"padding-bottom":this.spacing,"padding-left":this.colPadding,"padding-right":this.colPadding}),$(".dataTables_scrollHead table tr th:first-child, td:first-child").css({"padding-left":"10px"}),$(".dataTables_scrollHead table tr th:last-child, td:last-child").css({"padding-right":"10px"}),this.setFontSizes(),this.configureScrolling(),this.handleConditions(),this.isLoading?(this.isLoading=!1,readyEvent()):$(".dataTables_scrollBody").infiniteScroll.start()}},RiseVision.Spreadsheet.prototype.createDataTable=function(){var b,a=this;$("#container").width(prefs.getString("rsW")),$("#container").height(prefs.getString("rsH")),$(".page").empty(),this.data.getNumberOfColumns()>0&&this.renderHeadings();for(var c=0,d=this.data.getNumberOfRows();c<d;c++)this.renderRow(this.data.getNumberOfColumns(),c);this.formatColumns($(".page th")),this.sortConfig.aoColumnDefs=[],$.each(this.columns,function(c,d){d.width&&(b=$("."+d.column+":first").parent().children().index($("."+d.column+":first")),a.sortConfig.aoColumnDefs.push({sWidth:d.width,aTargets:[b]}))}),this.dataTable=$(".page").dataTable(this.sortConfig),$(".dataTables_scrollBody").height(($("#container").outerHeight(!0)-$(".dataTables_scrollHead").height())/this.rsH*100+"%")},RiseVision.Spreadsheet.prototype.showCustomLayout=function(){if(!this.checkForNoData()){var b=null,c=$("<thead />"),d=null;this.cols=[],this.imagesLoaded=0,$("#container").empty(),$("#container").append(this.layout),b=$("#header table tbody").html(),d=$(".repeat");for(var e=0;e<this.data.getNumberOfColumns();e++)this.cols.push(this.data.getColumnId(e));this.imageTotal=$(".image").length*this.data.getNumberOfRows()+$(".qrCode").length*this.data.getNumberOfRows();for(var f=0,g=this.data.getNumberOfRows();f<g;f++){f>0&&d.parent().append(d.clone());for(var e=0,h=this.cols.length;e<h;e++){var i=$("."+this.cols[e]+":last");i&&(i.hasClass("image")?this.loadImage(this.data.getValue(f,e),i):i.hasClass("qrCode")?this.data.getValue(f,e)?this.loadImage("https://chart.googleapis.com/chart?cht=qr&chs=100x100&chld=H|0&chl="+encodeURIComponent(this.data.getValue(f,e)),i):this.imageTotal--:"date"==this.data.getColumnType(e)?i.html(this.data.getFormattedValue(f,e)):i.html(this.data.getFormattedValue(f,e)))}}b&&(c.append(b),$(".page").prepend(c),$("#header").remove()),0==this.imageTotal&&this.finalizeCustomLayout()}},RiseVision.Spreadsheet.prototype.finalizeCustomLayout=function(){$(this.layout).find("table").length>0&&(this.formatColumns($(".page th")),this.dataTable=$(".page").dataTable(this.sortConfig),$(".dataTables_scrollHead table tr th, td").css({"padding-top":this.spacing,"padding-bottom":this.spacing,"padding-left":this.colPadding,"padding-right":this.colPadding}),$(".dataTables_scrollHead table tr th:first-child, td:first-child").css({"padding-left":"10px"}),$(".dataTables_scrollHead table tr th:last-child, td:last-child").css({"padding-right":"10px"}),$(".dataTables_scrollBody").height(($("#container").outerHeight(!0)-$(".dataTables_scrollHead").height())/this.rsH*100+"%")),this.setFontSizes(),this.buildMenu(),this.handleConditions(),this.configureScrolling(),this.isLoading?(this.isLoading=!1,readyEvent()):$(".dataTables_scrollBody").infiniteScroll.start()},RiseVision.Spreadsheet.prototype.buildMenu=function(){var a=this,b=!1,c=$("<div class='tableMenuWrapper' />"),d=$("<a href='#' class='tableMenuButton data_font-style'>Display</a>"),e=$("<div class='tableMenu tableMenuHidden data_font-style'><ul /></div>"),f=null;$(".dataTables_scrollHead th").each(function(a){if($(this).is(".persist, .essential, .optional"))return b=!0,!1}),b&&($(".dataTables_scrollHead th").each(function(b){var c=$(this),d=c.attr("class");$("tbody tr").each(function(){var a=$(this).find("th, td").eq(b);d&&a.addClass(d)}),c.is(".persist")||(f=$("<li><input type='checkbox' id='toggleCol"+b+"' value='"+b+"' /> <label for='toggleCol"+b+"'>"+c.html()+"</label></li>"),e.find("ul").append(f),f.find("input").change(function(){var b=parseInt($(this).val()),d=a.dataTable.fnSettings().aoColumns[b].bVisible,e=b+1;a.dataTable.fnSetColumnVis(b,!d),c.css("display","table-cell"),$("tr > td:nth-child("+e+")").css("display","table-cell")}).bind("updateCheck",function(){var b=parseInt($(this).val());"table-cell"==c.css("display")?($(this).attr("checked",!0),a.dataTable.fnSetColumnVis(b,!0)):($(this).attr("checked",!1),a.dataTable.fnSetColumnVis(b,!1))}))}),$(e.find("input")).each(function(a){$(this).trigger("updateCheck")}),$(window).bind("orientationchange resize",function(){e.find("input").trigger("updateCheck")}),d.click(function(){return e.toggleClass("tableMenuHidden"),!1}),c.append(d).append(e),$(".dataTables_scrollHead table").before(c),$(document).click(function(a){$(a.target).is(e)||$(a.target).is(e.find("*"))||e.addClass("tableMenuHidden")}))},RiseVision.Spreadsheet.prototype.formatColumns=function(a){var b=this,c="https://s3.amazonaws.com/risecontentlogos/financial/";$.each(this.columns,function(d,e){if(e.column){var h,f=$("."+e.column),g=$("."+e.column+":first").parent().children().index($("."+e.column+":first"));f.length>0&&(e.header&&a.eq(g).html(e.header),b.isLoading&&e.width&&(h=parseInt(e.width),h=h/b.rsW*100+"%",e.width=h),a.eq(g).css("text-align",e.alignment),f.css("text-align",e.alignment),f.each(function(a){if($(this).text()&&!isNaN($(this).text())){var b;if($(this).text(parseFloat($(this).text()).toFixed(e.decimals)),b=$(this).text(),"none"==e.sign)$(this).html(Math.abs(b).toFixed(e.decimals));else if("minus"==e.sign);else if("plusMinus"==e.sign)parseFloat(b)>0&&$(this).html("+"+b);else if("parentheses"==e.sign)parseFloat(b)<0&&$(this).html("("+Math.abs(b).toFixed(e.decimals)+")");else if("arrow"==e.sign){var d=$("<img class='arrow'>");d.height($(this).height()),$(this).html(Math.abs(b).toFixed(e.decimals)),parseFloat(b)<0?d.attr("src",c+"animated-red-arrow.gif"):parseFloat(b)>=0&&d.attr("src",c+"animated-green-arrow.gif"),$(this).prepend(d)}}}))}})},RiseVision.Spreadsheet.prototype.setFontSizes=function(){var a=parseInt($(".heading_font-style").css("font-size")),b=parseInt($(".data_font-style").css("font-size"));a/=16,b/=16,$(".heading_font-style").css("font-size",a+"em"),$(".data_font-style, .tableMenuButton").css("font-size",b+"em")},RiseVision.Spreadsheet.prototype.loadImage=function(a,b){var c=this,d=new Image;d.onload=function(){b.append(this),c.onImageLoaded()},d.onerror=function(){c.onImageLoaded()},d.src=a},RiseVision.Spreadsheet.prototype.onImageLoaded=function(){this.imagesLoaded++,this.imagesLoaded==this.imageTotal&&this.finalizeCustomLayout()},RiseVision.Spreadsheet.prototype.configureScrolling=function(){$(".dataTables_scrollBody").length>0?$(".dataTables_scrollBody").infiniteScroll({direction:this.scrollDirection,scrollBy:this.scrollBy,duration:this.duration,speed:this.scrollSpeed,swipingTimeout:this.interactivityTimeout}):$("#scrollContainer").length>0&&$("#scrollContainer").infiniteScroll({direction:this.scrollDirection,scrollBy:this.scrollBy,duration:this.duration,speed:this.scrollSpeed,swipingTimeout:this.interactivityTimeout})},RiseVision.Spreadsheet.prototype.hasHeadings=function(){for(var a=!1,b=0;b<this.data.getNumberOfColumns();b++){var c=this.data.getColumnLabel(b);if(null!=c&&""!=c){a=!0;break}}return a},RiseVision.Spreadsheet.prototype.renderHeadings=function(){for(var a=$("<thead>"),b=$("<tr>"),c=this.hasHeadings(),d=0;d<this.data.getNumberOfColumns();d++){var e=$("<th class='heading_font-style'>");c&&e.html(this.data.getColumnLabel(d)),b.append(e)}a.append(b),$(".page").append(a)},RiseVision.Spreadsheet.prototype.updateHeadings=function(){for(var a,b=this.hasHeadings(),c=0;c<this.data.getNumberOfColumns();c++)a=$(".page thead th").eq(c),b&&a.length>0&&a.html(this.data.getColumnLabel(c))},RiseVision.Spreadsheet.prototype.renderRow=function(a,b){for(var c=$("<tr class='item'>"),d=0;d<a;d++){var e="",f="";e=this.data.getFormattedValue(b,d),f=this.data.getProperty(b,d,"style"),f&&(f=f.substring(0,f.indexOf("font-family:"))),this.addCell(c,e,f,this.cols[d])}$(".page").append(c)},RiseVision.Spreadsheet.prototype.addCell=function(a,b,c,d){var e=$("<td>");""!=c&&e.attr("style",c),e.addClass("data_font-style "+d),e.html(b),a.append(e)},RiseVision.Spreadsheet.prototype.addRows=function(){for(var e,a=0,b=0,c=this.data.getNumberOfRows(),d=this.data.getNumberOfColumns();a<c;a++){for(e=[],b=0;b<d;b++)e.push(this.data.getFormattedValue(a,b));this.dataTable.fnAddData(e)}for($(".dataTables_scrollBody table tbody tr").addClass("item"),$(".dataTables_scrollBody table tbody tr td").addClass("data_font-style"),b=0;b<d;b++)$(".dataTables_scrollBody table tbody tr td:nth-child("+(b+1)+")").addClass(this.cols[b]);this.formatColumns($(".page th"))},RiseVision.Spreadsheet.prototype.checkForNoData=function(){return"NODATA"==this.data.getColumnId(0)?(!this.noDataFound&&this.showStale&&(this.noDataFound=!0,$(".item").contents().each(function(a){$(this).html($(this).html()+"*")})),this.isLoading||($(".dataTables_scrollBody").length>0?$(".dataTables_scrollBody").infiniteScroll.start():$("#scrollContainer").length>0&&$("#scrollContainer").infiniteScroll.start()),!0):(this.noDataFound=!1,!1)},RiseVision.Spreadsheet.prototype.handleConditions=function(){var a=this,b=-1;this.interval>0&&(this.conditions||(this.conditions={}),$.each(this.columns,function(c,d){"changeUp"==d.condition||"changeDown"==d.condition?a.conditions.columns&&($.each(a.conditions.columns,function(a,c){if(c.column==d.column)return b=a,!1}),a.checkConditions(a.conditions.columns[b],d.condition)):"valuePositive"!=d.condition&&"valueNegative"!=d.condition||a.checkSigns(d.column,d.condition)}),this.saveConditions())},RiseVision.Spreadsheet.prototype.checkSigns=function(a,b){for(var c=$("."+a+":first").parent().children().index($("."+a+":first")),d=0,e=this.data.getNumberOfRows();d<e;d++){var f=this.data.getValue(d,c);if(isNaN(f)&&(f=f.replace(/[^0-9\.-]+/g,""),f=parseFloat(f)),!isNaN(f)){var g=$("."+this.cols[c]).eq(d);"valuePositive"==b?f>=0?g.addClass("valuePositivePositive"):g.addClass("valuePositiveNegative"):f<0?g.addClass("valueNegativeNegative"):g.addClass("valueNegativePositive")}}},RiseVision.Spreadsheet.prototype.checkConditions=function(a,b){for(var c=$("."+a.column+":first").parent().children().index($("."+a.column+":first")),d=0,e=this.data.getNumberOfRows();d<e;d++){var f=this.data.getValue(d,c),g=a.values[d];if(isNaN(f)&&(f=f.replace(/[^0-9\.-]+/g,""),f=parseFloat(f)),isNaN(g)&&(g=g.replace(/[^0-9\.-]+/g,""),g=parseFloat(g)),f!=g&&!isNaN(f)&&!isNaN(g)){var h=$("."+a.column).eq(d);"changeUp"==b?f>g?h.addClass("changeUpIncrease"):h.addClass("changeUpDecrease"):f<g?h.addClass("changeDownDecrease"):h.addClass("changeDownIncrease")}}},RiseVision.Spreadsheet.prototype.saveConditions=function(){var a=this;i=0,a.conditions.columns=[],$.each(this.columns,function(b,c){"changeUp"!=c.condition&&"changeDown"!=c.condition||(a.conditions.columns.push({column:c.column,values:[]}),a.saveCondition(a.conditions.columns[i].values,c.column),i++)})},RiseVision.Spreadsheet.prototype.saveCondition=function(a,b){for(var c=$("."+b+":first").parent().children().index($("."+b+":first")),d=0,e=this.data.getNumberOfRows();d<e;d++)a.push(this.data.getValue(d,c))},RiseVision.Spreadsheet.prototype.isHorizontal=function(){return"rtl"==this.scrollDirection||"ltr"==this.scrollDirection},RiseVision.Spreadsheet.prototype.initHorizontalScroll=function(){var a=this,b=document.styleSheets[2].cssRules,c={url:this.url,refreshInterval:this.interval,callback:function(c){for(var f,d=c.getNumberOfRows(),e="",g=0;g<b.length;g++)if(".data_font-style"==b[g].selectorText){e=b[g].cssText;break}if(a.isLoading&&($("#container").remove(),a.isLoading=!1),null==a.horizontalScroll){if(d>0){for(var h=[],i=0;i<d;i++)h.push(a.getHorizontalScrollData(i,c,e));a.horizontalScroll=new RiseVision.Common.HorizontalScroll({width:a.rsW,height:a.rsH,scrollBy:a.prefs.getString("scrollBy"),scrollDirection:a.prefs.getString("scrollDirection"),duration:1e3*a.prefs.getInt("duration"),speed:a.scrollSpeed,interactivityTimeout:a.interactivityTimeout,spacing:a.prefs.getInt("spacing")},h),$(a.horizontalScroll).bind({done:function(){doneEvent()}}),setTimeout(function(){a.horizontalScroll.initialize()},1e3)}}else if(0==d)a.horizontalScroll.clear();else for(var i=0;i<d;i++)f=a.getHorizontalScrollData(i,c,e),a.horizontalScroll.updateItem(i,f)}};this.viz.getData(c)},RiseVision.Spreadsheet.prototype.getHorizontalScrollData=function(a,b,c){for(var d=b.getNumberOfColumns(),e="",f=[],g=0;g<d;g++)e=""==e?b.getFormattedValue(a,g):e+" "+b.getFormattedValue(a,g);return f.push({type:"text",value:e,fontRule:c}),f},RiseVision.Spreadsheet.prototype.play=function(){this.isHorizontal()||($(".dataTables_scrollBody").length>0?$(".dataTables_scrollBody").infiniteScroll.start():$("#scrollContainer").length>0&&$("#scrollContainer").infiniteScroll.start()),this.isPaused&&(this.isPaused=!1,this.isHorizontal()&&this.horizontalScroll.tick())},RiseVision.Spreadsheet.prototype.pause=function(){this.isPaused=!0,this.isHorizontal()?this.horizontalScroll.pause():this.isLoading||($(".dataTables_scrollBody").length>0?$(".dataTables_scrollBody").infiniteScroll.pause():$("#scrollContainer").length>0&&$("#scrollContainer").infiniteScroll.pause())};