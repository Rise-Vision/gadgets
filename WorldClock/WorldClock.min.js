var RiseVision=RiseVision||{};RiseVision.WorldClock={};RiseVision.WorldClock.Settings={};RiseVision.WorldClock.Controller={};RiseVision.WorldClock.Settings=function(){this.settings=new RiseVision.Common.Settings};
RiseVision.WorldClock.Settings.prototype.initSettings=function(){var c=this;$(".colorPicker").click(function(){clockSettings.showColorPicker($(this).data("for"))});$(".fontSelector").click(function(){clockSettings.showFontSelector($(this).data("for"))});$("#placement").change(function(){var a=$(this).val();"top"==a||"bottom"==a?($("li.horizontalAlign").show(),$("li.verticalAlign").hide()):($("li.horizontalAlign").hide(),$("li.verticalAlign").show())});$("input:checkbox").change(function(){"useLocalTime"==
$(this).val()?$(this).is(":checked")?$("li.timeZone").hide():$("li.timeZone").show():"showTitle"==$(this).val()?$(this).is(":checked")?$("li.title").show():$("li.title").hide():"showSecondHand"==$(this).val()&&($(this).is(":checked")?$("li.secondHand").show():$("li.secondHand").hide())});$("input[name='clockType']").change(function(){var a=$(this).val();$(this).is(":checked")&&("analog"==a?($("li.analog").show(),$("li.digital").hide()):($("li.analog").hide(),$("li.digital").show()))});gadgets.rpc.call("",
"rscmd_getAdditionalParams",function(a){if(a){var b=new gadgets.Prefs;a=JSON.parse(a);$("#useLocalTime").attr("checked",b.getBool("useLocalTime"));$("#timeZone").val(b.getString("timeZone"));$("#showTitle").attr("checked",b.getBool("showTitle"));$("#title").val(b.getString("title"));$("#placement").val(b.getString("placement"));$("#padding").val(b.getInt("padding"));$("#horizontalAlign").val(b.getString("horizontalAlign"));$("#verticalAlign").val(b.getString("verticalAlign"));$("#frameColor").val(b.getString("frameColor"));
$("#faceColor").val(b.getString("faceColor"));$("#handColor").val(b.getString("handColor"));$("#frameWidth").val(b.getInt("frameWidth"));$("#hourTickWidth").val(b.getInt("hourTickWidth"));$("#minuteTickWidth").val(b.getInt("minuteTickWidth"));$("#handWidth").val(b.getInt("handWidth"));$("#showSecondHand").attr("checked",b.getBool("showSecondHand"));$("#secondHandColor").val(b.getString("secondHandColor"));$("#secondHandWidth").val(b.getInt("secondHandWidth"));$("#format").val(b.getString("format"));
$("#digitalColor").val(b.getString("digitalColor"));$("#bgColor").val(b.getString("bgColor"));$("input[type='radio'][name='clockType']").each(function(){$(this).val()==b.getString("clockType")&&$(this).attr("checked","checked")});$("#title_font-style").text(a.title_font);$("#title_font-style").data("css",a["title_font-style"]);$("#numbers_font-style").text(a.numbers_font);$("#numbers_font-style").data("css",a["numbers_font-style"]);$("#digitalFont").val(a.digitalFont);c.populateColor($("#frameColor"),
b.getString("frameColor"));c.populateColor($("#faceColor"),b.getString("faceColor"));c.populateColor($("#handColor"),b.getString("handColor"));c.populateColor($("#secondHandColor"),b.getString("secondHandColor"));c.populateColor($("#digitalColor"),b.getString("digitalColor"));c.populateColor($("#bgColor"),b.getString("bgColor"))}$("form ol li ol.drillDown li:visible:last").css({clear:"left","float":"left","margin-bottom":"10px"});$("#settings").show();$("input:checkbox").trigger("change");$("input[name='clockType']").trigger("change");
$("#placement").trigger("change")})};RiseVision.WorldClock.Settings.prototype.populateColor=function(c,a){c.val(a);c.css("background-color",a)};RiseVision.WorldClock.Settings.prototype.showColorPicker=function(c){gadgets.rpc.call("","rscmd_openColorPicker",null,c,$("#"+c).val())};RiseVision.WorldClock.Settings.prototype.showFontSelector=function(c){gadgets.rpc.call("","rscmd_openFontSelector",null,c,$("#"+c).data("css"))};
RiseVision.WorldClock.Settings.prototype.setColor=function(c,a){$("#"+c).val(a);$("#"+c).css("background-color",a)};RiseVision.WorldClock.Settings.prototype.setFont=function(c,a,b){$("#"+c).data("css",a);$("#"+c).text(b)};
RiseVision.WorldClock.Settings.prototype.getSettings=function(){var c=!1,a=document.getElementsByClassName("errors")[0],b="",b=null;$(".errors").empty();c=clockSettings.settings.validateNumeric($("#padding"),a,"Padding")?!0:c;c=clockSettings.settings.validateNumeric($("#frameWidth"),a,"Frame Width")?!0:c;c=clockSettings.settings.validateNumeric($("#hourTickWidth"),a,"Hour Tick Width")?!0:c;c=clockSettings.settings.validateNumeric($("#minuteTickWidth"),a,"Minute Tick Width")?!0:c;c=clockSettings.settings.validateNumeric($("#handWidth"),
a,"Hour / Minute Hand Width")?!0:c;if(c=clockSettings.settings.validateNumeric($("#secondHandWidth"),a,"Second Hand Width")?!0:c)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null;b=$("#useLocalTime").is(":checked")?"up_useLocalTime=true":"up_useLocalTime=false";b+="&up_timeZone="+$("#timeZone").val();b+=$("#showTitle").is(":checked")?"&up_showTitle=true":"&up_showTitle=false";b+="&up_title="+$("#title").val()+"&up_placement="+$("#placement").val();b+=""==
$("#padding").val()?"&up_padding=0":"&up_padding= "+$("#padding").val();b+="&up_horizontalAlign="+$("#horizontalAlign").val()+"&up_verticalAlign="+$("#verticalAlign").val();c=$("input[type='radio'][name='clockType']:checked");0<c.length&&(b+="&up_clockType="+c.val());b+="&up_frameColor="+$("#frameColor").val()+"&up_faceColor="+$("#faceColor").val()+"&up_handColor="+$("#handColor").val();b+=$("#showSecondHand").is(":checked")?"&up_showSecondHand=true":"&up_showSecondHand=false";b+="&up_secondHandColor="+
$("#secondHandColor").val()+"&up_frameWidth="+$("#frameWidth").val()+"&up_hourTickWidth="+$("#hourTickWidth").val()+"&up_minuteTickWidth="+$("#minuteTickWidth").val()+"&up_handWidth="+$("#handWidth").val()+"&up_secondHandWidth="+$("#secondHandWidth").val()+"&up_format="+$("#format").val()+"&up_digitalColor="+$("#digitalColor").val()+"&up_bgColor="+$("#bgColor").val();b={params:b,additionalParams:JSON.stringify(clockSettings.saveAdditionalParams())};$(".errors").css({display:"none"});return b};
RiseVision.WorldClock.Settings.prototype.saveAdditionalParams=function(){var c={};c.title_font=$("#title_font-style").text();c["title_font-style"]=$("#title_font-style").data("css");c.numbers_font=$("#numbers_font-style").text();c["numbers_font-style"]=$("#numbers_font-style").data("css");c.digitalFont=$("#digitalFont").val();return c};
RiseVision.WorldClock.Controller=function(){this.rsW=prefs.getInt("rsW");this.rsH=prefs.getInt("rsH");this.useLocalTime=prefs.getBool("useLocalTime");this.timeZone=prefs.getString("timeZone");this.placement=prefs.getString("placement");this.horizontalAlign=prefs.getString("horizontalAlign");this.verticalAlign=prefs.getString("verticalAlign");this.frameColor=prefs.getString("frameColor");this.faceColor=prefs.getString("faceColor");this.handColor=prefs.getString("handColor");this.frameWidth=prefs.getInt("frameWidth");
this.hourTickWidth=prefs.getInt("hourTickWidth");this.minuteTickWidth=prefs.getInt("minuteTickWidth");this.handWidth=prefs.getInt("handWidth");this.showSecondHand=prefs.getBool("showSecondHand");this.secondHandColor=prefs.getString("secondHandColor");this.secondHandWidth=prefs.getInt("secondHandWidth");this.format=prefs.getString("format");this.digitalColor=prefs.getString("digitalColor")};
RiseVision.WorldClock.Controller.prototype.getAdditionalParams=function(c,a){var b;"additionalParams"==c&&a&&(b=document.createElement("style"),a=JSON.parse(a),b.appendChild(document.createTextNode(a["title_font-style"])),b.appendChild(document.createTextNode(a["numbers_font-style"])),document.getElementsByTagName("head")[0].appendChild(b),controller.numbersFont="",b=RiseVision.Common.Utility.parseCSSRule(RiseVision.Common.Utility.getStyle(".numbers_font-style")),null!=b[3]&&"normal"!=b[3]&&(controller.numbersFont+=
b[3]+" "),null!=b[4]&&"normal"!=b[4]&&(controller.numbersFont+=b[4]+" "),controller.numbersFont+=b[2]+" "+b[0],controller.numbersColor=b[1],$("#digitalClock").css("font-family",a.digitalFont));controller.init()};
RiseVision.WorldClock.Controller.prototype.init=function(){var c,a=prefs.getBool("showTitle"),b=$("#analogClock");a&&(c=$("<div id='title' class='title_font-style'></div>"),c.text(prefs.getString("title")),c.addClass(prefs.getString("clockType")+" "+this.placement),"top"==this.placement||"bottom"==this.placement?(c.addClass("halign"+this.horizontalAlign),"top"==this.placement?$("#container").prepend(c):$("#container").append(c)):(c.addClass("valign"+this.verticalAlign),"middle"==this.verticalAlign&&
c.css("line-height",this.rsH-2*prefs.getInt("padding")+"px"),$("#container").prepend(c)));timezoneJS.timezone.zoneFileBasePath="https://s3.amazonaws.com/Common-Production/TimezoneJS/Olson";timezoneJS.timezone.init({async:!1});"analog"==prefs.getString("clockType")?(c=document.getElementById("analogClock"),$("#digitalClock").hide(),a?"top"==this.placement||"bottom"==this.placement?(this.clockSize=this.rsH-$("#title").outerHeight(),this.clockSize>this.rsW&&(this.clockSize=this.rsW),c.width=this.clockSize,
c.height=this.clockSize,$("#container").addClass("haligncenter")):("middle"==this.verticalAlign?(this.clockSize=this.rsW-$("#title").outerWidth(),this.clockSize>this.rsH&&(this.clockSize=this.rsH),b.addClass("valign"),b.css("margin-top",-this.clockSize/2+"px")):(this.clockSize=this.rsH-$("#title").outerHeight(),this.clockSize>this.rsW&&(this.clockSize=this.rsW),$("#container").addClass("haligncenter")),c.width=this.clockSize,c.height=this.clockSize):(this.rsW>this.rsH?(this.clockSize=this.rsH,$("#container").addClass("haligncenter")):
this.rsW<this.rsH?(this.clockSize=this.rsW,b.addClass("valign"),b.css("margin-top",-this.clockSize/2+"px")):this.clockSize=this.rsW,c.width=this.clockSize,c.height=this.clockSize),this.drawAnalog()):(b.hide(),a?"top"==this.placement||"bottom"==this.placement?$("#digitalClock").css("line-height",this.rsH-$("#title").outerHeight()+"px"):$("#digitalClock").css("line-height",this.rsH+"px"):$("#digitalClock").css("line-height",this.rsH+"px"),this.drawDigital(),this.setBodyScale());readyEvent()};
RiseVision.WorldClock.Controller.prototype.drawAnalog=function(){var c=this,a=document.getElementById("analogClock"),b,d,e;if(a.getContext){a=a.getContext("2d");a.clearRect(0,0,this.clockSize,this.clockSize);a.font=this.numbersFont;a.textBaseline="middle";a.textAlign="center";a.lineWidth=1;a.save();a.strokeStyle=this.frameColor;a.fillStyle=this.faceColor;a.lineWidth=this.frameWidth;a.beginPath();a.arc(this.clockSize/2,this.clockSize/2,this.clockSize/2-this.frameWidth/2,0,2*Math.PI,!0);a.fill();a.stroke();
a.strokeStyle=this.numbersColor;a.fillStyle=this.numbersColor;a.save();a.translate(this.clockSize/2,this.clockSize/2);for(d=1;60>=d;d++)ang=Math.PI/30*d,sang=Math.sin(ang),cang=Math.cos(ang),0==d%5?(a.lineWidth=this.hourTickWidth,sx=sang*this.clockSize/2.9,sy=cang*-this.clockSize/2.9,ex=sang*this.clockSize/2.3,ey=cang*-this.clockSize/2.3,nx=sang*this.clockSize/3.55,ny=cang*-this.clockSize/3.55,a.fillText(d/5,nx,ny)):(a.lineWidth=this.minuteTickWidth,sx=sang*this.clockSize/2.5,sy=cang*this.clockSize/
2.5,ex=sang*this.clockSize/2.3,ey=cang*this.clockSize/2.3),a.beginPath(),a.moveTo(sx,sy),a.lineTo(ex,ey),a.stroke();b=this.useLocalTime?new Date:new timezoneJS.Date(new Date,this.timeZone);d=b.getHours();e=b.getMinutes();b=b.getSeconds();a.strokeStyle=this.handColor;a.lineWidth=this.handWidth;a.save();a.rotate(Math.PI/6*(d+e/60+b/3600));a.beginPath();a.moveTo(0,this.clockSize/30);a.lineTo(0,-this.clockSize/5);a.stroke();a.restore();a.save();a.rotate(Math.PI/30*(e+b/60));a.beginPath();a.moveTo(0,this.clockSize/
15);a.lineTo(0,-this.clockSize/2.5);a.stroke();a.restore();a.save();this.showSecondHand&&(a.rotate(Math.PI/30*b),a.strokeStyle=this.secondHandColor,a.lineWidth=this.secondHandWidth,a.beginPath(),a.moveTo(0,this.clockSize/15),a.lineTo(0,-this.clockSize/2.5),a.stroke());a.restore();a.restore();setTimeout(function(){c.drawAnalog()},1E3)}};
RiseVision.WorldClock.Controller.prototype.drawDigital=function(){var c=this,a=" AM",b=this.useLocalTime?new Date:new timezoneJS.Date(new Date,this.timeZone),d=b.getHours(),e=b.getMinutes(),b=b.getSeconds(),f="";12<=d&&(a=" PM");9>=e&&(e="0"+e);9>=b&&(b="0"+b);"12HourSeconds"==this.format||"12Hour"==this.format?(12<d&&(d-=12),0==d&&(d=12),f="12HourSeconds"==this.format?d+":"+e+":"+b+a:d+":"+e+a):f="24HourSeconds"==this.format?d+":"+e+":"+b:d+":"+e;$("#digitalClock").html(f).css("color",this.digitalColor);
setTimeout(function(){c.drawDigital()},1E3)};RiseVision.WorldClock.Controller.prototype.setBodyScale=function(){var c=parseInt($("#digitalClock").css("font-size")),a,b=this.rsH;for(a="left"!=this.placement&&"right"!=this.placement||"middle"!=this.verticalAlign?this.rsW:this.rsW-$("#title").outerWidth();document.getElementById("digitalClock").offsetWidth<a&&document.getElementById("digitalClock").offsetHeight<b;)$("#digitalClock").css("font-size",++c);$("#digitalClock").css("font-size",--c)};
RiseVision.WorldClock.Controller.prototype.play=function(){};RiseVision.WorldClock.Controller.prototype.pause=function(){};